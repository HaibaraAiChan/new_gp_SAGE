main start at this time 1658034979.2508066
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03160548210144043
global_2_local spend time (sec) 0.03665876388549805
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.00621795654296875
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 71198, 1: 13428, 2: 11706, 3: 9277, 4: 7320, 5: 6222, 6: 4868, 7: 4045, 8: 3472, 9: 2976, 10: 2599, 11: 2203, 12: 1937, 13: 1656, 14: 1434, 15: 1289, 16: 1111, 17: 1030, 18: 948, 19: 836, 20: 807, 21: 717, 22: 556, 24: 525, 23: 519, 25: 483, 26: 409, 27: 390, 28: 370, 29: 329, 31: 300, 32: 273, 30: 261, 33: 261, 34: 231, 36: 226, 400: 207, 35: 200, 39: 200, 37: 196, 38: 186, 41: 167, 42: 165, 40: 161, 45: 142, 43: 138, 44: 135, 48: 112, 46: 106, 47: 105, 51: 104, 49: 91, 55: 90, 50: 89, 52: 81, 53: 79, 54: 78, 58: 73, 56: 71, 61: 69, 67: 68, 57: 68, 72: 63, 60: 63, 62: 62, 59: 55, 65: 54, 63: 52, 66: 51, 64: 49, 69: 47, 70: 44, 71: 43, 68: 42, 77: 40, 86: 39, 87: 38, 74: 36, 75: 35, 82: 35, 81: 35, 84: 33, 73: 32, 80: 31, 76: 31, 105: 30, 94: 29, 98: 29, 83: 29, 95: 27, 112: 27, 79: 27, 85: 27, 91: 27, 99: 26, 88: 25, 111: 25, 92: 24, 101: 24, 89: 24, 90: 23, 93: 22, 78: 22, 97: 21, 96: 20, 103: 20, 109: 20, 122: 20, 117: 19, 104: 18, 113: 18, 123: 18, 100: 18, 106: 17, 108: 17, 133: 17, 107: 17, 130: 16, 116: 16, 102: 16, 115: 14, 125: 14, 128: 14, 127: 13, 134: 13, 161: 13, 153: 13, 118: 13, 136: 13, 120: 12, 121: 12, 146: 12, 124: 12, 114: 12, 145: 11, 151: 11, 140: 11, 157: 11, 155: 11, 166: 11, 110: 10, 170: 10, 150: 10, 132: 9, 135: 9, 129: 9, 141: 9, 209: 9, 119: 9, 152: 8, 181: 8, 143: 8, 126: 8, 156: 8, 162: 8, 137: 8, 200: 8, 165: 8, 149: 7, 211: 7, 186: 7, 148: 7, 241: 7, 182: 7, 154: 7, 172: 7, 199: 6, 210: 6, 216: 6, 168: 6, 252: 6, 144: 6, 197: 6, 269: 6, 159: 6, 139: 6, 178: 6, 194: 6, 167: 6, 171: 5, 131: 5, 237: 5, 176: 5, 185: 5, 142: 5, 147: 5, 203: 5, 177: 5, 300: 5, 160: 5, 205: 5, 173: 5, 270: 5, 195: 5, 138: 4, 179: 4, 217: 4, 275: 4, 190: 4, 212: 4, 222: 4, 285: 4, 218: 4, 183: 4, 175: 4, 198: 4, 349: 4, 261: 4, 277: 4, 163: 4, 251: 4, 264: 4, 164: 4, 231: 4, 297: 3, 343: 3, 192: 3, 333: 3, 208: 3, 196: 3, 253: 3, 254: 3, 191: 3, 391: 3, 260: 3, 335: 3, 278: 3, 263: 3, 281: 3, 174: 3, 234: 3, 158: 3, 202: 3, 248: 3, 187: 3, 223: 3, 219: 3, 319: 3, 246: 3, 232: 3, 215: 3, 224: 3, 235: 3, 221: 3, 368: 3, 282: 3, 291: 3, 312: 3, 370: 3, 204: 3, 302: 2, 169: 2, 201: 2, 332: 2, 244: 2, 193: 2, 379: 2, 363: 2, 207: 2, 310: 2, 296: 2, 225: 2, 184: 2, 284: 2, 268: 2, 213: 2, 279: 2, 188: 2, 378: 2, 311: 2, 247: 2, 355: 2, 180: 2, 265: 2, 267: 2, 318: 2, 256: 2, 280: 2, 390: 2, 243: 2, 262: 2, 245: 2, 325: 2, 276: 2, 189: 2, 233: 2, 287: 2, 229: 2, 214: 2, 356: 2, 250: 2, 380: 2, 308: 2, 238: 2, 344: 2, 317: 2, 226: 2, 328: 2, 365: 2, 342: 2, 236: 2, 387: 1, 377: 1, 294: 1, 338: 1, 327: 1, 374: 1, 239: 1, 383: 1, 348: 1, 381: 1, 345: 1, 331: 1, 354: 1, 388: 1, 373: 1, 249: 1, 273: 1, 272: 1, 307: 1, 386: 1, 367: 1, 320: 1, 329: 1, 288: 1, 395: 1, 350: 1, 382: 1, 357: 1, 371: 1, 255: 1, 321: 1, 337: 1, 316: 1, 375: 1, 358: 1, 372: 1, 336: 1, 286: 1, 298: 1, 240: 1, 323: 1, 361: 1, 274: 1, 305: 1, 304: 1, 230: 1, 227: 1, 351: 1, 259: 1, 341: 1, 346: 1, 334: 1, 366: 1, 376: 1, 257: 1, 389: 1, 283: 1, 369: 1, 362: 1, 258: 1})

A = g.adjacency_matrix() spent  0.021603822708129883
auxiliary_graph
Graph(num_nodes=162139, num_edges=45620847,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.08238339424133301
remove nodes length  71198

auxiliary_graph.remove_nodes spent  2.215411901473999
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=45620847,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  2.0328524112701416

the counter of shared neighbor distribution
Counter({1.0: 32539430, 2.0: 7985430, 3.0: 2702326, 4.0: 1057896, 5.0: 481946, 6.0: 248934, 7.0: 143530, 8.0: 90224, 9.0: 60628, 10.0: 42058, 11.0: 30948, 12.0: 23240, 13.0: 17936, 14.0: 14618, 15.0: 11868, 16.0: 9478, 17.0: 7914, 18.0: 6612, 19.0: 5536, 20.0: 4780, 21.0: 4152, 22.0: 3530, 23.0: 3156, 24.0: 2812, 25.0: 2430, 26.0: 2160, 27.0: 1986, 28.0: 1824, 29.0: 1594, 30.0: 1448, 31.0: 1374, 32.0: 1188, 33.0: 1174, 35.0: 970, 34.0: 970, 36.0: 872, 38.0: 744, 39.0: 740, 37.0: 716, 40.0: 642, 41.0: 544, 42.0: 528, 43.0: 514, 44.0: 504, 45.0: 442, 46.0: 420, 47.0: 384, 48.0: 360, 49.0: 332, 50.0: 284, 52.0: 276, 51.0: 252, 56.0: 250, 53.0: 244, 58.0: 234, 54.0: 228, 55.0: 228, 60.0: 180, 59.0: 178, 61.0: 164, 57.0: 162, 62.0: 142, 65.0: 136, 63.0: 134, 66.0: 130, 64.0: 128, 67.0: 120, 68.0: 110, 75.0: 94, 70.0: 92, 77.0: 92, 69.0: 90, 81.0: 90, 71.0: 86, 73.0: 84, 78.0: 84, 74.0: 80, 72.0: 78, 79.0: 66, 76.0: 66, 88.0: 62, 84.0: 58, 86.0: 54, 91.0: 52, 82.0: 52, 85.0: 52, 80.0: 52, 83.0: 50, 94.0: 46, 93.0: 46, 90.0: 44, 97.0: 42, 95.0: 38, 89.0: 38, 99.0: 34, 92.0: 34, 98.0: 30, 101.0: 30, 109.0: 28, 106.0: 28, 87.0: 26, 102.0: 26, 115.0: 26, 103.0: 26, 108.0: 24, 110.0: 24, 96.0: 22, 105.0: 20, 113.0: 20, 100.0: 20, 112.0: 20, 114.0: 20, 117.0: 14, 104.0: 14, 111.0: 14, 125.0: 14, 116.0: 14, 120.0: 12, 119.0: 12, 127.0: 12, 121.0: 12, 139.0: 12, 107.0: 12, 130.0: 10, 144.0: 10, 136.0: 10, 140.0: 10, 149.0: 8, 123.0: 8, 129.0: 8, 147.0: 8, 131.0: 8, 154.0: 6, 155.0: 6, 126.0: 6, 122.0: 6, 164.0: 6, 148.0: 4, 118.0: 4, 133.0: 4, 142.0: 4, 134.0: 4, 151.0: 4, 128.0: 4, 141.0: 4, 159.0: 4, 177.0: 4, 156.0: 4, 146.0: 4, 181.0: 2, 152.0: 2, 124.0: 2, 160.0: 2, 150.0: 2, 170.0: 2, 135.0: 2, 192.0: 2, 137.0: 2, 171.0: 2, 222.0: 2, 163.0: 2, 138.0: 2, 186.0: 2, 165.0: 2, 196.0: 2, 185.0: 2, 189.0: 2, 169.0: 2})
45529906
Convert a graph into a bidirected graph: 2.048 seconds
Metis partitioning: 7.040 seconds
Split the graph: 7.876 seconds
Construct subgraphs: 0.077 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  17.062768697738647
45272
45669
total k batches seeds list generation spend  28.053962469100952
after graph partition
graph partition algorithm spend time 28.21696448326111
45272
45669
partition_len_list
[109403, 69592]
REG selection method  spend 28.304723024368286
time for parepare:  0.0176546573638916
local_output_nid generation:  0.0043637752532958984
local_in_edges_tensor generation:  0.010174036026000977
mini_batch_src_global generation:  0.028118610382080078
r_  generation:  0.24295973777770996
local_output_nid generation:  0.005896806716918945
local_in_edges_tensor generation:  0.009875774383544922
mini_batch_src_global generation:  0.018025636672973633
r_  generation:  0.1649162769317627
----------------------check_connections_block total spend ----------------------------- 0.5965869426727295
generate_one_block  0.3466782569885254
generate_one_block  0.20352959632873535
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

connection checking time:  0.5965869426727295
block generation total time  0.5502078533172607
average batch blocks generation time:  0.27510392665863037
block dataloader generation time/epoch 29.552613496780396
pseudo mini batch 0 input nodes size: 109403
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.0701904296875 GB
    Memory Allocated: 0.05277252197265625  GigaBytes
Max Memory Allocated: 0.05277252197265625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.0701904296875 GB
    Memory Allocated: 0.05311012268066406  GigaBytes
Max Memory Allocated: 0.05311012268066406  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.0701904296875 GB
    Memory Allocated: 0.05311012268066406  GigaBytes
Max Memory Allocated: 0.05311012268066406  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.1541748046875 GB
    Memory Allocated: 0.058917999267578125  GigaBytes
Max Memory Allocated: 0.058917999267578125  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1541748046875 GB
    Memory Allocated: 0.058917999267578125  GigaBytes
Max Memory Allocated: 0.058917999267578125  GigaBytes

----------------input nodes number: 109403
----------------output nodes number: 45272
----------------edges number: 779441
----------------------------------------before mean aggregator
 Nvidia-smi: 1.1541748046875 GB
    Memory Allocated: 0.06007099151611328  GigaBytes
Max Memory Allocated: 0.06297492980957031  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.09438133239746094  GigaBytes
Max Memory Allocated: 0.1093912124633789  GigaBytes

h_neigh size torch.Size([45272, 40])
torch.Size([45272, 40])
torch.Size([45272, 40])
----------------------------------------after rst
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.10112762451171875  GigaBytes
Max Memory Allocated: 0.1093912124633789  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.09438133239746094  GigaBytes
Max Memory Allocated: 0.1093912124633789  GigaBytes

torch.Size([45272, 40])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.10112762451171875  GigaBytes
Max Memory Allocated: 0.1093912124633789  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.10787487030029297  GigaBytes
Max Memory Allocated: 0.1093912124633789  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.07283306121826172  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

pseudo mini batch 1 input nodes size: 69592
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.05989551544189453  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.4158935546875 GB
    Memory Allocated: 0.05989551544189453  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.09309864044189453  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.09343910217285156  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04036712646484375  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04326820373535156  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04326820373535156  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------input nodes number: 69592
----------------output nodes number: 45669
----------------edges number: 389278
----------------------------------------before mean aggregator
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.044127464294433594  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.07599115371704102  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

h_neigh size torch.Size([45669, 40])
torch.Size([45669, 40])
torch.Size([45669, 40])
----------------------------------------after rst
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.08279657363891602  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.07599115371704102  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

torch.Size([45669, 40])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.0760502815246582  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.0828561782836914  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04746818542480469  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04754447937011719  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 1.4490966796875 GB
    Memory Allocated: 0.04754447937011719  GigaBytes
Max Memory Allocated: 0.1213674545288086  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.028438329696655273 |0.1769118309020996 |0.3870866298675537 |0.0002728700637817383 |0.0022176504135131836 |0.001461029052734375 |
----------------------------------------------------------pseudo_mini_loss sum 3.856752395629883
Total (block generation + training)time/epoch 30.75140953063965
Training time/epoch 1.1982214450836182
Training time without block to device /epoch 0.844397783279419
Training time without total dataloading part /epoch 0.7806153297424316
load block tensor time/epoch 0.05687665939331055
block to device time/epoch 0.3538236618041992
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  178995
Number of first layer input nodes during this epoch:  178995
Number of first layer output nodes during this epoch:  90941
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=128, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=40, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  10240
trainable parameters
layers.0.fc_self.weight, torch.Size([40, 128])
layers.0.fc_neigh.weight, torch.Size([40, 128])
----------------------------------------
un-trainable parameters
