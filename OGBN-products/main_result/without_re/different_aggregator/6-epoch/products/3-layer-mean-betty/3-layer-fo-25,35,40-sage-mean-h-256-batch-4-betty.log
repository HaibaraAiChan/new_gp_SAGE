main start at this time 1656620039.898522
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3372187614440918
global_2_local spend time (sec) 0.5007944107055664
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.08104181289672852
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181132, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12072491645812988
auxiliary_graph
Graph(num_nodes=1377703, num_edges=101856625,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.636073112487793
remove nodes length  1181132

auxiliary_graph.remove_nodes spent  5.228306293487549
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101856625,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.457820177078247

the counter of shared neighbor distribution
Counter({1.0: 76591578, 2.0: 14049546, 3.0: 5010892, 4.0: 2311722, 5.0: 1250786, 6.0: 739600, 7.0: 472478, 8.0: 320570, 9.0: 222488, 10.0: 161872, 11.0: 120832, 12.0: 90056, 13.0: 69248, 14.0: 53652, 15.0: 42676, 16.0: 31336, 17.0: 22028, 18.0: 19462, 19.0: 13316, 20.0: 10776, 21.0: 7196, 22.0: 5792, 23.0: 4758, 24.0: 3924, 25.0: 3444, 33.0: 2970, 28.0: 2904, 26.0: 2622, 30.0: 2388, 27.0: 2258, 32.0: 2096, 31.0: 2082, 39.0: 2070, 35.0: 1734, 29.0: 1726, 37.0: 1702, 36.0: 1500, 34.0: 1446, 38.0: 1436, 40.0: 1092})
101660054
Convert a graph into a bidirected graph: 6.470 seconds
Metis partitioning: 23.056 seconds
Split the graph: 5.692 seconds
Construct subgraphs: 0.606 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  35.86338949203491
50416
47807
47876
50472
total k batches seeds list generation spend  64.47907090187073
after graph partition
graph partition algorithm spend time 65.58215928077698
50416
47807
47876
50472
partition_len_list
[401488, 367398, 457711, 444128]
REG selection method  spend 66.31300497055054
time for parepare:  0.28058290481567383
local_output_nid generation:  0.008589506149291992
local_in_edges_tensor generation:  0.019220352172851562
mini_batch_src_global generation:  0.06864380836486816
r_  generation:  0.7629363536834717
local_output_nid generation:  0.011374473571777344
local_in_edges_tensor generation:  0.06556987762451172
mini_batch_src_global generation:  0.08607196807861328
r_  generation:  0.7728526592254639
local_output_nid generation:  0.01289820671081543
local_in_edges_tensor generation:  0.06377887725830078
mini_batch_src_global generation:  0.06624984741210938
r_  generation:  0.7010281085968018
local_output_nid generation:  0.010111331939697266
local_in_edges_tensor generation:  0.03525876998901367
mini_batch_src_global generation:  0.07705950736999512
r_  generation:  0.8556029796600342
----------------------check_connections_block total spend ----------------------------- 4.497494697570801
generate_one_block  2.517155885696411
generate_one_block  0.8682105541229248
generate_one_block  0.886810302734375
generate_one_block  1.096160650253296
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.231809616088867
gen group dst list time:  0.04806971549987793
time for parepare:  0.44747138023376465
local_output_nid generation:  0.08369088172912598
local_in_edges_tensor generation:  0.4072279930114746
mini_batch_src_global generation:  0.4099736213684082
r_  generation:  4.53071141242981
local_output_nid generation:  0.09978961944580078
local_in_edges_tensor generation:  0.28373241424560547
mini_batch_src_global generation:  0.47317957878112793
r_  generation:  3.870281934738159
local_output_nid generation:  0.14384961128234863
local_in_edges_tensor generation:  0.4012422561645508
mini_batch_src_global generation:  0.5283389091491699
r_  generation:  5.6428282260894775
local_output_nid generation:  0.1371297836303711
local_in_edges_tensor generation:  0.5060827732086182
mini_batch_src_global generation:  0.6017913818359375
r_  generation:  5.58807373046875
----------------------check_connections_block total spend ----------------------------- 27.702641487121582
generate_one_block  6.705544710159302
generate_one_block  5.307684421539307
generate_one_block  7.171216011047363
generate_one_block  7.068519115447998
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2291126251220703
gen group dst list time:  0.15172314643859863
time for parepare:  0.47716593742370605
local_output_nid generation:  0.2971501350402832
local_in_edges_tensor generation:  0.7776947021484375
mini_batch_src_global generation:  0.7359669208526611
r_  generation:  9.142855644226074
local_output_nid generation:  0.28122496604919434
local_in_edges_tensor generation:  0.5821402072906494
mini_batch_src_global generation:  0.8224480152130127
r_  generation:  8.18317174911499
local_output_nid generation:  0.3777029514312744
local_in_edges_tensor generation:  0.9858920574188232
mini_batch_src_global generation:  1.0577521324157715
r_  generation:  12.159016609191895
local_output_nid generation:  0.36653995513916016
local_in_edges_tensor generation:  0.6702926158905029
mini_batch_src_global generation:  0.992241382598877
r_  generation:  10.087345600128174
----------------------check_connections_block total spend ----------------------------- 55.0077006816864
generate_one_block  12.603447437286377
generate_one_block  10.63881540298462
generate_one_block  15.347553014755249
generate_one_block  12.959831476211548
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

connection checking time:  87.20783686637878
block generation total time  83.17094898223877
average batch blocks generation time:  6.930912415186564
block dataloader generation time/epoch 247.9630732536316
pseudo mini batch 0 input nodes size: 1884138
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.7205810546875 GB
    Memory Allocated: 0.702664852142334  GigaBytes
Max Memory Allocated: 0.702664852142334  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.7205810546875 GB
    Memory Allocated: 0.703040599822998  GigaBytes
Max Memory Allocated: 0.703040599822998  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.7205810546875 GB
    Memory Allocated: 0.703040599822998  GigaBytes
Max Memory Allocated: 0.703040599822998  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.0623779296875 GB
    Memory Allocated: 0.9732251167297363  GigaBytes
Max Memory Allocated: 0.9732251167297363  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.0623779296875 GB
    Memory Allocated: 0.9732251167297363  GigaBytes
Max Memory Allocated: 0.9732251167297363  GigaBytes

first layer input nodes number: 1884138
first layer output nodes number: 1065680
edges number: 22279860
torch.Size([1884138, 100])
torch.Size([1065680, 256])
input nodes number: 1065680
output nodes number: 401488
edges number: 12005313
torch.Size([1065680, 256])
torch.Size([401488, 256])
torch.Size([50416, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.1092529296875 GB
    Memory Allocated: 5.277833461761475  GigaBytes
Max Memory Allocated: 5.580268383026123  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.1092529296875 GB
    Memory Allocated: 5.2866621017456055  GigaBytes
Max Memory Allocated: 5.580268383026123  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 1.4020228385925293  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

pseudo mini batch 1 input nodes size: 1834787
----------------------------------------before load block subtensor 
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 0.7126379013061523  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 0.7126379013061523  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 1.3961496353149414  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 1.3965058326721191  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 0.6942338943481445  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 0.9267663955688477  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 0.9267663955688477  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

first layer input nodes number: 1834787
first layer output nodes number: 999235
edges number: 19598937
torch.Size([1834787, 100])
torch.Size([999235, 256])
input nodes number: 999235
output nodes number: 367398
edges number: 9816523
torch.Size([999235, 256])
torch.Size([367398, 256])
torch.Size([47807, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 4.907673358917236  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 10.9158935546875 GB
    Memory Allocated: 4.91604471206665  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 1.2888460159301758  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

pseudo mini batch 2 input nodes size: 1994641
----------------------------------------before load block subtensor 
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 0.6937770843505859  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 0.6937770843505859  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 1.4368391036987305  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 1.4371962547302246  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 0.7533283233642578  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 1.0810861587524414  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 11.8690185546875 GB
    Memory Allocated: 1.0810861587524414  GigaBytes
Max Memory Allocated: 6.1181535720825195  GigaBytes

first layer input nodes number: 1994641
first layer output nodes number: 1361773
edges number: 28661299
torch.Size([1994641, 100])
torch.Size([1361773, 256])
input nodes number: 1361773
output nodes number: 457711
edges number: 13603125
torch.Size([1361773, 256])
torch.Size([457711, 256])
torch.Size([47876, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 15.8748779296875 GB
    Memory Allocated: 6.360676288604736  GigaBytes
Max Memory Allocated: 6.729910850524902  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 15.8748779296875 GB
    Memory Allocated: 6.3690595626831055  GigaBytes
Max Memory Allocated: 6.729910850524902  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 1.5788097381591797  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

pseudo mini batch 3 input nodes size: 1801512
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 0.7533402442932129  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 0.7533402442932129  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 1.4244561195373535  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 1.4248323440551758  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 0.6814131736755371  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 0.9747147560119629  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 0.9747147560119629  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 1801512
first layer output nodes number: 1084015
edges number: 23465954
torch.Size([1801512, 100])
torch.Size([1084015, 256])
input nodes number: 1084015
output nodes number: 444128
edges number: 13803028
torch.Size([1084015, 256])
torch.Size([444128, 256])
torch.Size([50472, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 5.47212028503418  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 5.481623649597168  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4549560546875 GB
    Memory Allocated: 1.4302101135253906  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4317474365234375  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4317474365234375  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.3066856265068054 |0.38726550340652466 |0.2666778564453125 |0.00017952919006347656 |0.05065375566482544 |0.0024149417877197266 |
----------------------------------------------------------pseudo_mini_loss sum 7.172252655029297
Total (block generation + training)time/epoch 252.18990969657898
Training time/epoch 4.226422548294067
Training time without block to device /epoch 2.6773605346679688
Training time without total dataloading part /epoch 1.2724595069885254
load block tensor time/epoch 1.2267425060272217
block to device time/epoch 1.5490620136260986
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  13696506
Number of first layer input nodes during this epoch:  7515078
Number of first layer output nodes during this epoch:  4510703
----------------------------------------before generate dataloader block 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4317469596862793  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.4352869987487793
global_2_local spend time (sec) 0.5459766387939453
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.03591132164001465
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181573, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12058854103088379
auxiliary_graph
Graph(num_nodes=1378144, num_edges=101440449,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6234908103942871
remove nodes length  1181573

auxiliary_graph.remove_nodes spent  5.305198431015015
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101440449,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.2733166217803955

the counter of shared neighbor distribution
Counter({1.0: 76262470, 2.0: 13999502, 3.0: 4993082, 4.0: 2303996, 5.0: 1242502, 6.0: 739396, 7.0: 471654, 8.0: 318818, 9.0: 223652, 10.0: 162218, 11.0: 119508, 12.0: 90236, 13.0: 68272, 14.0: 52940, 15.0: 42884, 16.0: 30994, 17.0: 22020, 18.0: 20014, 19.0: 13430, 20.0: 10922, 21.0: 7462, 22.0: 5748, 23.0: 4694, 24.0: 3946, 25.0: 3448, 33.0: 2964, 28.0: 2830, 26.0: 2556, 30.0: 2394, 27.0: 2196, 32.0: 2176, 31.0: 2104, 39.0: 2086, 29.0: 1842, 35.0: 1724, 37.0: 1628, 36.0: 1536, 38.0: 1480, 34.0: 1476, 40.0: 1078})
101243878
Convert a graph into a bidirected graph: 6.884 seconds
Metis partitioning: 23.936 seconds
Split the graph: 6.927 seconds
Construct subgraphs: 0.012 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  37.79860472679138
50535
47709
50581
47746
total k batches seeds list generation spend  66.7071886062622
after graph partition
graph partition algorithm spend time 67.85368752479553
50535
47709
50581
47746
partition_len_list
[393927, 401312, 467880, 458387]
REG selection method  spend 68.69867372512817
time for parepare:  0.29689693450927734
local_output_nid generation:  0.009778261184692383
local_in_edges_tensor generation:  0.017179012298583984
mini_batch_src_global generation:  0.06846976280212402
r_  generation:  0.756406307220459
local_output_nid generation:  0.012962102890014648
local_in_edges_tensor generation:  0.03155779838562012
mini_batch_src_global generation:  0.07899236679077148
r_  generation:  0.6942286491394043
local_output_nid generation:  0.010202884674072266
local_in_edges_tensor generation:  0.03262042999267578
mini_batch_src_global generation:  0.07590794563293457
r_  generation:  0.8502039909362793
local_output_nid generation:  0.009661436080932617
local_in_edges_tensor generation:  0.021012306213378906
mini_batch_src_global generation:  0.07202363014221191
r_  generation:  0.7410905361175537
----------------------check_connections_block total spend ----------------------------- 4.33797550201416
generate_one_block  1.3227953910827637
generate_one_block  0.9428942203521729
generate_one_block  1.096207857131958
generate_one_block  0.9048199653625488
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.395939826965332
gen group dst list time:  0.06691670417785645
time for parepare:  0.44840097427368164
local_output_nid generation:  0.10710501670837402
local_in_edges_tensor generation:  0.36131882667541504
mini_batch_src_global generation:  0.34909605979919434
r_  generation:  4.1120734214782715
local_output_nid generation:  0.10359454154968262
local_in_edges_tensor generation:  0.5536048412322998
mini_batch_src_global generation:  0.4892234802246094
r_  generation:  4.865258455276489
local_output_nid generation:  0.14966773986816406
local_in_edges_tensor generation:  0.45876574516296387
mini_batch_src_global generation:  0.5761523246765137
r_  generation:  5.872852087020874
local_output_nid generation:  0.12032604217529297
local_in_edges_tensor generation:  0.3434138298034668
mini_batch_src_global generation:  0.60951828956604
r_  generation:  5.9725425243377686
----------------------check_connections_block total spend ----------------------------- 29.179015398025513
generate_one_block  6.0401387214660645
generate_one_block  6.2768800258636475
generate_one_block  7.537933588027954
generate_one_block  7.81646203994751
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.3648715019226074
gen group dst list time:  0.18090152740478516
time for parepare:  0.47852253913879395
local_output_nid generation:  0.30684351921081543
local_in_edges_tensor generation:  0.7891695499420166
mini_batch_src_global generation:  0.7105021476745605
r_  generation:  9.039934396743774
local_output_nid generation:  0.3552389144897461
local_in_edges_tensor generation:  0.9054033756256104
mini_batch_src_global generation:  0.9859437942504883
r_  generation:  10.298500061035156
local_output_nid generation:  0.38808107376098633
local_in_edges_tensor generation:  0.6994926929473877
mini_batch_src_global generation:  1.023625135421753
r_  generation:  10.392282247543335
local_output_nid generation:  0.3941488265991211
local_in_edges_tensor generation:  1.1186046600341797
mini_batch_src_global generation:  1.2059612274169922
r_  generation:  11.914507389068604
----------------------check_connections_block total spend ----------------------------- 58.57230615615845
generate_one_block  12.421671390533447
generate_one_block  13.288323879241943
generate_one_block  13.28228759765625
generate_one_block  15.274219512939453
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4317469596862793  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

connection checking time:  92.08929705619812
block generation total time  86.20463418960571
average batch blocks generation time:  7.183719515800476
block dataloader generation time/epoch 253.49259209632874
pseudo mini batch 0 input nodes size: 1860586
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.6834039688110352  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.6834039688110352  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.3765263557434082  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.3769030570983887  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7054109573364258  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.9577627182006836  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.9577627182006836  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 1860586
first layer output nodes number: 1082234
edges number: 21440361
torch.Size([1860586, 100])
torch.Size([1082234, 256])
input nodes number: 1082234
output nodes number: 393927
edges number: 10529740
torch.Size([1082234, 256])
torch.Size([393927, 256])
torch.Size([50535, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.25432825088501  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.263177394866943  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.3474798202514648  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

pseudo mini batch 1 input nodes size: 1972849
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7054228782653809  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7054228782653809  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4403667449951172  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4407224655151367  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7472233772277832  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0323691368103027  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0323691368103027  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 1972849
first layer output nodes number: 1166621
edges number: 24400935
torch.Size([1972849, 100])
torch.Size([1166621, 256])
input nodes number: 1166621
output nodes number: 401312
edges number: 11958579
torch.Size([1166621, 256])
torch.Size([401312, 256])
torch.Size([47709, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.5957770347595215  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.60413122177124  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4667658805847168  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

pseudo mini batch 2 input nodes size: 1776385
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7467288970947266  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7467288970947266  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4084839820861816  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4088611602783203  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.6735615730285645  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.9743061065673828  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.9743061065673828  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 1776385
first layer output nodes number: 1091715
edges number: 23634466
torch.Size([1776385, 100])
torch.Size([1091715, 256])
input nodes number: 1091715
output nodes number: 467880
edges number: 14685137
torch.Size([1091715, 256])
torch.Size([467880, 256])
torch.Size([50581, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.5735368728637695  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 5.582393646240234  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.445375919342041  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

pseudo mini batch 3 input nodes size: 1933279
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.6740641593933105  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.6740641593933105  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.3942670822143555  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.3946232795715332  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7324910163879395  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0552029609680176  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0552029609680176  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 1933279
first layer output nodes number: 1320199
edges number: 27844387
torch.Size([1933279, 100])
torch.Size([1320199, 256])
input nodes number: 1320199
output nodes number: 458387
edges number: 13746738
torch.Size([1320199, 256])
torch.Size([458387, 256])
torch.Size([47746, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 6.223353385925293  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 6.231713771820068  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.544339656829834  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.544339656829834  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.544339656829834  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.34489572048187256 |0.2935771942138672 |0.0789002776145935 |0.00018101930618286133 |0.0052645206451416016 |0.0015976428985595703 |
----------------------------------------------------------pseudo_mini_loss sum 12.461153030395508
Total (block generation + training)time/epoch 257.1519248485565
Training time/epoch 3.0915005207061768
Training time without block to device /epoch 1.917191743850708
Training time without total dataloading part /epoch 0.33898091316223145
load block tensor time/epoch 1.3795828819274902
block to device time/epoch 1.1743087768554688
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  13925374
Number of first layer input nodes during this epoch:  7543099
Number of first layer output nodes during this epoch:  4660769
----------------------------------------before generate dataloader block 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.5443391799926758  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.4320518970489502
global_2_local spend time (sec) 0.5754539966583252
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.05554485321044922
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181078, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.13724899291992188
auxiliary_graph
Graph(num_nodes=1377649, num_edges=101592085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6535179615020752
remove nodes length  1181078

auxiliary_graph.remove_nodes spent  5.659106731414795
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101592085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.29016375541687

the counter of shared neighbor distribution
Counter({1.0: 76339074, 2.0: 14045470, 3.0: 5010672, 4.0: 2310438, 5.0: 1250692, 6.0: 739836, 7.0: 471014, 8.0: 320252, 9.0: 222946, 10.0: 161434, 11.0: 118206, 12.0: 90108, 13.0: 68208, 14.0: 53080, 15.0: 42064, 16.0: 31386, 17.0: 22226, 18.0: 19100, 19.0: 13390, 20.0: 10732, 21.0: 7146, 22.0: 5532, 23.0: 4856, 24.0: 3998, 25.0: 3558, 33.0: 3082, 28.0: 2884, 26.0: 2734, 30.0: 2352, 27.0: 2180, 39.0: 2092, 31.0: 2088, 32.0: 2088, 29.0: 1736, 35.0: 1716, 37.0: 1686, 36.0: 1476, 38.0: 1450, 34.0: 1444, 40.0: 1088})
101395514
Convert a graph into a bidirected graph: 6.734 seconds
Metis partitioning: 24.964 seconds
Split the graph: 6.434 seconds
Construct subgraphs: 0.029 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  38.20029377937317
47746
49785
49584
49456
total k batches seeds list generation spend  67.75999712944031
after graph partition
graph partition algorithm spend time 68.87890005111694
47746
49785
49584
49456
partition_len_list
[461268, 443036, 370687, 401970]
REG selection method  spend 69.72699069976807
time for parepare:  0.2731192111968994
local_output_nid generation:  0.008459806442260742
local_in_edges_tensor generation:  0.015308618545532227
mini_batch_src_global generation:  0.06527543067932129
r_  generation:  0.6365432739257812
local_output_nid generation:  0.009972095489501953
local_in_edges_tensor generation:  0.01661396026611328
mini_batch_src_global generation:  0.08178997039794922
r_  generation:  0.7747313976287842
local_output_nid generation:  0.009957075119018555
local_in_edges_tensor generation:  0.01721668243408203
mini_batch_src_global generation:  0.0700371265411377
r_  generation:  0.757457971572876
local_output_nid generation:  0.01148676872253418
local_in_edges_tensor generation:  0.03126358985900879
mini_batch_src_global generation:  0.08363509178161621
r_  generation:  0.8180298805236816
----------------------check_connections_block total spend ----------------------------- 4.248316049575806
generate_one_block  1.3527274131774902
generate_one_block  1.0345120429992676
generate_one_block  1.1483180522918701
generate_one_block  1.0373194217681885
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.4273722171783447
gen group dst list time:  0.052239418029785156
time for parepare:  0.4583923816680908
local_output_nid generation:  0.11077499389648438
local_in_edges_tensor generation:  0.4184701442718506
mini_batch_src_global generation:  0.45435094833374023
r_  generation:  5.2504637241363525
local_output_nid generation:  0.10343003273010254
local_in_edges_tensor generation:  0.313124418258667
mini_batch_src_global generation:  0.5675790309906006
r_  generation:  5.481565713882446
local_output_nid generation:  0.08782100677490234
local_in_edges_tensor generation:  0.3363673686981201
mini_batch_src_global generation:  0.47820448875427246
r_  generation:  4.005512952804565
local_output_nid generation:  0.12001180648803711
local_in_edges_tensor generation:  0.32338619232177734
mini_batch_src_global generation:  0.4784371852874756
r_  generation:  4.818235158920288
----------------------check_connections_block total spend ----------------------------- 27.38724637031555
generate_one_block  7.7623560428619385
generate_one_block  7.51328182220459
generate_one_block  5.527019739151001
generate_one_block  6.158127069473267
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2993717193603516
gen group dst list time:  0.17071533203125
time for parepare:  0.4321136474609375
local_output_nid generation:  0.40302324295043945
local_in_edges_tensor generation:  1.0274500846862793
mini_batch_src_global generation:  0.9887816905975342
r_  generation:  12.852699041366577
local_output_nid generation:  0.37285923957824707
local_in_edges_tensor generation:  0.8389034271240234
mini_batch_src_global generation:  1.0413312911987305
r_  generation:  9.884765148162842
local_output_nid generation:  0.3250904083251953
local_in_edges_tensor generation:  0.6229124069213867
mini_batch_src_global generation:  0.8540053367614746
r_  generation:  8.692524194717407
local_output_nid generation:  0.3419044017791748
local_in_edges_tensor generation:  0.9698359966278076
mini_batch_src_global generation:  0.9519538879394531
r_  generation:  9.805563926696777
----------------------check_connections_block total spend ----------------------------- 57.726115226745605
generate_one_block  16.181042194366455
generate_one_block  12.668593168258667
generate_one_block  10.891489028930664
generate_one_block  12.707303762435913
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.5443391799926758  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

connection checking time:  89.36167764663696
block generation total time  83.98208975791931
average batch blocks generation time:  6.99850747982661
block dataloader generation time/epoch 254.0097013314565
pseudo mini batch 0 input nodes size: 2004216
----------------------------------------before load block subtensor 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7319936752319336  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7319936752319336  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4786224365234375  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.4789786338806152  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 0.7584195137023926  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0904507637023926  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.4569091796875 GB
    Memory Allocated: 1.0904507637023926  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

first layer input nodes number: 2004216
first layer output nodes number: 1382390
edges number: 29047475
torch.Size([2004216, 100])
torch.Size([1382390, 256])
input nodes number: 1382390
output nodes number: 461268
edges number: 13698520
torch.Size([1382390, 256])
torch.Size([461268, 256])
torch.Size([47746, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4197998046875 GB
    Memory Allocated: 6.435835361480713  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4197998046875 GB
    Memory Allocated: 6.444742679595947  GigaBytes
Max Memory Allocated: 7.606095314025879  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.590813159942627  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 1 input nodes size: 1774091
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.758420467376709  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.758420467376709  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.419321060180664  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.419692039489746  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6727070808410645  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.963712215423584  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.963712215423584  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1774091
first layer output nodes number: 1071589
edges number: 23248697
torch.Size([1774091, 100])
torch.Size([1071589, 256])
input nodes number: 1071589
output nodes number: 443036
edges number: 13849386
torch.Size([1071589, 256])
torch.Size([443036, 256])
torch.Size([49785, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.423483371734619  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.432200908660889  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.417642593383789  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 2 input nodes size: 1825305
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6730642318725586  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6730642318725586  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.353043556213379  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3534131050109863  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6921415328979492  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9264774322509766  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9264774322509766  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1825305
first layer output nodes number: 1005142
edges number: 19717561
torch.Size([1825305, 100])
torch.Size([1005142, 256])
input nodes number: 1005142
output nodes number: 370687
edges number: 9869786
torch.Size([1005142, 256])
torch.Size([370687, 256])
torch.Size([49584, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 4.935845851898193  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 4.944528102874756  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.290696144104004  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 3 input nodes size: 1900660
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6921062469482422  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6921062469482422  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4001574516296387  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4005260467529297  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.720177173614502  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.992103099822998  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.992103099822998  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1900660
first layer output nodes number: 1080342
edges number: 22549870
torch.Size([1900660, 100])
torch.Size([1080342, 256])
input nodes number: 1080342
output nodes number: 401970
edges number: 12010057
torch.Size([1080342, 256])
torch.Size([401970, 256])
torch.Size([49456, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.327541351318359  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.336201190948486  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4126081466674805  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4126081466674805  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4126081466674805  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.2996111512184143 |0.2654818892478943 |0.07771068811416626 |0.00018841028213500977 |0.04305189847946167 |0.0015399456024169922 |
----------------------------------------------------------pseudo_mini_loss sum 3.632035255432129
Total (block generation + training)time/epoch 257.42379093170166
Training time/epoch 2.9233596324920654
Training time without block to device /epoch 1.8614320755004883
Training time without total dataloading part /epoch 0.48534393310546875
load block tensor time/epoch 1.1984446048736572
block to device time/epoch 1.0619275569915771
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  13720696
Number of first layer input nodes during this epoch:  7504272
Number of first layer output nodes during this epoch:  4539463
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4126076698303223  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.34998250007629395
global_2_local spend time (sec) 0.5886149406433105
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.03931570053100586
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181035, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12644433975219727
auxiliary_graph
Graph(num_nodes=1377606, num_edges=101674287,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6451597213745117
remove nodes length  1181035

auxiliary_graph.remove_nodes spent  5.396657466888428
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101674287,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.281336784362793

the counter of shared neighbor distribution
Counter({1.0: 76438302, 2.0: 14044614, 3.0: 5010044, 4.0: 2306628, 5.0: 1243674, 6.0: 737406, 7.0: 470430, 8.0: 317834, 9.0: 224420, 10.0: 161934, 11.0: 118450, 12.0: 89198, 13.0: 68550, 14.0: 52286, 15.0: 42424, 16.0: 31166, 17.0: 21944, 18.0: 19188, 19.0: 13520, 20.0: 10676, 21.0: 6852, 22.0: 5766, 23.0: 4726, 24.0: 4066, 25.0: 3670, 33.0: 2968, 28.0: 2830, 26.0: 2596, 30.0: 2356, 27.0: 2246, 31.0: 2206, 39.0: 2084, 32.0: 2044, 35.0: 1740, 29.0: 1672, 37.0: 1660, 36.0: 1542, 34.0: 1470, 38.0: 1456, 40.0: 1078})
101477716
Convert a graph into a bidirected graph: 6.773 seconds
Metis partitioning: 24.922 seconds
Split the graph: 6.802 seconds
Construct subgraphs: 0.021 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  38.55823230743408
47782
48248
50351
50190
total k batches seeds list generation spend  68.0502302646637
after graph partition
graph partition algorithm spend time 69.1653778553009
47782
48248
50351
50190
partition_len_list
[458834, 421187, 401164, 389639]
REG selection method  spend 70.0624668598175
time for parepare:  0.28625917434692383
local_output_nid generation:  0.008820295333862305
local_in_edges_tensor generation:  0.025788307189941406
mini_batch_src_global generation:  0.05957674980163574
r_  generation:  0.636676549911499
local_output_nid generation:  0.010018110275268555
local_in_edges_tensor generation:  0.020551204681396484
mini_batch_src_global generation:  0.10445666313171387
r_  generation:  0.7931809425354004
local_output_nid generation:  0.013352155685424805
local_in_edges_tensor generation:  0.022460460662841797
mini_batch_src_global generation:  0.08993339538574219
r_  generation:  0.7794456481933594
local_output_nid generation:  0.01006317138671875
local_in_edges_tensor generation:  0.017652273178100586
mini_batch_src_global generation:  0.07736063003540039
r_  generation:  0.7846651077270508
----------------------check_connections_block total spend ----------------------------- 4.30363655090332
generate_one_block  1.2877795696258545
generate_one_block  0.9624507427215576
generate_one_block  0.9203734397888184
generate_one_block  0.8939132690429688
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.324582576751709
gen group dst list time:  0.05405712127685547
time for parepare:  0.4945707321166992
local_output_nid generation:  0.10984182357788086
local_in_edges_tensor generation:  0.45267486572265625
mini_batch_src_global generation:  0.47972726821899414
r_  generation:  5.771651268005371
local_output_nid generation:  0.1451404094696045
local_in_edges_tensor generation:  0.45692896842956543
mini_batch_src_global generation:  0.5988965034484863
r_  generation:  5.754603385925293
local_output_nid generation:  0.12227725982666016
local_in_edges_tensor generation:  0.4636268615722656
mini_batch_src_global generation:  0.5229275226593018
r_  generation:  4.934945344924927
local_output_nid generation:  0.10809636116027832
local_in_edges_tensor generation:  0.27568721771240234
mini_batch_src_global generation:  0.4494779109954834
r_  generation:  4.620485067367554
----------------------check_connections_block total spend ----------------------------- 29.387333631515503
generate_one_block  7.744830131530762
generate_one_block  6.720611095428467
generate_one_block  6.169278144836426
generate_one_block  5.383492946624756
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2704098224639893
gen group dst list time:  0.17511725425720215
time for parepare:  0.431459903717041
local_output_nid generation:  0.3949716091156006
local_in_edges_tensor generation:  0.9954102039337158
mini_batch_src_global generation:  0.9927988052368164
r_  generation:  13.058184146881104
local_output_nid generation:  0.34040117263793945
local_in_edges_tensor generation:  0.6501796245574951
mini_batch_src_global generation:  1.0082635879516602
r_  generation:  9.94938325881958
local_output_nid generation:  0.3485996723175049
local_in_edges_tensor generation:  0.6477081775665283
mini_batch_src_global generation:  0.9269545078277588
r_  generation:  10.173904418945312
local_output_nid generation:  0.3307168483734131
local_in_edges_tensor generation:  0.7625823020935059
mini_batch_src_global generation:  0.9033997058868408
r_  generation:  9.664086818695068
----------------------check_connections_block total spend ----------------------------- 58.786187171936035
generate_one_block  16.00686001777649
generate_one_block  12.287121295928955
generate_one_block  12.703926086425781
generate_one_block  11.60977029800415
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4126076698303223  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

connection checking time:  92.47715735435486
block generation total time  82.69040703773499
average batch blocks generation time:  6.890867253144582
block dataloader generation time/epoch 254.77214968204498
pseudo mini batch 0 input nodes size: 1983493
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.72015380859375  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.72015380859375  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4590625762939453  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.459418773651123  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7509989738464355  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.079291820526123  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.079291820526123  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1983493
first layer output nodes number: 1357070
edges number: 28647860
torch.Size([1983493, 100])
torch.Size([1357070, 256])
input nodes number: 1357070
output nodes number: 458834
edges number: 13695233
torch.Size([1357070, 256])
torch.Size([458834, 256])
torch.Size([47782, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.350822925567627  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.359189987182617  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.5777530670166016  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 1 input nodes size: 1783916
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.750706672668457  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.750706672668457  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4152674674987793  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4156270027160645  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6763620376586914  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9578332901000977  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9578332901000977  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1783916
first layer output nodes number: 1048055
edges number: 22767845
torch.Size([1783916, 100])
torch.Size([1048055, 256])
input nodes number: 1048055
output nodes number: 421187
edges number: 13110603
torch.Size([1048055, 256])
torch.Size([421187, 256])
torch.Size([48248, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.279019355773926  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.287467956542969  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3960647583007812  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 2 input nodes size: 1879491
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6764440536499023  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6764440536499023  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3766093254089355  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3769845962524414  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.712064266204834  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9824843406677246  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9824843406677246  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1879491
first layer output nodes number: 1063345
edges number: 22232042
torch.Size([1879491, 100])
torch.Size([1063345, 256])
input nodes number: 1063345
output nodes number: 401164
edges number: 11999309
torch.Size([1063345, 256])
torch.Size([401164, 256])
torch.Size([50351, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.271546363830566  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.280363082885742  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4015250205993652  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 3 input nodes size: 1892894
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7124323844909668  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7124323844909668  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.417590618133545  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4179649353027344  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7174243927001953  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9649906158447266  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9649906158447266  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1892894
first layer output nodes number: 1065849
edges number: 20925583
torch.Size([1892894, 100])
torch.Size([1065849, 256])
input nodes number: 1065849
output nodes number: 389639
edges number: 10415209
torch.Size([1065849, 256])
torch.Size([389639, 256])
torch.Size([50190, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.2018585205078125  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.210647106170654  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.349466323852539  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.349466323852539  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.349466323852539  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.34857505559921265 |0.35022711753845215 |0.07671153545379639 |0.00016629695892333984 |0.004850268363952637 |0.0033178329467773438 |
----------------------------------------------------------pseudo_mini_loss sum 4.487428665161133
Total (block generation + training)time/epoch 258.1553063392639
Training time/epoch 3.29012131690979
Training time without block to device /epoch 1.8892128467559814
Training time without total dataloading part /epoch 0.3302302360534668
load block tensor time/epoch 1.3943002223968506
block to device time/epoch 1.4009084701538086
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 3 |
Number of nodes for computation during this epoch:  13744937
Number of first layer input nodes during this epoch:  7539794
Number of first layer output nodes during this epoch:  4534319
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3494658470153809  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.41008687019348145
global_2_local spend time (sec) 0.5655624866485596
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.059358835220336914
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180944, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12060689926147461
auxiliary_graph
Graph(num_nodes=1377515, num_edges=101823085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6738464832305908
remove nodes length  1180944

auxiliary_graph.remove_nodes spent  5.34513521194458
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101823085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.28303861618042

the counter of shared neighbor distribution
Counter({1.0: 76547122, 2.0: 14056272, 3.0: 5017922, 4.0: 2311666, 5.0: 1247774, 6.0: 739896, 7.0: 471840, 8.0: 321294, 9.0: 224538, 10.0: 162872, 11.0: 119210, 12.0: 90016, 13.0: 68792, 14.0: 52750, 15.0: 42010, 16.0: 30888, 17.0: 21954, 18.0: 19466, 19.0: 13842, 20.0: 10936, 21.0: 7212, 22.0: 5854, 23.0: 4770, 24.0: 4078, 25.0: 3548, 33.0: 2986, 28.0: 2878, 26.0: 2574, 30.0: 2376, 27.0: 2218, 31.0: 2152, 39.0: 2088, 32.0: 2030, 29.0: 1774, 35.0: 1730, 37.0: 1692, 36.0: 1502, 38.0: 1458, 34.0: 1450, 40.0: 1084})
101626514
Convert a graph into a bidirected graph: 6.736 seconds
Metis partitioning: 25.058 seconds
Split the graph: 6.565 seconds
Construct subgraphs: 0.028 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  38.42700910568237
48485
49708
50619
47759
total k batches seeds list generation spend  67.50370621681213
after graph partition
graph partition algorithm spend time 68.65456247329712
48485
49708
50619
47759
partition_len_list
[373355, 396975, 447194, 447073]
REG selection method  spend 69.50412583351135
time for parepare:  0.27965807914733887
local_output_nid generation:  0.009002208709716797
local_in_edges_tensor generation:  0.05169939994812012
mini_batch_src_global generation:  0.09181594848632812
r_  generation:  0.6570403575897217
local_output_nid generation:  0.010200738906860352
local_in_edges_tensor generation:  0.0172884464263916
mini_batch_src_global generation:  0.07877588272094727
r_  generation:  0.7749149799346924
local_output_nid generation:  0.015011787414550781
local_in_edges_tensor generation:  0.024549484252929688
mini_batch_src_global generation:  0.08796405792236328
r_  generation:  0.8015618324279785
local_output_nid generation:  0.009841203689575195
local_in_edges_tensor generation:  0.015720605850219727
mini_batch_src_global generation:  0.07765483856201172
r_  generation:  0.7303764820098877
----------------------check_connections_block total spend ----------------------------- 4.292774438858032
generate_one_block  1.2561001777648926
generate_one_block  0.9858965873718262
generate_one_block  1.0338752269744873
generate_one_block  0.8790109157562256
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.3717989921569824
gen group dst list time:  0.049310922622680664
time for parepare:  0.4486687183380127
local_output_nid generation:  0.08492565155029297
local_in_edges_tensor generation:  0.3544182777404785
mini_batch_src_global generation:  0.34111738204956055
r_  generation:  3.7776832580566406
local_output_nid generation:  0.11161375045776367
local_in_edges_tensor generation:  0.2758293151855469
mini_batch_src_global generation:  0.48574328422546387
r_  generation:  4.633086442947388
local_output_nid generation:  0.11469054222106934
local_in_edges_tensor generation:  0.4144773483276367
mini_batch_src_global generation:  0.5934395790100098
r_  generation:  5.678719520568848
local_output_nid generation:  0.14913439750671387
local_in_edges_tensor generation:  0.43364667892456055
mini_batch_src_global generation:  0.5647523403167725
r_  generation:  5.317399263381958
----------------------check_connections_block total spend ----------------------------- 27.345920085906982
generate_one_block  5.702972650527954
generate_one_block  6.528135776519775
generate_one_block  7.1535420417785645
generate_one_block  6.848092317581177
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.280198335647583
gen group dst list time:  0.16842985153198242
time for parepare:  0.4595024585723877
local_output_nid generation:  0.3003206253051758
local_in_edges_tensor generation:  0.7386152744293213
mini_batch_src_global generation:  0.669574499130249
r_  generation:  8.430366516113281
local_output_nid generation:  0.3209545612335205
local_in_edges_tensor generation:  0.8888847827911377
mini_batch_src_global generation:  0.971970796585083
r_  generation:  9.517992973327637
local_output_nid generation:  0.3626894950866699
local_in_edges_tensor generation:  0.6440255641937256
mini_batch_src_global generation:  0.920623779296875
r_  generation:  10.06683087348938
local_output_nid generation:  0.3879721164703369
local_in_edges_tensor generation:  0.872687816619873
mini_batch_src_global generation:  1.1740829944610596
r_  generation:  11.917634963989258
----------------------check_connections_block total spend ----------------------------- 55.960124492645264
generate_one_block  11.689438581466675
generate_one_block  12.498784303665161
generate_one_block  12.940420866012573
generate_one_block  15.39268970489502
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3494658470153809  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

connection checking time:  87.59881901741028
block generation total time  82.90895915031433
average batch blocks generation time:  6.909079929192861
block dataloader generation time/epoch 254.20387177467347
pseudo mini batch 0 input nodes size: 1867047
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7173953056335449  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7173953056335449  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4129247665405273  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4132862091064453  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7077536582946777  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9475159645080566  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9475159645080566  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1867047
first layer output nodes number: 1030887
edges number: 20299334
torch.Size([1867047, 100])
torch.Size([1030887, 256])
input nodes number: 1030887
output nodes number: 373355
edges number: 9951251
torch.Size([1030887, 256])
torch.Size([373355, 256])
torch.Size([48485, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.035073757171631  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.043564319610596  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3180599212646484  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 1 input nodes size: 1889971
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.707456111907959  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.707456111907959  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4115252494812012  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.411895751953125  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7160048484802246  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9889864921569824  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9889864921569824  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1889971
first layer output nodes number: 1082446
edges number: 22682622
torch.Size([1889971, 100])
torch.Size([1082446, 256])
input nodes number: 1082446
output nodes number: 396975
edges number: 11852714
torch.Size([1082446, 256])
torch.Size([396975, 256])
torch.Size([49708, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.314751148223877  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.323455333709717  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4083538055419922  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 2 input nodes size: 1787594
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7162189483642578  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7162189483642578  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3821496963500977  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3825268745422363  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6780872344970703  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9712734222412109  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9712734222412109  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1787594
first layer output nodes number: 1074294
edges number: 23292421
torch.Size([1787594, 100])
torch.Size([1074294, 256])
input nodes number: 1074294
output nodes number: 447194
edges number: 13961021
torch.Size([1074294, 256])
torch.Size([447194, 256])
torch.Size([50619, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.4535369873046875  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.463046550750732  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4278264045715332  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 3 input nodes size: 1966611
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6782464981079102  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6782464981079102  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4108662605285645  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4112224578857422  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7449145317077637  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.0638208389282227  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.0638208389282227  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1966611
first layer output nodes number: 1317945
edges number: 27792524
torch.Size([1966611, 100])
torch.Size([1317945, 256])
input nodes number: 1317945
output nodes number: 447073
edges number: 13248630
torch.Size([1317945, 256])
torch.Size([447073, 256])
torch.Size([47759, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.187833309173584  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.19619607925415  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.545832633972168  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.545832633972168  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.545832633972168  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.3457934260368347 |0.304121196269989 |0.0769539475440979 |0.00018423795700073242 |0.00529325008392334 |0.001611948013305664 |
----------------------------------------------------------pseudo_mini_loss sum 3.3646910190582275
Total (block generation + training)time/epoch 257.5351101875305
Training time/epoch 3.1232378482818604
Training time without block to device /epoch 1.9067530632019043
Training time without total dataloading part /epoch 0.33133769035339355
load block tensor time/epoch 1.3831737041473389
block to device time/epoch 1.216484785079956
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 4 |
Number of nodes for computation during this epoch:  13681392
Number of first layer input nodes during this epoch:  7511223
Number of first layer output nodes during this epoch:  4505572
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.5458321571350098  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3374314308166504
global_2_local spend time (sec) 0.5603196620941162
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.035607337951660156
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180968, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12883949279785156
auxiliary_graph
Graph(num_nodes=1377539, num_edges=101778399,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.630021333694458
remove nodes length  1180968

auxiliary_graph.remove_nodes spent  5.339538335800171
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101778399,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.237311363220215

the counter of shared neighbor distribution
Counter({1.0: 76534596, 2.0: 14039790, 3.0: 5006502, 4.0: 2312414, 5.0: 1247454, 6.0: 739086, 7.0: 470314, 8.0: 321348, 9.0: 224020, 10.0: 161382, 11.0: 118914, 12.0: 90378, 13.0: 69162, 14.0: 52818, 15.0: 41862, 16.0: 30822, 17.0: 21642, 18.0: 19400, 19.0: 13432, 20.0: 10984, 21.0: 7158, 22.0: 5670, 23.0: 5046, 24.0: 4118, 25.0: 3436, 28.0: 2922, 33.0: 2914, 26.0: 2610, 30.0: 2360, 27.0: 2328, 32.0: 2094, 39.0: 2088, 31.0: 2076, 29.0: 1772, 35.0: 1676, 37.0: 1662, 36.0: 1516, 34.0: 1496, 38.0: 1486, 40.0: 1080})
101581828
Convert a graph into a bidirected graph: 6.783 seconds
Metis partitioning: 25.686 seconds
Split the graph: 6.102 seconds
Construct subgraphs: 0.020 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  38.631322622299194
47772
50090
48712
49997
total k batches seeds list generation spend  67.59420228004456
after graph partition
graph partition algorithm spend time 68.74390578269958
47772
50090
48712
49997
partition_len_list
[394707, 418045, 452709, 432536]
REG selection method  spend 69.59388518333435
time for parepare:  0.27215003967285156
local_output_nid generation:  0.008728504180908203
local_in_edges_tensor generation:  0.015715837478637695
mini_batch_src_global generation:  0.09420490264892578
r_  generation:  0.6660799980163574
local_output_nid generation:  0.013459444046020508
local_in_edges_tensor generation:  0.01699995994567871
mini_batch_src_global generation:  0.07768750190734863
r_  generation:  0.7749202251434326
local_output_nid generation:  0.010187149047851562
local_in_edges_tensor generation:  0.016047239303588867
mini_batch_src_global generation:  0.06943440437316895
r_  generation:  0.7056496143341064
local_output_nid generation:  0.010291099548339844
local_in_edges_tensor generation:  0.02340841293334961
mini_batch_src_global generation:  0.09233403205871582
r_  generation:  0.8584303855895996
----------------------check_connections_block total spend ----------------------------- 4.288511276245117
generate_one_block  1.2568726539611816
generate_one_block  1.033271074295044
generate_one_block  0.9219119548797607
generate_one_block  1.0823516845703125
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2219419479370117
gen group dst list time:  0.0640265941619873
time for parepare:  0.44679713249206543
local_output_nid generation:  0.10183525085449219
local_in_edges_tensor generation:  0.38730359077453613
mini_batch_src_global generation:  0.369753360748291
r_  generation:  4.105396032333374
local_output_nid generation:  0.10966706275939941
local_in_edges_tensor generation:  0.2892777919769287
mini_batch_src_global generation:  0.5019731521606445
r_  generation:  4.7538745403289795
local_output_nid generation:  0.12078380584716797
local_in_edges_tensor generation:  0.3147768974304199
mini_batch_src_global generation:  0.5532286167144775
r_  generation:  5.337303161621094
local_output_nid generation:  0.1015312671661377
local_in_edges_tensor generation:  0.37827515602111816
mini_batch_src_global generation:  0.5765984058380127
r_  generation:  5.562947034835815
----------------------check_connections_block total spend ----------------------------- 27.628429651260376
generate_one_block  6.235295057296753
generate_one_block  6.318304538726807
generate_one_block  7.073326349258423
generate_one_block  7.051875114440918
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.352208137512207
gen group dst list time:  0.17354679107666016
time for parepare:  0.44115447998046875
local_output_nid generation:  0.3380415439605713
local_in_edges_tensor generation:  0.8238725662231445
mini_batch_src_global generation:  0.7265102863311768
r_  generation:  9.040222883224487
local_output_nid generation:  0.347398042678833
local_in_edges_tensor generation:  0.7166562080383301
mini_batch_src_global generation:  0.9600980281829834
r_  generation:  10.111980676651001
local_output_nid generation:  0.40297532081604004
local_in_edges_tensor generation:  0.8394370079040527
mini_batch_src_global generation:  1.0756425857543945
r_  generation:  11.917036056518555
local_output_nid generation:  0.32768702507019043
local_in_edges_tensor generation:  0.6815047264099121
mini_batch_src_global generation:  1.0098466873168945
r_  generation:  10.027390480041504
----------------------check_connections_block total spend ----------------------------- 57.03356742858887
generate_one_block  12.45819354057312
generate_one_block  12.71208143234253
generate_one_block  15.58472466468811
generate_one_block  12.343688011169434
----------===============-------------===============-------------the number of batches *****---- 4

original number of batches:  4
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.5458321571350098  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

connection checking time:  88.95050835609436
block generation total time  84.07189607620239
average batch blocks generation time:  7.005991339683533
block dataloader generation time/epoch 254.23844186464945
pseudo mini batch 0 input nodes size: 1912918
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.744412899017334  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.744412899017334  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4570307731628418  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4573869705200195  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7244110107421875  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9855422973632812  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9855422973632812  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1912918
first layer output nodes number: 1119714
edges number: 22163413
torch.Size([1912918, 100])
torch.Size([1119714, 256])
input nodes number: 1119714
output nodes number: 394707
edges number: 11104429
torch.Size([1119714, 256])
torch.Size([394707, 256])
torch.Size([47772, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.387264728546143  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.395630359649658  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.3901925086975098  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 1 input nodes size: 1900070
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7244143486022949  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7244143486022949  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4322457313537598  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4326190948486328  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7196450233459473  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9984993934631348  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9984993934631348  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1900070
first layer output nodes number: 1139431
edges number: 23368770
torch.Size([1900070, 100])
torch.Size([1139431, 256])
input nodes number: 1139431
output nodes number: 418045
edges number: 12134603
torch.Size([1139431, 256])
torch.Size([418045, 256])
torch.Size([50090, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.541415214538574  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.5501861572265625  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4300689697265625  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 2 input nodes size: 1986707
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7200508117675781  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7200508117675781  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4601569175720215  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4605202674865723  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7523155212402344  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.0725822448730469  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.0725822448730469  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1986707
first layer output nodes number: 1331094
edges number: 27895441
torch.Size([1986707, 100])
torch.Size([1331094, 256])
input nodes number: 1331094
output nodes number: 452709
edges number: 13331527
torch.Size([1331094, 256])
torch.Size([452709, 256])
torch.Size([48712, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.251478672027588  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 6.260008335113525  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.5584654808044434  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

pseudo mini batch 3 input nodes size: 1803060
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7520742416381836  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.7520742416381836  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4237666130065918  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4241394996643066  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.6836700439453125  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9719505310058594  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 0.9719505310058594  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

first layer input nodes number: 1803060
first layer output nodes number: 1069796
edges number: 23241154
torch.Size([1803060, 100])
torch.Size([1069796, 256])
input nodes number: 1069796
output nodes number: 432536
edges number: 13482808
torch.Size([1069796, 256])
torch.Size([432536, 256])
torch.Size([49997, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.39302396774292  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 5.401778697967529  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4217991828918457  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4217991828918457  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.7576904296875 GB
    Memory Allocated: 1.4217991828918457  GigaBytes
Max Memory Allocated: 7.7088189125061035  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.33933526277542114 |0.3556877374649048 |0.07842057943344116 |0.00018525123596191406 |0.004789113998413086 |0.004256486892700195 |
----------------------------------------------------------pseudo_mini_loss sum 2.202695846557617
Total (block generation + training)time/epoch 257.5646390914917
Training time/epoch 3.3007311820983887
Training time without block to device /epoch 1.8779802322387695
Training time without total dataloading part /epoch 0.33783626556396484
load block tensor time/epoch 1.3573410511016846
block to device time/epoch 1.4227509498596191
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 5 |
Number of nodes for computation during this epoch:  13960787
Number of first layer input nodes during this epoch:  7602755
Number of first layer output nodes during this epoch:  4660035
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=100, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=256, bias=False)
    )
    (2): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  206336
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 100])
layers.0.fc_neigh.weight, torch.Size([256, 100])
layers.1.fc_self.weight, torch.Size([256, 256])
layers.1.fc_neigh.weight, torch.Size([256, 256])
layers.2.fc_self.weight, torch.Size([47, 256])
layers.2.fc_neigh.weight, torch.Size([47, 256])
----------------------------------------
un-trainable parameters
