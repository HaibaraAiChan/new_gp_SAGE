main start at this time 1656967439.4378836
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.4476613998413086
global_2_local spend time (sec) 0.4562501907348633
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 1.566 seconds
Metis partitioning: 2.019 seconds
Split the graph: 1.163 seconds
Construct subgraphs: 0.103 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  4.891875505447388
after graph partition
graph partition algorithm spend time 6.238686800003052
95696
100875
partition_len_list
[1086182, 1110249]
metis selection method  spend 6.953421115875244
time for parepare:  0.29427504539489746
local_output_nid generation:  0.013421058654785156
local_in_edges_tensor generation:  0.1194295883178711
mini_batch_src_global generation:  0.10751032829284668
r_  generation:  1.8024280071258545
local_output_nid generation:  0.016481876373291016
local_in_edges_tensor generation:  0.07117295265197754
mini_batch_src_global generation:  0.15831995010375977
r_  generation:  2.0688674449920654
----------------------check_connections_block total spend ----------------------------- 5.325499773025513
generate_one_block  3.8970203399658203
generate_one_block  2.4345571994781494
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2941038608551025
gen group dst list time:  0.059597015380859375
time for parepare:  0.4186415672302246
local_output_nid generation:  0.23882150650024414
local_in_edges_tensor generation:  0.8881800174713135
mini_batch_src_global generation:  1.0031161308288574
r_  generation:  14.327367305755615
local_output_nid generation:  0.28593921661376953
local_in_edges_tensor generation:  0.7662720680236816
mini_batch_src_global generation:  1.3290784358978271
r_  generation:  14.809328317642212
----------------------check_connections_block total spend ----------------------------- 38.75394940376282
generate_one_block  18.948926210403442
generate_one_block  19.21782612800598
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2169291973114014
gen group dst list time:  0.15671038627624512
time for parepare:  0.4862339496612549
local_output_nid generation:  0.5579378604888916
local_in_edges_tensor generation:  1.2111845016479492
mini_batch_src_global generation:  1.2342133522033691
r_  generation:  18.700419664382935
local_output_nid generation:  0.5647785663604736
local_in_edges_tensor generation:  1.178992748260498
mini_batch_src_global generation:  1.6022062301635742
r_  generation:  18.793339252471924
----------------------check_connections_block total spend ----------------------------- 50.59347701072693
generate_one_block  23.4649441242218
generate_one_block  23.522650241851807
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

connection checking time:  94.67292618751526
block generation total time  91.485924243927
average batch blocks generation time:  15.247654040654501
block dataloader generation time/epoch 205.36822319030762
pseudo mini batch 0 input nodes size: 2250206
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.8572998046875 GB
    Memory Allocated: 0.8390359878540039  GigaBytes
Max Memory Allocated: 0.8390359878540039  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.8572998046875 GB
    Memory Allocated: 0.8397493362426758  GigaBytes
Max Memory Allocated: 0.8397493362426758  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.8572998046875 GB
    Memory Allocated: 0.8397493362426758  GigaBytes
Max Memory Allocated: 0.8397493362426758  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.4920654296875 GB
    Memory Allocated: 1.4076528549194336  GigaBytes
Max Memory Allocated: 1.4076528549194336  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.4920654296875 GB
    Memory Allocated: 1.4076528549194336  GigaBytes
Max Memory Allocated: 1.4076528549194336  GigaBytes

first layer input nodes number: 2250206
first layer output nodes number: 2037659
edges number: 39644447
torch.Size([2250206, 100])
torch.Size([2037659, 256])
input nodes number: 2037659
output nodes number: 1086182
edges number: 32706781
torch.Size([2037659, 256])
torch.Size([1086182, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 15.6678466796875 GB
    Memory Allocated: 10.672276973724365  GigaBytes
Max Memory Allocated: 11.555096626281738  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 15.6678466796875 GB
    Memory Allocated: 10.689117908477783  GigaBytes
Max Memory Allocated: 11.555096626281738  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 2.3445467948913574  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

pseudo mini batch 1 input nodes size: 2249699
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 0.8572745323181152  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 0.8572745323181152  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 1.6953530311584473  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 1.6961050033569336  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 0.8571243286132812  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 1.4304828643798828  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.6287841796875 GB
    Memory Allocated: 1.4304828643798828  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

first layer input nodes number: 2249699
first layer output nodes number: 2044571
edges number: 39695326
torch.Size([2249699, 100])
torch.Size([2044571, 256])
input nodes number: 2044571
output nodes number: 1110249
edges number: 33296175
torch.Size([2044571, 256])
torch.Size([1110249, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 18.4979248046875 GB
    Memory Allocated: 10.780764102935791  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 18.4979248046875 GB
    Memory Allocated: 10.798427104949951  GigaBytes
Max Memory Allocated: 12.666722297668457  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.360635757446289  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.362173080444336  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.362173080444336  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.3683481216430664 |0.8573310375213623 |0.6594265699386597 |0.00026106834411621094 |0.24630475044250488 |0.003545999526977539 |
----------------------------------------------------------pseudo_mini_loss sum 7.141941070556641
Total (block generation + training)time/epoch 209.80052089691162
Training time/epoch 4.431942462921143
Training time without block to device /epoch 2.717280387878418
Training time without total dataloading part /epoch 1.815530776977539
load block tensor time/epoch 0.7366962432861328
block to device time/epoch 1.7146620750427246
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  10778566
Number of first layer input nodes during this epoch:  4499905
Number of first layer output nodes during this epoch:  4082230
----------------------------------------before generate dataloader block 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.3621726036071777  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.5226726531982422
global_2_local spend time (sec) 0.47485780715942383
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 0.495 seconds
Metis partitioning: 2.202 seconds
Split the graph: 1.210 seconds
Construct subgraphs: 0.024 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  3.987023115158081
after graph partition
graph partition algorithm spend time 5.444102764129639
95696
100875
partition_len_list
[1086559, 1110358]
metis selection method  spend 6.218667984008789
time for parepare:  0.28398919105529785
local_output_nid generation:  0.013263225555419922
local_in_edges_tensor generation:  0.06658482551574707
mini_batch_src_global generation:  0.11680746078491211
r_  generation:  1.8708100318908691
local_output_nid generation:  0.0151214599609375
local_in_edges_tensor generation:  0.06357288360595703
mini_batch_src_global generation:  0.15935039520263672
r_  generation:  2.0414955615997314
----------------------check_connections_block total spend ----------------------------- 5.315516233444214
generate_one_block  2.7591519355773926
generate_one_block  2.488903045654297
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2843804359436035
gen group dst list time:  0.06513047218322754
time for parepare:  0.4463076591491699
local_output_nid generation:  0.2771759033203125
local_in_edges_tensor generation:  0.8327727317810059
mini_batch_src_global generation:  1.0170679092407227
r_  generation:  14.51201581954956
local_output_nid generation:  0.29953455924987793
local_in_edges_tensor generation:  0.8928265571594238
mini_batch_src_global generation:  1.3895301818847656
r_  generation:  14.769476890563965
----------------------check_connections_block total spend ----------------------------- 39.2958984375
generate_one_block  18.91002082824707
generate_one_block  18.894559621810913
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2100601196289062
gen group dst list time:  0.1647646427154541
time for parepare:  0.5061626434326172
local_output_nid generation:  0.5381579399108887
local_in_edges_tensor generation:  1.4392929077148438
mini_batch_src_global generation:  1.2755827903747559
r_  generation:  18.763787269592285
local_output_nid generation:  0.585059404373169
local_in_edges_tensor generation:  1.2284390926361084
mini_batch_src_global generation:  1.6093473434448242
r_  generation:  19.021872758865356
----------------------check_connections_block total spend ----------------------------- 51.081716537475586
generate_one_block  23.724688053131104
generate_one_block  23.599875688552856
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.3621726036071777  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

connection checking time:  95.6931312084198
block generation total time  90.37719917297363
average batch blocks generation time:  15.06286652882894
block dataloader generation time/epoch 205.08082461357117
pseudo mini batch 0 input nodes size: 2250254
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8595676422119141  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8595676422119141  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.697852611541748  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.69856595993042  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8597354888916016  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.4271373748779297  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.4271373748779297  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

first layer input nodes number: 2250254
first layer output nodes number: 2038674
edges number: 39657573
torch.Size([2250254, 100])
torch.Size([2038674, 256])
input nodes number: 2038674
output nodes number: 1086559
edges number: 32692205
torch.Size([2038674, 256])
torch.Size([1086559, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 10.675062656402588  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 10.691819190979004  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 2.3430986404418945  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

pseudo mini batch 1 input nodes size: 2248547
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8588294982910156  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8588294982910156  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.6964788436889648  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.6972308158874512  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 0.8582324981689453  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.4317340850830078  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5174560546875 GB
    Memory Allocated: 1.4317340850830078  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

first layer input nodes number: 2248547
first layer output nodes number: 2043252
edges number: 39672795
torch.Size([2248547, 100])
torch.Size([2043252, 256])
input nodes number: 2043252
output nodes number: 1110358
edges number: 33314752
torch.Size([2043252, 256])
torch.Size([1110358, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 10.77847671508789  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 10.79613971710205  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3614706993103027  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3614706993103027  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3614706993103027  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.49963903427124023 |0.699000358581543 |0.14357924461364746 |0.00023484230041503906 |0.0052073001861572266 |0.0013611316680908203 |
----------------------------------------------------------pseudo_mini_loss sum 12.500889778137207
Total (block generation + training)time/epoch 208.8516081571579
Training time/epoch 3.108994722366333
Training time without block to device /epoch 1.710994005203247
Training time without total dataloading part /epoch 0.2994039058685303
load block tensor time/epoch 0.9992780685424805
block to device time/epoch 1.398000717163086
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  10777644
Number of first layer input nodes during this epoch:  4498801
Number of first layer output nodes during this epoch:  4081926
----------------------------------------before generate dataloader block 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3614702224731445  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3780355453491211
global_2_local spend time (sec) 0.4817931652069092
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 0.491 seconds
Metis partitioning: 2.184 seconds
Split the graph: 1.212 seconds
Construct subgraphs: 0.032 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  3.968475103378296
after graph partition
graph partition algorithm spend time 5.254696846008301
95696
100875
partition_len_list
[1087589, 1110323]
metis selection method  spend 6.013273239135742
time for parepare:  0.26597070693969727
local_output_nid generation:  0.014553308486938477
local_in_edges_tensor generation:  0.04405617713928223
mini_batch_src_global generation:  0.11746072769165039
r_  generation:  1.7689602375030518
local_output_nid generation:  0.014825582504272461
local_in_edges_tensor generation:  0.0592648983001709
mini_batch_src_global generation:  0.15271544456481934
r_  generation:  1.997063159942627
----------------------check_connections_block total spend ----------------------------- 5.1082000732421875
generate_one_block  2.7417349815368652
generate_one_block  2.459733247756958
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2366039752960205
gen group dst list time:  0.07017660140991211
time for parepare:  0.4546480178833008
local_output_nid generation:  0.27552199363708496
local_in_edges_tensor generation:  0.921560525894165
mini_batch_src_global generation:  1.029726266860962
r_  generation:  14.67872166633606
local_output_nid generation:  0.3066253662109375
local_in_edges_tensor generation:  0.9526455402374268
mini_batch_src_global generation:  1.4183611869812012
r_  generation:  14.78034520149231
----------------------check_connections_block total spend ----------------------------- 39.80938267707825
generate_one_block  19.013933897018433
generate_one_block  19.195683479309082
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1849958896636963
gen group dst list time:  0.15417933464050293
time for parepare:  0.4461174011230469
local_output_nid generation:  0.5034561157226562
local_in_edges_tensor generation:  1.18072509765625
mini_batch_src_global generation:  1.2094204425811768
r_  generation:  17.787065982818604
local_output_nid generation:  0.5039761066436768
local_in_edges_tensor generation:  1.032958984375
mini_batch_src_global generation:  1.636439561843872
r_  generation:  18.404237270355225
----------------------check_connections_block total spend ----------------------------- 48.76658535003662
generate_one_block  23.19088363647461
generate_one_block  23.896790504455566
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3614702224731445  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

connection checking time:  93.68416810035706
block generation total time  90.49875974655151
average batch blocks generation time:  15.083126624425253
block dataloader generation time/epoch 204.16918269793192
pseudo mini batch 0 input nodes size: 2249115
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.8591384887695312  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.8591384887695312  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.6969995498657227  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.6977128982543945  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.859311580657959  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.4269680976867676  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.4269680976867676  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

first layer input nodes number: 2249115
first layer output nodes number: 2035969
edges number: 39612225
torch.Size([2249115, 100])
torch.Size([2035969, 256])
input nodes number: 2035969
output nodes number: 1087589
edges number: 32725800
torch.Size([2035969, 256])
torch.Size([1087589, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 10.671521663665771  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 10.688278198242188  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 2.3434219360351562  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

pseudo mini batch 1 input nodes size: 2250951
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.858405590057373  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.858405590057373  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.6969504356384277  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.697702407836914  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 0.8591279983520508  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.4324913024902344  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5194091796875 GB
    Memory Allocated: 1.4324913024902344  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

first layer input nodes number: 2250951
first layer output nodes number: 2046429
edges number: 39723131
torch.Size([2250951, 100])
torch.Size([2046429, 256])
input nodes number: 2046429
output nodes number: 1110323
edges number: 33296727
torch.Size([2046429, 256])
torch.Size([1110323, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 18.4139404296875 GB
    Memory Allocated: 10.788613319396973  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 18.4139404296875 GB
    Memory Allocated: 10.806276321411133  GigaBytes
Max Memory Allocated: 12.816699028015137  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.363588333129883  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.363588333129883  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.363588333129883  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.45165014266967773 |0.7533936500549316 |0.2698650360107422 |0.00018322467803955078 |0.14767062664031982 |0.0028867721557617188 |
----------------------------------------------------------pseudo_mini_loss sum 3.5981931686401367
Total (block generation + training)time/epoch 207.82905173301697
Training time/epoch 3.4377665519714355
Training time without block to device /epoch 1.9309792518615723
Training time without total dataloading part /epoch 0.8383245468139648
load block tensor time/epoch 0.9033002853393555
block to device time/epoch 1.5067873001098633
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  10780376
Number of first layer input nodes during this epoch:  4500066
Number of first layer output nodes during this epoch:  4082398
----------------------------------------before generate dataloader block 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3635878562927246  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3292715549468994
global_2_local spend time (sec) 0.4870717525482178
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 0.451 seconds
Metis partitioning: 2.282 seconds
Split the graph: 1.174 seconds
Construct subgraphs: 0.070 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  4.025207757949829
after graph partition
graph partition algorithm spend time 5.3211212158203125
95696
100875
partition_len_list
[1087291, 1110416]
metis selection method  spend 6.095322847366333
time for parepare:  0.27690625190734863
local_output_nid generation:  0.013792037963867188
local_in_edges_tensor generation:  0.045845985412597656
mini_batch_src_global generation:  0.112579345703125
r_  generation:  1.7989447116851807
local_output_nid generation:  0.014911651611328125
local_in_edges_tensor generation:  0.029874324798583984
mini_batch_src_global generation:  0.1589186191558838
r_  generation:  1.992729663848877
----------------------check_connections_block total spend ----------------------------- 5.112426042556763
generate_one_block  2.8432705402374268
generate_one_block  2.417316198348999
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.0496139526367188
gen group dst list time:  0.07116150856018066
time for parepare:  0.4617464542388916
local_output_nid generation:  0.2742297649383545
local_in_edges_tensor generation:  0.954953670501709
mini_batch_src_global generation:  1.0244715213775635
r_  generation:  14.518555164337158
local_output_nid generation:  0.3116304874420166
local_in_edges_tensor generation:  0.8806359767913818
mini_batch_src_global generation:  1.421919345855713
r_  generation:  14.711383819580078
----------------------check_connections_block total spend ----------------------------- 39.63413882255554
generate_one_block  19.125638246536255
generate_one_block  19.181530475616455
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.1776411533355713
gen group dst list time:  0.16222524642944336
time for parepare:  0.46581482887268066
local_output_nid generation:  0.5684983730316162
local_in_edges_tensor generation:  1.3275644779205322
mini_batch_src_global generation:  1.2659239768981934
r_  generation:  18.65266180038452
local_output_nid generation:  0.5843424797058105
local_in_edges_tensor generation:  1.313077688217163
mini_batch_src_global generation:  1.6710269451141357
r_  generation:  18.851054430007935
----------------------check_connections_block total spend ----------------------------- 50.77375793457031
generate_one_block  23.490781545639038
generate_one_block  23.60209083557129
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3635878562927246  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

connection checking time:  95.52032279968262
block generation total time  90.66062784194946
average batch blocks generation time:  15.110104640324911
block dataloader generation time/epoch 204.22418266534805
pseudo mini batch 0 input nodes size: 2248375
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8600339889526367  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8600339889526367  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6976189613342285  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6983323097229004  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8590354919433594  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4268827438354492  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4268827438354492  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2248375
first layer output nodes number: 2037165
edges number: 39646874
torch.Size([2248375, 100])
torch.Size([2037165, 256])
input nodes number: 2037165
output nodes number: 1087291
edges number: 32752043
torch.Size([2037165, 256])
torch.Size([1087291, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.67294692993164  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.689703464508057  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.342953681945801  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

pseudo mini batch 1 input nodes size: 2251868
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8581295013427734  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8581295013427734  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6970157623291016  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.697767734527588  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8594694137573242  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4327545166015625  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4327545166015625  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2251868
first layer output nodes number: 2045525
edges number: 39701982
torch.Size([2251868, 100])
torch.Size([2045525, 256])
input nodes number: 2045525
output nodes number: 1110416
edges number: 33285630
torch.Size([2045525, 256])
torch.Size([1110416, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.787208080291748  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.804871082305908  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3640899658203125  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3640899658203125  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3640899658203125  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.4922407865524292 |0.699518084526062 |0.1548902988433838 |0.00022172927856445312 |0.005209684371948242 |0.002763509750366211 |
----------------------------------------------------------pseudo_mini_loss sum 4.504097938537598
Total (block generation + training)time/epoch 207.7491353750229
Training time/epoch 3.1199302673339844
Training time without block to device /epoch 1.7208940982818604
Training time without total dataloading part /epoch 0.3234069347381592
load block tensor time/epoch 0.9844815731048584
block to device time/epoch 1.399036169052124
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 3 |
Number of nodes for computation during this epoch:  10780640
Number of first layer input nodes during this epoch:  4500243
Number of first layer output nodes during this epoch:  4082690
----------------------------------------before generate dataloader block 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3640894889831543  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3075082302093506
global_2_local spend time (sec) 0.4874601364135742
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 0.441 seconds
Metis partitioning: 2.268 seconds
Split the graph: 1.214 seconds
Construct subgraphs: 0.051 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  4.010740756988525
after graph partition
graph partition algorithm spend time 5.294066905975342
95696
100875
partition_len_list
[1087273, 1108797]
metis selection method  spend 6.098561763763428
time for parepare:  0.2746748924255371
local_output_nid generation:  0.014110326766967773
local_in_edges_tensor generation:  0.06497573852539062
mini_batch_src_global generation:  0.11176204681396484
r_  generation:  1.809861421585083
local_output_nid generation:  0.020041704177856445
local_in_edges_tensor generation:  0.05269908905029297
mini_batch_src_global generation:  0.16397976875305176
r_  generation:  2.043642044067383
----------------------check_connections_block total spend ----------------------------- 5.24239706993103
generate_one_block  2.856374502182007
generate_one_block  2.4979543685913086
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.247943878173828
gen group dst list time:  0.06842517852783203
time for parepare:  0.4438469409942627
local_output_nid generation:  0.27005839347839355
local_in_edges_tensor generation:  0.8548972606658936
mini_batch_src_global generation:  1.0139052867889404
r_  generation:  14.25071907043457
local_output_nid generation:  0.30010509490966797
local_in_edges_tensor generation:  0.8894639015197754
mini_batch_src_global generation:  1.3059818744659424
r_  generation:  14.913554430007935
----------------------check_connections_block total spend ----------------------------- 39.057621479034424
generate_one_block  18.93707847595215
generate_one_block  18.935018301010132
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.197244882583618
gen group dst list time:  0.1632239818572998
time for parepare:  0.46994662284851074
local_output_nid generation:  0.5301933288574219
local_in_edges_tensor generation:  1.2658591270446777
mini_batch_src_global generation:  1.263491153717041
r_  generation:  18.74572777748108
local_output_nid generation:  0.5664401054382324
local_in_edges_tensor generation:  1.2754809856414795
mini_batch_src_global generation:  1.6633985042572021
r_  generation:  18.476101875305176
----------------------check_connections_block total spend ----------------------------- 50.39974784851074
generate_one_block  23.293188333511353
generate_one_block  23.39754891395569
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3640894889831543  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

connection checking time:  94.6997663974762
block generation total time  89.91716289520264
average batch blocks generation time:  14.986193815867106
block dataloader generation time/epoch 203.99522557258607
pseudo mini batch 0 input nodes size: 2249909
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8603754043579102  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8603754043579102  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6985321044921875  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6992454528808594  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8596072196960449  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4272685050964355  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4272685050964355  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2249909
first layer output nodes number: 2038134
edges number: 39637743
torch.Size([2249909, 100])
torch.Size([2038134, 256])
input nodes number: 2038134
output nodes number: 1087273
edges number: 32726608
torch.Size([2038134, 256])
torch.Size([1087273, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.67552375793457  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.692280292510986  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.343273639678955  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

pseudo mini batch 1 input nodes size: 2250603
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.858701229095459  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.858701229095459  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6971163749694824  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6978683471679688  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8589982986450195  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.432180404663086  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.432180404663086  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2250603
first layer output nodes number: 2046116
edges number: 39725996
torch.Size([2250603, 100])
torch.Size([2046116, 256])
input nodes number: 2046116
output nodes number: 1108797
edges number: 33272148
torch.Size([2046116, 256])
torch.Size([1108797, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.781754970550537  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.799417972564697  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3620657920837402  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3620657920837402  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3620657920837402  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.4899972677230835 |0.7114334106445312 |0.134210467338562 |0.00016820430755615234 |0.005129218101501465 |0.0013000965118408203 |
----------------------------------------------------------pseudo_mini_loss sum 3.4084315299987793
Total (block generation + training)time/epoch 207.43825993537902
Training time/epoch 3.1150732040405273
Training time without block to device /epoch 1.6922063827514648
Training time without total dataloading part /epoch 0.2803158760070801
load block tensor time/epoch 0.979994535446167
block to device time/epoch 1.4228668212890625
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 4 |
Number of nodes for computation during this epoch:  10780832
Number of first layer input nodes during this epoch:  4500512
Number of first layer output nodes during this epoch:  4084250
----------------------------------------before generate dataloader block 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.362065315246582  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3456697463989258
global_2_local spend time (sec) 0.4874444007873535
----------------------------  graph partition start---------------------
Convert a graph into a bidirected graph: 0.481 seconds
Metis partitioning: 2.254 seconds
Split the graph: 1.178 seconds
Construct subgraphs: 0.053 seconds
95696
100875
The batched output nid list before graph partition
total k batches seeds list generation spend  4.01232385635376
after graph partition
graph partition algorithm spend time 5.370535373687744
95696
100875
partition_len_list
[1087593, 1109556]
metis selection method  spend 6.148757457733154
time for parepare:  0.2636222839355469
local_output_nid generation:  0.014199018478393555
local_in_edges_tensor generation:  0.027196168899536133
mini_batch_src_global generation:  0.11082887649536133
r_  generation:  1.7576308250427246
local_output_nid generation:  0.015725374221801758
local_in_edges_tensor generation:  0.04612588882446289
mini_batch_src_global generation:  0.15861749649047852
r_  generation:  2.097339153289795
----------------------check_connections_block total spend ----------------------------- 5.185202121734619
generate_one_block  2.7925732135772705
generate_one_block  2.4353599548339844
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.1497929096221924
gen group dst list time:  0.0776817798614502
time for parepare:  0.4629948139190674
local_output_nid generation:  0.26042890548706055
local_in_edges_tensor generation:  0.9434306621551514
mini_batch_src_global generation:  1.0691537857055664
r_  generation:  14.574846982955933
local_output_nid generation:  0.30558180809020996
local_in_edges_tensor generation:  0.9150786399841309
mini_batch_src_global generation:  1.3990800380706787
r_  generation:  14.689050197601318
----------------------check_connections_block total spend ----------------------------- 39.66507363319397
generate_one_block  19.071352005004883
generate_one_block  19.295975923538208
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2022969722747803
gen group dst list time:  0.16040444374084473
time for parepare:  0.4307708740234375
local_output_nid generation:  0.5512430667877197
local_in_edges_tensor generation:  1.2797441482543945
mini_batch_src_global generation:  1.2649080753326416
r_  generation:  18.729188203811646
local_output_nid generation:  0.5805375576019287
local_in_edges_tensor generation:  1.2905957698822021
mini_batch_src_global generation:  1.7120060920715332
r_  generation:  18.697810411453247
----------------------check_connections_block total spend ----------------------------- 50.65285634994507
generate_one_block  23.96815037727356
generate_one_block  23.487509727478027
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.362065315246582  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

connection checking time:  95.50313210487366
block generation total time  91.05092120170593
average batch blocks generation time:  15.175153533617655
block dataloader generation time/epoch 204.15652783711752
pseudo mini batch 0 input nodes size: 2247056
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8599042892456055  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8599042892456055  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.696998119354248  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.69771146774292  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8585443496704102  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4261245727539062  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4261245727539062  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2247056
first layer output nodes number: 2037180
edges number: 39628841
torch.Size([2247056, 100])
torch.Size([2037180, 256])
input nodes number: 2037180
output nodes number: 1087593
edges number: 32718174
torch.Size([2037180, 256])
torch.Size([1087593, 256])
torch.Size([95696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.672828674316406  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.689585208892822  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3417820930480957  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

pseudo mini batch 1 input nodes size: 2251355
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8576383590698242  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.8576383590698242  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.696333885192871  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.6970858573913574  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 0.859278678894043  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4327173233032227  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 1.4327173233032227  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

first layer input nodes number: 2251355
first layer output nodes number: 2046035
edges number: 39716503
torch.Size([2251355, 100])
torch.Size([2046035, 256])
input nodes number: 2046035
output nodes number: 1109556
edges number: 33304077
torch.Size([2046035, 256])
torch.Size([1109556, 256])
torch.Size([100875, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.784753322601318  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 10.802416324615479  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3631720542907715  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3631720542907715  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 21.4295654296875 GB
    Memory Allocated: 2.3631720542907715  GigaBytes
Max Memory Allocated: 12.824690818786621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.48931753635406494 |0.6920268535614014 |0.1348053216934204 |0.0001697540283203125 |0.005063772201538086 |0.001291036605834961 |
----------------------------------------------------------pseudo_mini_loss sum 2.24357271194458
Total (block generation + training)time/epoch 207.53775262832642
Training time/epoch 3.071958303451538
Training time without block to device /epoch 1.6879045963287354
Training time without total dataloading part /epoch 0.2813687324523926
load block tensor time/epoch 0.9786350727081299
block to device time/epoch 1.3840537071228027
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 5 |
Number of nodes for computation during this epoch:  10778775
Number of first layer input nodes during this epoch:  4498411
Number of first layer output nodes during this epoch:  4083215
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=100, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=256, bias=False)
    )
    (2): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  206336
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 100])
layers.0.fc_neigh.weight, torch.Size([256, 100])
layers.1.fc_self.weight, torch.Size([256, 256])
layers.1.fc_neigh.weight, torch.Size([256, 256])
layers.2.fc_self.weight, torch.Size([47, 256])
layers.2.fc_neigh.weight, torch.Size([47, 256])
----------------------------------------
un-trainable parameters
