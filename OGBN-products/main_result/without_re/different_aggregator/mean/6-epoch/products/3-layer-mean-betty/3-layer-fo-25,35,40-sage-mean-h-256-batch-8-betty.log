main start at this time 1656621610.7431626
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.32985568046569824
global_2_local spend time (sec) 0.5018970966339111
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.08012127876281738
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181132, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12111282348632812
auxiliary_graph
Graph(num_nodes=1377703, num_edges=101856625,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6203205585479736
remove nodes length  1181132

auxiliary_graph.remove_nodes spent  5.52362322807312
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101856625,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.2492969036102295

the counter of shared neighbor distribution
Counter({1.0: 76591578, 2.0: 14049546, 3.0: 5010892, 4.0: 2311722, 5.0: 1250786, 6.0: 739600, 7.0: 472478, 8.0: 320570, 9.0: 222488, 10.0: 161872, 11.0: 120832, 12.0: 90056, 13.0: 69248, 14.0: 53652, 15.0: 42676, 16.0: 31336, 17.0: 22028, 18.0: 19462, 19.0: 13316, 20.0: 10776, 21.0: 7196, 22.0: 5792, 23.0: 4758, 24.0: 3924, 25.0: 3444, 33.0: 2970, 28.0: 2904, 26.0: 2622, 30.0: 2388, 27.0: 2258, 32.0: 2096, 31.0: 2082, 39.0: 2070, 35.0: 1734, 29.0: 1726, 37.0: 1702, 36.0: 1500, 34.0: 1446, 38.0: 1436, 40.0: 1092})
101660054
Convert a graph into a bidirected graph: 6.882 seconds
Metis partitioning: 23.431 seconds
Split the graph: 3.783 seconds
Construct subgraphs: 0.558 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  34.69524049758911
24554
23943
24052
25225
23950
25196
25197
24454
total k batches seeds list generation spend  63.672645807266235
after graph partition
graph partition algorithm spend time 64.6385395526886
24554
23943
24052
25225
23950
25196
25197
24454
partition_len_list
[180146, 247588, 237219, 205397, 252480, 261637, 266606, 242654]
REG selection method  spend 65.39680361747742
time for parepare:  0.2751650810241699
local_output_nid generation:  0.00557398796081543
local_in_edges_tensor generation:  0.009572029113769531
mini_batch_src_global generation:  0.031368255615234375
r_  generation:  0.2869741916656494
local_output_nid generation:  0.006796836853027344
local_in_edges_tensor generation:  0.012720823287963867
mini_batch_src_global generation:  0.03689408302307129
r_  generation:  0.3156857490539551
local_output_nid generation:  0.0067005157470703125
local_in_edges_tensor generation:  0.018490076065063477
mini_batch_src_global generation:  0.04936552047729492
r_  generation:  0.3463618755340576
local_output_nid generation:  0.008254766464233398
local_in_edges_tensor generation:  0.0667574405670166
mini_batch_src_global generation:  0.04764556884765625
r_  generation:  0.35205793380737305
local_output_nid generation:  0.007966995239257812
local_in_edges_tensor generation:  0.01748967170715332
mini_batch_src_global generation:  0.0361478328704834
r_  generation:  0.32091546058654785
local_output_nid generation:  0.006766796112060547
local_in_edges_tensor generation:  0.010640382766723633
mini_batch_src_global generation:  0.0420069694519043
r_  generation:  0.39496707916259766
local_output_nid generation:  0.00675654411315918
local_in_edges_tensor generation:  0.01528477668762207
mini_batch_src_global generation:  0.04208183288574219
r_  generation:  0.4008500576019287
local_output_nid generation:  0.006582736968994141
local_in_edges_tensor generation:  0.014686107635498047
mini_batch_src_global generation:  0.04288649559020996
r_  generation:  0.3902921676635742
----------------------check_connections_block total spend ----------------------------- 4.236080884933472
generate_one_block  1.9556021690368652
generate_one_block  0.4278721809387207
generate_one_block  0.4331676959991455
generate_one_block  0.4487643241882324
generate_one_block  0.44902515411376953
generate_one_block  0.5556788444519043
generate_one_block  0.5449440479278564
generate_one_block  0.459073543548584
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.27482008934021
gen group dst list time:  0.053069353103637695
time for parepare:  0.45419764518737793
local_output_nid generation:  0.04035592079162598
local_in_edges_tensor generation:  0.2716410160064697
mini_batch_src_global generation:  0.181640625
r_  generation:  1.7431237697601318
local_output_nid generation:  0.09448838233947754
local_in_edges_tensor generation:  0.19733166694641113
mini_batch_src_global generation:  0.28874969482421875
r_  generation:  2.7017982006073
local_output_nid generation:  0.06896162033081055
local_in_edges_tensor generation:  0.23496246337890625
mini_batch_src_global generation:  0.30727076530456543
r_  generation:  2.75936222076416
local_output_nid generation:  0.08700823783874512
local_in_edges_tensor generation:  0.22376728057861328
mini_batch_src_global generation:  0.2413196563720703
r_  generation:  2.087831735610962
local_output_nid generation:  0.07434630393981934
local_in_edges_tensor generation:  0.31429624557495117
mini_batch_src_global generation:  0.3287076950073242
r_  generation:  3.1557273864746094
local_output_nid generation:  0.10208749771118164
local_in_edges_tensor generation:  0.28751540184020996
mini_batch_src_global generation:  0.36232733726501465
r_  generation:  3.2867348194122314
local_output_nid generation:  0.07511353492736816
local_in_edges_tensor generation:  0.23024463653564453
mini_batch_src_global generation:  0.38121509552001953
r_  generation:  3.382261276245117
local_output_nid generation:  0.06646466255187988
local_in_edges_tensor generation:  0.24587512016296387
mini_batch_src_global generation:  0.3387339115142822
r_  generation:  3.019767999649048
----------------------check_connections_block total spend ----------------------------- 31.733784437179565
generate_one_block  2.852259874343872
generate_one_block  3.775578498840332
generate_one_block  3.390756130218506
generate_one_block  2.642580986022949
generate_one_block  4.228999853134155
generate_one_block  4.144315958023071
generate_one_block  4.3470458984375
generate_one_block  3.7531580924987793
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.311060667037964
gen group dst list time:  0.23737573623657227
time for parepare:  0.47327733039855957
local_output_nid generation:  0.1682121753692627
local_in_edges_tensor generation:  0.5209481716156006
mini_batch_src_global generation:  0.3962380886077881
r_  generation:  4.400646209716797
local_output_nid generation:  0.33564114570617676
local_in_edges_tensor generation:  0.6814558506011963
mini_batch_src_global generation:  0.8217616081237793
r_  generation:  8.967068433761597
local_output_nid generation:  0.2758493423461914
local_in_edges_tensor generation:  0.7026271820068359
mini_batch_src_global generation:  0.7458536624908447
r_  generation:  7.374230146408081
local_output_nid generation:  0.21576189994812012
local_in_edges_tensor generation:  0.52077317237854
mini_batch_src_global generation:  0.5507016181945801
r_  generation:  5.318975448608398
local_output_nid generation:  0.37811875343322754
local_in_edges_tensor generation:  0.7364466190338135
mini_batch_src_global generation:  0.8879437446594238
r_  generation:  9.838217496871948
local_output_nid generation:  0.275437593460083
local_in_edges_tensor generation:  0.5760443210601807
mini_batch_src_global generation:  0.8742899894714355
r_  generation:  8.201616525650024
local_output_nid generation:  0.2807884216308594
local_in_edges_tensor generation:  0.6635637283325195
mini_batch_src_global generation:  0.8409199714660645
r_  generation:  8.460918426513672
local_output_nid generation:  0.27848100662231445
local_in_edges_tensor generation:  0.633826732635498
mini_batch_src_global generation:  0.8511645793914795
r_  generation:  7.562574148178101
----------------------check_connections_block total spend ----------------------------- 84.76596188545227
generate_one_block  6.56161642074585
generate_one_block  12.018316745758057
generate_one_block  9.296467304229736
generate_one_block  6.872924566268921
generate_one_block  12.714850425720215
generate_one_block  10.334483623504639
generate_one_block  10.45657229423523
generate_one_block  9.220041275024414
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

connection checking time:  120.73582720756531
block generation total time  111.8840959072113
average batch blocks generation time:  4.661837329467137
block dataloader generation time/epoch 310.4674062728882
pseudo mini batch 0 input nodes size: 1410979
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0007686614990234375  GigaBytes
Max Memory Allocated: 0.0007686614990234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.5447998046875 GB
    Memory Allocated: 0.5263996124267578  GigaBytes
Max Memory Allocated: 0.5263996124267578  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.5447998046875 GB
    Memory Allocated: 0.5265827178955078  GigaBytes
Max Memory Allocated: 0.5265827178955078  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.5447998046875 GB
    Memory Allocated: 0.5265827178955078  GigaBytes
Max Memory Allocated: 0.5265827178955078  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.7537841796875 GB
    Memory Allocated: 0.6583471298217773  GigaBytes
Max Memory Allocated: 0.6583471298217773  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.7537841796875 GB
    Memory Allocated: 0.6583471298217773  GigaBytes
Max Memory Allocated: 0.6583471298217773  GigaBytes

first layer input nodes number: 1410979
first layer output nodes number: 561190
edges number: 11364620
torch.Size([1410979, 100])
torch.Size([561190, 256])
input nodes number: 561190
output nodes number: 180146
edges number: 5042903
torch.Size([561190, 256])
torch.Size([180146, 256])
torch.Size([24554, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.7830810546875 GB
    Memory Allocated: 2.81669282913208  GigaBytes
Max Memory Allocated: 2.949531078338623  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 4.7830810546875 GB
    Memory Allocated: 2.8210978507995605  GigaBytes
Max Memory Allocated: 2.949531078338623  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.7381591796875 GB
    Memory Allocated: 0.8643956184387207  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

pseudo mini batch 1 input nodes size: 1903313
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.7381591796875 GB
    Memory Allocated: 0.531651496887207  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.7381591796875 GB
    Memory Allocated: 0.531651496887207  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.4490966796875 GB
    Memory Allocated: 1.2406911849975586  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.4490966796875 GB
    Memory Allocated: 1.2408699989318848  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.4490966796875 GB
    Memory Allocated: 0.7150559425354004  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.4490966796875 GB
    Memory Allocated: 0.9376034736633301  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.4490966796875 GB
    Memory Allocated: 0.9376034736633301  GigaBytes
Max Memory Allocated: 3.347832679748535  GigaBytes

first layer input nodes number: 1903313
first layer output nodes number: 1013959
edges number: 21819338
torch.Size([1903313, 100])
torch.Size([1013959, 256])
input nodes number: 1013959
output nodes number: 247588
edges number: 7162126
torch.Size([1013959, 256])
torch.Size([247588, 256])
torch.Size([23943, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 10.5252685546875 GB
    Memory Allocated: 4.544895648956299  GigaBytes
Max Memory Allocated: 4.747297763824463  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 10.5252685546875 GB
    Memory Allocated: 4.549088478088379  GigaBytes
Max Memory Allocated: 4.747297763824463  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 1.2621955871582031  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

pseudo mini batch 2 input nodes size: 1695166
----------------------------------------before load block subtensor 
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 0.7149491310119629  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 0.7149491310119629  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 1.3464479446411133  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 1.3466272354125977  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 0.6374087333679199  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 0.8224787712097168  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 0.8224787712097168  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

first layer input nodes number: 1695166
first layer output nodes number: 846950
edges number: 17164426
torch.Size([1695166, 100])
torch.Size([846950, 256])
input nodes number: 846950
output nodes number: 237219
edges number: 6763580
torch.Size([846950, 256])
torch.Size([237219, 256])
torch.Size([24052, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 3.9353513717651367  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 11.9256591796875 GB
    Memory Allocated: 3.939563274383545  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 1.1003341674804688  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

pseudo mini batch 3 input nodes size: 1475785
----------------------------------------before load block subtensor 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.637427806854248  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.637427806854248  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 1.1872010231018066  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 1.1873893737792969  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.5557112693786621  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.6935591697692871  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.6935591697692871  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

first layer input nodes number: 1475785
first layer output nodes number: 620601
edges number: 12046737
torch.Size([1475785, 100])
torch.Size([620601, 256])
input nodes number: 620601
output nodes number: 205397
edges number: 5442682
torch.Size([620601, 256])
torch.Size([205397, 256])
torch.Size([25225, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 3.0859785079956055  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 3.090395927429199  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.9095072746276855  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

pseudo mini batch 4 input nodes size: 1839685
----------------------------------------before load block subtensor 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.5559167861938477  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.5559167861938477  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 1.2412528991699219  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 1.241431713104248  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.6914701461791992  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.9293813705444336  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 12.7342529296875 GB
    Memory Allocated: 0.9293813705444336  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

first layer input nodes number: 1839685
first layer output nodes number: 1058694
edges number: 23304108
torch.Size([1839685, 100])
torch.Size([1058694, 256])
input nodes number: 1058694
output nodes number: 252480
edges number: 7790119
torch.Size([1058694, 256])
torch.Size([252480, 256])
torch.Size([23950, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 15.7791748046875 GB
    Memory Allocated: 4.680599689483643  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 15.7791748046875 GB
    Memory Allocated: 4.68576717376709  GigaBytes
Max Memory Allocated: 5.749619007110596  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.2732014656066895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1678475
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6912469863891602  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6912469863891602  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.3165278434753418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.3167157173156738  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6312007904052734  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8425464630126953  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8425464630126953  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1678475
first layer output nodes number: 848406
edges number: 18965069
torch.Size([1678475, 100])
torch.Size([848406, 256])
input nodes number: 848406
output nodes number: 261637
edges number: 8401327
torch.Size([848406, 256])
torch.Size([261637, 256])
torch.Size([25196, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.063776969909668  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.0681891441345215  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.162233829498291  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1599562
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6314187049865723  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6314187049865723  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.227302074432373  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.227489948272705  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6020212173461914  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8167533874511719  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8167533874511719  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1599562
first layer output nodes number: 865634
edges number: 19303137
torch.Size([1599562, 100])
torch.Size([865634, 256])
input nodes number: 865634
output nodes number: 266606
edges number: 8455062
torch.Size([865634, 256])
torch.Size([266606, 256])
torch.Size([25197, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.099142074584961  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.1037116050720215  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.1391777992248535  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 7 input nodes size: 1638918
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6021637916564941  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6021637916564941  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.2127084732055664  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.2128911018371582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6168198585510254  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8086695671081543  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8086695671081543  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1638918
first layer output nodes number: 779169
edges number: 17236834
torch.Size([1638918, 100])
torch.Size([779169, 256])
input nodes number: 779169
output nodes number: 242654
edges number: 7555725
torch.Size([779169, 256])
torch.Size([242654, 256])
torch.Size([24454, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 3.773285388946533  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 3.7775678634643555  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.0976481437683105  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.0991854667663574  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.0991854667663574  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.26377302408218384 |0.24204078316688538 |0.14950785040855408 |0.0001609325408935547 |0.02237492799758911 |0.004197359085083008 |
----------------------------------------------------------pseudo_mini_loss sum 7.174403190612793
Total (block generation + training)time/epoch 316.01433205604553
Training time/epoch 5.546613693237305
Training time without block to device /epoch 3.6102874279022217
Training time without total dataloading part /epoch 1.380547046661377
load block tensor time/epoch 2.1101841926574707
block to device time/epoch 1.936326265335083
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  21730213
Number of first layer input nodes during this epoch:  13241883
Number of first layer output nodes during this epoch:  6594603
----------------------------------------before generate dataloader block 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.0991849899291992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.4362368583679199
global_2_local spend time (sec) 0.5398640632629395
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.08255934715270996
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181573, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12355613708496094
auxiliary_graph
Graph(num_nodes=1378144, num_edges=101440449,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6278281211853027
remove nodes length  1181573

auxiliary_graph.remove_nodes spent  5.365780830383301
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101440449,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.263906717300415

the counter of shared neighbor distribution
Counter({1.0: 76262470, 2.0: 13999502, 3.0: 4993082, 4.0: 2303996, 5.0: 1242502, 6.0: 739396, 7.0: 471654, 8.0: 318818, 9.0: 223652, 10.0: 162218, 11.0: 119508, 12.0: 90236, 13.0: 68272, 14.0: 52940, 15.0: 42884, 16.0: 30994, 17.0: 22020, 18.0: 20014, 19.0: 13430, 20.0: 10922, 21.0: 7462, 22.0: 5748, 23.0: 4694, 24.0: 3946, 25.0: 3448, 33.0: 2964, 28.0: 2830, 26.0: 2556, 30.0: 2394, 27.0: 2196, 32.0: 2176, 31.0: 2104, 39.0: 2086, 29.0: 1842, 35.0: 1724, 37.0: 1628, 36.0: 1536, 38.0: 1480, 34.0: 1476, 40.0: 1078})
101243878
Convert a graph into a bidirected graph: 6.917 seconds
Metis partitioning: 25.987 seconds
Split the graph: 3.364 seconds
Construct subgraphs: 0.025 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  36.33096742630005
23979
24665
24021
24103
25305
23880
25309
25309
total k batches seeds list generation spend  65.68978524208069
after graph partition
graph partition algorithm spend time 66.6722047328949
23979
24665
24021
24103
25305
23880
25309
25309
partition_len_list
[262845, 240363, 262419, 228346, 211161, 237087, 250622, 187782]
REG selection method  spend 67.49509000778198
time for parepare:  0.29248714447021484
local_output_nid generation:  0.005998134613037109
local_in_edges_tensor generation:  0.009534120559692383
mini_batch_src_global generation:  0.043088674545288086
r_  generation:  0.330585241317749
local_output_nid generation:  0.006906270980834961
local_in_edges_tensor generation:  0.03731513023376465
mini_batch_src_global generation:  0.042716026306152344
r_  generation:  0.3730008602142334
local_output_nid generation:  0.009569406509399414
local_in_edges_tensor generation:  0.012619733810424805
mini_batch_src_global generation:  0.03653311729431152
r_  generation:  0.3257293701171875
local_output_nid generation:  0.007119417190551758
local_in_edges_tensor generation:  0.03253436088562012
mini_batch_src_global generation:  0.03583812713623047
r_  generation:  0.3298461437225342
local_output_nid generation:  0.0070040225982666016
local_in_edges_tensor generation:  0.01854705810546875
mini_batch_src_global generation:  0.037999629974365234
r_  generation:  0.3766062259674072
local_output_nid generation:  0.006795167922973633
local_in_edges_tensor generation:  0.0121917724609375
mini_batch_src_global generation:  0.041249990463256836
r_  generation:  0.36914515495300293
local_output_nid generation:  0.0070667266845703125
local_in_edges_tensor generation:  0.019324064254760742
mini_batch_src_global generation:  0.04304766654968262
r_  generation:  0.42973923683166504
local_output_nid generation:  0.007239580154418945
local_in_edges_tensor generation:  0.015244007110595703
mini_batch_src_global generation:  0.04393267631530762
r_  generation:  0.3818957805633545
----------------------check_connections_block total spend ----------------------------- 4.352232933044434
generate_one_block  0.8069577217102051
generate_one_block  0.5623824596405029
generate_one_block  0.49178504943847656
generate_one_block  0.5458858013153076
generate_one_block  0.6235899925231934
generate_one_block  0.574638843536377
generate_one_block  0.5310423374176025
generate_one_block  0.43213820457458496
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.22678279876709
gen group dst list time:  0.06578850746154785
time for parepare:  0.4958326816558838
local_output_nid generation:  0.06748628616333008
local_in_edges_tensor generation:  0.339569091796875
mini_batch_src_global generation:  0.2855229377746582
r_  generation:  3.21085524559021
local_output_nid generation:  0.09891724586486816
local_in_edges_tensor generation:  0.36918067932128906
mini_batch_src_global generation:  0.33589911460876465
r_  generation:  2.8182926177978516
local_output_nid generation:  0.07470393180847168
local_in_edges_tensor generation:  0.26064252853393555
mini_batch_src_global generation:  0.349459171295166
r_  generation:  3.290691375732422
local_output_nid generation:  0.09542608261108398
local_in_edges_tensor generation:  0.24691557884216309
mini_batch_src_global generation:  0.2938086986541748
r_  generation:  2.510080337524414
local_output_nid generation:  0.06207633018493652
local_in_edges_tensor generation:  0.16178178787231445
mini_batch_src_global generation:  0.2643289566040039
r_  generation:  2.2000932693481445
local_output_nid generation:  0.06863045692443848
local_in_edges_tensor generation:  0.2762107849121094
mini_batch_src_global generation:  0.29160046577453613
r_  generation:  2.939136505126953
local_output_nid generation:  0.10575723648071289
local_in_edges_tensor generation:  0.2239067554473877
mini_batch_src_global generation:  0.36151576042175293
r_  generation:  3.145827531814575
local_output_nid generation:  0.05083656311035156
local_in_edges_tensor generation:  0.13628506660461426
mini_batch_src_global generation:  0.26218390464782715
r_  generation:  2.0235846042633057
----------------------check_connections_block total spend ----------------------------- 31.8193302154541
generate_one_block  4.74306583404541
generate_one_block  3.876166343688965
generate_one_block  4.489133596420288
generate_one_block  3.4030356407165527
generate_one_block  2.7279396057128906
generate_one_block  3.3568778038024902
generate_one_block  3.804778814315796
generate_one_block  2.5037894248962402
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.24979829788208
gen group dst list time:  0.25566864013671875
time for parepare:  0.49686336517333984
local_output_nid generation:  0.28415417671203613
local_in_edges_tensor generation:  0.6862409114837646
mini_batch_src_global generation:  0.6866683959960938
r_  generation:  8.487459659576416
local_output_nid generation:  0.29500842094421387
local_in_edges_tensor generation:  0.6436724662780762
mini_batch_src_global generation:  0.7376773357391357
r_  generation:  7.178049325942993
local_output_nid generation:  0.3173179626464844
local_in_edges_tensor generation:  0.7377817630767822
mini_batch_src_global generation:  0.9127662181854248
r_  generation:  9.439998388290405
local_output_nid generation:  0.3400232791900635
local_in_edges_tensor generation:  0.6608798503875732
mini_batch_src_global generation:  0.8419468402862549
r_  generation:  8.186663150787354
local_output_nid generation:  0.20839571952819824
local_in_edges_tensor generation:  0.46930980682373047
mini_batch_src_global generation:  0.6520001888275146
r_  generation:  5.717849493026733
local_output_nid generation:  0.27539682388305664
local_in_edges_tensor generation:  0.5409221649169922
mini_batch_src_global generation:  0.7244315147399902
r_  generation:  7.542541742324829
local_output_nid generation:  0.30607056617736816
local_in_edges_tensor generation:  0.6058175563812256
mini_batch_src_global generation:  0.7684903144836426
r_  generation:  7.702064752578735
local_output_nid generation:  0.18248915672302246
local_in_edges_tensor generation:  0.35780978202819824
mini_batch_src_global generation:  0.5774478912353516
r_  generation:  5.103675127029419
----------------------check_connections_block total spend ----------------------------- 83.3672387599945
generate_one_block  11.766817331314087
generate_one_block  9.08109450340271
generate_one_block  12.155081272125244
generate_one_block  10.476947546005249
generate_one_block  6.9439697265625
generate_one_block  9.303617238998413
generate_one_block  9.561765670776367
generate_one_block  6.3368823528289795
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.0991849899291992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

connection checking time:  119.53880190849304
block generation total time  109.09938311576843
average batch blocks generation time:  4.545807629823685
block dataloader generation time/epoch 309.60524690151215
pseudo mini batch 0 input nodes size: 1732058
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6180839538574219  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6180839538574219  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.2633261680603027  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.263504981994629  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6527776718139648  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8722267150878906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.8722267150878906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1732058
first layer output nodes number: 907561
edges number: 20179571
torch.Size([1732058, 100])
torch.Size([907561, 256])
input nodes number: 907561
output nodes number: 262845
edges number: 8330786
torch.Size([907561, 256])
torch.Size([262845, 256])
torch.Size([23979, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.252875328063965  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 4.25707483291626  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.1987252235412598  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 1 input nodes size: 1541916
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6526951789855957  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.6526951789855957  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.2271037101745605  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 1.227287769317627  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.5818667411804199  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.7737631797790527  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8299560546875 GB
    Memory Allocated: 0.7737631797790527  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1541916
first layer output nodes number: 772568
edges number: 17250287
torch.Size([1541916, 100])
torch.Size([772568, 256])
input nodes number: 772568
output nodes number: 240363
edges number: 7531786
torch.Size([772568, 256])
torch.Size([240363, 256])
torch.Size([24665, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.714928150177002  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.719247341156006  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0630993843078613  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 2 input nodes size: 1773446
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5819869041442871  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5819869041442871  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2426471710205078  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2428264617919922  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6682338714599609  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.901214599609375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.901214599609375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1773446
first layer output nodes number: 999951
edges number: 22076724
torch.Size([1773446, 100])
torch.Size([999951, 256])
input nodes number: 999951
output nodes number: 262419
edges number: 8201357
torch.Size([999951, 256])
torch.Size([262419, 256])
torch.Size([24021, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.529099941253662  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.53330659866333  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2427973747253418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 3 input nodes size: 1750632
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.668121337890625  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.668121337890625  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3202829360961914  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.320462703704834  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6596231460571289  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8611688613891602  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8611688613891602  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1750632
first layer output nodes number: 916027
edges number: 19649646
torch.Size([1750632, 100])
torch.Size([916027, 256])
input nodes number: 916027
output nodes number: 228346
edges number: 6530852
torch.Size([916027, 256])
torch.Size([228346, 256])
torch.Size([24103, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.138197898864746  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.14241886138916  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1548848152160645  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 4 input nodes size: 1549821
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.659637451171875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.659637451171875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2369909286499023  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2371797561645508  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5848383903503418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7307009696960449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7307009696960449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1549821
first layer output nodes number: 663845
edges number: 12995213
torch.Size([1549821, 100])
torch.Size([663845, 256])
input nodes number: 663845
output nodes number: 211161
edges number: 5634120
torch.Size([663845, 256])
torch.Size([211161, 256])
torch.Size([25305, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.2591991424560547  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.2636303901672363  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9558377265930176  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1730990
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5850486755371094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5850486755371094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2298927307128906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2300710678100586  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6525287628173828  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.841310977935791  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.841310977935791  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1730990
first layer output nodes number: 860075
edges number: 17488893
torch.Size([1730990, 100])
torch.Size([860075, 256])
input nodes number: 860075
output nodes number: 237087
edges number: 6739900
torch.Size([860075, 256])
torch.Size([237087, 256])
torch.Size([23880, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.988645076751709  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.993718147277832  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1210508346557617  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1702609
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6522793769836426  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6522793769836426  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2865509986877441  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2867398262023926  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6417174339294434  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8429951667785645  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8429951667785645  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1702609
first layer output nodes number: 817617
edges number: 18121607
torch.Size([1702609, 100])
torch.Size([817617, 256])
input nodes number: 817617
output nodes number: 250622
edges number: 7898538
torch.Size([817617, 256])
torch.Size([250622, 256])
torch.Size([25309, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.9417967796325684  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.9462289810180664  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1471023559570312  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 7 input nodes size: 1466265
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6419677734375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6419677734375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1881942749023438  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1883831024169922  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5539226531982422  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6899099349975586  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6899099349975586  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1466265
first layer output nodes number: 591314
edges number: 12021072
torch.Size([1466265, 100])
torch.Size([591314, 256])
input nodes number: 591314
output nodes number: 187782
edges number: 5293510
torch.Size([591314, 256])
torch.Size([187782, 256])
torch.Size([25309, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.9515790939331055  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.9560112953186035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9022026062011719  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9022026062011719  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9022026062011719  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.2578074038028717 |0.172515869140625 |0.0554405152797699 |0.0001411736011505127 |0.004663795232772827 |0.0012454986572265625 |
----------------------------------------------------------pseudo_mini_loss sum 12.510263442993164
Total (block generation + training)time/epoch 314.39050817489624
Training time/epoch 4.023303270339966
Training time without block to device /epoch 2.643176317214966
Training time without total dataloading part /epoch 0.48320937156677246
load block tensor time/epoch 2.0624592304229736
block to device time/epoch 1.380126953125
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  21657320
Number of first layer input nodes during this epoch:  13247737
Number of first layer output nodes during this epoch:  6528958
----------------------------------------before generate dataloader block 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9022021293640137  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3913915157318115
global_2_local spend time (sec) 0.6081409454345703
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.032917022705078125
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181078, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12225151062011719
auxiliary_graph
Graph(num_nodes=1377649, num_edges=101592085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6327495574951172
remove nodes length  1181078

auxiliary_graph.remove_nodes spent  5.425385236740112
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101592085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.127042293548584

the counter of shared neighbor distribution
Counter({1.0: 76339074, 2.0: 14045470, 3.0: 5010672, 4.0: 2310438, 5.0: 1250692, 6.0: 739836, 7.0: 471014, 8.0: 320252, 9.0: 222946, 10.0: 161434, 11.0: 118206, 12.0: 90108, 13.0: 68208, 14.0: 53080, 15.0: 42064, 16.0: 31386, 17.0: 22226, 18.0: 19100, 19.0: 13390, 20.0: 10732, 21.0: 7146, 22.0: 5532, 23.0: 4856, 24.0: 3998, 25.0: 3558, 33.0: 3082, 28.0: 2884, 26.0: 2734, 30.0: 2352, 27.0: 2180, 39.0: 2092, 31.0: 2088, 32.0: 2088, 29.0: 1736, 35.0: 1716, 37.0: 1686, 36.0: 1476, 38.0: 1450, 34.0: 1444, 40.0: 1088})
101395514
Convert a graph into a bidirected graph: 6.904 seconds
Metis partitioning: 25.724 seconds
Split the graph: 3.206 seconds
Construct subgraphs: 0.037 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  35.91032409667969
25143
23862
24561
25307
25234
24206
24092
24166
total k batches seeds list generation spend  65.12398314476013
after graph partition
graph partition algorithm spend time 66.11741709709167
25143
23862
24561
25307
25234
24206
24092
24166
partition_len_list
[238132, 210680, 233849, 208808, 242678, 258652, 268366, 239115]
REG selection method  spend 67.0390031337738
time for parepare:  0.2729606628417969
local_output_nid generation:  0.006270170211791992
local_in_edges_tensor generation:  0.010180234909057617
mini_batch_src_global generation:  0.03786182403564453
r_  generation:  0.3331632614135742
local_output_nid generation:  0.006854534149169922
local_in_edges_tensor generation:  0.010818004608154297
mini_batch_src_global generation:  0.04145026206970215
r_  generation:  0.31435108184814453
local_output_nid generation:  0.0070993900299072266
local_in_edges_tensor generation:  0.013287544250488281
mini_batch_src_global generation:  0.0505833625793457
r_  generation:  0.33269596099853516
local_output_nid generation:  0.0070726871490478516
local_in_edges_tensor generation:  0.01480245590209961
mini_batch_src_global generation:  0.05980968475341797
r_  generation:  0.364471435546875
local_output_nid generation:  0.0070226192474365234
local_in_edges_tensor generation:  0.009794473648071289
mini_batch_src_global generation:  0.04137706756591797
r_  generation:  0.3634045124053955
local_output_nid generation:  0.006925344467163086
local_in_edges_tensor generation:  0.011932611465454102
mini_batch_src_global generation:  0.05245637893676758
r_  generation:  0.35219693183898926
local_output_nid generation:  0.006956577301025391
local_in_edges_tensor generation:  0.06712913513183594
mini_batch_src_global generation:  0.05947566032409668
r_  generation:  0.3901550769805908
local_output_nid generation:  0.009529352188110352
local_in_edges_tensor generation:  0.022495508193969727
mini_batch_src_global generation:  0.04523968696594238
r_  generation:  0.40102267265319824
----------------------check_connections_block total spend ----------------------------- 4.330422639846802
generate_one_block  0.8101840019226074
generate_one_block  0.47831225395202637
generate_one_block  0.4727041721343994
generate_one_block  0.44090962409973145
generate_one_block  0.46682286262512207
generate_one_block  0.42903852462768555
generate_one_block  0.4608006477355957
generate_one_block  0.4607405662536621
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.3154304027557373
gen group dst list time:  0.06321978569030762
time for parepare:  0.45022130012512207
local_output_nid generation:  0.06131458282470703
local_in_edges_tensor generation:  0.3244915008544922
mini_batch_src_global generation:  0.2542695999145508
r_  generation:  2.6132466793060303
local_output_nid generation:  0.0554356575012207
local_in_edges_tensor generation:  0.2496190071105957
mini_batch_src_global generation:  0.26053953170776367
r_  generation:  2.178584337234497
local_output_nid generation:  0.06457090377807617
local_in_edges_tensor generation:  0.2089378833770752
mini_batch_src_global generation:  0.2800743579864502
r_  generation:  2.5646095275878906
local_output_nid generation:  0.05509543418884277
local_in_edges_tensor generation:  0.19649648666381836
mini_batch_src_global generation:  0.2516913414001465
r_  generation:  2.1440987586975098
local_output_nid generation:  0.08396649360656738
local_in_edges_tensor generation:  0.23412132263183594
mini_batch_src_global generation:  0.2882883548736572
r_  generation:  2.7125587463378906
local_output_nid generation:  0.08323431015014648
local_in_edges_tensor generation:  0.23491668701171875
mini_batch_src_global generation:  0.3327805995941162
r_  generation:  3.0859646797180176
local_output_nid generation:  0.07653927803039551
local_in_edges_tensor generation:  0.21440887451171875
mini_batch_src_global generation:  0.3617513179779053
r_  generation:  3.343752384185791
local_output_nid generation:  0.06538033485412598
local_in_edges_tensor generation:  0.18343281745910645
mini_batch_src_global generation:  0.33362793922424316
r_  generation:  2.8188681602478027
----------------------check_connections_block total spend ----------------------------- 30.757697820663452
generate_one_block  4.156572103500366
generate_one_block  3.189321756362915
generate_one_block  3.6218791007995605
generate_one_block  2.768126964569092
generate_one_block  3.5104472637176514
generate_one_block  4.153163194656372
generate_one_block  4.315161228179932
generate_one_block  3.6507725715637207
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.295976400375366
gen group dst list time:  0.2474057674407959
time for parepare:  0.4646494388580322
local_output_nid generation:  0.24529504776000977
local_in_edges_tensor generation:  0.6671221256256104
mini_batch_src_global generation:  0.5961318016052246
r_  generation:  7.040484189987183
local_output_nid generation:  0.23727989196777344
local_in_edges_tensor generation:  0.6327147483825684
mini_batch_src_global generation:  0.6819007396697998
r_  generation:  6.588068246841431
local_output_nid generation:  0.3196732997894287
local_in_edges_tensor generation:  0.5432698726654053
mini_batch_src_global generation:  0.6865501403808594
r_  generation:  7.086410999298096
local_output_nid generation:  0.20496535301208496
local_in_edges_tensor generation:  0.3955521583557129
mini_batch_src_global generation:  0.5662243366241455
r_  generation:  5.366878509521484
local_output_nid generation:  0.2804224491119385
local_in_edges_tensor generation:  0.805656909942627
mini_batch_src_global generation:  0.7766027450561523
r_  generation:  8.171314001083374
local_output_nid generation:  0.3698117733001709
local_in_edges_tensor generation:  0.6814193725585938
mini_batch_src_global generation:  0.9339573383331299
r_  generation:  9.613648891448975
local_output_nid generation:  0.30824828147888184
local_in_edges_tensor generation:  0.6566116809844971
mini_batch_src_global generation:  0.8907115459442139
r_  generation:  8.718693494796753
local_output_nid generation:  0.24792861938476562
local_in_edges_tensor generation:  0.5098071098327637
mini_batch_src_global generation:  0.8125627040863037
r_  generation:  7.139416456222534
----------------------check_connections_block total spend ----------------------------- 84.09805226325989
generate_one_block  9.77907133102417
generate_one_block  9.008445978164673
generate_one_block  9.127650737762451
generate_one_block  6.71311616897583
generate_one_block  10.111406564712524
generate_one_block  11.882498264312744
generate_one_block  11.509060859680176
generate_one_block  8.962310075759888
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9022021293640137  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

connection checking time:  119.18617272377014
block generation total time  110.4785168170929
average batch blocks generation time:  4.603271534045537
block dataloader generation time/epoch 309.54018290837604
pseudo mini batch 0 input nodes size: 1715778
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5539216995239258  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5539216995239258  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.193099021911621  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.193286418914795  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6468710899353027  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8410592079162598  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8410592079162598  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1715778
first layer output nodes number: 799589
edges number: 17536507
torch.Size([1715778, 100])
torch.Size([799589, 256])
input nodes number: 799589
output nodes number: 238132
edges number: 7537895
torch.Size([799589, 256])
torch.Size([238132, 256])
torch.Size([25143, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.84702205657959  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.8518919944763184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1333794593811035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 1 input nodes size: 1715248
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6468429565429688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6468429565429688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.285822868347168  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2860007286071777  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6466360092163086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8176407814025879  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8176407814025879  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1715248
first layer output nodes number: 759205
edges number: 15913271
torch.Size([1715248, 100])
torch.Size([759205, 256])
input nodes number: 759205
output nodes number: 210680
edges number: 6040215
torch.Size([759205, 256])
torch.Size([210680, 256])
torch.Size([23862, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6104888916015625  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6146674156188965  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.073422908782959  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 2 input nodes size: 1676730
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6464114189147949  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6464114189147949  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2710423469543457  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2712254524230957  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6320676803588867  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8150882720947266  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8150882720947266  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1676730
first layer output nodes number: 831930
edges number: 16951169
torch.Size([1676730, 100])
torch.Size([831930, 256])
input nodes number: 831930
output nodes number: 233849
edges number: 6680553
torch.Size([831930, 256])
torch.Size([233849, 256])
torch.Size([24561, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.878631114959717  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.882932186126709  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0921945571899414  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 3 input nodes size: 1513500
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6321902275085449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6321902275085449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1960129737854004  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1962018013000488  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.571387767791748  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7137832641601562  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7137832641601562  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1513500
first layer output nodes number: 644103
edges number: 12527206
torch.Size([1513500, 100])
torch.Size([644103, 256])
input nodes number: 644103
output nodes number: 208808
edges number: 5543382
torch.Size([644103, 256])
torch.Size([208808, 256])
torch.Size([25307, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.180966377258301  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.1853981018066406  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9345998764038086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 4 input nodes size: 1746372
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5715184211730957  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5715184211730957  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.222093105316162  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2222814559936523  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6582698822021484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8599410057067871  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8599410057067871  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1746372
first layer output nodes number: 893840
edges number: 19069844
torch.Size([1746372, 100])
torch.Size([893840, 256])
input nodes number: 893840
output nodes number: 242678
edges number: 7008493
torch.Size([893840, 256])
torch.Size([242678, 256])
torch.Size([25234, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.126334190368652  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.130753040313721  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1571426391601562  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1800806
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.658257007598877  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.658257007598877  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3291096687316895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3292903900146484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6785273551940918  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9129853248596191  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9129853248596191  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1800806
first layer output nodes number: 1026427
edges number: 22603169
torch.Size([1800806, 100])
torch.Size([1026427, 256])
input nodes number: 1026427
output nodes number: 258652
edges number: 8015603
torch.Size([1026427, 256])
torch.Size([258652, 256])
torch.Size([24206, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.598298072814941  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.602537155151367  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2542338371276855  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1745715
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6783475875854492  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6783475875854492  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3286771774291992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3288569450378418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6578235626220703  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8832368850708008  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8832368850708008  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1745715
first layer output nodes number: 936109
edges number: 20799028
torch.Size([1745715, 100])
torch.Size([936109, 256])
input nodes number: 936109
output nodes number: 268366
edges number: 8509822
torch.Size([936109, 256])
torch.Size([268366, 256])
torch.Size([24092, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.3611345291137695  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.365357398986816  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2200164794921875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 7 input nodes size: 1537007
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6578035354614258  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6578035354614258  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2303833961486816  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2305636405944824  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5800542831420898  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7713832855224609  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7713832855224609  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1537007
first layer output nodes number: 770059
edges number: 17199408
torch.Size([1537007, 100])
torch.Size([770059, 256])
input nodes number: 770059
output nodes number: 239115
edges number: 7497229
torch.Size([770059, 256])
torch.Size([239115, 256])
torch.Size([24166, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.701977252960205  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.706209182739258  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0607476234436035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0607476234436035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0607476234436035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.26395928859710693 |0.1898116171360016 |0.056823521852493286 |0.00014096498489379883 |0.005104154348373413 |0.0033037662506103516 |
----------------------------------------------------------pseudo_mini_loss sum 3.6403911113739014
Total (block generation + training)time/epoch 314.1461857954661
Training time/epoch 4.247191905975342
Training time without block to device /epoch 2.728698968887329
Training time without total dataloading part /epoch 0.49985289573669434
load block tensor time/epoch 2.1116743087768555
block to device time/epoch 1.5184929370880127
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  22012698
Number of first layer input nodes during this epoch:  13451156
Number of first layer output nodes during this epoch:  6661262
----------------------------------------before generate dataloader block 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0607471466064453  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.342069149017334
global_2_local spend time (sec) 0.6201376914978027
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.03694415092468262
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181035, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12345457077026367
auxiliary_graph
Graph(num_nodes=1377606, num_edges=101674287,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.65814208984375
remove nodes length  1181035

auxiliary_graph.remove_nodes spent  5.46350622177124
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101674287,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.211418390274048

the counter of shared neighbor distribution
Counter({1.0: 76438302, 2.0: 14044614, 3.0: 5010044, 4.0: 2306628, 5.0: 1243674, 6.0: 737406, 7.0: 470430, 8.0: 317834, 9.0: 224420, 10.0: 161934, 11.0: 118450, 12.0: 89198, 13.0: 68550, 14.0: 52286, 15.0: 42424, 16.0: 31166, 17.0: 21944, 18.0: 19188, 19.0: 13520, 20.0: 10676, 21.0: 6852, 22.0: 5766, 23.0: 4726, 24.0: 4066, 25.0: 3670, 33.0: 2968, 28.0: 2830, 26.0: 2596, 30.0: 2356, 27.0: 2246, 31.0: 2206, 39.0: 2084, 32.0: 2044, 35.0: 1740, 29.0: 1672, 37.0: 1660, 36.0: 1542, 34.0: 1470, 38.0: 1456, 40.0: 1078})
101477716
Convert a graph into a bidirected graph: 6.770 seconds
Metis partitioning: 26.625 seconds
Split the graph: 3.776 seconds
Construct subgraphs: 0.030 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  37.23786783218384
23863
25224
23879
24982
24653
23920
24742
25308
total k batches seeds list generation spend  66.3412868976593
after graph partition
graph partition algorithm spend time 67.29720187187195
23863
25224
23879
24982
24653
23920
24742
25308
partition_len_list
[213703, 235646, 240647, 213947, 268190, 242903, 271834, 244450]
REG selection method  spend 68.2077271938324
time for parepare:  0.26320552825927734
local_output_nid generation:  0.00593113899230957
local_in_edges_tensor generation:  0.00886082649230957
mini_batch_src_global generation:  0.031308650970458984
r_  generation:  0.28538012504577637
local_output_nid generation:  0.007289409637451172
local_in_edges_tensor generation:  0.009598016738891602
mini_batch_src_global generation:  0.04392552375793457
r_  generation:  0.3420863151550293
local_output_nid generation:  0.006855010986328125
local_in_edges_tensor generation:  0.009119033813476562
mini_batch_src_global generation:  0.03717160224914551
r_  generation:  0.32680845260620117
local_output_nid generation:  0.007097005844116211
local_in_edges_tensor generation:  0.0093994140625
mini_batch_src_global generation:  0.037082672119140625
r_  generation:  0.3616774082183838
local_output_nid generation:  0.006971836090087891
local_in_edges_tensor generation:  0.009061574935913086
mini_batch_src_global generation:  0.0393223762512207
r_  generation:  0.3597550392150879
local_output_nid generation:  0.006905555725097656
local_in_edges_tensor generation:  0.008899450302124023
mini_batch_src_global generation:  0.03860592842102051
r_  generation:  0.33327579498291016
local_output_nid generation:  0.0073206424713134766
local_in_edges_tensor generation:  0.009466886520385742
mini_batch_src_global generation:  0.04753684997558594
r_  generation:  0.40763378143310547
local_output_nid generation:  0.007152080535888672
local_in_edges_tensor generation:  0.009657859802246094
mini_batch_src_global generation:  0.045458078384399414
r_  generation:  0.4046599864959717
----------------------check_connections_block total spend ----------------------------- 4.111517906188965
generate_one_block  0.6874704360961914
generate_one_block  0.5696651935577393
generate_one_block  0.4709813594818115
generate_one_block  0.4341461658477783
generate_one_block  0.46358513832092285
generate_one_block  0.40339231491088867
generate_one_block  0.4667980670928955
generate_one_block  0.4827859401702881
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.359354257583618
gen group dst list time:  0.05711102485656738
time for parepare:  0.4143500328063965
local_output_nid generation:  0.052835702896118164
local_in_edges_tensor generation:  0.2275545597076416
mini_batch_src_global generation:  0.2106935977935791
r_  generation:  2.117201805114746
local_output_nid generation:  0.07270455360412598
local_in_edges_tensor generation:  0.2770349979400635
mini_batch_src_global generation:  0.3352851867675781
r_  generation:  2.6703102588653564
local_output_nid generation:  0.09183073043823242
local_in_edges_tensor generation:  0.18158411979675293
mini_batch_src_global generation:  0.30052661895751953
r_  generation:  2.600706100463867
local_output_nid generation:  0.05783843994140625
local_in_edges_tensor generation:  0.11085247993469238
mini_batch_src_global generation:  0.2500112056732178
r_  generation:  2.1541502475738525
local_output_nid generation:  0.07001090049743652
local_in_edges_tensor generation:  0.19472050666809082
mini_batch_src_global generation:  0.32523393630981445
r_  generation:  3.059386968612671
local_output_nid generation:  0.06929659843444824
local_in_edges_tensor generation:  0.19147133827209473
mini_batch_src_global generation:  0.3361489772796631
r_  generation:  2.9053471088409424
local_output_nid generation:  0.07617855072021484
local_in_edges_tensor generation:  0.2102832794189453
mini_batch_src_global generation:  0.372791051864624
r_  generation:  3.437321424484253
local_output_nid generation:  0.06704497337341309
local_in_edges_tensor generation:  0.22372770309448242
mini_batch_src_global generation:  0.3449990749359131
r_  generation:  2.8581113815307617
----------------------check_connections_block total spend ----------------------------- 30.86690855026245
generate_one_block  3.471313238143921
generate_one_block  3.9629716873168945
generate_one_block  3.570202112197876
generate_one_block  2.9887855052948
generate_one_block  4.123515844345093
generate_one_block  3.8837008476257324
generate_one_block  4.389873743057251
generate_one_block  3.6977832317352295
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.5345447063446045
gen group dst list time:  0.24936652183532715
time for parepare:  0.4816761016845703
local_output_nid generation:  0.24862337112426758
local_in_edges_tensor generation:  0.6812665462493896
mini_batch_src_global generation:  0.5726003646850586
r_  generation:  6.721235990524292
local_output_nid generation:  0.2514774799346924
local_in_edges_tensor generation:  0.8514156341552734
mini_batch_src_global generation:  0.7637214660644531
r_  generation:  7.144373416900635
local_output_nid generation:  0.3247225284576416
local_in_edges_tensor generation:  0.5926604270935059
mini_batch_src_global generation:  0.7509052753448486
r_  generation:  7.805637836456299
local_output_nid generation:  0.22122573852539062
local_in_edges_tensor generation:  0.43813252449035645
mini_batch_src_global generation:  0.6636614799499512
r_  generation:  5.8943932056427
local_output_nid generation:  0.30212974548339844
local_in_edges_tensor generation:  0.6415205001831055
mini_batch_src_global generation:  0.8454570770263672
r_  generation:  9.169003963470459
local_output_nid generation:  0.3834216594696045
local_in_edges_tensor generation:  0.8150982856750488
mini_batch_src_global generation:  0.9404351711273193
r_  generation:  9.258921384811401
local_output_nid generation:  0.28809070587158203
local_in_edges_tensor generation:  0.606896162033081
mini_batch_src_global generation:  0.8675320148468018
r_  generation:  8.723832845687866
local_output_nid generation:  0.24083828926086426
local_in_edges_tensor generation:  0.522564172744751
mini_batch_src_global generation:  0.7527868747711182
r_  generation:  7.3491058349609375
----------------------check_connections_block total spend ----------------------------- 87.2772810459137
generate_one_block  9.488277912139893
generate_one_block  9.412088871002197
generate_one_block  10.007426738739014
generate_one_block  7.442129850387573
generate_one_block  11.406094551086426
generate_one_block  11.724212169647217
generate_one_block  11.026135444641113
generate_one_block  9.270892143249512
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0607471466064453  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

connection checking time:  122.25570750236511
block generation total time  113.84422850608826
average batch blocks generation time:  4.74350952108701
block dataloader generation time/epoch 311.4728411436081
pseudo mini batch 0 input nodes size: 1770355
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5800662040710449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5800662040710449  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.239574909210205  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2397527694702148  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6669926643371582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8454222679138184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8454222679138184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1770355
first layer output nodes number: 798050
edges number: 16785562
torch.Size([1770355, 100])
torch.Size([798050, 256])
input nodes number: 798050
output nodes number: 213703
edges number: 6125296
torch.Size([798050, 256])
torch.Size([213703, 256])
torch.Size([23863, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.7554779052734375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.7597103118896484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1130757331848145  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 1 input nodes size: 1733532
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6669406890869141  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6669406890869141  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3127317428588867  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.312920093536377  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.653233528137207  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8453159332275391  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8453159332275391  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1733532
first layer output nodes number: 804538
edges number: 17454991
torch.Size([1733532, 100])
torch.Size([804538, 256])
input nodes number: 804538
output nodes number: 235646
edges number: 7322749
torch.Size([804538, 256])
torch.Size([235646, 256])
torch.Size([25224, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.8554859161376953  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.859902858734131  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1352367401123047  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 2 input nodes size: 1763719
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6534714698791504  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6534714698791504  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3105082511901855  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3106865882873535  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6647071838378906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8609504699707031  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8609504699707031  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1763719
first layer output nodes number: 904156
edges number: 18530420
torch.Size([1763719, 100])
torch.Size([904156, 256])
input nodes number: 904156
output nodes number: 240647
edges number: 6909671
torch.Size([904156, 256])
torch.Size([240647, 256])
torch.Size([23879, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.141531467437744  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.146663665771484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1542134284973145  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 3 input nodes size: 1585368
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6644721031188965  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6644721031188965  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2550678253173828  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2552542686462402  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5980391502380371  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7494587898254395  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7494587898254395  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1585368
first layer output nodes number: 695646
edges number: 13697062
torch.Size([1585368, 100])
torch.Size([695646, 256])
input nodes number: 695646
output nodes number: 213947
edges number: 5689511
torch.Size([695646, 256])
torch.Size([213947, 256])
torch.Size([24982, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.374454975128174  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.3791275024414062  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9854092597961426  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 4 input nodes size: 1752504
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5982322692871094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5982322692871094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2510910034179688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2512750625610352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6604928970336914  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8840970993041992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8840970993041992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1752504
first layer output nodes number: 981619
edges number: 21147953
torch.Size([1752504, 100])
torch.Size([981619, 256])
input nodes number: 981619
output nodes number: 268190
edges number: 7945227
torch.Size([981619, 256])
torch.Size([268190, 256])
torch.Size([24653, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.475528240203857  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.4798455238342285  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2142810821533203  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1777903
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6604351997375488  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6604351997375488  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3227558135986328  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3229341506958008  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.669891357421875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8951196670532227  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8951196670532227  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1777903
first layer output nodes number: 990920
edges number: 21888244
torch.Size([1777903, 100])
torch.Size([990920, 256])
input nodes number: 990920
output nodes number: 242903
edges number: 7506539
torch.Size([990920, 256])
torch.Size([242903, 256])
torch.Size([23920, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.432163715362549  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.436352729797363  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.221696376800537  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1645282
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6697630882263184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6697630882263184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2826786041259766  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2828631401062012  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6203641891479492  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8398666381835938  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8398666381835938  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1645282
first layer output nodes number: 884953
edges number: 19772226
torch.Size([1645282, 100])
torch.Size([884953, 256])
input nodes number: 884953
output nodes number: 271834
edges number: 8712791
torch.Size([884953, 256])
torch.Size([271834, 256])
torch.Size([24742, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.1923699378967285  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.196702480316162  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1688971519470215  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 7 input nodes size: 1539082
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6205077171325684  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6205077171325684  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1938605308532715  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.19404935836792  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5809493064880371  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7705001831054688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7705001831054688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1539082
first layer output nodes number: 753413
edges number: 16765619
torch.Size([1539082, 100])
torch.Size([753413, 256])
input nodes number: 753413
output nodes number: 244450
edges number: 7638155
torch.Size([753413, 256])
torch.Size([244450, 256])
torch.Size([25308, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6736207008361816  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6780524253845215  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0585112571716309  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0585112571716309  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0585112571716309  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.27821484208106995 |0.24129000306129456 |0.058189570903778076 |0.00014331936836242676 |0.004940599203109741 |0.0012600421905517578 |
----------------------------------------------------------pseudo_mini_loss sum 4.510691165924072
Total (block generation + training)time/epoch 316.12448811531067
Training time/epoch 4.788248062133789
Training time without block to device /epoch 2.8579280376434326
Training time without total dataloading part /epoch 0.5074479579925537
load block tensor time/epoch 2.2257187366485596
block to device time/epoch 1.9303200244903564
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 3 |
Number of nodes for computation during this epoch:  22312360
Number of first layer input nodes during this epoch:  13567745
Number of first layer output nodes during this epoch:  6813295
----------------------------------------before generate dataloader block 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0585107803344727  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.37892627716064453
global_2_local spend time (sec) 0.6344730854034424
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.037662506103515625
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180944, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.1270124912261963
auxiliary_graph
Graph(num_nodes=1377515, num_edges=101823085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6828985214233398
remove nodes length  1180944

auxiliary_graph.remove_nodes spent  5.395265102386475
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101823085,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.7976202964782715

the counter of shared neighbor distribution
Counter({1.0: 76547122, 2.0: 14056272, 3.0: 5017922, 4.0: 2311666, 5.0: 1247774, 6.0: 739896, 7.0: 471840, 8.0: 321294, 9.0: 224538, 10.0: 162872, 11.0: 119210, 12.0: 90016, 13.0: 68792, 14.0: 52750, 15.0: 42010, 16.0: 30888, 17.0: 21954, 18.0: 19466, 19.0: 13842, 20.0: 10936, 21.0: 7212, 22.0: 5854, 23.0: 4770, 24.0: 4078, 25.0: 3548, 33.0: 2986, 28.0: 2878, 26.0: 2574, 30.0: 2376, 27.0: 2218, 31.0: 2152, 39.0: 2088, 32.0: 2030, 29.0: 1774, 35.0: 1730, 37.0: 1692, 36.0: 1502, 38.0: 1458, 34.0: 1450, 40.0: 1084})
101626514
Convert a graph into a bidirected graph: 6.780 seconds
Metis partitioning: 26.418 seconds
Split the graph: 3.336 seconds
Construct subgraphs: 0.041 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  36.614859104156494
25139
25180
25078
23854
24130
24315
25021
23854
total k batches seeds list generation spend  66.32950162887573
after graph partition
graph partition algorithm spend time 67.36338567733765
25139
25180
25078
23854
24130
24315
25021
23854
partition_len_list
[246906, 186702, 227473, 239161, 266875, 248819, 242266, 248354]
REG selection method  spend 68.30377149581909
time for parepare:  0.2708265781402588
local_output_nid generation:  0.006155490875244141
local_in_edges_tensor generation:  0.010002374649047852
mini_batch_src_global generation:  0.037235260009765625
r_  generation:  0.3379509449005127
local_output_nid generation:  0.007030963897705078
local_in_edges_tensor generation:  0.03758525848388672
mini_batch_src_global generation:  0.045670270919799805
r_  generation:  0.3233790397644043
local_output_nid generation:  0.0071620941162109375
local_in_edges_tensor generation:  0.013321876525878906
mini_batch_src_global generation:  0.0400698184967041
r_  generation:  0.343780517578125
local_output_nid generation:  0.007050037384033203
local_in_edges_tensor generation:  0.009398460388183594
mini_batch_src_global generation:  0.04152107238769531
r_  generation:  0.3417515754699707
local_output_nid generation:  0.007050275802612305
local_in_edges_tensor generation:  0.008842706680297852
mini_batch_src_global generation:  0.040244102478027344
r_  generation:  0.36969614028930664
local_output_nid generation:  0.007048606872558594
local_in_edges_tensor generation:  0.011398792266845703
mini_batch_src_global generation:  0.04064154624938965
r_  generation:  0.34094762802124023
local_output_nid generation:  0.007190704345703125
local_in_edges_tensor generation:  0.009505271911621094
mini_batch_src_global generation:  0.06686806678771973
r_  generation:  0.40377283096313477
local_output_nid generation:  0.0069277286529541016
local_in_edges_tensor generation:  0.015106678009033203
mini_batch_src_global generation:  0.0454869270324707
r_  generation:  0.3847970962524414
----------------------check_connections_block total spend ----------------------------- 4.22979998588562
generate_one_block  0.808262825012207
generate_one_block  0.5112917423248291
generate_one_block  0.4875607490539551
generate_one_block  0.45164060592651367
generate_one_block  0.45230627059936523
generate_one_block  0.4150044918060303
generate_one_block  0.4784114360809326
generate_one_block  0.45581674575805664
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.378218412399292
gen group dst list time:  0.05738210678100586
time for parepare:  0.4303710460662842
local_output_nid generation:  0.0621027946472168
local_in_edges_tensor generation:  0.31032562255859375
mini_batch_src_global generation:  0.2681734561920166
r_  generation:  2.71264910697937
local_output_nid generation:  0.04881429672241211
local_in_edges_tensor generation:  0.12661528587341309
mini_batch_src_global generation:  0.22828173637390137
r_  generation:  1.8481552600860596
local_output_nid generation:  0.06293702125549316
local_in_edges_tensor generation:  0.16315007209777832
mini_batch_src_global generation:  0.251619815826416
r_  generation:  2.4451234340667725
local_output_nid generation:  0.06987762451171875
local_in_edges_tensor generation:  0.16045594215393066
mini_batch_src_global generation:  0.2876427173614502
r_  generation:  2.650360345840454
local_output_nid generation:  0.0740504264831543
local_in_edges_tensor generation:  0.19902515411376953
mini_batch_src_global generation:  0.33136558532714844
r_  generation:  3.135538339614868
local_output_nid generation:  0.06802535057067871
local_in_edges_tensor generation:  0.18814635276794434
mini_batch_src_global generation:  0.3370845317840576
r_  generation:  3.0226974487304688
local_output_nid generation:  0.0655221939086914
local_in_edges_tensor generation:  0.18342971801757812
mini_batch_src_global generation:  0.34479308128356934
r_  generation:  2.901961326599121
local_output_nid generation:  0.0728309154510498
local_in_edges_tensor generation:  0.1952672004699707
mini_batch_src_global generation:  0.3558382987976074
r_  generation:  3.052743673324585
----------------------check_connections_block total spend ----------------------------- 30.64416241645813
generate_one_block  4.144368410110474
generate_one_block  2.7186968326568604
generate_one_block  3.2038185596466064
generate_one_block  3.5518996715545654
generate_one_block  4.145881175994873
generate_one_block  3.9776194095611572
generate_one_block  3.6566996574401855
generate_one_block  4.000482797622681
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.2719569206237793
gen group dst list time:  0.23549890518188477
time for parepare:  0.4644923210144043
local_output_nid generation:  0.24268841743469238
local_in_edges_tensor generation:  0.6654932498931885
mini_batch_src_global generation:  0.6011712551116943
r_  generation:  7.105064153671265
local_output_nid generation:  0.17949318885803223
local_in_edges_tensor generation:  0.3667256832122803
mini_batch_src_global generation:  0.5725255012512207
r_  generation:  4.843646049499512
local_output_nid generation:  0.2362668514251709
local_in_edges_tensor generation:  0.4742276668548584
mini_batch_src_global generation:  0.5818262100219727
r_  generation:  6.554572582244873
local_output_nid generation:  0.36214780807495117
local_in_edges_tensor generation:  0.7731614112854004
mini_batch_src_global generation:  0.7862746715545654
r_  generation:  8.086795330047607
local_output_nid generation:  0.31450867652893066
local_in_edges_tensor generation:  0.6641533374786377
mini_batch_src_global generation:  0.8792526721954346
r_  generation:  9.028057336807251
local_output_nid generation:  0.30735182762145996
local_in_edges_tensor generation:  0.6703948974609375
mini_batch_src_global generation:  0.9536099433898926
r_  generation:  9.125919818878174
local_output_nid generation:  0.24437475204467773
local_in_edges_tensor generation:  0.7657632827758789
mini_batch_src_global generation:  0.7882239818572998
r_  generation:  7.1830809116363525
local_output_nid generation:  0.3273050785064697
local_in_edges_tensor generation:  0.638303279876709
mini_batch_src_global generation:  0.837752103805542
r_  generation:  8.587789058685303
----------------------check_connections_block total spend ----------------------------- 85.26538062095642
generate_one_block  9.883359432220459
generate_one_block  6.2755796909332275
generate_one_block  8.13245677947998
generate_one_block  10.723912954330444
generate_one_block  11.482295513153076
generate_one_block  11.578876495361328
generate_one_block  9.167082071304321
generate_one_block  10.723698616027832
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0585107803344727  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

connection checking time:  120.13934302330017
block generation total time  111.42702293395996
average batch blocks generation time:  4.642792622248332
block dataloader generation time/epoch 311.72715005874636
pseudo mini batch 0 input nodes size: 1711065
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.581047534942627  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.581047534942627  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2184691429138184  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2186565399169922  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6451148986816406  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8409719467163086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8409719467163086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1711065
first layer output nodes number: 799516
edges number: 17539344
torch.Size([1711065, 100])
torch.Size([799516, 256])
input nodes number: 799516
output nodes number: 246906
edges number: 7681919
torch.Size([799516, 256])
torch.Size([246906, 256])
torch.Size([25139, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.875880241394043  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.880312442779541  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1371359825134277  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 1 input nodes size: 1454839
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6450862884521484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6450862884521484  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.187056064605713  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.187243938446045  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5496349334716797  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6841249465942383  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6841249465942383  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1454839
first layer output nodes number: 583609
edges number: 11856132
torch.Size([1454839, 100])
torch.Size([583609, 256])
input nodes number: 583609
output nodes number: 186702
edges number: 5261313
torch.Size([583609, 256])
torch.Size([186702, 256])
torch.Size([25180, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.920778274536133  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.925187587738037  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8926119804382324  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 2 input nodes size: 1627358
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5496420860290527  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5496420860290527  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1558804512023926  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1560673713684082  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6139097213745117  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.779266357421875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.779266357421875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1627358
first layer output nodes number: 756431
edges number: 14992542
torch.Size([1627358, 100])
torch.Size([756431, 256])
input nodes number: 756431
output nodes number: 227473
edges number: 6257767
torch.Size([756431, 256])
torch.Size([227473, 256])
torch.Size([25078, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6131792068481445  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6175708770751953  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0321588516235352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 3 input nodes size: 1837674
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6138920783996582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6138920783996582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2984790802001953  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.298656940460205  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6922316551208496  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8938069343566895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8938069343566895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1837674
first layer output nodes number: 940005
edges number: 19415577
torch.Size([1837674, 100])
torch.Size([940005, 256])
input nodes number: 940005
output nodes number: 239161
edges number: 6746592
torch.Size([940005, 256])
torch.Size([239161, 256])
torch.Size([23854, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.2662811279296875  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.270672798156738  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1912083625793457  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 4 input nodes size: 1734509
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6920170783996582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6920170783996582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.338172435760498  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3383526802062988  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.653587818145752  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8777327537536621  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8777327537536621  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1734509
first layer output nodes number: 979683
edges number: 21189369
torch.Size([1734509, 100])
torch.Size([979683, 256])
input nodes number: 979683
output nodes number: 266875
edges number: 7955109
torch.Size([979683, 256])
torch.Size([266875, 256])
torch.Size([24130, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.460744380950928  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.464970111846924  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2098078727722168  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1736133
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.654484748840332  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.654484748840332  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3012447357177734  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3014259338378906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.65509033203125  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8753957748413086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8753957748413086  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1736133
first layer output nodes number: 953609
edges number: 21016241
torch.Size([1736133, 100])
torch.Size([953609, 256])
input nodes number: 953609
output nodes number: 248819
edges number: 7701399
torch.Size([953609, 256])
torch.Size([248819, 256])
torch.Size([24315, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.330671787261963  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.334929943084717  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1977386474609375  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1518831
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6547842025756836  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6547842025756836  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.220592975616455  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2207794189453125  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5738382339477539  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7621192932128906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7621192932128906  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1518831
first layer output nodes number: 748166
edges number: 16683396
torch.Size([1518831, 100])
torch.Size([748166, 256])
input nodes number: 748166
output nodes number: 242266
edges number: 7597774
torch.Size([748166, 256])
torch.Size([242266, 256])
torch.Size([25021, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6444926261901855  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.6491894721984863  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.047591209411621  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 7 input nodes size: 1731821
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5734519958496094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5734519958496094  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2186059951782227  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2187838554382324  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6527886390686035  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8677811622619629  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8677811622619629  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1731821
first layer output nodes number: 902575
edges number: 20080616
torch.Size([1731821, 100])
torch.Size([902575, 256])
input nodes number: 902575
output nodes number: 248354
edges number: 7841100
torch.Size([902575, 256])
torch.Size([248354, 256])
torch.Size([23854, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.188302516937256  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.192479610443115  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1874322891235352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1874322891235352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1874322891235352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.26931843161582947 |0.19046369194984436 |0.056250154972076416 |0.00014591217041015625 |0.004790395498275757 |0.0012755393981933594 |
----------------------------------------------------------pseudo_mini_loss sum 3.367257595062256
Total (block generation + training)time/epoch 316.3085920333862
Training time/epoch 4.300353288650513
Training time without block to device /epoch 2.776643753051758
Training time without total dataloading part /epoch 0.490767240524292
load block tensor time/epoch 2.1545474529266357
block to device time/epoch 1.5237095355987549
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 4 |
Number of nodes for computation during this epoch:  21922380
Number of first layer input nodes during this epoch:  13352230
Number of first layer output nodes during this epoch:  6663594
----------------------------------------before generate dataloader block 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.187431812286377  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

The real block id is  2
get_global_graph_edges_ids_block function  spend 0.3220677375793457
global_2_local spend time (sec) 0.5566282272338867
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0351564884185791
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180968, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12255644798278809
auxiliary_graph
Graph(num_nodes=1377539, num_edges=101778399,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6491620540618896
remove nodes length  1180968

auxiliary_graph.remove_nodes spent  5.369686126708984
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101778399,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.278029441833496

the counter of shared neighbor distribution
Counter({1.0: 76534596, 2.0: 14039790, 3.0: 5006502, 4.0: 2312414, 5.0: 1247454, 6.0: 739086, 7.0: 470314, 8.0: 321348, 9.0: 224020, 10.0: 161382, 11.0: 118914, 12.0: 90378, 13.0: 69162, 14.0: 52818, 15.0: 41862, 16.0: 30822, 17.0: 21642, 18.0: 19400, 19.0: 13432, 20.0: 10984, 21.0: 7158, 22.0: 5670, 23.0: 5046, 24.0: 4118, 25.0: 3436, 28.0: 2922, 33.0: 2914, 26.0: 2610, 30.0: 2360, 27.0: 2328, 32.0: 2094, 39.0: 2088, 31.0: 2076, 29.0: 1772, 35.0: 1676, 37.0: 1662, 36.0: 1516, 34.0: 1496, 38.0: 1486, 40.0: 1080})
101581828
Convert a graph into a bidirected graph: 6.641 seconds
Metis partitioning: 26.339 seconds
Split the graph: 3.887 seconds
Construct subgraphs: 0.031 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  36.93576431274414
24503
25208
25287
23877
24827
23854
23954
25061
total k batches seeds list generation spend  65.64639115333557
after graph partition
graph partition algorithm spend time 66.62701725959778
24503
25208
25287
23877
24827
23854
23954
25061
partition_len_list
[265136, 240076, 218333, 237864, 181974, 254961, 260900, 242279]
REG selection method  spend 67.44318127632141
time for parepare:  0.2698512077331543
local_output_nid generation:  0.006015300750732422
local_in_edges_tensor generation:  0.009233474731445312
mini_batch_src_global generation:  0.03458428382873535
r_  generation:  0.3227367401123047
local_output_nid generation:  0.007061481475830078
local_in_edges_tensor generation:  0.00928807258605957
mini_batch_src_global generation:  0.043129682540893555
r_  generation:  0.34930968284606934
local_output_nid generation:  0.0070705413818359375
local_in_edges_tensor generation:  0.009362459182739258
mini_batch_src_global generation:  0.0351104736328125
r_  generation:  0.3406186103820801
local_output_nid generation:  0.0068721771240234375
local_in_edges_tensor generation:  0.008797883987426758
mini_batch_src_global generation:  0.0404508113861084
r_  generation:  0.3478989601135254
local_output_nid generation:  0.0070209503173828125
local_in_edges_tensor generation:  0.009095907211303711
mini_batch_src_global generation:  0.03847551345825195
r_  generation:  0.34230804443359375
local_output_nid generation:  0.006862163543701172
local_in_edges_tensor generation:  0.008737802505493164
mini_batch_src_global generation:  0.042197465896606445
r_  generation:  0.353562593460083
local_output_nid generation:  0.006995201110839844
local_in_edges_tensor generation:  0.008386850357055664
mini_batch_src_global generation:  0.044690847396850586
r_  generation:  0.3354330062866211
local_output_nid generation:  0.007167816162109375
local_in_edges_tensor generation:  0.009421348571777344
mini_batch_src_global generation:  0.04377627372741699
r_  generation:  0.39910888671875
----------------------check_connections_block total spend ----------------------------- 4.081177711486816
generate_one_block  0.622218132019043
generate_one_block  0.5156688690185547
generate_one_block  0.4702951908111572
generate_one_block  0.5234956741333008
generate_one_block  0.4752845764160156
generate_one_block  0.45563793182373047
generate_one_block  0.41148877143859863
generate_one_block  0.4834756851196289
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2672812938690186
gen group dst list time:  0.05555438995361328
time for parepare:  0.44895029067993164
local_output_nid generation:  0.06568098068237305
local_in_edges_tensor generation:  0.30973291397094727
mini_batch_src_global generation:  0.29208803176879883
r_  generation:  3.019355297088623
local_output_nid generation:  0.06342387199401855
local_in_edges_tensor generation:  0.16450929641723633
mini_batch_src_global generation:  0.3280525207519531
r_  generation:  2.765752077102661
local_output_nid generation:  0.06989574432373047
local_in_edges_tensor generation:  0.1468055248260498
mini_batch_src_global generation:  0.25121617317199707
r_  generation:  2.303750514984131
local_output_nid generation:  0.06516742706298828
local_in_edges_tensor generation:  0.15903830528259277
mini_batch_src_global generation:  0.29552650451660156
r_  generation:  2.6695969104766846
local_output_nid generation:  0.046240806579589844
local_in_edges_tensor generation:  0.15218853950500488
mini_batch_src_global generation:  0.23422479629516602
r_  generation:  1.8664300441741943
local_output_nid generation:  0.06679749488830566
local_in_edges_tensor generation:  0.20629072189331055
mini_batch_src_global generation:  0.29943132400512695
r_  generation:  2.8315622806549072
local_output_nid generation:  0.07334399223327637
local_in_edges_tensor generation:  0.27330875396728516
mini_batch_src_global generation:  0.3654799461364746
r_  generation:  3.3071494102478027
local_output_nid generation:  0.08791875839233398
local_in_edges_tensor generation:  0.19367694854736328
mini_batch_src_global generation:  0.335568904876709
r_  generation:  2.8738152980804443
----------------------check_connections_block total spend ----------------------------- 30.716344118118286
generate_one_block  4.545101642608643
generate_one_block  3.83243465423584
generate_one_block  2.8083462715148926
generate_one_block  3.383554697036743
generate_one_block  2.4083406925201416
generate_one_block  3.7690014839172363
generate_one_block  4.200078964233398
generate_one_block  3.9041459560394287
The real block id is  0
get_global_graph_edges_ids_block function  spend 2.3411195278167725
gen group dst list time:  0.23189520835876465
time for parepare:  0.421663761138916
local_output_nid generation:  0.26627135276794434
local_in_edges_tensor generation:  0.7242832183837891
mini_batch_src_global generation:  0.6893417835235596
r_  generation:  8.068308115005493
local_output_nid generation:  0.2796802520751953
local_in_edges_tensor generation:  0.5497636795043945
mini_batch_src_global generation:  0.7859551906585693
r_  generation:  7.495133638381958
local_output_nid generation:  0.23461580276489258
local_in_edges_tensor generation:  0.4509098529815674
mini_batch_src_global generation:  0.6254117488861084
r_  generation:  6.165300369262695
local_output_nid generation:  0.30498671531677246
local_in_edges_tensor generation:  0.5659270286560059
mini_batch_src_global generation:  0.7264959812164307
r_  generation:  7.675290584564209
local_output_nid generation:  0.17466235160827637
local_in_edges_tensor generation:  0.34841465950012207
mini_batch_src_global generation:  0.5778112411499023
r_  generation:  4.930325269699097
local_output_nid generation:  0.32548952102661133
local_in_edges_tensor generation:  0.7482001781463623
mini_batch_src_global generation:  0.8525886535644531
r_  generation:  9.121226072311401
local_output_nid generation:  0.3541600704193115
local_in_edges_tensor generation:  0.727104902267456
mini_batch_src_global generation:  0.9926290512084961
r_  generation:  10.039862632751465
local_output_nid generation:  0.24674367904663086
local_in_edges_tensor generation:  0.5821273326873779
mini_batch_src_global generation:  0.8205986022949219
r_  generation:  7.256882667541504
----------------------check_connections_block total spend ----------------------------- 85.26971888542175
generate_one_block  11.090126514434814
generate_one_block  9.664496421813965
generate_one_block  7.768526077270508
generate_one_block  9.7482750415802
generate_one_block  6.063055753707886
generate_one_block  11.925297737121582
generate_one_block  13.090278387069702
generate_one_block  8.916500806808472
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.187431812286377  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

connection checking time:  120.06724071502686
block generation total time  111.07512593269348
average batch blocks generation time:  4.628130247195561
block dataloader generation time/epoch 311.62023242314655
pseudo mini batch 0 input nodes size: 1724925
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.652583122253418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.652583122253418  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2951679229736328  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2953505516052246  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6500186920166016  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8673686981201172  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8673686981201172  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1724925
first layer output nodes number: 892339
edges number: 19825264
torch.Size([1724925, 100])
torch.Size([892339, 256])
input nodes number: 892339
output nodes number: 265136
edges number: 8387473
torch.Size([892339, 256])
torch.Size([265136, 256])
torch.Size([24503, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.216475009918213  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.220766544342041  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.194124698638916  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 1 input nodes size: 1694953
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6503109931945801  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6503109931945801  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2817306518554688  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2819185256958008  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6391510963439941  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8388676643371582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8388676643371582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1694953
first layer output nodes number: 820016
edges number: 18242488
torch.Size([1694953, 100])
torch.Size([820016, 256])
input nodes number: 820016
output nodes number: 240076
edges number: 7573490
torch.Size([820016, 256])
torch.Size([240076, 256])
torch.Size([25208, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.909088134765625  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.9139132499694824  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1388912200927734  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 2 input nodes size: 1627107
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6390972137451172  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6390972137451172  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2452421188354492  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2454309463500977  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.613823413848877  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7713065147399902  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.7713065147399902  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1627107
first layer output nodes number: 728451
edges number: 14356128
torch.Size([1627107, 100])
torch.Size([728451, 256])
input nodes number: 728451
output nodes number: 218333
edges number: 5832234
torch.Size([728451, 256])
torch.Size([218333, 256])
torch.Size([25287, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.49837064743042  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 3.5027990341186523  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.0135812759399414  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 3 input nodes size: 1762630
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6138372421264648  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6138372421264648  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2704682350158691  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.270646572113037  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6643128395080566  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8566975593566895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8566975593566895  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1762630
first layer output nodes number: 875939
edges number: 18041556
torch.Size([1762630, 100])
torch.Size([875939, 256])
input nodes number: 875939
output nodes number: 237864
edges number: 6879259
torch.Size([875939, 256])
torch.Size([237864, 256])
torch.Size([23877, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.053125858306885  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.057307243347168  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1449437141418457  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 4 input nodes size: 1435146
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6640658378601074  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6640658378601074  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1986994743347168  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.1988844871520996  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5420751571655273  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6739273071289062  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6739273071289062  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1435146
first layer output nodes number: 564496
edges number: 11439579
torch.Size([1435146, 100])
torch.Size([564496, 256])
input nodes number: 564496
output nodes number: 181974
edges number: 5114599
torch.Size([564496, 256])
torch.Size([181974, 256])
torch.Size([24827, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.8435544967651367  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 2.847902297973633  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.8763384819030762  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 5 input nodes size: 1845436
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5422415733337402  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.5422415733337402  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.229720115661621  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2298979759216309  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6950793266296387  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.921196460723877  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.921196460723877  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1845436
first layer output nodes number: 1020296
edges number: 21970565
torch.Size([1845436, 100])
torch.Size([1020296, 256])
input nodes number: 1020296
output nodes number: 254961
edges number: 7386808
torch.Size([1020296, 256])
torch.Size([254961, 256])
torch.Size([23854, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.572026252746582  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 4.576203346252441  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.2499322891235352  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

pseudo mini batch 6 input nodes size: 1834116
----------------------------------------before load block subtensor 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.694908618927002  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.694908618927002  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3781704902648926  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 1.3783493041992188  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.6906929016113281  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9330806732177734  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 16.8319091796875 GB
    Memory Allocated: 0.9330806732177734  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

first layer input nodes number: 1834116
first layer output nodes number: 1066948
edges number: 23569701
torch.Size([1834116, 100])
torch.Size([1066948, 256])
input nodes number: 1066948
output nodes number: 260900
edges number: 8125059
torch.Size([1066948, 256])
torch.Size([260900, 256])
torch.Size([23954, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 19.8885498046875 GB
    Memory Allocated: 4.735946178436279  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 19.8885498046875 GB
    Memory Allocated: 4.740140914916992  GigaBytes
Max Memory Allocated: 5.959071159362793  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.283921718597412  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

pseudo mini batch 7 input nodes size: 1527983
----------------------------------------before load block subtensor 
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 0.6907105445861816  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 0.6907105445861816  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.2599287033081055  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.260115623474121  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 0.5766749382019043  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 0.7658276557922363  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 0.7658276557922363  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

first layer input nodes number: 1527983
first layer output nodes number: 753960
edges number: 16809672
torch.Size([1527983, 100])
torch.Size([753960, 256])
input nodes number: 753960
output nodes number: 242279
edges number: 7586900
torch.Size([753960, 256])
torch.Size([242279, 256])
torch.Size([25061, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 3.6634902954101562  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 3.667879104614258  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.053006649017334  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.053006649017334  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 20.9139404296875 GB
    Memory Allocated: 1.053006649017334  GigaBytes
Max Memory Allocated: 6.006084442138672  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.26155102252960205 |0.23232027888298035 |0.05836448073387146 |0.0001494884490966797 |0.0145951509475708 |0.001280069351196289 |
----------------------------------------------------------pseudo_mini_loss sum 2.2391879558563232
Total (block generation + training)time/epoch 316.2152637243271
Training time/epoch 4.662578344345093
Training time without block to device /epoch 2.80401611328125
Training time without total dataloading part /epoch 0.5861530303955078
load block tensor time/epoch 2.0924081802368164
block to device time/epoch 1.8585622310638428
input features size transfer per epoch 1.0728836059570312e-06
blocks size to device per epoch 7.152557373046875e-07
 Run 0| Epoch 5 |
Number of nodes for computation during this epoch:  22076264
Number of first layer input nodes during this epoch:  13452296
Number of first layer output nodes during this epoch:  6722445
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=100, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=256, bias=False)
    )
    (2): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  206336
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 100])
layers.0.fc_neigh.weight, torch.Size([256, 100])
layers.1.fc_self.weight, torch.Size([256, 256])
layers.1.fc_neigh.weight, torch.Size([256, 256])
layers.2.fc_self.weight, torch.Size([47, 256])
layers.2.fc_neigh.weight, torch.Size([47, 256])
----------------------------------------
un-trainable parameters
