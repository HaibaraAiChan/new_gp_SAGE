main start at this time 1658189044.107064
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0022430419921875  GigaBytes
Max Memory Allocated: 0.0022430419921875  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0022430419921875  GigaBytes
Max Memory Allocated: 0.0022430419921875  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.09124016761779785
global_2_local spend time (sec) 0.3292245864868164
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.016448974609375
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 809158, 15: 189452, 14: 695, 7: 655, 10: 640, 11: 624, 13: 615, 12: 583, 9: 576, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.05983448028564453
auxiliary_graph
Graph(num_nodes=1005729, num_edges=22639839,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5206913948059082
remove nodes length  809158

auxiliary_graph.remove_nodes spent  1.288322925567627
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=22639839,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.9521534442901611

the counter of shared neighbor distribution
Counter({1.0: 19991684, 2.0: 1794372, 3.0: 401822, 4.0: 133762, 5.0: 53900, 6.0: 23014, 7.0: 13780, 8.0: 6972, 9.0: 5604, 10.0: 3978, 14.0: 3312, 12.0: 3152, 15.0: 3114, 11.0: 2724, 13.0: 2078})
22443268
Convert a graph into a bidirected graph: 1.327 seconds
Metis partitioning: 5.189 seconds
Split the graph: 2.568 seconds
Construct subgraphs: 0.062 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  9.156793117523193
97658
98913
total k batches seeds list generation spend  16.876904249191284
after graph partition
graph partition algorithm spend time 17.389572620391846
97658
98913
partition_len_list
[503794, 550518]
REG selection method  spend 17.936869621276855
time for parepare:  0.21235108375549316
local_output_nid generation:  0.013237953186035156
local_in_edges_tensor generation:  0.016904592514038086
mini_batch_src_global generation:  0.045900821685791016
r_  generation:  0.6480238437652588
local_output_nid generation:  0.014482259750366211
local_in_edges_tensor generation:  0.03224539756774902
mini_batch_src_global generation:  0.06352829933166504
r_  generation:  0.7299914360046387
----------------------check_connections_block total spend ----------------------------- 2.053072214126587
generate_one_block  2.3199236392974854
generate_one_block  0.913794994354248
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.6141130924224854
gen group dst list time:  0.029160022735595703
time for parepare:  0.3882923126220703
local_output_nid generation:  0.08901333808898926
local_in_edges_tensor generation:  0.21251964569091797
mini_batch_src_global generation:  0.15393638610839844
r_  generation:  2.448115825653076
local_output_nid generation:  0.10414743423461914
local_in_edges_tensor generation:  0.14447903633117676
mini_batch_src_global generation:  0.2115638256072998
r_  generation:  2.8711392879486084
----------------------check_connections_block total spend ----------------------------- 7.579073429107666
generate_one_block  3.457465887069702
generate_one_block  3.8751587867736816
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0022430419921875  GigaBytes
Max Memory Allocated: 0.0022430419921875  GigaBytes

connection checking time:  9.632145643234253
block generation total time  10.566343307495117
average batch blocks generation time:  2.6415858268737793
block dataloader generation time/epoch 39.78719162940979
pseudo mini batch 0 input nodes size: 997691
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0022430419921875  GigaBytes
Max Memory Allocated: 0.0022430419921875  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0022430419921875  GigaBytes
Max Memory Allocated: 0.0022430419921875  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.3924560546875 GB
    Memory Allocated: 0.37391233444213867  GigaBytes
Max Memory Allocated: 0.37391233444213867  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.3924560546875 GB
    Memory Allocated: 0.37463998794555664  GigaBytes
Max Memory Allocated: 0.37463998794555664  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.3924560546875 GB
    Memory Allocated: 0.37463998794555664  GigaBytes
Max Memory Allocated: 0.37463998794555664  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.5155029296875 GB
    Memory Allocated: 0.4217514991760254  GigaBytes
Max Memory Allocated: 0.4217514991760254  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.5155029296875 GB
    Memory Allocated: 0.4217514991760254  GigaBytes
Max Memory Allocated: 0.4217514991760254  GigaBytes

first layer input nodes number: 997691
first layer output nodes number: 503794
edges number: 4881910
----------------------------------------before model layer 0
 Nvidia-smi: 1.5545654296875 GB
    Memory Allocated: 0.4329385757446289  GigaBytes
Max Memory Allocated: 0.4511251449584961  GigaBytes

torch.Size([997691, 100])
----------------------------------------before mean aggregator
 Nvidia-smi: 1.5545654296875 GB
    Memory Allocated: 0.4329385757446289  GigaBytes
Max Memory Allocated: 0.4511251449584961  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 6.2967529296875 GB
    Memory Allocated: 4.502616882324219  GigaBytes
Max Memory Allocated: 4.502616882324219  GigaBytes

h_neigh size torch.Size([503794, 2048])
torch.Size([503794, 2048])
torch.Size([503794, 2048])
----------------------------------------after rst
 Nvidia-smi: 13.9842529296875 GB
    Memory Allocated: 8.346366882324219  GigaBytes
Max Memory Allocated: 12.190116882324219  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 13.9842529296875 GB
    Memory Allocated: 4.502616882324219  GigaBytes
Max Memory Allocated: 12.190116882324219  GigaBytes

torch.Size([503794, 2048])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 13.9842529296875 GB
    Memory Allocated: 8.346366882324219  GigaBytes
Max Memory Allocated: 12.190116882324219  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 14.9451904296875 GB
    Memory Allocated: 9.307304382324219  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

----------------input nodes number: 503794
----------------output nodes number: 97658
----------------edges number: 1441227
----------------------------------------before mean aggregator
 Nvidia-smi: 14.9451904296875 GB
    Memory Allocated: 9.311785697937012  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 15.5037841796875 GB
    Memory Allocated: 10.085422039031982  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

h_neigh size torch.Size([97658, 47])
torch.Size([97658, 47])
torch.Size([97658, 47])
----------------------------------------after rst
 Nvidia-smi: 15.5037841796875 GB
    Memory Allocated: 10.102520942687988  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 15.5037841796875 GB
    Memory Allocated: 10.085422039031982  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

torch.Size([97658, 47])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 15.5037841796875 GB
    Memory Allocated: 10.102520942687988  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 15.5037841796875 GB
    Memory Allocated: 10.11962080001831  GigaBytes
Max Memory Allocated: 13.151054382324219  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.5187301635742188  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

pseudo mini batch 1 input nodes size: 1077260
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.3939828872680664  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.3939828872680664  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.7952938079833984  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.7960309982299805  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.42363405227661133  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.474912166595459  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.474912166595459  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

first layer input nodes number: 1077260
first layer output nodes number: 550518
edges number: 5420844
----------------------------------------before model layer 0
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.48704051971435547  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

torch.Size([1077260, 100])
----------------------------------------before mean aggregator
 Nvidia-smi: 23.2108154296875 GB
    Memory Allocated: 0.48704051971435547  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 11.7108154296875 GB
    Memory Allocated: 4.935544490814209  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

h_neigh size torch.Size([550518, 2048])
torch.Size([550518, 2048])
torch.Size([550518, 2048])
----------------------------------------after rst
 Nvidia-smi: 20.1131591796875 GB
    Memory Allocated: 9.135663509368896  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 20.1131591796875 GB
    Memory Allocated: 4.935544490814209  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

torch.Size([550518, 2048])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 20.1131591796875 GB
    Memory Allocated: 9.135663509368896  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 21.1639404296875 GB
    Memory Allocated: 10.186444759368896  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------input nodes number: 550518
----------------output nodes number: 98913
----------------edges number: 1461489
----------------------------------------before mean aggregator
 Nvidia-smi: 21.1658935546875 GB
    Memory Allocated: 10.191283702850342  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 21.1756591796875 GB
    Memory Allocated: 10.97487497329712  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

h_neigh size torch.Size([98913, 47])
torch.Size([98913, 47])
torch.Size([98913, 47])
----------------------------------------after rst
 Nvidia-smi: 21.1756591796875 GB
    Memory Allocated: 10.992193698883057  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 21.1756591796875 GB
    Memory Allocated: 10.97487497329712  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

torch.Size([98913, 47])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.1756591796875 GB
    Memory Allocated: 10.97509479522705  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.1756591796875 GB
    Memory Allocated: 10.992413997650146  GigaBytes
Max Memory Allocated: 17.040820121765137  GigaBytes

