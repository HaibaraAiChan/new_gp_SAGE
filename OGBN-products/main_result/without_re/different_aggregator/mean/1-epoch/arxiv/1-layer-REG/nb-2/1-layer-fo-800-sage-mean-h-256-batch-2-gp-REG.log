main start at this time 1658035026.192398
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04010748863220215
global_2_local spend time (sec) 0.036574602127075195
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.005933284759521484
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 71691, 1: 13428, 2: 11706, 3: 9277, 4: 7320, 5: 6222, 6: 4868, 7: 4045, 8: 3472, 9: 2976, 10: 2599, 11: 2203, 12: 1937, 13: 1656, 14: 1434, 15: 1289, 16: 1111, 17: 1030, 18: 948, 19: 836, 20: 807, 21: 717, 22: 556, 24: 525, 23: 519, 25: 483, 26: 409, 27: 390, 28: 370, 29: 329, 31: 300, 32: 273, 30: 261, 33: 261, 34: 231, 36: 226, 35: 200, 39: 200, 37: 196, 38: 186, 41: 167, 42: 165, 40: 161, 45: 142, 43: 138, 44: 135, 48: 112, 46: 106, 47: 105, 51: 104, 49: 91, 55: 90, 50: 89, 800: 84, 52: 81, 53: 79, 54: 78, 58: 73, 56: 71, 61: 69, 67: 68, 57: 68, 72: 63, 60: 63, 62: 62, 59: 55, 65: 54, 63: 52, 66: 51, 64: 49, 69: 47, 70: 44, 71: 43, 68: 42, 77: 40, 86: 39, 87: 38, 74: 36, 75: 35, 82: 35, 81: 35, 84: 33, 73: 32, 80: 31, 76: 31, 105: 30, 94: 29, 98: 29, 83: 29, 95: 27, 112: 27, 79: 27, 85: 27, 91: 27, 99: 26, 88: 25, 111: 25, 92: 24, 101: 24, 89: 24, 90: 23, 93: 22, 78: 22, 97: 21, 96: 20, 103: 20, 109: 20, 122: 20, 117: 19, 104: 18, 113: 18, 123: 18, 100: 18, 106: 17, 108: 17, 133: 17, 107: 17, 130: 16, 116: 16, 102: 16, 115: 14, 125: 14, 128: 14, 127: 13, 134: 13, 161: 13, 153: 13, 118: 13, 136: 13, 120: 12, 121: 12, 146: 12, 124: 12, 114: 12, 145: 11, 151: 11, 140: 11, 157: 11, 155: 11, 166: 11, 110: 10, 170: 10, 150: 10, 132: 9, 135: 9, 129: 9, 141: 9, 209: 9, 119: 9, 152: 8, 181: 8, 143: 8, 126: 8, 156: 8, 162: 8, 137: 8, 200: 8, 165: 8, 149: 7, 211: 7, 186: 7, 148: 7, 241: 7, 182: 7, 154: 7, 172: 7, 199: 6, 210: 6, 216: 6, 168: 6, 252: 6, 144: 6, 197: 6, 269: 6, 159: 6, 139: 6, 178: 6, 194: 6, 167: 6, 171: 5, 131: 5, 237: 5, 176: 5, 185: 5, 142: 5, 147: 5, 203: 5, 177: 5, 300: 5, 160: 5, 205: 5, 173: 5, 270: 5, 195: 5, 138: 4, 179: 4, 217: 4, 275: 4, 190: 4, 212: 4, 222: 4, 285: 4, 218: 4, 183: 4, 175: 4, 198: 4, 349: 4, 261: 4, 277: 4, 163: 4, 251: 4, 264: 4, 164: 4, 231: 4, 297: 3, 452: 3, 343: 3, 530: 3, 192: 3, 333: 3, 208: 3, 196: 3, 253: 3, 562: 3, 254: 3, 191: 3, 391: 3, 260: 3, 335: 3, 278: 3, 263: 3, 281: 3, 174: 3, 416: 3, 234: 3, 505: 3, 158: 3, 202: 3, 248: 3, 187: 3, 223: 3, 219: 3, 319: 3, 246: 3, 232: 3, 215: 3, 224: 3, 235: 3, 221: 3, 368: 3, 282: 3, 450: 3, 291: 3, 312: 3, 370: 3, 471: 3, 204: 3, 302: 2, 169: 2, 201: 2, 547: 2, 332: 2, 244: 2, 193: 2, 379: 2, 363: 2, 207: 2, 596: 2, 310: 2, 296: 2, 225: 2, 184: 2, 284: 2, 268: 2, 213: 2, 279: 2, 188: 2, 378: 2, 311: 2, 247: 2, 355: 2, 458: 2, 180: 2, 265: 2, 267: 2, 318: 2, 502: 2, 256: 2, 280: 2, 679: 2, 390: 2, 243: 2, 262: 2, 529: 2, 245: 2, 325: 2, 276: 2, 189: 2, 233: 2, 287: 2, 229: 2, 214: 2, 356: 2, 250: 2, 380: 2, 308: 2, 238: 2, 344: 2, 528: 2, 317: 2, 539: 2, 226: 2, 328: 2, 365: 2, 342: 2, 236: 2, 664: 2, 553: 1, 470: 1, 387: 1, 656: 1, 543: 1, 377: 1, 731: 1, 620: 1, 294: 1, 338: 1, 476: 1, 787: 1, 500: 1, 439: 1, 482: 1, 635: 1, 327: 1, 659: 1, 374: 1, 239: 1, 383: 1, 348: 1, 677: 1, 453: 1, 733: 1, 517: 1, 381: 1, 345: 1, 569: 1, 331: 1, 425: 1, 558: 1, 479: 1, 571: 1, 775: 1, 727: 1, 614: 1, 354: 1, 722: 1, 388: 1, 373: 1, 249: 1, 674: 1, 273: 1, 532: 1, 272: 1, 454: 1, 307: 1, 386: 1, 406: 1, 523: 1, 367: 1, 320: 1, 329: 1, 288: 1, 410: 1, 481: 1, 395: 1, 464: 1, 475: 1, 350: 1, 382: 1, 497: 1, 556: 1, 598: 1, 629: 1, 357: 1, 371: 1, 255: 1, 769: 1, 708: 1, 657: 1, 403: 1, 321: 1, 561: 1, 337: 1, 316: 1, 375: 1, 797: 1, 682: 1, 358: 1, 372: 1, 506: 1, 461: 1, 336: 1, 473: 1, 286: 1, 298: 1, 240: 1, 323: 1, 466: 1, 361: 1, 274: 1, 305: 1, 304: 1, 765: 1, 230: 1, 435: 1, 227: 1, 351: 1, 480: 1, 762: 1, 405: 1, 259: 1, 570: 1, 730: 1, 578: 1, 791: 1, 341: 1, 593: 1, 346: 1, 438: 1, 334: 1, 402: 1, 366: 1, 580: 1, 376: 1, 522: 1, 739: 1, 644: 1, 536: 1, 774: 1, 257: 1, 432: 1, 389: 1, 760: 1, 748: 1, 283: 1, 703: 1, 369: 1, 462: 1, 488: 1, 460: 1, 697: 1, 362: 1, 258: 1, 419: 1, 535: 1, 415: 1, 499: 1, 734: 1, 442: 1, 428: 1, 407: 1})

A = g.adjacency_matrix() spent  0.01999974250793457
auxiliary_graph
Graph(num_nodes=162632, num_edges=46102297,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.08115291595458984
remove nodes length  71691

auxiliary_graph.remove_nodes spent  2.1918952465057373
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=46102297,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  2.042834997177124

the counter of shared neighbor distribution
Counter({1.0: 32672192, 2.0: 8093144, 3.0: 2773814, 4.0: 1102944, 5.0: 510618, 6.0: 268390, 7.0: 157250, 8.0: 100336, 9.0: 68178, 10.0: 48160, 11.0: 35778, 12.0: 27214, 13.0: 21150, 14.0: 17102, 15.0: 14140, 16.0: 11292, 17.0: 9594, 18.0: 8136, 19.0: 6950, 20.0: 5874, 21.0: 5200, 22.0: 4510, 23.0: 3954, 24.0: 3442, 25.0: 3094, 26.0: 2778, 27.0: 2512, 28.0: 2332, 29.0: 1980, 30.0: 1904, 31.0: 1714, 32.0: 1568, 33.0: 1474, 34.0: 1356, 35.0: 1236, 36.0: 1130, 37.0: 954, 38.0: 942, 39.0: 938, 40.0: 840, 41.0: 766, 43.0: 674, 44.0: 648, 42.0: 644, 45.0: 588, 47.0: 524, 48.0: 516, 46.0: 484, 49.0: 426, 50.0: 398, 52.0: 376, 51.0: 374, 53.0: 348, 54.0: 306, 58.0: 302, 56.0: 300, 59.0: 284, 55.0: 280, 57.0: 262, 60.0: 260, 62.0: 244, 66.0: 218, 63.0: 216, 61.0: 208, 65.0: 198, 68.0: 178, 64.0: 176, 67.0: 172, 70.0: 164, 73.0: 158, 69.0: 152, 71.0: 150, 77.0: 136, 79.0: 136, 78.0: 132, 81.0: 132, 75.0: 128, 76.0: 128, 72.0: 118, 80.0: 116, 74.0: 108, 82.0: 94, 83.0: 92, 94.0: 90, 84.0: 82, 89.0: 82, 93.0: 78, 85.0: 76, 95.0: 76, 88.0: 70, 87.0: 70, 86.0: 70, 97.0: 66, 90.0: 64, 98.0: 62, 91.0: 60, 106.0: 58, 105.0: 50, 101.0: 50, 92.0: 50, 99.0: 48, 102.0: 48, 107.0: 48, 112.0: 44, 103.0: 44, 120.0: 42, 111.0: 40, 96.0: 38, 121.0: 36, 115.0: 36, 108.0: 34, 116.0: 34, 114.0: 34, 109.0: 32, 124.0: 30, 100.0: 30, 110.0: 28, 127.0: 28, 117.0: 26, 128.0: 26, 131.0: 24, 118.0: 24, 119.0: 24, 162.0: 22, 142.0: 22, 123.0: 20, 122.0: 20, 113.0: 20, 125.0: 20, 136.0: 20, 126.0: 20, 135.0: 18, 146.0: 18, 139.0: 18, 104.0: 18, 140.0: 18, 155.0: 18, 141.0: 16, 177.0: 16, 133.0: 16, 143.0: 16, 134.0: 16, 149.0: 14, 145.0: 14, 168.0: 14, 130.0: 14, 132.0: 14, 129.0: 14, 173.0: 12, 137.0: 12, 159.0: 12, 144.0: 12, 164.0: 12, 154.0: 12, 147.0: 12, 138.0: 12, 183.0: 10, 198.0: 10, 171.0: 10, 165.0: 10, 152.0: 10, 150.0: 10, 167.0: 8, 170.0: 8, 166.0: 8, 174.0: 8, 156.0: 8, 163.0: 8, 187.0: 8, 184.0: 8, 178.0: 8, 151.0: 8, 228.0: 8, 161.0: 8, 194.0: 8, 192.0: 8, 189.0: 8, 181.0: 8, 188.0: 6, 224.0: 6, 205.0: 6, 196.0: 6, 148.0: 6, 231.0: 6, 158.0: 6, 160.0: 6, 211.0: 6, 185.0: 6, 223.0: 6, 257.0: 4, 269.0: 4, 246.0: 4, 199.0: 4, 182.0: 4, 195.0: 4, 248.0: 4, 190.0: 4, 172.0: 4, 206.0: 4, 197.0: 4, 203.0: 4, 210.0: 4, 157.0: 4, 229.0: 4, 288.0: 4, 176.0: 4, 169.0: 4, 214.0: 4, 225.0: 4, 234.0: 4, 186.0: 4, 209.0: 2, 312.0: 2, 217.0: 2, 253.0: 2, 390.0: 2, 240.0: 2, 271.0: 2, 242.0: 2, 227.0: 2, 302.0: 2, 252.0: 2, 216.0: 2, 296.0: 2, 356.0: 2, 193.0: 2, 359.0: 2, 180.0: 2, 256.0: 2, 355.0: 2, 376.0: 2, 383.0: 2, 245.0: 2, 299.0: 2, 264.0: 2, 179.0: 2, 251.0: 2, 569.0: 2, 289.0: 2, 259.0: 2, 226.0: 2, 279.0: 2, 377.0: 2, 308.0: 2, 287.0: 2, 284.0: 2, 230.0: 2, 175.0: 2, 191.0: 2, 235.0: 2, 352.0: 2, 266.0: 2, 153.0: 2, 328.0: 2, 243.0: 2, 200.0: 2, 219.0: 2, 207.0: 2, 262.0: 2, 201.0: 2, 286.0: 2, 283.0: 2})
46011356
Convert a graph into a bidirected graph: 2.126 seconds
Metis partitioning: 7.149 seconds
Split the graph: 7.194 seconds
Construct subgraphs: 0.051 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  16.540673971176147
44997
45944
total k batches seeds list generation spend  27.47107696533203
after graph partition
graph partition algorithm spend time 27.628578662872314
44997
45944
partition_len_list
[68407, 110530]
REG selection method  spend 27.714818954467773
time for parepare:  0.017490625381469727
local_output_nid generation:  0.00439763069152832
local_in_edges_tensor generation:  0.006482839584350586
mini_batch_src_global generation:  0.012305021286010742
r_  generation:  0.13097071647644043
local_output_nid generation:  0.006886482238769531
local_in_edges_tensor generation:  0.014861822128295898
mini_batch_src_global generation:  0.03177285194396973
r_  generation:  0.2703714370727539
----------------------check_connections_block total spend ----------------------------- 0.5949199199676514
generate_one_block  0.1755986213684082
generate_one_block  0.35221242904663086
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

connection checking time:  0.5949199199676514
block generation total time  0.5278110504150391
average batch blocks generation time:  0.26390552520751953
block dataloader generation time/epoch 28.948743104934692
pseudo mini batch 0 input nodes size: 68407
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 3.814697265625e-05  GigaBytes
Max Memory Allocated: 3.814697265625e-05  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.0506591796875 GB
    Memory Allocated: 0.03324127197265625  GigaBytes
Max Memory Allocated: 0.03324127197265625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.0506591796875 GB
    Memory Allocated: 0.03357696533203125  GigaBytes
Max Memory Allocated: 0.03357696533203125  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.0506591796875 GB
    Memory Allocated: 0.03357696533203125  GigaBytes
Max Memory Allocated: 0.03357696533203125  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.1346435546875 GB
    Memory Allocated: 0.036362648010253906  GigaBytes
Max Memory Allocated: 0.036362648010253906  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1346435546875 GB
    Memory Allocated: 0.036362648010253906  GigaBytes
Max Memory Allocated: 0.036362648010253906  GigaBytes

----------------input nodes number: 68407
----------------output nodes number: 44997
----------------edges number: 373763
----------------------------------------before mean aggregator
 Nvidia-smi: 1.1346435546875 GB
    Memory Allocated: 0.03720808029174805  GigaBytes
Max Memory Allocated: 0.038600921630859375  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.06835126876831055  GigaBytes
Max Memory Allocated: 0.0832982063293457  GigaBytes

h_neigh size torch.Size([44997, 40])
torch.Size([44997, 40])
torch.Size([44997, 40])
----------------------------------------after rst
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.07505655288696289  GigaBytes
Max Memory Allocated: 0.0832982063293457  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.06835126876831055  GigaBytes
Max Memory Allocated: 0.0832982063293457  GigaBytes

torch.Size([44997, 40])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.07505655288696289  GigaBytes
Max Memory Allocated: 0.0832982063293457  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.08231210708618164  GigaBytes
Max Memory Allocated: 0.0832982063293457  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.0469059944152832  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

pseudo mini batch 1 input nodes size: 110530
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.04032135009765625  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.3651123046875 GB
    Memory Allocated: 0.04032135009765625  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.09305572509765625  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.0933980941772461  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.059859275817871094  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.06617450714111328  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.06617450714111328  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------input nodes number: 110530
----------------output nodes number: 45944
----------------edges number: 847524
----------------------------------------before mean aggregator
 Nvidia-smi: 1.4178466796875 GB
    Memory Allocated: 0.06734085083007812  GigaBytes
Max Memory Allocated: 0.09572267532348633  GigaBytes

----------------------------------------after mean aggregator-------
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.10352087020874023  GigaBytes
Max Memory Allocated: 0.11875343322753906  GigaBytes

h_neigh size torch.Size([45944, 40])
torch.Size([45944, 40])
torch.Size([45944, 40])
----------------------------------------after rst
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.1103672981262207  GigaBytes
Max Memory Allocated: 0.11875343322753906  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.10352087020874023  GigaBytes
Max Memory Allocated: 0.11875343322753906  GigaBytes

torch.Size([45944, 40])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.10366201400756836  GigaBytes
Max Memory Allocated: 0.11875343322753906  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.11145401000976562  GigaBytes
Max Memory Allocated: 0.11875343322753906  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.07490777969360352  GigaBytes
Max Memory Allocated: 0.12514686584472656  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.07498407363891602  GigaBytes
Max Memory Allocated: 0.12514686584472656  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 1.4451904296875 GB
    Memory Allocated: 0.07498407363891602  GigaBytes
Max Memory Allocated: 0.12514686584472656  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.031659722328186035 |0.16451895236968994 |0.38474392890930176 |0.0002557039260864258 |0.0020842552185058594 |0.001201629638671875 |
----------------------------------------------------------pseudo_mini_loss sum 3.85675311088562
Total (block generation + training)time/epoch 30.122485637664795
Training time/epoch 1.173295497894287
Training time without block to device /epoch 0.8442575931549072
Training time without total dataloading part /epoch 0.77536940574646
load block tensor time/epoch 0.06331944465637207
block to device time/epoch 0.3290379047393799
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  178937
Number of first layer input nodes during this epoch:  178937
Number of first layer output nodes during this epoch:  90941
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=128, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=40, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  10240
trainable parameters
layers.0.fc_self.weight, torch.Size([40, 128])
layers.0.fc_neigh.weight, torch.Size([40, 128])
----------------------------------------
un-trainable parameters
