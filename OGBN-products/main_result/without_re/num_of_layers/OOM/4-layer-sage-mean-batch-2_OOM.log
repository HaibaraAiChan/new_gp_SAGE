main start at this time 1655848641.981823
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.3502011299133301
global_2_local spend time (sec) 0.42844104766845703
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.07544684410095215
A = g.adjacency_matrix() spent  0.12016797065734863
auxiliary_graph
Graph(num_nodes=1377742, num_edges=101873543,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.7686421871185303
remove nodes length
1181171
auxiliary_graph.remove_nodes spent  6.1603851318359375
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101873543,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.834763050079346

the counter of shared neighbor distribution
Counter({1.0: 76625834, 2.0: 14048222, 3.0: 5011620, 4.0: 2308328, 5.0: 1244288, 6.0: 737614, 7.0: 469104, 8.0: 320932, 9.0: 223716, 10.0: 162494, 11.0: 118854, 12.0: 89870, 13.0: 69466, 14.0: 53028, 15.0: 41764, 16.0: 31248, 17.0: 22002, 18.0: 19492, 19.0: 13018, 20.0: 10882, 21.0: 7144, 22.0: 5740, 23.0: 4796, 24.0: 3814, 25.0: 3584, 33.0: 3046, 28.0: 2926, 26.0: 2688, 30.0: 2312, 27.0: 2286, 31.0: 2154, 39.0: 2098, 32.0: 2040, 35.0: 1750, 29.0: 1680, 37.0: 1650, 36.0: 1526, 38.0: 1460, 34.0: 1422, 40.0: 1080})
101676972
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([        0,         1,         2,  ..., 101676969, 101676970,
        101676971])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 76625834, 2.0: 14048222, 3.0: 5011620, 4.0: 2308328, 5.0: 1244288, 6.0: 737614, 7.0: 469104, 8.0: 320932, 9.0: 223716, 10.0: 162494, 11.0: 118854, 12.0: 89870, 13.0: 69466, 14.0: 53028, 15.0: 41764, 16.0: 31248, 17.0: 22002, 18.0: 19492, 19.0: 13018, 20.0: 10882, 21.0: 7144, 22.0: 5740, 23.0: 4796, 24.0: 3814, 25.0: 3584, 33.0: 3046, 28.0: 2926, 26.0: 2688, 30.0: 2312, 27.0: 2286, 31.0: 2154, 39.0: 2098, 32.0: 2040, 35.0: 1750, 29.0: 1680, 37.0: 1650, 36.0: 1526, 38.0: 1460, 34.0: 1422, 40.0: 1080})
Convert a graph into a bidirected graph: 6.916 seconds
Metis partitioning: 22.792 seconds
Split the graph: 11.845 seconds
Construct subgraphs: 0.054 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  41.64981436729431
100157
96414
total k batches seeds list generation spend  87.46590995788574
after graph partition
graph partition algorithm spend time 88.84814476966858
100157
96414
partition_len_list
[718684, 767213]
shared_neighbor_graph_partition_s0 selection method  spend 89.55547904968262
time for parepare:  0.2999458312988281
local_output_nid generation:  0.014143228530883789
local_in_edges_tensor generation:  0.08479046821594238
mini_batch_src_global generation:  0.11467623710632324
r_  generation:  1.740696907043457
local_output_nid generation:  0.016301870346069336
local_in_edges_tensor generation:  0.13073015213012695
mini_batch_src_global generation:  0.1375102996826172
r_  generation:  1.7152533531188965
----------------------check_connections_block total spend ----------------------------- 4.876635551452637
generate_one_block  3.4390482902526855
generate_one_block  2.0456840991973877
The real block id is  2
get_global_graph_edges_ids_block function  spend 2.229097366333008
gen group dst list time:  0.04039263725280762
time for parepare:  0.4239177703857422
local_output_nid generation:  0.1173543930053711
local_in_edges_tensor generation:  0.4687318801879883
mini_batch_src_global generation:  0.5472424030303955
r_  generation:  8.12449598312378
local_output_nid generation:  0.1336362361907959
local_in_edges_tensor generation:  0.5088760852813721
mini_batch_src_global generation:  0.7971768379211426
r_  generation:  8.860169887542725
----------------------check_connections_block total spend ----------------------------- 22.940244674682617
generate_one_block  10.192781925201416
generate_one_block  11.515126466751099
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.222771167755127
gen group dst list time:  0.13046026229858398
time for parepare:  0.4686288833618164
local_output_nid generation:  0.3223400115966797
local_in_edges_tensor generation:  0.8256149291992188
mini_batch_src_global generation:  0.8862776756286621
r_  generation:  13.338985919952393
local_output_nid generation:  0.3535902500152588
local_in_edges_tensor generation:  0.8372721672058105
mini_batch_src_global generation:  1.1877455711364746
r_  generation:  13.830506563186646
----------------------check_connections_block total spend ----------------------------- 36.88815689086914
generate_one_block  16.591700792312622
generate_one_block  17.59519124031067
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.157059907913208
gen group dst list time:  0.1564948558807373
time for parepare:  0.4810912609100342
local_output_nid generation:  0.5204191207885742
local_in_edges_tensor generation:  0.9874842166900635
mini_batch_src_global generation:  0.5671830177307129
r_  generation:  9.772407054901123
local_output_nid generation:  0.5570089817047119
local_in_edges_tensor generation:  0.82366943359375
mini_batch_src_global generation:  0.742408037185669
r_  generation:  9.475845098495483
----------------------check_connections_block total spend ----------------------------- 27.721150398254395
generate_one_block  12.28526258468628
generate_one_block  11.97519302368164
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

connection checking time:  92.42618751525879
block generation total time  85.6399884223938
average batch blocks generation time:  10.704998552799225
block dataloader generation time/epoch 281.2140905857086
pseudo mini batch 0 input nodes size: 2188659
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.8338623046875 GB
    Memory Allocated: 0.8165960311889648  GigaBytes
Max Memory Allocated: 0.8165960311889648  GigaBytes

<class 'torch.Tensor'>
----------------------------------------after  batch labels to device
 Nvidia-smi: 1.8358154296875 GB
    Memory Allocated: 0.8173422813415527  GigaBytes
Max Memory Allocated: 0.8173422813415527  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.8358154296875 GB
    Memory Allocated: 0.8173422813415527  GigaBytes
Max Memory Allocated: 0.8173422813415527  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.4197998046875 GB
    Memory Allocated: 1.3284554481506348  GigaBytes
Max Memory Allocated: 1.3284554481506348  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.4197998046875 GB
    Memory Allocated: 1.3284554481506348  GigaBytes
Max Memory Allocated: 1.3284554481506348  GigaBytes

first layer input nodes number: 2188659
first layer output nodes number: 2054248
edges number: 18438959
----------------------------------------before model layer 0
 Nvidia-smi: 2.5233154296875 GB
    Memory Allocated: 1.3603873252868652  GigaBytes
Max Memory Allocated: 1.4290781021118164  GigaBytes

torch.Size([2188659, 100])
----------------------------------------after rst
 Nvidia-smi: 11.4881591796875 GB
    Memory Allocated: 6.189213752746582  GigaBytes
Max Memory Allocated: 8.148297309875488  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 11.4881591796875 GB
    Memory Allocated: 4.230130195617676  GigaBytes
Max Memory Allocated: 8.148297309875488  GigaBytes

torch.Size([2054248, 256])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 11.4881591796875 GB
    Memory Allocated: 6.189213752746582  GigaBytes
Max Memory Allocated: 8.148297309875488  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 11.4881591796875 GB
    Memory Allocated: 6.678984642028809  GigaBytes
Max Memory Allocated: 8.638068199157715  GigaBytes

input nodes number: 2054248
output nodes number: 1461652
edges number: 28541479
----------------------------------------before model layer 1
 Nvidia-smi: 11.4881591796875 GB
    Memory Allocated: 6.705180644989014  GigaBytes
Max Memory Allocated: 8.638068199157715  GigaBytes

torch.Size([2054248, 256])
----------------------------------------after rst
 Nvidia-smi: 16.3006591796875 GB
    Memory Allocated: 11.111725330352783  GigaBytes
Max Memory Allocated: 12.506256580352783  GigaBytes

----------------------------------------after model layer 1 x = layer(block, x)
 Nvidia-smi: 16.3006591796875 GB
    Memory Allocated: 9.717785358428955  GigaBytes
Max Memory Allocated: 12.506256580352783  GigaBytes

torch.Size([1461652, 256])
----------------------------------------after model layer 1 x = self.activation(x)
 Nvidia-smi: 16.3006591796875 GB
    Memory Allocated: 11.112316608428955  GigaBytes
Max Memory Allocated: 12.506256580352783  GigaBytes

----------------------------------------after model layer 1 x = self.dropout(x)
 Nvidia-smi: 16.3006591796875 GB
    Memory Allocated: 11.46021032333374  GigaBytes
Max Memory Allocated: 12.85474157333374  GigaBytes

input nodes number: 1461652
output nodes number: 718684
edges number: 17790691
----------------------------------------before model layer 2
 Nvidia-smi: 16.3006591796875 GB
    Memory Allocated: 11.47645616531372  GigaBytes
Max Memory Allocated: 12.85474157333374  GigaBytes

torch.Size([1461652, 256])
----------------------------------------after rst
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 13.670924186706543  GigaBytes
Max Memory Allocated: 14.356471061706543  GigaBytes

----------------------------------------after model layer 2 x = layer(block, x)
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 12.985533714294434  GigaBytes
Max Memory Allocated: 14.356471061706543  GigaBytes

torch.Size([718684, 256])
----------------------------------------after model layer 2 x = self.activation(x)
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 13.670924186706543  GigaBytes
Max Memory Allocated: 14.356471061706543  GigaBytes

----------------------------------------after model layer 2 x = self.dropout(x)
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 13.842428207397461  GigaBytes
Max Memory Allocated: 14.52781867980957  GigaBytes

----------------------------------------after rst
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 14.002033233642578  GigaBytes
Max Memory Allocated: 14.52781867980957  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 13.984496593475342  GigaBytes
Max Memory Allocated: 14.52781867980957  GigaBytes

torch.Size([100157, 47])
input nodes number: 718684
output nodes number: 100157
edges number: 3793977
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 14.008134365081787  GigaBytes
Max Memory Allocated: 14.52781867980957  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.6717529296875 GB
    Memory Allocated: 14.008135318756104  GigaBytes
Max Memory Allocated: 14.52781867980957  GigaBytes

