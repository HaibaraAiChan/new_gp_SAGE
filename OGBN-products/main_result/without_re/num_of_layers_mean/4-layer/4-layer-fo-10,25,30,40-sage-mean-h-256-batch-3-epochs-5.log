main start at this time 1656229381.5541117
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.3519423007965088
global_2_local spend time (sec) 0.4334733486175537
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.07917594909667969
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181168, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.1242518424987793
auxiliary_graph
Graph(num_nodes=1377739, num_edges=101629065,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.7397723197937012
remove nodes length  1181168

auxiliary_graph.remove_nodes spent  5.947023153305054
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101629065,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.692226886749268

the counter of shared neighbor distribution
Counter({1.0: 76428880, 2.0: 14009736, 3.0: 4997856, 4.0: 2306386, 5.0: 1244092, 6.0: 741914, 7.0: 475248, 8.0: 320162, 9.0: 223894, 10.0: 160924, 11.0: 119500, 12.0: 88636, 13.0: 68494, 14.0: 52380, 15.0: 42232, 16.0: 31574, 17.0: 21912, 18.0: 19530, 19.0: 13310, 20.0: 10676, 21.0: 7116, 22.0: 5824, 23.0: 4770, 24.0: 3940, 25.0: 3592, 33.0: 3022, 28.0: 2874, 26.0: 2642, 30.0: 2332, 27.0: 2150, 31.0: 2110, 39.0: 2110, 32.0: 2054, 29.0: 1774, 35.0: 1736, 37.0: 1620, 36.0: 1528, 38.0: 1468, 34.0: 1416, 40.0: 1080})
101432494
Convert a graph into a bidirected graph: 6.786 seconds
Metis partitioning: 23.123 seconds
Split the graph: 7.665 seconds
Construct subgraphs: 0.037 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  37.65492534637451
66549
65832
64190
total k batches seeds list generation spend  70.8827452659607
after graph partition
graph partition algorithm spend time 71.9630355834961
66549
65832
64190
partition_len_list
[489285, 536314, 554229]
REG selection method  spend 72.6559190750122
time for parepare:  0.27059197425842285
local_output_nid generation:  0.00979924201965332
local_in_edges_tensor generation:  0.023164749145507812
mini_batch_src_global generation:  0.0801389217376709
r_  generation:  1.0399413108825684
local_output_nid generation:  0.014181375503540039
local_in_edges_tensor generation:  0.09640216827392578
mini_batch_src_global generation:  0.09752488136291504
r_  generation:  1.099548578262329
local_output_nid generation:  0.010894775390625
local_in_edges_tensor generation:  0.03681182861328125
mini_batch_src_global generation:  0.10316300392150879
r_  generation:  1.142810344696045
----------------------check_connections_block total spend ----------------------------- 4.6243085861206055
generate_one_block  2.700914144515991
generate_one_block  1.3301873207092285
generate_one_block  1.29103422164917
The real block id is  2
get_global_graph_edges_ids_block function  spend 1.7810266017913818
gen group dst list time:  0.04388928413391113
time for parepare:  0.4225435256958008
local_output_nid generation:  0.0942697525024414
local_in_edges_tensor generation:  0.3897528648376465
mini_batch_src_global generation:  0.3917858600616455
r_  generation:  5.080795764923096
local_output_nid generation:  0.1380462646484375
local_in_edges_tensor generation:  0.5408802032470703
mini_batch_src_global generation:  0.5781514644622803
r_  generation:  6.284729242324829
local_output_nid generation:  0.13487577438354492
local_in_edges_tensor generation:  0.4347705841064453
mini_batch_src_global generation:  0.6153528690338135
r_  generation:  6.375523090362549
----------------------check_connections_block total spend ----------------------------- 24.753650665283203
generate_one_block  6.887004852294922
generate_one_block  8.349979400634766
generate_one_block  8.175175905227661
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2745461463928223
gen group dst list time:  0.12478494644165039
time for parepare:  0.4614739418029785
local_output_nid generation:  0.25753283500671387
local_in_edges_tensor generation:  0.6716067790985107
mini_batch_src_global generation:  0.6475305557250977
r_  generation:  9.121540307998657
local_output_nid generation:  0.2951693534851074
local_in_edges_tensor generation:  0.722637414932251
mini_batch_src_global generation:  0.9552533626556396
r_  generation:  11.353647470474243
local_output_nid generation:  0.3919205665588379
local_in_edges_tensor generation:  0.8600080013275146
mini_batch_src_global generation:  1.1283321380615234
r_  generation:  13.196372509002686
----------------------check_connections_block total spend ----------------------------- 46.04184031486511
generate_one_block  12.307680368423462
generate_one_block  14.546363115310669
generate_one_block  16.619754314422607
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.1375477313995361
gen group dst list time:  0.23523426055908203
time for parepare:  0.4733598232269287
local_output_nid generation:  0.5394518375396729
local_in_edges_tensor generation:  0.9585230350494385
mini_batch_src_global generation:  0.5423634052276611
r_  generation:  8.784971952438354
local_output_nid generation:  0.6235015392303467
local_in_edges_tensor generation:  0.9216594696044922
mini_batch_src_global generation:  0.6684854030609131
r_  generation:  9.07503628730774
local_output_nid generation:  0.6728589534759521
local_in_edges_tensor generation:  0.905705451965332
mini_batch_src_global generation:  0.7339935302734375
r_  generation:  9.9427649974823
----------------------check_connections_block total spend ----------------------------- 40.42920637130737
generate_one_block  11.407786846160889
generate_one_block  11.152325630187988
generate_one_block  12.080164670944214
----------===============-------------===============-------------the number of batches *****---- 3

original number of batches:  3
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

connection checking time:  115.8490059375763
block generation total time  106.84837079048157
average batch blocks generation time:  8.904030899206797
block dataloader generation time/epoch 309.59740233421326
pseudo mini batch 0 input nodes size: 2121941
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0012569427490234375  GigaBytes
Max Memory Allocated: 0.0012569427490234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.8084716796875 GB
    Memory Allocated: 0.7922725677490234  GigaBytes
Max Memory Allocated: 0.7922725677490234  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.8084716796875 GB
    Memory Allocated: 0.7927684783935547  GigaBytes
Max Memory Allocated: 0.7927684783935547  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.8084716796875 GB
    Memory Allocated: 0.7927684783935547  GigaBytes
Max Memory Allocated: 0.7927684783935547  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.2713623046875 GB
    Memory Allocated: 1.1879043579101562  GigaBytes
Max Memory Allocated: 1.1879043579101562  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.2713623046875 GB
    Memory Allocated: 1.1879043579101562  GigaBytes
Max Memory Allocated: 1.1879043579101562  GigaBytes

first layer input nodes number: 2121941
first layer output nodes number: 1886463
edges number: 17053718
torch.Size([2121941, 100])
torch.Size([1886463, 256])
input nodes number: 1886463
output nodes number: 1111081
edges number: 21245399
torch.Size([1886463, 256])
torch.Size([1111081, 256])
input nodes number: 1111081
output nodes number: 489285
edges number: 11753325
torch.Size([1111081, 256])
torch.Size([489285, 256])
torch.Size([66549, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 14.6268310546875 GB
    Memory Allocated: 11.465353965759277  GigaBytes
Max Memory Allocated: 11.826202392578125  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 14.6268310546875 GB
    Memory Allocated: 11.477006912231445  GigaBytes
Max Memory Allocated: 11.826202392578125  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 1.9493861198425293  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

pseudo mini batch 1 input nodes size: 2114868
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 0.8056783676147461  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 0.8056783676147461  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 1.5935282707214355  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 1.5940189361572266  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 0.8025074005126953  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 1.248098373413086  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.2830810546875 GB
    Memory Allocated: 1.248098373413086  GigaBytes
Max Memory Allocated: 12.344407081604004  GigaBytes

first layer input nodes number: 2114868
first layer output nodes number: 1871525
edges number: 17195990
torch.Size([2114868, 100])
torch.Size([1871525, 256])
input nodes number: 1871525
output nodes number: 1198990
edges number: 25520576
torch.Size([1871525, 256])
torch.Size([1198990, 256])
input nodes number: 1198990
output nodes number: 536314
edges number: 14480887
torch.Size([1198990, 256])
torch.Size([536314, 256])
torch.Size([65832, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.7772216796875 GB
    Memory Allocated: 11.94528579711914  GigaBytes
Max Memory Allocated: 12.36343002319336  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.7772216796875 GB
    Memory Allocated: 11.956812858581543  GigaBytes
Max Memory Allocated: 12.36343002319336  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 2.103780746459961  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

pseudo mini batch 2 input nodes size: 2213894
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 0.8023819923400879  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 0.8023819923400879  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 1.627121925354004  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 1.6276001930236816  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 0.8392596244812012  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 1.3257927894592285  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.0037841796875 GB
    Memory Allocated: 1.3257927894592285  GigaBytes
Max Memory Allocated: 12.915124416351318  GigaBytes

first layer input nodes number: 2213894
first layer output nodes number: 2054367
edges number: 18685719
torch.Size([2213894, 100])
torch.Size([2054367, 256])
input nodes number: 2054367
output nodes number: 1416347
edges number: 29636549
torch.Size([2054367, 256])
torch.Size([1416347, 256])
input nodes number: 1416347
output nodes number: 554229
edges number: 14534882
torch.Size([1416347, 256])
torch.Size([554229, 256])
torch.Size([64190, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 19.3084716796875 GB
    Memory Allocated: 13.26466703414917  GigaBytes
Max Memory Allocated: 13.702364921569824  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 19.3084716796875 GB
    Memory Allocated: 13.275906562805176  GigaBytes
Max Memory Allocated: 13.702364921569824  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.3104248046875 GB
    Memory Allocated: 2.2633471488952637  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 2.2658610343933105  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 2.2658610343933105  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.43588844935099286 |0.6535367965698242 |0.6267663637797037 |0.00021918614705403647 |0.18120853106180826 |0.004918098449707031 |
----------------------------------------------------------pseudo_mini_loss sum 11.008626937866211
Total (block generation + training)time/epoch 315.46148681640625
Training time/epoch 5.863759279251099
Training time without block to device /epoch 3.903148889541626
Training time without total dataloading part /epoch 2.4295003414154053
load block tensor time/epoch 1.3076653480529785
block to device time/epoch 1.9606103897094727
input features size transfer per epoch 4.023313522338867e-07
blocks size to device per epoch 2.682209014892578e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  17569304
Number of first layer input nodes during this epoch:  6450703
Number of first layer output nodes during this epoch:  5812355
----------------------------------------before generate dataloader block 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 2.2658605575561523  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.45227909088134766
global_2_local spend time (sec) 0.4856867790222168
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.08136343955993652
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180772, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.1257777214050293
auxiliary_graph
Graph(num_nodes=1377343, num_edges=101587319,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.6805305480957031
remove nodes length  1180772

auxiliary_graph.remove_nodes spent  5.9472010135650635
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101587319,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.047418117523193

the counter of shared neighbor distribution
Counter({1.0: 76436864, 2.0: 13986692, 3.0: 4981726, 4.0: 2298640, 5.0: 1242682, 6.0: 739370, 7.0: 473870, 8.0: 321150, 9.0: 223324, 10.0: 162428, 11.0: 118266, 12.0: 89782, 13.0: 68224, 14.0: 53450, 15.0: 42736, 16.0: 30890, 17.0: 22210, 18.0: 18922, 19.0: 13588, 20.0: 10858, 21.0: 7072, 22.0: 5756, 23.0: 4684, 24.0: 3942, 25.0: 3600, 33.0: 2990, 28.0: 2852, 26.0: 2666, 30.0: 2288, 31.0: 2182, 27.0: 2170, 39.0: 2096, 32.0: 2044, 29.0: 1798, 35.0: 1708, 37.0: 1676, 36.0: 1554, 34.0: 1488, 38.0: 1432, 40.0: 1078})
101390748
Convert a graph into a bidirected graph: 6.860 seconds
Metis partitioning: 24.593 seconds
Split the graph: 7.063 seconds
Construct subgraphs: 0.088 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  38.64690279960632
66447
63648
66476
total k batches seeds list generation spend  69.63990712165833
after graph partition
graph partition algorithm spend time 70.90048360824585
66447
63648
66476
partition_len_list
[490448, 560040, 550029]
REG selection method  spend 71.66225600242615
time for parepare:  0.277508020401001
local_output_nid generation:  0.010913610458374023
local_in_edges_tensor generation:  0.022065401077270508
mini_batch_src_global generation:  0.0779421329498291
r_  generation:  1.00453782081604
local_output_nid generation:  0.011488914489746094
local_in_edges_tensor generation:  0.05036449432373047
mini_batch_src_global generation:  0.09873199462890625
r_  generation:  1.0695230960845947
local_output_nid generation:  0.011959314346313477
local_in_edges_tensor generation:  0.04318070411682129
mini_batch_src_global generation:  0.1031503677368164
r_  generation:  1.2428345680236816
----------------------check_connections_block total spend ----------------------------- 4.630659103393555
generate_one_block  1.6540484428405762
generate_one_block  1.407524585723877
generate_one_block  1.4036085605621338
The real block id is  2
get_global_graph_edges_ids_block function  spend 1.908202886581421
gen group dst list time:  0.0468447208404541
time for parepare:  0.46569204330444336
local_output_nid generation:  0.0971992015838623
local_in_edges_tensor generation:  0.3827228546142578
mini_batch_src_global generation:  0.3804769515991211
r_  generation:  5.088512659072876
local_output_nid generation:  0.14668583869934082
local_in_edges_tensor generation:  0.45200109481811523
mini_batch_src_global generation:  0.6247100830078125
r_  generation:  6.60962176322937
local_output_nid generation:  0.14657211303710938
local_in_edges_tensor generation:  0.4062011241912842
mini_batch_src_global generation:  0.5972943305969238
r_  generation:  6.449675798416138
----------------------check_connections_block total spend ----------------------------- 25.158915996551514
generate_one_block  6.936209678649902
generate_one_block  8.363884210586548
generate_one_block  8.4166841506958
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.267021656036377
gen group dst list time:  0.1705460548400879
time for parepare:  0.5002768039703369
local_output_nid generation:  0.27428507804870605
local_in_edges_tensor generation:  0.7524256706237793
mini_batch_src_global generation:  0.6825623512268066
r_  generation:  9.928755044937134
local_output_nid generation:  0.4392671585083008
local_in_edges_tensor generation:  0.9757652282714844
mini_batch_src_global generation:  1.1371102333068848
r_  generation:  13.87589406967163
local_output_nid generation:  0.3525209426879883
local_in_edges_tensor generation:  0.9747896194458008
mini_batch_src_global generation:  1.0447118282318115
r_  generation:  11.810707569122314
----------------------check_connections_block total spend ----------------------------- 49.07046103477478
generate_one_block  12.5371675491333
generate_one_block  17.380762100219727
generate_one_block  15.240807056427002
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.2064642906188965
gen group dst list time:  0.2116382122039795
time for parepare:  0.5296103954315186
local_output_nid generation:  0.5871403217315674
local_in_edges_tensor generation:  0.9165828227996826
mini_batch_src_global generation:  0.5520641803741455
r_  generation:  8.916066646575928
local_output_nid generation:  0.6776306629180908
local_in_edges_tensor generation:  0.9660820960998535
mini_batch_src_global generation:  0.7295303344726562
r_  generation:  9.969460725784302
local_output_nid generation:  0.5987153053283691
local_in_edges_tensor generation:  0.8894715309143066
mini_batch_src_global generation:  0.7162859439849854
r_  generation:  9.105273485183716
----------------------check_connections_block total spend ----------------------------- 40.69264006614685
generate_one_block  11.526957750320435
generate_one_block  12.267486572265625
generate_one_block  11.347201108932495
----------===============-------------===============-------------the number of batches *****---- 3

original number of batches:  3
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 2.2658605575561523  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

connection checking time:  119.5526762008667
block generation total time  108.48234176635742
average batch blocks generation time:  9.040195147196451
block dataloader generation time/epoch 312.15144538879395
pseudo mini batch 0 input nodes size: 2145320
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.8414850234985352  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.8414850234985352  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.6406793594360352  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.6411747932434082  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.8159565925598145  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.2099337577819824  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.2099337577819824  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

first layer input nodes number: 2145320
first layer output nodes number: 1900189
edges number: 17194133
torch.Size([2145320, 100])
torch.Size([1900189, 256])
input nodes number: 1900189
output nodes number: 1113402
edges number: 21334654
torch.Size([1900189, 256])
torch.Size([1113402, 256])
input nodes number: 1113402
output nodes number: 490448
edges number: 11816102
torch.Size([1113402, 256])
torch.Size([490448, 256])
torch.Size([66447, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 11.522431373596191  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 11.534066677093506  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.9636411666870117  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

pseudo mini batch 1 input nodes size: 2192939
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.8163528442382812  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.8163528442382812  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.633286476135254  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.633760929107666  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 0.834071159362793  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.328878402709961  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.3123779296875 GB
    Memory Allocated: 1.328878402709961  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

first layer input nodes number: 2192939
first layer output nodes number: 2046930
edges number: 18601227
torch.Size([2192939, 100])
torch.Size([2046930, 256])
input nodes number: 2046930
output nodes number: 1436811
edges number: 30410053
torch.Size([2046930, 256])
torch.Size([1436811, 256])
input nodes number: 1436811
output nodes number: 560040
edges number: 15012663
torch.Size([1436811, 256])
torch.Size([560040, 256])
torch.Size([63648, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 20.4295654296875 GB
    Memory Allocated: 13.337501525878906  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 20.4295654296875 GB
    Memory Allocated: 13.34864616394043  GigaBytes
Max Memory Allocated: 14.30833387374878  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.285912036895752  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

pseudo mini batch 2 input nodes size: 2122277
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8335809707641602  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8335809707641602  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.6241908073425293  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.6246862411499023  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8072781562805176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.25419282913208  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.25419282913208  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2122277
first layer output nodes number: 1882351
edges number: 17288430
torch.Size([2122277, 100])
torch.Size([1882351, 256])
input nodes number: 1882351
output nodes number: 1221585
edges number: 25584329
torch.Size([1882351, 256])
torch.Size([1221585, 256])
input nodes number: 1221585
output nodes number: 550029
edges number: 14541391
torch.Size([1221585, 256])
torch.Size([550029, 256])
torch.Size([66476, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 12.095248222351074  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 12.10688829421997  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.114556312561035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.114556312561035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.114556312561035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.4105030695597331 |0.507127602895101 |0.2772189776102702 |0.00016450881958007812 |0.13904714584350586 |0.006874561309814453 |
----------------------------------------------------------pseudo_mini_loss sum 26.600460052490234
Total (block generation + training)time/epoch 317.28950715065
Training time/epoch 4.4117090702056885
Training time without block to device /epoch 2.8903262615203857
Training time without total dataloading part /epoch 1.2561664581298828
load block tensor time/epoch 1.2315092086791992
block to device time/epoch 1.5213828086853027
input features size transfer per epoch 4.023313522338867e-07
blocks size to device per epoch 2.682209014892578e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  17662321
Number of first layer input nodes during this epoch:  6460536
Number of first layer output nodes during this epoch:  5829470
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.114555835723877  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.3267080783843994
global_2_local spend time (sec) 0.49954771995544434
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.03614377975463867
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181492, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.12692856788635254
auxiliary_graph
Graph(num_nodes=1378063, num_edges=101514003,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.7401659488677979
remove nodes length  1181492

auxiliary_graph.remove_nodes spent  5.26232385635376
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101514003,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  3.9958887100219727

the counter of shared neighbor distribution
Counter({1.0: 76315904, 2.0: 14010454, 3.0: 4992976, 4.0: 2307532, 5.0: 1246094, 6.0: 741804, 7.0: 473400, 8.0: 319712, 9.0: 224478, 10.0: 160362, 11.0: 120284, 12.0: 89240, 13.0: 68550, 14.0: 52868, 15.0: 42336, 16.0: 30708, 17.0: 22358, 18.0: 19190, 19.0: 13434, 20.0: 10622, 21.0: 7382, 22.0: 5490, 23.0: 4628, 24.0: 4090, 25.0: 3508, 33.0: 3022, 28.0: 2844, 26.0: 2638, 30.0: 2476, 27.0: 2200, 39.0: 2088, 31.0: 2086, 32.0: 2072, 35.0: 1770, 29.0: 1720, 37.0: 1624, 36.0: 1494, 38.0: 1464, 34.0: 1428, 40.0: 1102})
101317432
Convert a graph into a bidirected graph: 6.543 seconds
Metis partitioning: 24.027 seconds
Split the graph: 7.133 seconds
Construct subgraphs: 0.086 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  37.831286907196045
66708
64225
65638
total k batches seeds list generation spend  67.95836782455444
after graph partition
graph partition algorithm spend time 69.2293758392334
66708
64225
65638
partition_len_list
[487069, 550997, 538720]
REG selection method  spend 69.99881529808044
time for parepare:  0.2814292907714844
local_output_nid generation:  0.014072418212890625
local_in_edges_tensor generation:  0.02130603790283203
mini_batch_src_global generation:  0.07792949676513672
r_  generation:  0.9958901405334473
local_output_nid generation:  0.012334823608398438
local_in_edges_tensor generation:  0.04038643836975098
mini_batch_src_global generation:  0.10004663467407227
r_  generation:  1.0539805889129639
local_output_nid generation:  0.013567686080932617
local_in_edges_tensor generation:  0.0695338249206543
mini_batch_src_global generation:  0.09561467170715332
r_  generation:  1.131392002105713
----------------------check_connections_block total spend ----------------------------- 4.500341892242432
generate_one_block  1.6639373302459717
generate_one_block  1.678462266921997
generate_one_block  1.458772897720337
The real block id is  2
get_global_graph_edges_ids_block function  spend 1.9685993194580078
gen group dst list time:  0.05191349983215332
time for parepare:  0.47319483757019043
local_output_nid generation:  0.09758424758911133
local_in_edges_tensor generation:  0.3618290424346924
mini_batch_src_global generation:  0.3866109848022461
r_  generation:  5.076760530471802
local_output_nid generation:  0.15877485275268555
local_in_edges_tensor generation:  0.43343472480773926
mini_batch_src_global generation:  0.5632538795471191
r_  generation:  6.874340057373047
local_output_nid generation:  0.14815664291381836
local_in_edges_tensor generation:  0.501446008682251
mini_batch_src_global generation:  0.5861451625823975
r_  generation:  6.393934726715088
----------------------check_connections_block total spend ----------------------------- 25.235979557037354
generate_one_block  6.980654001235962
generate_one_block  8.087376117706299
generate_one_block  8.056493759155273
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2635953426361084
gen group dst list time:  0.13622045516967773
time for parepare:  0.44202446937561035
local_output_nid generation:  0.2707176208496094
local_in_edges_tensor generation:  0.7161552906036377
mini_batch_src_global generation:  0.6692647933959961
r_  generation:  9.494981527328491
local_output_nid generation:  0.41584086418151855
local_in_edges_tensor generation:  1.1051862239837646
mini_batch_src_global generation:  1.090902328491211
r_  generation:  13.430526971817017
local_output_nid generation:  0.3697388172149658
local_in_edges_tensor generation:  0.7886879444122314
mini_batch_src_global generation:  1.0679700374603271
r_  generation:  11.535436868667603
----------------------check_connections_block total spend ----------------------------- 47.44363808631897
generate_one_block  12.610565900802612
generate_one_block  16.867451667785645
generate_one_block  14.503484725952148
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.164799451828003
gen group dst list time:  0.22523188591003418
time for parepare:  0.45807528495788574
local_output_nid generation:  0.5376486778259277
local_in_edges_tensor generation:  0.8990154266357422
mini_batch_src_global generation:  0.5313491821289062
r_  generation:  8.447945594787598
local_output_nid generation:  0.5904102325439453
local_in_edges_tensor generation:  0.8541600704193115
mini_batch_src_global generation:  0.7437546253204346
r_  generation:  9.550241470336914
local_output_nid generation:  0.5378572940826416
local_in_edges_tensor generation:  0.8561434745788574
mini_batch_src_global generation:  0.7576110363006592
r_  generation:  8.963557958602905
----------------------check_connections_block total spend ----------------------------- 39.15947985649109
generate_one_block  11.327166080474854
generate_one_block  12.167700052261353
generate_one_block  11.221685409545898
----------===============-------------===============-------------the number of batches *****---- 3

original number of batches:  3
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 2.114555835723877  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

connection checking time:  116.33943939208984
block generation total time  106.62375020980835
average batch blocks generation time:  8.88531251748403
block dataloader generation time/epoch 310.6591339111328
pseudo mini batch 0 input nodes size: 2130509
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8077726364135742  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8077726364135742  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.6014494895935059  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.6019468307495117  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8108415603637695  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.2035698890686035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.2035698890686035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2130509
first layer output nodes number: 1901921
edges number: 17199197
torch.Size([2130509, 100])
torch.Size([1901921, 256])
input nodes number: 1901921
output nodes number: 1112913
edges number: 21295246
torch.Size([1901921, 256])
torch.Size([1112913, 256])
input nodes number: 1112913
output nodes number: 487069
edges number: 11677071
torch.Size([1112913, 256])
torch.Size([487069, 256])
torch.Size([66708, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 11.506011009216309  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 11.51769208908081  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.9533395767211914  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

pseudo mini batch 1 input nodes size: 2212847
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8108830451965332  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8108830451965332  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.635232925415039  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.635711669921875  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 0.8415374755859375  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.3247747421264648  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 1.3247747421264648  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2212847
first layer output nodes number: 2050485
edges number: 18670059
torch.Size([2212847, 100])
torch.Size([2050485, 256])
input nodes number: 2050485
output nodes number: 1400147
edges number: 29295818
torch.Size([2050485, 256])
torch.Size([1400147, 256])
input nodes number: 1400147
output nodes number: 550997
edges number: 14453800
torch.Size([1400147, 256])
torch.Size([550997, 256])
torch.Size([64225, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 13.187268257141113  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9647216796875 GB
    Memory Allocated: 13.198513984680176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.2557458877563477  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

pseudo mini batch 2 input nodes size: 2122423
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8411026000976562  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8411026000976562  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.6317667961120605  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.632256031036377  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8074274063110352  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2568531036376953  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2568531036376953  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2122423
first layer output nodes number: 1884804
edges number: 17312437
torch.Size([2122423, 100])
torch.Size([1884804, 256])
input nodes number: 1884804
output nodes number: 1207368
edges number: 25712299
torch.Size([1884804, 256])
torch.Size([1207368, 256])
input nodes number: 1207368
output nodes number: 538720
edges number: 14553351
torch.Size([1207368, 256])
torch.Size([538720, 256])
torch.Size([65638, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 12.024352550506592  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 12.035845756530762  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.117703437805176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.117703437805176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.117703437805176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.41341455777486164 |0.46823549270629883 |0.21783026059468588 |0.00015727678934733072 |0.1334966023763021 |0.003386259078979492 |
----------------------------------------------------------pseudo_mini_loss sum 5.582616329193115
Total (block generation + training)time/epoch 315.45258649190265
Training time/epoch 4.103917121887207
Training time without block to device /epoch 2.6992106437683105
Training time without total dataloading part /epoch 1.0578386783599854
load block tensor time/epoch 1.240243673324585
block to device time/epoch 1.4047064781188965
input features size transfer per epoch 4.023313522338867e-07
blocks size to device per epoch 2.682209014892578e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  17600203
Number of first layer input nodes during this epoch:  6465779
Number of first layer output nodes during this epoch:  5837210
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.1177029609680176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.3276040554046631
global_2_local spend time (sec) 0.48376941680908203
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.035266876220703125
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1180934, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.0912926197052002
auxiliary_graph
Graph(num_nodes=1377505, num_edges=101649695,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.7561061382293701
remove nodes length  1180934

auxiliary_graph.remove_nodes spent  5.4591052532196045
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101649695,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.239067316055298

the counter of shared neighbor distribution
Counter({1.0: 76419440, 2.0: 14040850, 3.0: 5000714, 4.0: 2309790, 5.0: 1244988, 6.0: 738434, 7.0: 470928, 8.0: 318614, 9.0: 223142, 10.0: 160722, 11.0: 119786, 12.0: 89366, 13.0: 69118, 14.0: 53008, 15.0: 42246, 16.0: 31006, 17.0: 21814, 18.0: 19380, 19.0: 13724, 20.0: 10948, 21.0: 7130, 22.0: 5536, 23.0: 4820, 24.0: 3950, 25.0: 3582, 28.0: 2932, 33.0: 2930, 26.0: 2692, 30.0: 2366, 27.0: 2216, 31.0: 2180, 39.0: 2094, 32.0: 2016, 35.0: 1774, 29.0: 1730, 37.0: 1712, 36.0: 1472, 34.0: 1452, 38.0: 1440, 40.0: 1082})
101453124
Convert a graph into a bidirected graph: 6.794 seconds
Metis partitioning: 24.903 seconds
Split the graph: 7.356 seconds
Construct subgraphs: 0.055 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  39.15222787857056
66444
66464
63663
total k batches seeds list generation spend  69.97347950935364
after graph partition
graph partition algorithm spend time 71.1949212551117
66444
66464
63663
partition_len_list
[489832, 539942, 553408]
REG selection method  spend 71.95965003967285
time for parepare:  0.26714515686035156
local_output_nid generation:  0.011418819427490234
local_in_edges_tensor generation:  0.021614789962768555
mini_batch_src_global generation:  0.08423852920532227
r_  generation:  1.0091867446899414
local_output_nid generation:  0.012261390686035156
local_in_edges_tensor generation:  0.04891777038574219
mini_batch_src_global generation:  0.10627269744873047
r_  generation:  1.1007843017578125
local_output_nid generation:  0.012126922607421875
local_in_edges_tensor generation:  0.02808976173400879
mini_batch_src_global generation:  0.09469151496887207
r_  generation:  1.0794956684112549
----------------------check_connections_block total spend ----------------------------- 4.443030118942261
generate_one_block  1.6622841358184814
generate_one_block  1.5983457565307617
generate_one_block  1.4603126049041748
The real block id is  2
get_global_graph_edges_ids_block function  spend 1.9489600658416748
gen group dst list time:  0.06067299842834473
time for parepare:  0.4819951057434082
local_output_nid generation:  0.09869527816772461
local_in_edges_tensor generation:  0.3782970905303955
mini_batch_src_global generation:  0.3940117359161377
r_  generation:  5.139328479766846
local_output_nid generation:  0.14778542518615723
local_in_edges_tensor generation:  0.4259068965911865
mini_batch_src_global generation:  0.5543153285980225
r_  generation:  6.435962915420532
local_output_nid generation:  0.1577458381652832
local_in_edges_tensor generation:  0.5175974369049072
mini_batch_src_global generation:  0.5870685577392578
r_  generation:  6.438805818557739
----------------------check_connections_block total spend ----------------------------- 24.914108991622925
generate_one_block  6.996770143508911
generate_one_block  7.950730085372925
generate_one_block  8.052577018737793
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.1737308502197266
gen group dst list time:  0.13927340507507324
time for parepare:  0.4212677478790283
local_output_nid generation:  0.2704942226409912
local_in_edges_tensor generation:  0.7229151725769043
mini_batch_src_global generation:  0.6610238552093506
r_  generation:  9.61595892906189
local_output_nid generation:  0.35277223587036133
local_in_edges_tensor generation:  0.8959674835205078
mini_batch_src_global generation:  1.0075843334197998
r_  generation:  11.784189462661743
local_output_nid generation:  0.4329102039337158
local_in_edges_tensor generation:  0.9453744888305664
mini_batch_src_global generation:  1.1736078262329102
r_  generation:  13.49521279335022
----------------------check_connections_block total spend ----------------------------- 47.9735209941864
generate_one_block  12.681855201721191
generate_one_block  15.21906065940857
generate_one_block  17.121715784072876
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.1837067604064941
gen group dst list time:  0.2398843765258789
time for parepare:  0.46332502365112305
local_output_nid generation:  0.5548567771911621
local_in_edges_tensor generation:  0.9224154949188232
mini_batch_src_global generation:  0.5525779724121094
r_  generation:  9.113939046859741
local_output_nid generation:  0.6496665477752686
local_in_edges_tensor generation:  0.9009573459625244
mini_batch_src_global generation:  0.7574212551116943
r_  generation:  8.944420099258423
local_output_nid generation:  0.6393296718597412
local_in_edges_tensor generation:  0.9163775444030762
mini_batch_src_global generation:  0.8611369132995605
r_  generation:  9.864207029342651
----------------------check_connections_block total spend ----------------------------- 40.75666284561157
generate_one_block  11.420588254928589
generate_one_block  11.371222972869873
generate_one_block  12.247251272201538
----------===============-------------===============-------------the number of batches *****---- 3

original number of batches:  3
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.1177029609680176  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

connection checking time:  118.08732295036316
block generation total time  107.78271389007568
average batch blocks generation time:  8.981892824172974
block dataloader generation time/epoch 311.0440036058426
pseudo mini batch 0 input nodes size: 2143189
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8076739311218262  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8076739311218262  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.606074333190918  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.606569766998291  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8154163360595703  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2086968421936035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2086968421936035  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2143189
first layer output nodes number: 1899800
edges number: 17189703
torch.Size([2143189, 100])
torch.Size([1899800, 256])
input nodes number: 1899800
output nodes number: 1109664
edges number: 21259923
torch.Size([1899800, 256])
torch.Size([1109664, 256])
input nodes number: 1109664
output nodes number: 489832
edges number: 11799280
torch.Size([1109664, 256])
torch.Size([489832, 256])
torch.Size([66444, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 11.503113746643066  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 11.514748573303223  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.9589810371398926  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

pseudo mini batch 1 input nodes size: 2117454
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8155584335327148  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8155584335327148  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.6043715476989746  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.6048669815063477  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8059711456298828  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2531356811523438  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.2531356811523438  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2117454
first layer output nodes number: 1875156
edges number: 17225644
torch.Size([2117454, 100])
torch.Size([1875156, 256])
input nodes number: 1875156
output nodes number: 1204208
edges number: 25631697
torch.Size([1875156, 256])
torch.Size([1204208, 256])
input nodes number: 1204208
output nodes number: 539942
edges number: 14588669
torch.Size([1204208, 256])
torch.Size([539942, 256])
torch.Size([66464, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 11.990467548370361  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 12.002105236053467  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 2.1126341819763184  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

pseudo mini batch 2 input nodes size: 2214597
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8059744834899902  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8059744834899902  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.6309762001037598  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.6314506530761719  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 0.8421421051025391  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.3308687210083008  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.9686279296875 GB
    Memory Allocated: 1.3308687210083008  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

first layer input nodes number: 2214597
first layer output nodes number: 2067054
edges number: 18774489
torch.Size([2214597, 100])
torch.Size([2067054, 256])
input nodes number: 2067054
output nodes number: 1433627
edges number: 29927264
torch.Size([2067054, 256])
torch.Size([1433627, 256])
input nodes number: 1433627
output nodes number: 553408
edges number: 14476716
torch.Size([1433627, 256])
torch.Size([553408, 256])
torch.Size([63663, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 19.4608154296875 GB
    Memory Allocated: 13.352089405059814  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 19.4608154296875 GB
    Memory Allocated: 13.36372709274292  GigaBytes
Max Memory Allocated: 14.408186912536621  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 2.273303508758545  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 2.273303508758545  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 2.273303508758545  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.5147960980733236 |0.4713603655497233 |0.32908137639363605 |0.00016339619954427084 |0.18809096018473306 |0.0037729740142822266 |
----------------------------------------------------------pseudo_mini_loss sum 4.35818338394165
Total (block generation + training)time/epoch 315.79426205158234
Training time/epoch 4.620427131652832
Training time without block to device /epoch 3.206346035003662
Training time without total dataloading part /epoch 1.5557801723480225
load block tensor time/epoch 1.5443882942199707
block to device time/epoch 1.41408109664917
input features size transfer per epoch 4.023313522338867e-07
blocks size to device per epoch 2.682209014892578e-07
 Run 0| Epoch 3 |
Number of nodes for computation during this epoch:  17647931
Number of first layer input nodes during this epoch:  6475240
Number of first layer output nodes during this epoch:  5842010
----------------------------------------before generate dataloader block 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 2.2733030319213867  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

The real block id is  3
get_global_graph_edges_ids_block function  spend 0.3136112689971924
global_2_local spend time (sec) 0.5222213268280029
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.03586292266845703
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1181261, 40: 172537, 39: 816, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.13240742683410645
auxiliary_graph
Graph(num_nodes=1377832, num_edges=101593543,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.740717887878418
remove nodes length  1181261

auxiliary_graph.remove_nodes spent  5.465591192245483
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=101593543,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  4.430257081985474

the counter of shared neighbor distribution
Counter({1.0: 76365738, 2.0: 14028286, 3.0: 5004694, 4.0: 2312772, 5.0: 1243162, 6.0: 739068, 7.0: 470026, 8.0: 319602, 9.0: 224300, 10.0: 163088, 11.0: 120276, 12.0: 89826, 13.0: 68390, 14.0: 52610, 15.0: 42738, 16.0: 31452, 17.0: 21982, 18.0: 19198, 19.0: 13444, 20.0: 11178, 21.0: 7120, 22.0: 5624, 23.0: 4754, 24.0: 3904, 25.0: 3688, 28.0: 2948, 33.0: 2940, 26.0: 2564, 30.0: 2392, 27.0: 2270, 32.0: 2116, 39.0: 2100, 31.0: 2056, 29.0: 1748, 35.0: 1746, 37.0: 1580, 36.0: 1530, 38.0: 1508, 34.0: 1474, 40.0: 1080})
101396972
Convert a graph into a bidirected graph: 6.783 seconds
Metis partitioning: 24.324 seconds
Split the graph: 8.178 seconds
Construct subgraphs: 0.090 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  39.41702604293823
66280
66474
63817
total k batches seeds list generation spend  70.68724632263184
after graph partition
graph partition algorithm spend time 71.89562153816223
66280
66474
63817
partition_len_list
[488350, 544755, 551359]
REG selection method  spend 72.7018175125122
time for parepare:  0.2693488597869873
local_output_nid generation:  0.011345148086547852
local_in_edges_tensor generation:  0.020300626754760742
mini_batch_src_global generation:  0.08558511734008789
r_  generation:  1.0062761306762695
local_output_nid generation:  0.011931180953979492
local_in_edges_tensor generation:  0.048323869705200195
mini_batch_src_global generation:  0.10379385948181152
r_  generation:  1.1093924045562744
local_output_nid generation:  0.011795997619628906
local_in_edges_tensor generation:  0.025998830795288086
mini_batch_src_global generation:  0.09493398666381836
r_  generation:  1.0933287143707275
----------------------check_connections_block total spend ----------------------------- 4.470722198486328
generate_one_block  1.6683473587036133
generate_one_block  1.7251179218292236
generate_one_block  1.323049783706665
The real block id is  2
get_global_graph_edges_ids_block function  spend 1.9731953144073486
gen group dst list time:  0.05020713806152344
time for parepare:  0.4632716178894043
local_output_nid generation:  0.1138761043548584
local_in_edges_tensor generation:  0.37871718406677246
mini_batch_src_global generation:  0.3858921527862549
r_  generation:  5.079453945159912
local_output_nid generation:  0.14303851127624512
local_in_edges_tensor generation:  0.4273862838745117
mini_batch_src_global generation:  0.5654661655426025
r_  generation:  6.501895189285278
local_output_nid generation:  0.15868926048278809
local_in_edges_tensor generation:  0.5369396209716797
mini_batch_src_global generation:  0.581336498260498
r_  generation:  6.445953130722046
----------------------check_connections_block total spend ----------------------------- 24.999140739440918
generate_one_block  7.00475549697876
generate_one_block  8.024338006973267
generate_one_block  8.087192296981812
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.3128445148468018
gen group dst list time:  0.13522958755493164
time for parepare:  0.44614696502685547
local_output_nid generation:  0.28128838539123535
local_in_edges_tensor generation:  0.7148871421813965
mini_batch_src_global generation:  0.6619789600372314
r_  generation:  9.268352746963501
local_output_nid generation:  0.3094773292541504
local_in_edges_tensor generation:  0.6638753414154053
mini_batch_src_global generation:  0.9775087833404541
r_  generation:  11.474565029144287
local_output_nid generation:  0.3970801830291748
local_in_edges_tensor generation:  0.9539604187011719
mini_batch_src_global generation:  1.1166987419128418
r_  generation:  13.553903579711914
----------------------check_connections_block total spend ----------------------------- 46.96734404563904
generate_one_block  12.514332056045532
generate_one_block  14.999769687652588
generate_one_block  17.37883424758911
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.2054762840270996
gen group dst list time:  0.22304630279541016
time for parepare:  0.45627903938293457
local_output_nid generation:  0.6028399467468262
local_in_edges_tensor generation:  0.923363447189331
mini_batch_src_global generation:  0.5577893257141113
r_  generation:  8.921252965927124
local_output_nid generation:  0.613905668258667
local_in_edges_tensor generation:  0.8863437175750732
mini_batch_src_global generation:  0.690575361251831
r_  generation:  9.095094680786133
local_output_nid generation:  0.648998498916626
local_in_edges_tensor generation:  0.9294190406799316
mini_batch_src_global generation:  0.777827262878418
r_  generation:  9.816901922225952
----------------------check_connections_block total spend ----------------------------- 40.393710136413574
generate_one_block  11.414878129959106
generate_one_block  11.194283962249756
generate_one_block  12.060469627380371
----------===============-------------===============-------------the number of batches *****---- 3

original number of batches:  3
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 2.2733030319213867  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

connection checking time:  116.83091711997986
block generation total time  107.3953685760498
average batch blocks generation time:  8.94961404800415
block dataloader generation time/epoch 311.15221710205077
pseudo mini batch 0 input nodes size: 2141387
----------------------------------------before load block subtensor 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 0.8416509628295898  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 0.8416509628295898  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 1.6393799781799316  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 1.63987398147583  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 0.8143978118896484  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 1.2083783149719238  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 1.2083783149719238  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

first layer input nodes number: 2141387
first layer output nodes number: 1906259
edges number: 17242686
torch.Size([2141387, 100])
torch.Size([1906259, 256])
input nodes number: 1906259
output nodes number: 1118003
edges number: 21405889
torch.Size([1906259, 256])
torch.Size([1118003, 256])
input nodes number: 1118003
output nodes number: 488350
edges number: 11728705
torch.Size([1118003, 256])
torch.Size([488350, 256])
torch.Size([66280, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 11.541538715362549  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 18.2518310546875 GB
    Memory Allocated: 11.553144931793213  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 1.9599246978759766  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

pseudo mini batch 1 input nodes size: 2113982
----------------------------------------before load block subtensor 
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 0.814857006072998  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 0.814857006072998  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 1.602376937866211  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 1.602872371673584  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 0.8046493530273438  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 1.2533378601074219  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 19.7850341796875 GB
    Memory Allocated: 1.2533378601074219  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

first layer input nodes number: 2113982
first layer output nodes number: 1873726
edges number: 17210830
torch.Size([2113982, 100])
torch.Size([1873726, 256])
input nodes number: 1873726
output nodes number: 1208254
edges number: 25717125
torch.Size([1873726, 256])
torch.Size([1208254, 256])
input nodes number: 1208254
output nodes number: 544755
edges number: 14712698
torch.Size([1208254, 256])
torch.Size([544755, 256])
torch.Size([66474, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 20.9373779296875 GB
    Memory Allocated: 12.015805721282959  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 20.9373779296875 GB
    Memory Allocated: 12.027445316314697  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 2.1160311698913574  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

pseudo mini batch 2 input nodes size: 2211372
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 0.8046832084655762  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 0.8046832084655762  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 1.628483772277832  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 1.6289596557617188  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 0.8409442901611328  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 1.328721046447754  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.0897216796875 GB
    Memory Allocated: 1.328721046447754  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

first layer input nodes number: 2211372
first layer output nodes number: 2057947
edges number: 18706727
torch.Size([2211372, 100])
torch.Size([2057947, 256])
input nodes number: 2057947
output nodes number: 1423828
edges number: 29771738
torch.Size([2057947, 256])
torch.Size([1423828, 256])
input nodes number: 1423828
output nodes number: 551359
edges number: 14459812
torch.Size([1423828, 256])
torch.Size([551359, 256])
torch.Size([63817, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4490966796875 GB
    Memory Allocated: 13.287731170654297  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4490966796875 GB
    Memory Allocated: 13.299370765686035  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.3045654296875 GB
    Memory Allocated: 2.2674508094787598  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.3045654296875 GB
    Memory Allocated: 2.2674508094787598  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.3045654296875 GB
    Memory Allocated: 2.2674508094787598  GigaBytes
Max Memory Allocated: 14.430373191833496  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.4999762376149495 |0.4848166306813558 |0.21719113985697427 |0.0001770655314127604 |0.0821082592010498 |0.0028867721557617188 |
----------------------------------------------------------pseudo_mini_loss sum 3.364513397216797
Total (block generation + training)time/epoch 315.7833129405975
Training time/epoch 4.154191732406616
Training time without block to device /epoch 2.699741840362549
Training time without total dataloading part /epoch 0.9013161659240723
load block tensor time/epoch 1.4999287128448486
block to device time/epoch 1.4544498920440674
input features size transfer per epoch 4.023313522338867e-07
blocks size to device per epoch 2.682209014892578e-07
 Run 0| Epoch 4 |
Number of nodes for computation during this epoch:  17639222
Number of first layer input nodes during this epoch:  6466741
Number of first layer output nodes during this epoch:  5837932
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=100, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=256, bias=False)
    )
    (2): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=256, bias=False)
    )
    (3): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  337408
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 100])
layers.0.fc_neigh.weight, torch.Size([256, 100])
layers.1.fc_self.weight, torch.Size([256, 256])
layers.1.fc_neigh.weight, torch.Size([256, 256])
layers.2.fc_self.weight, torch.Size([256, 256])
layers.2.fc_neigh.weight, torch.Size([256, 256])
layers.3.fc_self.weight, torch.Size([47, 256])
layers.3.fc_neigh.weight, torch.Size([47, 256])
----------------------------------------
un-trainable parameters
