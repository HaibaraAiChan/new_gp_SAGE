main start at this time 1656135655.7987704
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.5065553188323975
global_2_local spend time (sec) 0.49048900604248047
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.09473085403442383
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1256292, 50: 163817, 48: 958, 43: 933, 47: 927, 45: 884, 49: 879, 41: 861, 40: 852, 39: 816, 42: 813, 46: 807, 44: 806, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.14991021156311035
auxiliary_graph
Graph(num_nodes=1452863, num_edges=135129243,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.7718641757965088
remove nodes length  1256292

auxiliary_graph.remove_nodes spent  8.698275327682495
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=135129243,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  5.6329591274261475

the counter of shared neighbor distribution
Counter({1.0: 96835744, 2.0: 19827062, 3.0: 7693924, 4.0: 3791436, 5.0: 2140070, 6.0: 1318556, 7.0: 866322, 8.0: 595048, 9.0: 426444, 10.0: 310458, 11.0: 236344, 12.0: 183078, 13.0: 142976, 14.0: 106950, 15.0: 85820, 16.0: 67340, 17.0: 50862, 18.0: 42392, 19.0: 33792, 20.0: 28390, 21.0: 20868, 22.0: 18984, 23.0: 15084, 24.0: 12878, 25.0: 10746, 26.0: 9024, 27.0: 7364, 28.0: 6868, 30.0: 4276, 29.0: 4242, 31.0: 3522, 33.0: 3520, 32.0: 2852, 48.0: 2580, 35.0: 2468, 39.0: 2416, 36.0: 2416, 37.0: 2404, 34.0: 2034, 38.0: 2032, 40.0: 1910, 43.0: 1782, 41.0: 1508, 47.0: 1452, 44.0: 1420, 42.0: 1374, 49.0: 1218, 45.0: 1128, 46.0: 874, 50.0: 420})
134932672
Convert a graph into a bidirected graph: 9.496 seconds
Metis partitioning: 30.452 seconds
Split the graph: 3.961 seconds
Construct subgraphs: 0.064 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  44.0285267829895
19139
20183
20243
19099
20244
19084
20203
19083
19083
20210
total k batches seeds list generation spend  86.54157137870789
after graph partition
graph partition algorithm spend time 87.83746147155762
19139
20183
20243
19099
20244
19084
20203
19083
19083
20210
partition_len_list
[156264, 201543, 200573, 191237, 210176, 224992, 213100, 225278, 229396, 247876]
REG selection method  spend 88.6896140575409
time for parepare:  0.3621516227722168
local_output_nid generation:  0.005707263946533203
local_in_edges_tensor generation:  0.00924992561340332
mini_batch_src_global generation:  0.029158353805541992
r_  generation:  0.2748751640319824
local_output_nid generation:  0.0061490535736083984
local_in_edges_tensor generation:  0.01709270477294922
mini_batch_src_global generation:  0.04422903060913086
r_  generation:  0.3579428195953369
local_output_nid generation:  0.006188869476318359
local_in_edges_tensor generation:  0.019649028778076172
mini_batch_src_global generation:  0.038434505462646484
r_  generation:  0.37555456161499023
local_output_nid generation:  0.00592803955078125
local_in_edges_tensor generation:  0.009871482849121094
mini_batch_src_global generation:  0.03601503372192383
r_  generation:  0.3564019203186035
local_output_nid generation:  0.006218433380126953
local_in_edges_tensor generation:  0.014278411865234375
mini_batch_src_global generation:  0.04353785514831543
r_  generation:  0.382570743560791
local_output_nid generation:  0.006003618240356445
local_in_edges_tensor generation:  0.011868476867675781
mini_batch_src_global generation:  0.03626060485839844
r_  generation:  0.3330695629119873
local_output_nid generation:  0.006351947784423828
local_in_edges_tensor generation:  0.010418415069580078
mini_batch_src_global generation:  0.03876352310180664
r_  generation:  0.37471628189086914
local_output_nid generation:  0.0069921016693115234
local_in_edges_tensor generation:  0.02280569076538086
mini_batch_src_global generation:  0.04349040985107422
r_  generation:  0.4032919406890869
local_output_nid generation:  0.008506059646606445
local_in_edges_tensor generation:  0.023916006088256836
mini_batch_src_global generation:  0.044175148010253906
r_  generation:  0.3937668800354004
local_output_nid generation:  0.006224870681762695
local_in_edges_tensor generation:  0.018459081649780273
mini_batch_src_global generation:  0.043508052825927734
r_  generation:  0.41777467727661133
----------------------check_connections_block total spend ----------------------------- 5.367021322250366
generate_one_block  1.8346688747406006
generate_one_block  0.45587778091430664
generate_one_block  0.47887754440307617
generate_one_block  0.40651464462280273
generate_one_block  0.44087910652160645
generate_one_block  0.38084912300109863
generate_one_block  0.4326202869415283
generate_one_block  0.4642465114593506
generate_one_block  0.47626590728759766
generate_one_block  0.5335285663604736
The real block id is  3
get_global_graph_edges_ids_block function  spend 2.2970080375671387
gen group dst list time:  0.057274580001831055
time for parepare:  0.44037961959838867
local_output_nid generation:  0.03708457946777344
local_in_edges_tensor generation:  0.2327733039855957
mini_batch_src_global generation:  0.1465308666229248
r_  generation:  1.5626497268676758
local_output_nid generation:  0.05299663543701172
local_in_edges_tensor generation:  0.16725444793701172
mini_batch_src_global generation:  0.2566812038421631
r_  generation:  2.5685601234436035
local_output_nid generation:  0.055171966552734375
local_in_edges_tensor generation:  0.3997790813446045
mini_batch_src_global generation:  0.27365708351135254
r_  generation:  2.6074604988098145
local_output_nid generation:  0.05337929725646973
local_in_edges_tensor generation:  0.15294671058654785
mini_batch_src_global generation:  0.23939990997314453
r_  generation:  2.266291618347168
local_output_nid generation:  0.05488467216491699
local_in_edges_tensor generation:  0.14946484565734863
mini_batch_src_global generation:  0.26451921463012695
r_  generation:  2.46057391166687
local_output_nid generation:  0.06102418899536133
local_in_edges_tensor generation:  0.2305300235748291
mini_batch_src_global generation:  0.31870460510253906
r_  generation:  3.078545093536377
local_output_nid generation:  0.08073210716247559
local_in_edges_tensor generation:  0.16123747825622559
mini_batch_src_global generation:  0.2850048542022705
r_  generation:  2.6223878860473633
local_output_nid generation:  0.06510663032531738
local_in_edges_tensor generation:  0.18735623359680176
mini_batch_src_global generation:  0.30762171745300293
r_  generation:  3.079502820968628
local_output_nid generation:  0.06551742553710938
local_in_edges_tensor generation:  0.18981051445007324
mini_batch_src_global generation:  0.3456146717071533
r_  generation:  3.1322286128997803
local_output_nid generation:  0.06919670104980469
local_in_edges_tensor generation:  0.20893120765686035
mini_batch_src_global generation:  0.36239123344421387
r_  generation:  3.5144855976104736
----------------------check_connections_block total spend ----------------------------- 37.73852825164795
generate_one_block  2.6518964767456055
generate_one_block  3.539452075958252
generate_one_block  3.4363338947296143
generate_one_block  2.927497625350952
generate_one_block  3.1508121490478516
generate_one_block  4.185248136520386
generate_one_block  3.568897247314453
generate_one_block  4.038539409637451
generate_one_block  4.077060699462891
generate_one_block  4.448817253112793
The real block id is  2
get_global_graph_edges_ids_block function  spend 2.5103683471679688
gen group dst list time:  0.26825857162475586
time for parepare:  0.4888315200805664
local_output_nid generation:  0.15990233421325684
local_in_edges_tensor generation:  0.5147910118103027
mini_batch_src_global generation:  0.4094419479370117
r_  generation:  5.4094767570495605
local_output_nid generation:  0.2839500904083252
local_in_edges_tensor generation:  0.707252025604248
mini_batch_src_global generation:  0.7566933631896973
r_  generation:  8.092886209487915
local_output_nid generation:  0.2766602039337158
local_in_edges_tensor generation:  0.8855714797973633
mini_batch_src_global generation:  0.7907910346984863
r_  generation:  8.518307209014893
local_output_nid generation:  0.26727724075317383
local_in_edges_tensor generation:  0.47266268730163574
mini_batch_src_global generation:  0.6751153469085693
r_  generation:  7.151641845703125
local_output_nid generation:  0.21645665168762207
local_in_edges_tensor generation:  0.5554394721984863
mini_batch_src_global generation:  0.6288597583770752
r_  generation:  6.971174716949463
local_output_nid generation:  0.3200643062591553
local_in_edges_tensor generation:  0.7318189144134521
mini_batch_src_global generation:  0.9558126926422119
r_  generation:  10.775415420532227
local_output_nid generation:  0.2678689956665039
local_in_edges_tensor generation:  0.5412461757659912
mini_batch_src_global generation:  0.8763129711151123
r_  generation:  8.692922353744507
local_output_nid generation:  0.3049604892730713
local_in_edges_tensor generation:  0.7852108478546143
mini_batch_src_global generation:  0.9391970634460449
r_  generation:  10.178529739379883
local_output_nid generation:  0.27095556259155273
local_in_edges_tensor generation:  0.5725808143615723
mini_batch_src_global generation:  0.8963620662689209
r_  generation:  9.136307954788208
local_output_nid generation:  0.27913618087768555
local_in_edges_tensor generation:  0.7540664672851562
mini_batch_src_global generation:  0.9444220066070557
r_  generation:  9.970897912979126
----------------------check_connections_block total spend ----------------------------- 117.77067446708679
generate_one_block  7.3461267948150635
generate_one_block  10.927794456481934
generate_one_block  10.85447359085083
generate_one_block  9.380549907684326
generate_one_block  8.862314224243164
generate_one_block  13.673983335494995
generate_one_block  11.140005350112915
generate_one_block  12.802622318267822
generate_one_block  11.55500864982605
generate_one_block  12.307676315307617
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.2997171878814697
gen group dst list time:  0.6336390972137451
time for parepare:  0.46691393852233887
local_output_nid generation:  0.4989495277404785
local_in_edges_tensor generation:  1.139770269393921
mini_batch_src_global generation:  0.9680650234222412
r_  generation:  13.142026662826538
local_output_nid generation:  0.5873939990997314
local_in_edges_tensor generation:  1.289444923400879
mini_batch_src_global generation:  1.387178897857666
r_  generation:  15.350939989089966
local_output_nid generation:  0.6355445384979248
local_in_edges_tensor generation:  1.1606769561767578
mini_batch_src_global generation:  1.3884141445159912
r_  generation:  15.776302814483643
local_output_nid generation:  0.560173511505127
local_in_edges_tensor generation:  1.315136194229126
mini_batch_src_global generation:  1.4466941356658936
r_  generation:  14.458624362945557
local_output_nid generation:  0.5631363391876221
local_in_edges_tensor generation:  0.9929335117340088
mini_batch_src_global generation:  1.3877863883972168
r_  generation:  14.31532621383667
local_output_nid generation:  0.6453609466552734
local_in_edges_tensor generation:  1.2319087982177734
mini_batch_src_global generation:  1.4574544429779053
r_  generation:  16.302284240722656
local_output_nid generation:  0.6093502044677734
local_in_edges_tensor generation:  1.2019352912902832
mini_batch_src_global generation:  1.4155142307281494
r_  generation:  15.541880369186401
local_output_nid generation:  0.6093103885650635
local_in_edges_tensor generation:  1.2585365772247314
mini_batch_src_global generation:  1.5454001426696777
r_  generation:  16.187841176986694
local_output_nid generation:  0.5881202220916748
local_in_edges_tensor generation:  1.0359523296356201
mini_batch_src_global generation:  1.5125384330749512
r_  generation:  14.960204601287842
local_output_nid generation:  0.6037938594818115
local_in_edges_tensor generation:  1.1742832660675049
mini_batch_src_global generation:  1.4083251953125
r_  generation:  15.580527305603027
----------------------check_connections_block total spend ----------------------------- 210.95215606689453
generate_one_block  19.23608374595642
generate_one_block  20.436511993408203
generate_one_block  20.092973232269287
generate_one_block  18.496291160583496
generate_one_block  18.424105644226074
generate_one_block  20.837426900863647
generate_one_block  20.030136823654175
generate_one_block  20.8825364112854
generate_one_block  18.98850178718567
generate_one_block  19.52442717552185
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.259629249572754
gen group dst list time:  0.9022161960601807
time for parepare:  0.482241153717041
local_output_nid generation:  0.7178239822387695
local_in_edges_tensor generation:  1.1563811302185059
mini_batch_src_global generation:  0.5952374935150146
r_  generation:  9.493898630142212
local_output_nid generation:  0.7913846969604492
local_in_edges_tensor generation:  1.0469818115234375
mini_batch_src_global generation:  0.7574186325073242
r_  generation:  9.901891946792603
local_output_nid generation:  0.7528338432312012
local_in_edges_tensor generation:  1.1133859157562256
mini_batch_src_global generation:  0.8073983192443848
r_  generation:  10.079007863998413
local_output_nid generation:  0.7936360836029053
local_in_edges_tensor generation:  1.0412681102752686
mini_batch_src_global generation:  0.7280597686767578
r_  generation:  9.96595549583435
local_output_nid generation:  0.7489986419677734
local_in_edges_tensor generation:  1.1318483352661133
mini_batch_src_global generation:  0.7907624244689941
r_  generation:  9.898088932037354
local_output_nid generation:  0.7765369415283203
local_in_edges_tensor generation:  1.0518691539764404
mini_batch_src_global generation:  0.8226244449615479
r_  generation:  10.13618779182434
local_output_nid generation:  0.7805788516998291
local_in_edges_tensor generation:  0.9995400905609131
mini_batch_src_global generation:  0.8016932010650635
r_  generation:  10.437654495239258
local_output_nid generation:  0.7689216136932373
local_in_edges_tensor generation:  1.0710437297821045
mini_batch_src_global generation:  0.8868408203125
r_  generation:  10.230439901351929
local_output_nid generation:  0.7511358261108398
local_in_edges_tensor generation:  1.05607008934021
mini_batch_src_global generation:  0.8206751346588135
r_  generation:  10.153197288513184
local_output_nid generation:  0.7839744091033936
local_in_edges_tensor generation:  0.9856374263763428
mini_batch_src_global generation:  0.766728401184082
r_  generation:  10.317146301269531
----------------------check_connections_block total spend ----------------------------- 148.50916838645935
generate_one_block  12.735835313796997
generate_one_block  12.428919315338135
generate_one_block  12.768018007278442
generate_one_block  13.059033393859863
generate_one_block  12.536511182785034
generate_one_block  12.49264931678772
generate_one_block  12.868276119232178
generate_one_block  12.901178121566772
generate_one_block  12.243159770965576
generate_one_block  12.723536491394043
----------===============-------------===============-------------the number of batches *****---- 10

original number of batches:  10
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

connection checking time:  520.337548494339
block generation total time  474.4855501651764
average batch blocks generation time:  9.489711003303528
block dataloader generation time/epoch 1118.1638481616974
pseudo mini batch 0 input nodes size: 2219433
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.8455810546875 GB
    Memory Allocated: 0.8285489082336426  GigaBytes
Max Memory Allocated: 0.8285489082336426  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.8455810546875 GB
    Memory Allocated: 0.8286919593811035  GigaBytes
Max Memory Allocated: 0.8286919593811035  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.8455810546875 GB
    Memory Allocated: 0.8286919593811035  GigaBytes
Max Memory Allocated: 0.8286919593811035  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.4412841796875 GB
    Memory Allocated: 1.3412604331970215  GigaBytes
Max Memory Allocated: 1.3412604331970215  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.4412841796875 GB
    Memory Allocated: 1.3412604331970215  GigaBytes
Max Memory Allocated: 1.3412604331970215  GigaBytes

first layer input nodes number: 2219433
first layer output nodes number: 2123053
edges number: 19100421
torch.Size([2219433, 100])
torch.Size([2123053, 256])
input nodes number: 2123053
output nodes number: 1534621
edges number: 31455165
torch.Size([2123053, 256])
torch.Size([1534621, 256])
input nodes number: 1534621
output nodes number: 533455
edges number: 12670557
torch.Size([1534621, 256])
torch.Size([533455, 256])
input nodes number: 533455
output nodes number: 156264
edges number: 4643202
torch.Size([533455, 256])
torch.Size([156264, 256])
torch.Size([19139, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 17.8944091796875 GB
    Memory Allocated: 14.226150512695312  GigaBytes
Max Memory Allocated: 14.343753814697266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 17.8944091796875 GB
    Memory Allocated: 14.22950267791748  GigaBytes
Max Memory Allocated: 14.343753814697266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 2.342473030090332  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

pseudo mini batch 1 input nodes size: 2244678
----------------------------------------before load block subtensor 
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 0.8337893486022949  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 0.8337893486022949  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 1.669997215270996  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 1.6701478958129883  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 0.8432011604309082  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 1.4592232704162598  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.1912841796875 GB
    Memory Allocated: 1.4592232704162598  GigaBytes
Max Memory Allocated: 15.13674020767212  GigaBytes

first layer input nodes number: 2244678
first layer output nodes number: 2185001
edges number: 19475386
torch.Size([2244678, 100])
torch.Size([2185001, 256])
input nodes number: 2185001
output nodes number: 1770804
edges number: 35836967
torch.Size([2185001, 256])
torch.Size([1770804, 256])
input nodes number: 1770804
output nodes number: 765044
edges number: 19337435
torch.Size([1770804, 256])
torch.Size([765044, 256])
input nodes number: 765044
output nodes number: 201543
edges number: 6990140
torch.Size([765044, 256])
torch.Size([201543, 256])
torch.Size([20183, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.0799560546875 GB
    Memory Allocated: 16.207965850830078  GigaBytes
Max Memory Allocated: 16.368914127349854  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.0799560546875 GB
    Memory Allocated: 16.21150016784668  GigaBytes
Max Memory Allocated: 16.368914127349854  GigaBytes

