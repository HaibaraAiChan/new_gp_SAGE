main start at this time 1656134640.978873
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

The real block id is  4
get_global_graph_edges_ids_block function  spend 0.39013171195983887
global_2_local spend time (sec) 0.4710352420806885
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.09188985824584961
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 1256292, 50: 163817, 48: 958, 43: 933, 47: 927, 45: 884, 49: 879, 41: 861, 40: 852, 39: 816, 42: 813, 46: 807, 44: 806, 33: 793, 37: 791, 38: 775, 28: 768, 35: 754, 36: 741, 32: 727, 14: 695, 31: 691, 30: 689, 34: 677, 15: 673, 25: 671, 26: 659, 7: 655, 23: 648, 27: 646, 24: 645, 29: 643, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 22: 592, 21: 586, 19: 584, 12: 583, 9: 576, 20: 572, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.14558172225952148
auxiliary_graph
Graph(num_nodes=1452863, num_edges=135129243,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.767174482345581
remove nodes length  1256292

auxiliary_graph.remove_nodes spent  8.41958999633789
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=135129243,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  5.701133966445923

the counter of shared neighbor distribution
Counter({1.0: 96835744, 2.0: 19827062, 3.0: 7693924, 4.0: 3791436, 5.0: 2140070, 6.0: 1318556, 7.0: 866322, 8.0: 595048, 9.0: 426444, 10.0: 310458, 11.0: 236344, 12.0: 183078, 13.0: 142976, 14.0: 106950, 15.0: 85820, 16.0: 67340, 17.0: 50862, 18.0: 42392, 19.0: 33792, 20.0: 28390, 21.0: 20868, 22.0: 18984, 23.0: 15084, 24.0: 12878, 25.0: 10746, 26.0: 9024, 27.0: 7364, 28.0: 6868, 30.0: 4276, 29.0: 4242, 31.0: 3522, 33.0: 3520, 32.0: 2852, 48.0: 2580, 35.0: 2468, 39.0: 2416, 36.0: 2416, 37.0: 2404, 34.0: 2034, 38.0: 2032, 40.0: 1910, 43.0: 1782, 41.0: 1508, 47.0: 1452, 44.0: 1420, 42.0: 1374, 49.0: 1218, 45.0: 1128, 46.0: 874, 50.0: 420})
134932672
Convert a graph into a bidirected graph: 8.991 seconds
Metis partitioning: 30.741 seconds
Split the graph: 4.538 seconds
Construct subgraphs: 0.114 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  44.439183473587036
24852
25204
23911
25167
23855
23986
25309
24287
total k batches seeds list generation spend  87.29004859924316
after graph partition
graph partition algorithm spend time 88.52785658836365
24852
25204
23911
25167
23855
23986
25309
24287
partition_len_list
[269154, 222929, 223133, 260017, 288810, 269124, 295206, 272565]
REG selection method  spend 89.33090209960938
time for parepare:  0.3655240535736084
local_output_nid generation:  0.006921291351318359
local_in_edges_tensor generation:  0.01820516586303711
mini_batch_src_global generation:  0.03799319267272949
r_  generation:  0.4278535842895508
local_output_nid generation:  0.007102489471435547
local_in_edges_tensor generation:  0.024008512496948242
mini_batch_src_global generation:  0.04371452331542969
r_  generation:  0.4388892650604248
local_output_nid generation:  0.0077762603759765625
local_in_edges_tensor generation:  0.07012677192687988
mini_batch_src_global generation:  0.03761863708496094
r_  generation:  0.42266011238098145
local_output_nid generation:  0.00941777229309082
local_in_edges_tensor generation:  0.031186819076538086
mini_batch_src_global generation:  0.04391837120056152
r_  generation:  0.48583984375
local_output_nid generation:  0.006828784942626953
local_in_edges_tensor generation:  0.011545658111572266
mini_batch_src_global generation:  0.04338192939758301
r_  generation:  0.45905423164367676
local_output_nid generation:  0.0070340633392333984
local_in_edges_tensor generation:  0.010161161422729492
mini_batch_src_global generation:  0.04027366638183594
r_  generation:  0.41898512840270996
local_output_nid generation:  0.007058858871459961
local_in_edges_tensor generation:  0.01857924461364746
mini_batch_src_global generation:  0.08922886848449707
r_  generation:  0.5353174209594727
local_output_nid generation:  0.006777286529541016
local_in_edges_tensor generation:  0.020813941955566406
mini_batch_src_global generation:  0.05369162559509277
r_  generation:  0.5001120567321777
----------------------check_connections_block total spend ----------------------------- 5.4541916847229
generate_one_block  1.988476037979126
generate_one_block  0.5436885356903076
generate_one_block  0.520416259765625
generate_one_block  0.6133172512054443
generate_one_block  0.538670539855957
generate_one_block  0.4917643070220947
generate_one_block  0.6125438213348389
generate_one_block  0.5904750823974609
The real block id is  3
get_global_graph_edges_ids_block function  spend 2.2822394371032715
gen group dst list time:  0.058303117752075195
time for parepare:  0.44565367698669434
local_output_nid generation:  0.06862306594848633
local_in_edges_tensor generation:  0.3186829090118408
mini_batch_src_global generation:  0.2727010250091553
r_  generation:  3.3472156524658203
local_output_nid generation:  0.0892636775970459
local_in_edges_tensor generation:  0.23081564903259277
mini_batch_src_global generation:  0.27315187454223633
r_  generation:  2.5224974155426025
local_output_nid generation:  0.06390881538391113
local_in_edges_tensor generation:  0.28780102729797363
mini_batch_src_global generation:  0.2873363494873047
r_  generation:  2.6751585006713867
local_output_nid generation:  0.09518146514892578
local_in_edges_tensor generation:  0.2591073513031006
mini_batch_src_global generation:  0.3458101749420166
r_  generation:  3.581505060195923
local_output_nid generation:  0.07670426368713379
local_in_edges_tensor generation:  0.3044087886810303
mini_batch_src_global generation:  0.4236471652984619
r_  generation:  3.792163610458374
local_output_nid generation:  0.10328531265258789
local_in_edges_tensor generation:  0.2985703945159912
mini_batch_src_global generation:  0.375690221786499
r_  generation:  3.738487958908081
local_output_nid generation:  0.0781712532043457
local_in_edges_tensor generation:  0.25243568420410156
mini_batch_src_global generation:  0.42043399810791016
r_  generation:  4.175867319107056
local_output_nid generation:  0.0742499828338623
local_in_edges_tensor generation:  0.2709085941314697
mini_batch_src_global generation:  0.396167516708374
r_  generation:  3.7821359634399414
----------------------check_connections_block total spend ----------------------------- 38.71067237854004
generate_one_block  4.804009675979614
generate_one_block  3.3952908515930176
generate_one_block  3.552208423614502
generate_one_block  4.784833669662476
generate_one_block  5.182910919189453
generate_one_block  5.082939863204956
generate_one_block  5.742816686630249
generate_one_block  4.9566380977630615
The real block id is  2
get_global_graph_edges_ids_block function  spend 2.5601558685302734
gen group dst list time:  0.27176427841186523
time for parepare:  0.46949052810668945
local_output_nid generation:  0.2974662780761719
local_in_edges_tensor generation:  0.7732086181640625
mini_batch_src_global generation:  0.7304391860961914
r_  generation:  10.417353868484497
local_output_nid generation:  0.288923978805542
local_in_edges_tensor generation:  0.562899112701416
mini_batch_src_global generation:  0.6745960712432861
r_  generation:  6.763290643692017
local_output_nid generation:  0.3168790340423584
local_in_edges_tensor generation:  0.595041036605835
mini_batch_src_global generation:  0.7027630805969238
r_  generation:  8.120242595672607
local_output_nid generation:  0.3121931552886963
local_in_edges_tensor generation:  0.688706636428833
mini_batch_src_global generation:  0.8730030059814453
r_  generation:  9.846055507659912
local_output_nid generation:  0.3719654083251953
local_in_edges_tensor generation:  0.835869312286377
mini_batch_src_global generation:  1.08786940574646
r_  generation:  12.250889301300049
local_output_nid generation:  0.3724236488342285
local_in_edges_tensor generation:  0.8392829895019531
mini_batch_src_global generation:  1.1614515781402588
r_  generation:  12.102489233016968
local_output_nid generation:  0.33843493461608887
local_in_edges_tensor generation:  0.6932775974273682
mini_batch_src_global generation:  1.0025041103363037
r_  generation:  10.435818195343018
local_output_nid generation:  0.29209423065185547
local_in_edges_tensor generation:  0.7121918201446533
mini_batch_src_global generation:  0.9851641654968262
r_  generation:  10.301917791366577
----------------------check_connections_block total spend ----------------------------- 110.08097553253174
generate_one_block  12.768155574798584
generate_one_block  8.477942705154419
generate_one_block  10.759746074676514
generate_one_block  12.251661539077759
generate_one_block  16.054115056991577
generate_one_block  15.398823261260986
generate_one_block  13.187589645385742
generate_one_block  12.669061422348022
The real block id is  1
get_global_graph_edges_ids_block function  spend 2.102118730545044
gen group dst list time:  0.5796520709991455
time for parepare:  0.4767615795135498
local_output_nid generation:  0.5772566795349121
local_in_edges_tensor generation:  1.2298717498779297
mini_batch_src_global generation:  1.0878288745880127
r_  generation:  15.399342775344849
local_output_nid generation:  0.6293270587921143
local_in_edges_tensor generation:  1.195575475692749
mini_batch_src_global generation:  1.3567078113555908
r_  generation:  13.768422603607178
local_output_nid generation:  0.6884300708770752
local_in_edges_tensor generation:  1.1598503589630127
mini_batch_src_global generation:  1.5004017353057861
r_  generation:  15.625827550888062
local_output_nid generation:  0.711496114730835
local_in_edges_tensor generation:  1.25028657913208
mini_batch_src_global generation:  1.5096325874328613
r_  generation:  16.444139003753662
local_output_nid generation:  0.7485435009002686
local_in_edges_tensor generation:  2.21702241897583
mini_batch_src_global generation:  1.5258615016937256
r_  generation:  16.987666130065918
local_output_nid generation:  0.6281757354736328
local_in_edges_tensor generation:  1.2716310024261475
mini_batch_src_global generation:  1.6816494464874268
r_  generation:  16.359771251678467
local_output_nid generation:  0.6004235744476318
local_in_edges_tensor generation:  1.0357964038848877
mini_batch_src_global generation:  1.5468757152557373
r_  generation:  15.454997062683105
local_output_nid generation:  0.6370315551757812
local_in_edges_tensor generation:  1.205871820449829
mini_batch_src_global generation:  1.4637949466705322
r_  generation:  15.728791952133179
----------------------check_connections_block total spend ----------------------------- 176.78209447860718
generate_one_block  20.485135078430176
generate_one_block  18.151978492736816
generate_one_block  20.04814600944519
generate_one_block  22.369928121566772
generate_one_block  22.858274698257446
generate_one_block  21.40807318687439
generate_one_block  19.715403079986572
generate_one_block  20.639485120773315
The real block id is  0
get_global_graph_edges_ids_block function  spend 1.132443904876709
gen group dst list time:  0.7719154357910156
time for parepare:  0.5139133930206299
local_output_nid generation:  0.8284275531768799
local_in_edges_tensor generation:  1.1554248332977295
mini_batch_src_global generation:  0.6088004112243652
r_  generation:  9.983943462371826
local_output_nid generation:  0.8179032802581787
local_in_edges_tensor generation:  1.0806241035461426
mini_batch_src_global generation:  0.789560079574585
r_  generation:  9.641536235809326
local_output_nid generation:  0.7916209697723389
local_in_edges_tensor generation:  1.0840964317321777
mini_batch_src_global generation:  0.8791983127593994
r_  generation:  10.000878095626831
local_output_nid generation:  0.8249523639678955
local_in_edges_tensor generation:  1.0947186946868896
mini_batch_src_global generation:  0.7797038555145264
r_  generation:  10.231773853302002
local_output_nid generation:  0.841482400894165
local_in_edges_tensor generation:  1.0063254833221436
mini_batch_src_global generation:  0.8215665817260742
r_  generation:  10.562345504760742
local_output_nid generation:  0.801239013671875
local_in_edges_tensor generation:  1.0752954483032227
mini_batch_src_global generation:  0.8849115371704102
r_  generation:  10.961823463439941
local_output_nid generation:  0.8584818840026855
local_in_edges_tensor generation:  1.0484189987182617
mini_batch_src_global generation:  0.865790843963623
r_  generation:  10.209055185317993
local_output_nid generation:  0.7918660640716553
local_in_edges_tensor generation:  1.06787109375
mini_batch_src_global generation:  0.8938636779785156
r_  generation:  10.078518629074097
----------------------check_connections_block total spend ----------------------------- 121.05839562416077
generate_one_block  12.858854293823242
generate_one_block  12.524260759353638
generate_one_block  12.443330526351929
generate_one_block  12.723010540008545
generate_one_block  13.012367010116577
generate_one_block  12.478620529174805
generate_one_block  13.582709312438965
generate_one_block  12.526620388031006
----------===============-------------===============-------------the number of batches *****---- 8

original number of batches:  8
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

connection checking time:  452.0863296985626
block generation total time  412.7942924499512
average batch blocks generation time:  10.319857311248779
block dataloader generation time/epoch 985.4619979858398
pseudo mini batch 0 input nodes size: 2233077
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0017452239990234375  GigaBytes
Max Memory Allocated: 0.0017452239990234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.8494873046875 GB
    Memory Allocated: 0.8337764739990234  GigaBytes
Max Memory Allocated: 0.8337764739990234  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.8494873046875 GB
    Memory Allocated: 0.8339619636535645  GigaBytes
Max Memory Allocated: 0.8339619636535645  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.8494873046875 GB
    Memory Allocated: 0.8339619636535645  GigaBytes
Max Memory Allocated: 0.8339619636535645  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 2.5740966796875 GB
    Memory Allocated: 1.479703426361084  GigaBytes
Max Memory Allocated: 1.479703426361084  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 2.5740966796875 GB
    Memory Allocated: 1.479703426361084  GigaBytes
Max Memory Allocated: 1.479703426361084  GigaBytes

first layer input nodes number: 2233077
first layer output nodes number: 2165299
edges number: 19246129
torch.Size([2233077, 100])
torch.Size([2165299, 256])
input nodes number: 2165299
output nodes number: 1804763
edges number: 35617958
torch.Size([2165299, 256])
torch.Size([1804763, 256])
input nodes number: 1804763
output nodes number: 935096
edges number: 21821526
torch.Size([1804763, 256])
torch.Size([935096, 256])
input nodes number: 935096
output nodes number: 269154
edges number: 8442712
torch.Size([935096, 256])
torch.Size([269154, 256])
torch.Size([24852, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 21.5721435546875 GB
    Memory Allocated: 17.06284809112549  GigaBytes
Max Memory Allocated: 17.277277946472168  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 21.5721435546875 GB
    Memory Allocated: 17.067200660705566  GigaBytes
Max Memory Allocated: 17.277277946472168  GigaBytes

