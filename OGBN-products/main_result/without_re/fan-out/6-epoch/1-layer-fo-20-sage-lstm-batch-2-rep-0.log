main start at this time 1656287670.6820283
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.12234735488891602
global_2_local spend time (sec) 0.39078187942504883
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.020108461380004883
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922461, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.062497854232788086
auxiliary_graph
Graph(num_nodes=1119032, num_edges=36562937,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.490506649017334
remove nodes length  922461

auxiliary_graph.remove_nodes spent  2.1203160285949707
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36562937,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.5357739925384521

the counter of shared neighbor distribution
Counter({1.0: 31164826, 2.0: 3561518, 3.0: 934218, 4.0: 351738, 5.0: 159080, 6.0: 75358, 7.0: 41298, 8.0: 21216, 9.0: 14146, 10.0: 9880, 11.0: 6414, 12.0: 4740, 15.0: 4618, 14.0: 3980, 13.0: 3538, 18.0: 2746, 16.0: 2680, 17.0: 1692, 19.0: 1414, 20.0: 1266})
36366366
Convert a graph into a bidirected graph: 2.008 seconds
Metis partitioning: 8.841 seconds
Split the graph: 4.139 seconds
Construct subgraphs: 0.013 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.015162229537964
95500
101071
total k batches seeds list generation spend  25.84091067314148
after graph partition
graph partition algorithm spend time 26.490826845169067
95500
101071
partition_len_list
[556960, 629189]
REG selection method  spend 27.103798389434814
time for parepare:  0.2258315086364746
local_output_nid generation:  0.013501644134521484
local_in_edges_tensor generation:  0.03514599800109863
mini_batch_src_global generation:  0.07012510299682617
r_  generation:  0.78578782081604
local_output_nid generation:  0.015153884887695312
local_in_edges_tensor generation:  0.03138899803161621
mini_batch_src_global generation:  0.08070564270019531
r_  generation:  0.914405107498169
----------------------check_connections_block total spend ----------------------------- 2.5256760120391846
generate_one_block  2.0751707553863525
generate_one_block  1.0798254013061523
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

connection checking time:  2.5256760120391846
block generation total time  3.154996156692505
average batch blocks generation time:  1.5774980783462524
block dataloader generation time/epoch 33.14788818359375
pseudo mini batch 0 input nodes size: 556960
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.2264404296875 GB
    Memory Allocated: 0.20782136917114258  GigaBytes
Max Memory Allocated: 0.20782136917114258  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.2264404296875 GB
    Memory Allocated: 0.20853328704833984  GigaBytes
Max Memory Allocated: 0.20853328704833984  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.2264404296875 GB
    Memory Allocated: 0.20853328704833984  GigaBytes
Max Memory Allocated: 0.20853328704833984  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.3104248046875 GB
    Memory Allocated: 0.2224273681640625  GigaBytes
Max Memory Allocated: 0.2224273681640625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.3104248046875 GB
    Memory Allocated: 0.2224273681640625  GigaBytes
Max Memory Allocated: 0.2224273681640625  GigaBytes

torch.Size([95500, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 10.835255146026611  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 10.851977348327637  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.2537374496459961  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

pseudo mini batch 1 input nodes size: 629189
----------------------------------------before load block subtensor 
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.22559309005737305  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.22559309005737305  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.45998430252075195  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.4607377052307129  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.25254201889038086  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.26816701889038086  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 13.6072998046875 GB
    Memory Allocated: 0.26816701889038086  GigaBytes
Max Memory Allocated: 12.172105312347412  GigaBytes

torch.Size([101071, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 11.496563911437988  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 11.514261245727539  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.2851443290710449  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.28581953048706055  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.28581953048706055  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.16019845008850098 |0.15998327732086182 |0.29937005043029785 |0.0002646446228027344 |0.13224434852600098 |0.004944801330566406 |
----------------------------------------------------------pseudo_mini_loss sum 4.791060447692871
Total (block generation + training)time/epoch 34.66671323776245
Training time/epoch 1.5184533596038818
Training time without block to device /epoch 1.1984868049621582
Training time without total dataloading part /epoch 0.8687028884887695
load block tensor time/epoch 0.32039690017700195
block to device time/epoch 0.31996655464172363
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  1186149
Number of first layer input nodes during this epoch:  1186149
Number of first layer output nodes during this epoch:  196571
----------------------------------------before generate dataloader block 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.28581905364990234  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.17350292205810547
global_2_local spend time (sec) 0.42492246627807617
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.01995539665222168
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922810, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.06879734992980957
auxiliary_graph
Graph(num_nodes=1119381, num_edges=36485133,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.4895360469818115
remove nodes length  922810

auxiliary_graph.remove_nodes spent  2.142852544784546
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36485133,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.550804853439331

the counter of shared neighbor distribution
Counter({1.0: 31096044, 2.0: 3545888, 3.0: 934214, 4.0: 355388, 5.0: 161580, 6.0: 75972, 7.0: 40774, 8.0: 21746, 9.0: 14302, 10.0: 9766, 11.0: 6144, 12.0: 4722, 15.0: 4668, 14.0: 4164, 13.0: 3468, 18.0: 2754, 16.0: 2572, 17.0: 1714, 19.0: 1400, 20.0: 1282})
36288562
Convert a graph into a bidirected graph: 2.039 seconds
Metis partitioning: 9.191 seconds
Split the graph: 3.922 seconds
Construct subgraphs: 0.004 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.1697359085083
98907
97664
total k batches seeds list generation spend  26.061988592147827
after graph partition
graph partition algorithm spend time 26.64426589012146
98907
97664
partition_len_list
[617843, 563847]
REG selection method  spend 27.289055109024048
time for parepare:  0.21857810020446777
local_output_nid generation:  0.013297557830810547
local_in_edges_tensor generation:  0.020937204360961914
mini_batch_src_global generation:  0.06708240509033203
r_  generation:  0.8284730911254883
local_output_nid generation:  0.01434016227722168
local_in_edges_tensor generation:  0.030182838439941406
mini_batch_src_global generation:  0.07779407501220703
r_  generation:  0.845205545425415
----------------------check_connections_block total spend ----------------------------- 2.437408208847046
generate_one_block  1.4593324661254883
generate_one_block  1.0920944213867188
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.28581905364990234  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

connection checking time:  2.437408208847046
block generation total time  2.551426887512207
average batch blocks generation time:  1.2757134437561035
block dataloader generation time/epoch 32.9173367023468
pseudo mini batch 0 input nodes size: 617843
----------------------------------------before load block subtensor 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.25419187545776367  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.25419187545776367  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.4843564033508301  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.4850935935974121  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.24994897842407227  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.264345645904541  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 22.7244873046875 GB
    Memory Allocated: 0.264345645904541  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([98907, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.253266334533691  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.2709641456604  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2787327766418457  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

pseudo mini batch 1 input nodes size: 563847
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2495708465576172  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2495708465576172  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.45962047576904297  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.46034812927246094  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2294464111328125  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2436656951904297  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2436656951904297  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([97664, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.11503791809082  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.1323561668396  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25803136825561523  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25803136825561523  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25803136825561523  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.10315608978271484 |0.010166287422180176 |0.05105578899383545 |0.00018012523651123047 |0.15030860900878906 |0.0038285255432128906 |
----------------------------------------------------------pseudo_mini_loss sum 4.16574764251709
Total (block generation + training)time/epoch 34.00186848640442
Training time/epoch 0.6499919891357422
Training time without block to device /epoch 0.6296594142913818
Training time without total dataloading part /epoch 0.4069175720214844
load block tensor time/epoch 0.2063121795654297
block to device time/epoch 0.02033257484436035
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  1181690
Number of first layer input nodes during this epoch:  1181690
Number of first layer output nodes during this epoch:  196571
----------------------------------------before generate dataloader block 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25803089141845703  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.2194206714630127
global_2_local spend time (sec) 0.40129661560058594
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.02061176300048828
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922764, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.042641401290893555
auxiliary_graph
Graph(num_nodes=1119335, num_edges=36392487,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.4871339797973633
remove nodes length  922764

auxiliary_graph.remove_nodes spent  2.116192579269409
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36392487,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.5488011837005615

the counter of shared neighbor distribution
Counter({1.0: 31010774, 2.0: 3540742, 3.0: 935166, 4.0: 352804, 5.0: 160332, 6.0: 75926, 7.0: 41418, 8.0: 21312, 9.0: 14802, 10.0: 9708, 11.0: 6500, 15.0: 4654, 12.0: 4476, 14.0: 4168, 13.0: 3316, 18.0: 2750, 16.0: 2678, 17.0: 1698, 19.0: 1422, 20.0: 1270})
36195916
Convert a graph into a bidirected graph: 2.011 seconds
Metis partitioning: 9.188 seconds
Split the graph: 4.073 seconds
Construct subgraphs: 0.011 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.296190738677979
100587
95984
total k batches seeds list generation spend  26.036683559417725
after graph partition
graph partition algorithm spend time 26.663959503173828
100587
95984
partition_len_list
[630362, 554157]
REG selection method  spend 27.294689178466797
time for parepare:  0.21652889251708984
local_output_nid generation:  0.015748023986816406
local_in_edges_tensor generation:  0.018562793731689453
mini_batch_src_global generation:  0.06683993339538574
r_  generation:  0.8658511638641357
local_output_nid generation:  0.01452016830444336
local_in_edges_tensor generation:  0.03229355812072754
mini_batch_src_global generation:  0.0800168514251709
r_  generation:  0.8692147731781006
----------------------check_connections_block total spend ----------------------------- 2.552455425262451
generate_one_block  1.5117173194885254
generate_one_block  1.035900354385376
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25803089141845703  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

connection checking time:  2.552455425262451
block generation total time  2.5476176738739014
average batch blocks generation time:  1.2738088369369507
block dataloader generation time/epoch 32.87448581059774
pseudo mini batch 0 input nodes size: 630362
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.22922754287719727  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.22922754287719727  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.46405601501464844  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.46480560302734375  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2540283203125  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2696533203125  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2696533203125  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([100587, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.446375370025635  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.463988304138184  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2861661911010742  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

pseudo mini batch 1 input nodes size: 554157
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25454139709472656  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25454139709472656  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4609813690185547  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4616966247558594  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2261185646057129  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24007844924926758  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24007844924926758  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([95984, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 10.886481761932373  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 10.904094219207764  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25359010696411133  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25359010696411133  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25359010696411133  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.13285326957702637 |0.008093953132629395 |0.05167710781097412 |0.0002086162567138672 |0.15116679668426514 |0.0046498775482177734 |
----------------------------------------------------------pseudo_mini_loss sum 3.444021701812744
Total (block generation + training)time/epoch 33.83229676882426
Training time/epoch 0.7040591239929199
Training time without block to device /epoch 0.6878712177276611
Training time without total dataloading part /epoch 0.410754919052124
load block tensor time/epoch 0.26570653915405273
block to device time/epoch 0.01618790626525879
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  1184519
Number of first layer input nodes during this epoch:  1184519
Number of first layer output nodes during this epoch:  196571
----------------------------------------before generate dataloader block 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2535896301269531  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.21352696418762207
global_2_local spend time (sec) 0.4350433349609375
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.019852638244628906
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922436, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.04461669921875
auxiliary_graph
Graph(num_nodes=1119007, num_edges=36557547,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5202457904815674
remove nodes length  922436

auxiliary_graph.remove_nodes spent  2.2169554233551025
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36557547,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.549997091293335

the counter of shared neighbor distribution
Counter({1.0: 31146920, 2.0: 3570816, 3.0: 937668, 4.0: 352688, 5.0: 159452, 6.0: 74234, 7.0: 40278, 8.0: 21756, 9.0: 14550, 10.0: 9628, 11.0: 6316, 15.0: 4724, 12.0: 4540, 14.0: 4110, 13.0: 3548, 18.0: 2716, 16.0: 2678, 17.0: 1658, 19.0: 1428, 20.0: 1268})
36360976
Convert a graph into a bidirected graph: 2.165 seconds
Metis partitioning: 9.409 seconds
Split the graph: 3.900 seconds
Construct subgraphs: 0.004 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.492149114608765
97898
98673
total k batches seeds list generation spend  26.75477361679077
after graph partition
graph partition algorithm spend time 27.392757415771484
97898
98673
partition_len_list
[616286, 567783]
REG selection method  spend 28.08815836906433
time for parepare:  0.2137434482574463
local_output_nid generation:  0.014039754867553711
local_in_edges_tensor generation:  0.0307769775390625
mini_batch_src_global generation:  0.06437993049621582
r_  generation:  0.7953801155090332
local_output_nid generation:  0.015775442123413086
local_in_edges_tensor generation:  0.039127349853515625
mini_batch_src_global generation:  0.0851900577545166
r_  generation:  0.8855316638946533
----------------------check_connections_block total spend ----------------------------- 2.5021016597747803
generate_one_block  1.5047388076782227
generate_one_block  1.117048978805542
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2535896301269531  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

connection checking time:  2.5021016597747803
block generation total time  2.6217877864837646
average batch blocks generation time:  1.3108938932418823
block dataloader generation time/epoch 33.07054102420807
pseudo mini batch 0 input nodes size: 616286
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2253117561340332  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2253117561340332  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4548964500427246  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4556260108947754  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24847078323364258  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2627243995666504  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2627243995666504  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([97898, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.15699052810669  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.174132347106934  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2776784896850586  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

pseudo mini batch 1 input nodes size: 567783
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24880647659301758  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24880647659301758  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.46032238006591797  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4610576629638672  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.230743408203125  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24510574340820312  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24510574340820312  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([98673, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.209195613861084  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.226472854614258  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25997161865234375  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25997161865234375  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25997161865234375  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.13437843322753906 |0.010221004486083984 |0.0515592098236084 |0.0003870725631713867 |0.14916086196899414 |0.00477147102355957 |
----------------------------------------------------------pseudo_mini_loss sum 2.5506157875061035
Total (block generation + training)time/epoch 33.965808629989624
Training time/epoch 0.7072570323944092
Training time without block to device /epoch 0.6868150234222412
Training time without total dataloading part /epoch 0.4069857597351074
load block tensor time/epoch 0.2687568664550781
block to device time/epoch 0.02044200897216797
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 3 |
Number of nodes for computation during this epoch:  1184069
Number of first layer input nodes during this epoch:  1184069
Number of first layer output nodes during this epoch:  196571
----------------------------------------before generate dataloader block 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25997114181518555  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.248032808303833
global_2_local spend time (sec) 0.44738197326660156
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.02057337760925293
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922083, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.05282783508300781
auxiliary_graph
Graph(num_nodes=1118654, num_edges=36498195,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5052220821380615
remove nodes length  922083

auxiliary_graph.remove_nodes spent  2.1616528034210205
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36498195,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.561131477355957

the counter of shared neighbor distribution
Counter({1.0: 31105106, 2.0: 3556238, 3.0: 933486, 4.0: 352076, 5.0: 160138, 6.0: 75422, 7.0: 40792, 8.0: 21138, 9.0: 14834, 10.0: 9634, 11.0: 6190, 15.0: 4716, 12.0: 4580, 14.0: 4098, 13.0: 3394, 18.0: 2772, 16.0: 2718, 17.0: 1608, 19.0: 1398, 20.0: 1286})
36301624
Convert a graph into a bidirected graph: 2.053 seconds
Metis partitioning: 9.300 seconds
Split the graph: 4.326 seconds
Construct subgraphs: 0.017 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.71073293685913
96188
100383
total k batches seeds list generation spend  26.75004744529724
after graph partition
graph partition algorithm spend time 27.364930391311646
96188
100383
partition_len_list
[555279, 626296]
REG selection method  spend 28.067169427871704
time for parepare:  0.2216339111328125
local_output_nid generation:  0.013353824615478516
local_in_edges_tensor generation:  0.018735647201538086
mini_batch_src_global generation:  0.06330227851867676
r_  generation:  0.7747781276702881
local_output_nid generation:  0.015764713287353516
local_in_edges_tensor generation:  0.04753613471984863
mini_batch_src_global generation:  0.0799412727355957
r_  generation:  0.9093749523162842
----------------------check_connections_block total spend ----------------------------- 2.4824235439300537
generate_one_block  1.4253051280975342
generate_one_block  1.1724603176116943
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25997114181518555  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

connection checking time:  2.4824235439300537
block generation total time  2.5977654457092285
average batch blocks generation time:  1.2988827228546143
block dataloader generation time/epoch 33.18374514579773
pseudo mini batch 0 input nodes size: 555279
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.23087835311889648  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.23087835311889648  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.43773603439331055  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.43845272064208984  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.22620153427124023  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24019193649291992  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24019193649291992  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([96188, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 10.96428632736206  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 10.981564044952393  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2541069984436035  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

pseudo mini batch 1 input nodes size: 626296
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2257676124572754  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2257676124572754  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.45908117294311523  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.45982933044433594  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2522549629211426  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.26688051223754883  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.26688051223754883  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([100383, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.42062759399414  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.438204288482666  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.28261470794677734  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.28261470794677734  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.28261470794677734  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.1331470012664795 |0.008347868919372559 |0.05227959156036377 |0.00019681453704833984 |0.15140998363494873 |0.001781463623046875 |
----------------------------------------------------------pseudo_mini_loss sum 1.995915412902832
Total (block generation + training)time/epoch 34.0401107788086
Training time/epoch 0.7005105018615723
Training time without block to device /epoch 0.6838147640228271
Training time without total dataloading part /epoch 0.40955424308776855
load block tensor time/epoch 0.266294002532959
block to device time/epoch 0.016695737838745117
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 4 |
Number of nodes for computation during this epoch:  1181575
Number of first layer input nodes during this epoch:  1181575
Number of first layer output nodes during this epoch:  196571
----------------------------------------before generate dataloader block 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.28261423110961914  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.23211336135864258
global_2_local spend time (sec) 0.4167015552520752
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.01982402801513672
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 921862, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.04437065124511719
auxiliary_graph
Graph(num_nodes=1118433, num_edges=36529791,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5014104843139648
remove nodes length  921862

auxiliary_graph.remove_nodes spent  2.1608595848083496
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36529791,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.5313575267791748

the counter of shared neighbor distribution
Counter({1.0: 31124932, 2.0: 3562740, 3.0: 935582, 4.0: 356286, 5.0: 159148, 6.0: 75464, 7.0: 40024, 8.0: 21704, 9.0: 14304, 10.0: 10042, 11.0: 6226, 15.0: 4794, 12.0: 4764, 14.0: 4080, 13.0: 3390, 18.0: 2750, 16.0: 2588, 17.0: 1708, 19.0: 1434, 20.0: 1260})
36333220
Convert a graph into a bidirected graph: 1.722 seconds
Metis partitioning: 9.266 seconds
Split the graph: 4.660 seconds
Construct subgraphs: 0.018 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  15.681026220321655
96659
99912
total k batches seeds list generation spend  26.671109437942505
after graph partition
graph partition algorithm spend time 27.330952882766724
96659
99912
partition_len_list
[601875, 579441]
REG selection method  spend 27.996188640594482
time for parepare:  0.21854925155639648
local_output_nid generation:  0.017728328704833984
local_in_edges_tensor generation:  0.019226789474487305
mini_batch_src_global generation:  0.06349730491638184
r_  generation:  0.7844431400299072
local_output_nid generation:  0.015804052352905273
local_in_edges_tensor generation:  0.0382688045501709
mini_batch_src_global generation:  0.08091950416564941
r_  generation:  0.8920993804931641
----------------------check_connections_block total spend ----------------------------- 2.4800713062286377
generate_one_block  1.4855687618255615
generate_one_block  1.0990352630615234
----------===============-------------===============-------------the number of batches *****---- 2

original number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.28261423110961914  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

connection checking time:  2.4800713062286377
block generation total time  2.584604024887085
average batch blocks generation time:  1.2923020124435425
block dataloader generation time/epoch 33.238479256629944
pseudo mini batch 0 input nodes size: 601875
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.252988338470459  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.252988338470459  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.4772043228149414  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.47792482376098633  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24386310577392578  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25792789459228516  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.25792789459228516  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([96659, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.004193305969238  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.021770477294922  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2717018127441406  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

pseudo mini batch 1 input nodes size: 579441
----------------------------------------before load block subtensor 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2432117462158203  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2432117462158203  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.45907068252563477  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.45981550216674805  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.2348790168762207  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24943113327026367  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.24943113327026367  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

torch.Size([99912, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.346081733703613  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 11.36357593536377  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.264925479888916  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.264925479888916  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 23.4256591796875 GB
    Memory Allocated: 0.264925479888916  GigaBytes
Max Memory Allocated: 12.929795265197754  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.11815464496612549 |0.008438706398010254 |0.05081748962402344 |0.00019180774688720703 |0.15438449382781982 |0.003896951675415039 |
----------------------------------------------------------pseudo_mini_loss sum 1.8912798166275024
Total (block generation + training)time/epoch 34.06511561075846
Training time/epoch 0.6777365207672119
Training time without block to device /epoch 0.6608591079711914
Training time without total dataloading part /epoch 0.414684534072876
load block tensor time/epoch 0.23630928993225098
block to device time/epoch 0.016877412796020508
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 5 |
Number of nodes for computation during this epoch:  1181316
Number of first layer input nodes during this epoch:  1181316
Number of first layer output nodes during this epoch:  196571
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(100, 100, batch_first=True)
      (fc_self): Linear(in_features=100, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  90200
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([400, 100])
layers.0.lstm.weight_hh_l0, torch.Size([400, 100])
layers.0.lstm.bias_ih_l0, torch.Size([400])
layers.0.lstm.bias_hh_l0, torch.Size([400])
layers.0.fc_self.weight, torch.Size([47, 100])
layers.0.fc_neigh.weight, torch.Size([47, 100])
----------------------------------------
un-trainable parameters
