main start at this time 1656028680.66884
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.13879108428955078
global_2_local spend time (sec) 0.34334444999694824
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.020015239715576172
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922590, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.06513381004333496
auxiliary_graph
Graph(num_nodes=1119161, num_edges=36530005,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5570268630981445
remove nodes length  922590

auxiliary_graph.remove_nodes spent  2.1648175716400146
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36530005,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.474323034286499

the counter of shared neighbor distribution
Counter({1.0: 31135406, 2.0: 3552592, 3.0: 936932, 4.0: 353502, 5.0: 159904, 6.0: 75186, 7.0: 40668, 8.0: 21746, 9.0: 14870, 10.0: 9568, 11.0: 6274, 12.0: 4756, 15.0: 4752, 14.0: 4072, 13.0: 3450, 18.0: 2810, 16.0: 2680, 17.0: 1584, 19.0: 1406, 20.0: 1276})
36333434
Convert a graph into a bidirected graph: 1.950 seconds
Metis partitioning: 9.032 seconds
Split the graph: 1.849 seconds
Construct subgraphs: 0.338 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  13.183839082717896
31826
33696
31824
31873
33612
33740
total k batches seeds list generation spend  24.58925771713257
after graph partition
graph partition algorithm spend time 25.20423650741577
31826
33696
31824
31873
33612
33740
partition_len_list
[253488, 248879, 246027, 193741, 231969, 212970]
REG selection method  spend 25.802162647247314
time for parepare:  0.22313404083251953
local_output_nid generation:  0.006583213806152344
local_in_edges_tensor generation:  0.007847070693969727
mini_batch_src_global generation:  0.020122289657592773
r_  generation:  0.24352312088012695
local_output_nid generation:  0.012402772903442383
local_in_edges_tensor generation:  0.016269207000732422
mini_batch_src_global generation:  0.02730584144592285
r_  generation:  0.29766845703125
local_output_nid generation:  0.007588863372802734
local_in_edges_tensor generation:  0.00769805908203125
mini_batch_src_global generation:  0.02027416229248047
r_  generation:  0.26961398124694824
local_output_nid generation:  0.007725954055786133
local_in_edges_tensor generation:  0.007827997207641602
mini_batch_src_global generation:  0.024013519287109375
r_  generation:  0.29102492332458496
local_output_nid generation:  0.007920265197753906
local_in_edges_tensor generation:  0.008127450942993164
mini_batch_src_global generation:  0.052080392837524414
r_  generation:  0.3243985176086426
local_output_nid generation:  0.007851839065551758
local_in_edges_tensor generation:  0.009873151779174805
mini_batch_src_global generation:  0.03508949279785156
r_  generation:  0.31951308250427246
----------------------check_connections_block total spend ----------------------------- 2.6204488277435303
generate_one_block  1.7615821361541748
generate_one_block  0.3608870506286621
generate_one_block  0.3262593746185303
generate_one_block  0.3208596706390381
generate_one_block  0.49005603790283203
generate_one_block  0.5062978267669678
----------===============-------------===============-------------the number of batches *****---- 6

original number of batches:  6
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

connection checking time:  2.6204488277435303
block generation total time  3.765942096710205
average batch blocks generation time:  0.6276570161183676
block dataloader generation time/epoch 32.58624625205994
pseudo mini batch 0 input nodes size: 253488
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.1131591796875 GB
    Memory Allocated: 0.09476947784423828  GigaBytes
Max Memory Allocated: 0.09476947784423828  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.1131591796875 GB
    Memory Allocated: 0.09500694274902344  GigaBytes
Max Memory Allocated: 0.09500694274902344  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.1131591796875 GB
    Memory Allocated: 0.09500694274902344  GigaBytes
Max Memory Allocated: 0.09500694274902344  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.1971435546875 GB
    Memory Allocated: 0.09963417053222656  GigaBytes
Max Memory Allocated: 0.09963417053222656  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1971435546875 GB
    Memory Allocated: 0.09963417053222656  GigaBytes
Max Memory Allocated: 0.09963417053222656  GigaBytes

torch.Size([31826, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 3.681675910949707  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 3.6872496604919434  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.11086463928222656  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

pseudo mini batch 1 input nodes size: 248879
----------------------------------------before load block subtensor 
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.10149145126342773  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.10149145126342773  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.19420623779296875  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.1944575309753418  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.09978818893432617  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.1053609848022461  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 5.3416748046875 GB
    Memory Allocated: 0.1053609848022461  GigaBytes
Max Memory Allocated: 4.125296592712402  GigaBytes

torch.Size([33696, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 3.9188971519470215  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 3.9250435829162598  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.11024284362792969  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

pseudo mini batch 2 input nodes size: 246027
----------------------------------------before load block subtensor 
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.09954214096069336  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.09954214096069336  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.1911945343017578  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.19143199920654297  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.0984659194946289  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.10299396514892578  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.5819091796875 GB
    Memory Allocated: 0.10299396514892578  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

torch.Size([31824, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.5584464073181152  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.5643467903137207  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.1077122688293457  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

pseudo mini batch 3 input nodes size: 193741
----------------------------------------before load block subtensor 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09813833236694336  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09813833236694336  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.17031288146972656  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.17055082321166992  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.07866096496582031  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.08326530456542969  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.08326530456542969  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

torch.Size([31873, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.6531906127929688  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.6587719917297363  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.0879974365234375  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

pseudo mini batch 4 input nodes size: 231969
----------------------------------------before load block subtensor 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.07866954803466797  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.07866954803466797  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.1650848388671875  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.16533565521240234  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09292316436767578  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.0984954833984375  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.0984954833984375  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

torch.Size([33612, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.8805365562438965  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.8864221572875977  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.10388612747192383  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

pseudo mini batch 5 input nodes size: 212970
----------------------------------------before load block subtensor 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09322738647460938  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09322738647460938  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.17256498336791992  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.17281675338745117  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.0861506462097168  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09104585647583008  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09104585647583008  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

torch.Size([33740, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.8257789611816406  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 3.8316869735717773  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09735441207885742  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09802961349487305  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 8.6307373046875 GB
    Memory Allocated: 0.09802961349487305  GigaBytes
Max Memory Allocated: 4.412967205047607  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.07496027151743571 |0.053887248039245605 |0.1336836020151774 |0.00016808509826660156 |0.05405926704406738 |0.003991603851318359 |
----------------------------------------------------------pseudo_mini_loss sum 4.7910614013671875
Total (block generation + training)time/epoch 34.51203966140747
Training time/epoch 1.9254446029663086
Training time without block to device /epoch 1.602121114730835
Training time without total dataloading part /epoch 1.1314573287963867
load block tensor time/epoch 0.44976162910461426
block to device time/epoch 0.32332348823547363
input features size transfer per epoch 8.046627044677734e-07
blocks size to device per epoch 5.364418029785156e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  1387074
Number of first layer input nodes during this epoch:  1387074
Number of first layer output nodes during this epoch:  196571
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(100, 100, batch_first=True)
      (fc_self): Linear(in_features=100, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  90200
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([400, 100])
layers.0.lstm.weight_hh_l0, torch.Size([400, 100])
layers.0.lstm.bias_ih_l0, torch.Size([400])
layers.0.lstm.bias_hh_l0, torch.Size([400])
layers.0.fc_self.weight, torch.Size([47, 100])
layers.0.fc_neigh.weight, torch.Size([47, 100])
----------------------------------------
un-trainable parameters
