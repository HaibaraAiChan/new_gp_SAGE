main start at this time 1656028740.1479917
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.1259291172027588
global_2_local spend time (sec) 0.365525484085083
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.019550085067749023
the counter of in-degree current block !!!!!!!!!!!!!!_______________!!!!!!!!!!
Counter({0: 922590, 20: 186421, 14: 695, 15: 673, 7: 655, 10: 640, 11: 624, 13: 615, 16: 614, 18: 604, 19: 584, 12: 583, 9: 576, 17: 556, 6: 550, 8: 512, 4: 456, 5: 445, 3: 374, 2: 221, 1: 173})

A = g.adjacency_matrix() spent  0.06889796257019043
auxiliary_graph
Graph(num_nodes=1119161, num_edges=36530005,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5543596744537354
remove nodes length  922590

auxiliary_graph.remove_nodes spent  2.2734291553497314
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=36530005,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.574183464050293

the counter of shared neighbor distribution
Counter({1.0: 31135406, 2.0: 3552592, 3.0: 936932, 4.0: 353502, 5.0: 159904, 6.0: 75186, 7.0: 40668, 8.0: 21746, 9.0: 14870, 10.0: 9568, 11.0: 6274, 12.0: 4756, 15.0: 4752, 14.0: 4072, 13.0: 3450, 18.0: 2810, 16.0: 2680, 17.0: 1584, 19.0: 1406, 20.0: 1276})
36333434
Convert a graph into a bidirected graph: 2.052 seconds
Metis partitioning: 8.893 seconds
Split the graph: 1.459 seconds
Construct subgraphs: 0.358 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  12.777850151062012
27262
28919
27264
28868
28887
28108
27263
total k batches seeds list generation spend  24.549500465393066
after graph partition
graph partition algorithm spend time 25.079905033111572
27262
28919
27264
28868
28887
28108
27263
partition_len_list
[160162, 181233, 197339, 212307, 221117, 202394, 218977]
REG selection method  spend 25.679795026779175
time for parepare:  0.236525297164917
local_output_nid generation:  0.006190061569213867
local_in_edges_tensor generation:  0.0071926116943359375
mini_batch_src_global generation:  0.019202232360839844
r_  generation:  0.18681716918945312
local_output_nid generation:  0.0073664188385009766
local_in_edges_tensor generation:  0.007451295852661133
mini_batch_src_global generation:  0.024958133697509766
r_  generation:  0.231001615524292
local_output_nid generation:  0.007041454315185547
local_in_edges_tensor generation:  0.010052204132080078
mini_batch_src_global generation:  0.01888442039489746
r_  generation:  0.23209023475646973
local_output_nid generation:  0.007329225540161133
local_in_edges_tensor generation:  0.007542610168457031
mini_batch_src_global generation:  0.021128416061401367
r_  generation:  0.26212286949157715
local_output_nid generation:  0.0073359012603759766
local_in_edges_tensor generation:  0.0075490474700927734
mini_batch_src_global generation:  0.022989273071289062
r_  generation:  0.2756507396697998
local_output_nid generation:  0.0072290897369384766
local_in_edges_tensor generation:  0.00738525390625
mini_batch_src_global generation:  0.023526430130004883
r_  generation:  0.28760266304016113
local_output_nid generation:  0.007208824157714844
local_in_edges_tensor generation:  0.007096052169799805
mini_batch_src_global generation:  0.02939462661743164
r_  generation:  0.26366305351257324
----------------------check_connections_block total spend ----------------------------- 2.5912671089172363
generate_one_block  1.7768833637237549
generate_one_block  0.39480090141296387
generate_one_block  0.3731522560119629
generate_one_block  0.3535637855529785
generate_one_block  0.32262539863586426
generate_one_block  0.2933998107910156
generate_one_block  0.28595685958862305
----------===============-------------===============-------------the number of batches *****---- 7

original number of batches:  7
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

connection checking time:  2.5912671089172363
block generation total time  3.800382375717163
average batch blocks generation time:  0.5429117679595947
block dataloader generation time/epoch 32.53987979888916
pseudo mini batch 0 input nodes size: 160162
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0174560546875 GB
    Memory Allocated: 0.0003376007080078125  GigaBytes
Max Memory Allocated: 0.0003376007080078125  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.0780029296875 GB
    Memory Allocated: 0.06088447570800781  GigaBytes
Max Memory Allocated: 0.06088447570800781  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 1.0780029296875 GB
    Memory Allocated: 0.061087608337402344  GigaBytes
Max Memory Allocated: 0.061087608337402344  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.0780029296875 GB
    Memory Allocated: 0.061087608337402344  GigaBytes
Max Memory Allocated: 0.061087608337402344  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.1619873046875 GB
    Memory Allocated: 0.0650186538696289  GigaBytes
Max Memory Allocated: 0.0650186538696289  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.1619873046875 GB
    Memory Allocated: 0.0650186538696289  GigaBytes
Max Memory Allocated: 0.0650186538696289  GigaBytes

torch.Size([27262, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 3.0814208984375  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 3.086195468902588  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.07477235794067383  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

pseudo mini batch 1 input nodes size: 181233
----------------------------------------before load block subtensor 
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.06680870056152344  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.06680870056152344  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.1343235969543457  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.13453912734985352  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.07378911972045898  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.07798242568969727  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.7381591796875 GB
    Memory Allocated: 0.07798242568969727  GigaBytes
Max Memory Allocated: 3.4586315155029297  GigaBytes

torch.Size([28919, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 3.3054580688476562  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 3.3105220794677734  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.0821237564086914  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

pseudo mini batch 2 input nodes size: 197339
----------------------------------------before load block subtensor 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.07362937927246094  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.07362937927246094  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.14714431762695312  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.14734745025634766  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.07961702346801758  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.08359861373901367  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.08359861373901367  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

torch.Size([27264, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 3.131255626678467  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 3.1360297203063965  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.0873103141784668  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

pseudo mini batch 3 input nodes size: 212307
----------------------------------------before load block subtensor 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.07916784286499023  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.07916784286499023  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.15825843811035156  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.15847396850585938  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.08475589752197266  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.08901691436767578  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3651123046875 GB
    Memory Allocated: 0.08901691436767578  GigaBytes
Max Memory Allocated: 3.713416576385498  GigaBytes

torch.Size([28868, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 3.3382391929626465  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 3.3438010215759277  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.09379434585571289  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

pseudo mini batch 4 input nodes size: 221117
----------------------------------------before load block subtensor 
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.08516454696655273  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.08516454696655273  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.16753721237182617  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.16775274276733398  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.08844661712646484  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.0927267074584961  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.5526123046875 GB
    Memory Allocated: 0.0927267074584961  GigaBytes
Max Memory Allocated: 3.7558813095092773  GigaBytes

torch.Size([28887, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 3.3755178451538086  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 3.3805761337280273  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.09774112701416016  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

pseudo mini batch 5 input nodes size: 202394
----------------------------------------before load block subtensor 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08907318115234375  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08907318115234375  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.16447114944458008  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.16468095779418945  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.0820927619934082  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08619832992553711  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08619832992553711  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

torch.Size([28108, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 3.2159667015075684  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 3.220888614654541  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.09011030197143555  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

pseudo mini batch 6 input nodes size: 218977
----------------------------------------before load block subtensor 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08179426193237305  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08179426193237305  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.16336965560913086  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.1635727882385254  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.08796501159667969  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.09183120727539062  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 9.9783935546875 GB
    Memory Allocated: 0.09183120727539062  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

torch.Size([27263, 47])
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 10.0233154296875 GB
    Memory Allocated: 3.0407376289367676  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 10.0233154296875 GB
    Memory Allocated: 3.0455117225646973  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 10.0233154296875 GB
    Memory Allocated: 0.09579849243164062  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 10.0233154296875 GB
    Memory Allocated: 0.09647369384765625  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 10.0233154296875 GB
    Memory Allocated: 0.09647369384765625  GigaBytes
Max Memory Allocated: 3.796534538269043  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.06030634471348354 |0.053055252347673686 |0.1131601333618164 |0.00016277176993233816 |0.04605160440717425 |0.0034341812133789062 |
----------------------------------------------------------pseudo_mini_loss sum 4.791061878204346
Total (block generation + training)time/epoch 34.479764223098755
Training time/epoch 1.939561367034912
Training time without block to device /epoch 1.5681746006011963
Training time without total dataloading part /epoch 1.1190557479858398
load block tensor time/epoch 0.42214441299438477
block to device time/epoch 0.3713867664337158
input features size transfer per epoch 9.387731552124023e-07
blocks size to device per epoch 6.258487701416016e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  1393529
Number of first layer input nodes during this epoch:  1393529
Number of first layer output nodes during this epoch:  196571
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(100, 100, batch_first=True)
      (fc_self): Linear(in_features=100, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  90200
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([400, 100])
layers.0.lstm.weight_hh_l0, torch.Size([400, 100])
layers.0.lstm.bias_ih_l0, torch.Size([400])
layers.0.lstm.bias_hh_l0, torch.Size([400])
layers.0.fc_self.weight, torch.Size([47, 100])
layers.0.fc_neigh.weight, torch.Size([47, 100])
----------------------------------------
un-trainable parameters
