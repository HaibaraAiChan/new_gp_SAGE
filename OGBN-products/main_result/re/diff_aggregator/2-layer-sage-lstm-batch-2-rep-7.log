main start at this time 1655958976.1188283
-----------------------------------------before load data 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 0.1717529296875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0025434494018554688  GigaBytes
Max Memory Allocated: 0.0025434494018554688  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0025434494018554688  GigaBytes
Max Memory Allocated: 0.0025434494018554688  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.2241830825805664
global_2_local spend time (sec) 0.3917558193206787
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.04949498176574707
A = g.adjacency_matrix() spent  0.07464742660522461
auxiliary_graph
Graph(num_nodes=1205586, num_edges=51744463,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.5857224464416504
remove nodes length
1009015
auxiliary_graph.remove_nodes spent  2.680675983428955
after remove non output nodes the auxiliary_graph
Graph(num_nodes=196571, num_edges=51744463,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  2.067131996154785

the counter of shared neighbor distribution
Counter({1.0: 42565268, 2.0: 5784668, 3.0: 1687528, 4.0: 688038, 5.0: 337564, 6.0: 180988, 7.0: 106156, 8.0: 62284, 9.0: 39504, 10.0: 24936, 11.0: 16152, 12.0: 10442, 13.0: 7436, 14.0: 6488, 15.0: 6116, 18.0: 3980, 16.0: 3882, 17.0: 2908, 20.0: 2870, 19.0: 2726, 22.0: 1912, 23.0: 1838, 21.0: 1636, 24.0: 1624, 25.0: 948})
51547892
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 51547889, 51547890, 51547891])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 42565268, 2.0: 5784668, 3.0: 1687528, 4.0: 688038, 5.0: 337564, 6.0: 180988, 7.0: 106156, 8.0: 62284, 9.0: 39504, 10.0: 24936, 11.0: 16152, 12.0: 10442, 13.0: 7436, 14.0: 6488, 15.0: 6116, 18.0: 3980, 16.0: 3882, 17.0: 2908, 20.0: 2870, 19.0: 2726, 22.0: 1912, 23.0: 1838, 21.0: 1636, 24.0: 1624, 25.0: 948})
Convert a graph into a bidirected graph: 2.874 seconds
Metis partitioning: 11.693 seconds
Split the graph: 6.362 seconds
Construct subgraphs: 0.060 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  21.01211905479431
99885
96686
total k batches seeds list generation spend  42.23845434188843
after graph partition
graph partition algorithm spend time 43.070810079574585
99885
96686
partition_len_list
[677235, 607702]
shared_neighbor_graph_partition_s0 selection method  spend 43.72282004356384
time for parepare:  0.24405455589294434
local_output_nid generation:  0.014636754989624023
local_in_edges_tensor generation:  0.07434892654418945
mini_batch_src_global generation:  0.07732439041137695
r_  generation:  1.0730254650115967
local_output_nid generation:  0.013879537582397461
local_in_edges_tensor generation:  0.04533696174621582
mini_batch_src_global generation:  0.09329009056091309
r_  generation:  1.1273541450500488
----------------------check_connections_block total spend ----------------------------- 3.201734781265259
generate_one_block  2.858236312866211
generate_one_block  1.3207032680511475
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.7285828590393066
gen group dst list time:  0.03576469421386719
time for parepare:  0.3905937671661377
local_output_nid generation:  0.10499858856201172
local_in_edges_tensor generation:  0.2562108039855957
mini_batch_src_global generation:  0.2086327075958252
r_  generation:  3.3218250274658203
local_output_nid generation:  0.11258482933044434
local_in_edges_tensor generation:  0.16712403297424316
mini_batch_src_global generation:  0.25777602195739746
r_  generation:  3.0105626583099365
----------------------check_connections_block total spend ----------------------------- 8.914547681808472
generate_one_block  4.547037601470947
generate_one_block  3.877559185028076
----------===============-------------===============-------------the number of batches *****---- 2

before re, number of batches:  2
after number of batches:  2
re graph partition time:  0

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0025434494018554688  GigaBytes
Max Memory Allocated: 0.0025434494018554688  GigaBytes

connection checking time:  12.11628246307373
block generation total time  12.603536367416382
average batch blocks generation time:  3.1508840918540955
block dataloader generation time/epoch 70.59819006919861
pseudo mini batch 0 input nodes size: 1170185
----------------------------------------before load block subtensor 
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0025434494018554688  GigaBytes
Max Memory Allocated: 0.0025434494018554688  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 1.0194091796875 GB
    Memory Allocated: 0.0025434494018554688  GigaBytes
Max Memory Allocated: 0.0025434494018554688  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 1.4569091796875 GB
    Memory Allocated: 0.43847179412841797  GigaBytes
Max Memory Allocated: 0.43847179412841797  GigaBytes

<class 'torch.Tensor'>
----------------------------------------after  batch labels to device
 Nvidia-smi: 1.4569091796875 GB
    Memory Allocated: 0.43921613693237305  GigaBytes
Max Memory Allocated: 0.43921613693237305  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 1.4569091796875 GB
    Memory Allocated: 0.43921613693237305  GigaBytes
Max Memory Allocated: 0.43921613693237305  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 1.5916748046875 GB
    Memory Allocated: 0.5080485343933105  GigaBytes
Max Memory Allocated: 0.5080485343933105  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 1.5916748046875 GB
    Memory Allocated: 0.5080485343933105  GigaBytes
Max Memory Allocated: 0.5080485343933105  GigaBytes

first layer input nodes number: 1170185
first layer output nodes number: 677235
edges number: 6641936
----------------------------------------before model layer 0
 Nvidia-smi: 1.6365966796875 GB
    Memory Allocated: 0.5218133926391602  GigaBytes
Max Memory Allocated: 0.5472040176391602  GigaBytes

torch.Size([1170185, 100])
----------------------------------------before graph.update_all(msg_fn, self._lstm_reducer)
 Nvidia-smi: 1.6365966796875 GB
    Memory Allocated: 0.5218133926391602  GigaBytes
Max Memory Allocated: 0.5472040176391602  GigaBytes

m.shape torch.Size([1170, 1, 100])
----------------------------------------1
 Nvidia-smi: 4.4412841796875 GB
    Memory Allocated: 3.068551540374756  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.4412841796875 GB
    Memory Allocated: 3.068551540374756  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

 h.shape torch.Size([1, 1170, 100]), torch.Size([1, 1170, 100])
----------------------------------------3
 Nvidia-smi: 4.4412841796875 GB
    Memory Allocated: 3.0694241523742676  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.4451904296875 GB
    Memory Allocated: 3.0764007568359375  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

rst.shape  torch.Size([1, 1170, 100])
m.shape torch.Size([1714, 2, 100])
----------------------------------------1
 Nvidia-smi: 4.4451904296875 GB
    Memory Allocated: 3.077444553375244  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.4451904296875 GB
    Memory Allocated: 3.077444553375244  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

 h.shape torch.Size([1, 1714, 100]), torch.Size([1, 1714, 100])
----------------------------------------3
 Nvidia-smi: 4.4471435546875 GB
    Memory Allocated: 3.0787224769592285  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.4510498046875 GB
    Memory Allocated: 3.0978827476501465  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

rst.shape  torch.Size([1, 1714, 100])
m.shape torch.Size([2423, 3, 100])
----------------------------------------1
 Nvidia-smi: 4.4510498046875 GB
    Memory Allocated: 3.09995174407959  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.4510498046875 GB
    Memory Allocated: 3.09995174407959  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

 h.shape torch.Size([1, 2423, 100]), torch.Size([1, 2423, 100])
----------------------------------------3
 Nvidia-smi: 4.4530029296875 GB
    Memory Allocated: 3.101757049560547  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.4608154296875 GB
    Memory Allocated: 3.1414737701416016  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

rst.shape  torch.Size([1, 2423, 100])
m.shape torch.Size([3259, 4, 100])
----------------------------------------1
 Nvidia-smi: 4.4608154296875 GB
    Memory Allocated: 3.145427703857422  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.4608154296875 GB
    Memory Allocated: 3.145427703857422  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

 h.shape torch.Size([1, 3259, 100]), torch.Size([1, 3259, 100])
----------------------------------------3
 Nvidia-smi: 4.4608154296875 GB
    Memory Allocated: 3.148512363433838  GigaBytes
Max Memory Allocated: 3.17409086227417  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.4998779296875 GB
    Memory Allocated: 3.219773769378662  GigaBytes
Max Memory Allocated: 3.224630355834961  GigaBytes

rst.shape  torch.Size([1, 3259, 100])
m.shape torch.Size([3972, 5, 100])
----------------------------------------1
 Nvidia-smi: 4.4998779296875 GB
    Memory Allocated: 3.2259578704833984  GigaBytes
Max Memory Allocated: 3.2261805534362793  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.4998779296875 GB
    Memory Allocated: 3.2259578704833984  GigaBytes
Max Memory Allocated: 3.2261805534362793  GigaBytes

 h.shape torch.Size([1, 3972, 100]), torch.Size([1, 3972, 100])
----------------------------------------3
 Nvidia-smi: 4.4998779296875 GB
    Memory Allocated: 3.2289180755615234  GigaBytes
Max Memory Allocated: 3.2289180755615234  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.6170654296875 GB
    Memory Allocated: 3.3374924659729004  GigaBytes
Max Memory Allocated: 3.34489107131958  GigaBytes

rst.shape  torch.Size([1, 3972, 100])
m.shape torch.Size([4489, 6, 100])
----------------------------------------1
 Nvidia-smi: 4.6287841796875 GB
    Memory Allocated: 3.3460464477539062  GigaBytes
Max Memory Allocated: 3.3463478088378906  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.6287841796875 GB
    Memory Allocated: 3.3460464477539062  GigaBytes
Max Memory Allocated: 3.3463478088378906  GigaBytes

 h.shape torch.Size([1, 4489, 100]), torch.Size([1, 4489, 100])
----------------------------------------3
 Nvidia-smi: 4.6287841796875 GB
    Memory Allocated: 3.3494038581848145  GigaBytes
Max Memory Allocated: 3.3494038581848145  GigaBytes

----------------------------------------4
 Nvidia-smi: 4.7967529296875 GB
    Memory Allocated: 3.494572639465332  GigaBytes
Max Memory Allocated: 3.5046067237854004  GigaBytes

rst.shape  torch.Size([1, 4489, 100])
m.shape torch.Size([5187, 7, 100])
----------------------------------------1
 Nvidia-smi: 4.8104248046875 GB
    Memory Allocated: 3.5065598487854004  GigaBytes
Max Memory Allocated: 3.5069661140441895  GigaBytes

----------------------------------------2
 Nvidia-smi: 4.8104248046875 GB
    Memory Allocated: 3.5065598487854004  GigaBytes
Max Memory Allocated: 3.5069661140441895  GigaBytes

 h.shape torch.Size([1, 5187, 100]), torch.Size([1, 5187, 100])
----------------------------------------3
 Nvidia-smi: 4.8104248046875 GB
    Memory Allocated: 3.510425090789795  GigaBytes
Max Memory Allocated: 3.510425090789795  GigaBytes

----------------------------------------4
 Nvidia-smi: 5.0194091796875 GB
    Memory Allocated: 3.7053871154785156  GigaBytes
Max Memory Allocated: 3.7190589904785156  GigaBytes

rst.shape  torch.Size([1, 5187, 100])
m.shape torch.Size([5325, 8, 100])
----------------------------------------1
 Nvidia-smi: 5.0369873046875 GB
    Memory Allocated: 3.7191176414489746  GigaBytes
Max Memory Allocated: 3.7195940017700195  GigaBytes

----------------------------------------2
 Nvidia-smi: 5.0369873046875 GB
    Memory Allocated: 3.7191176414489746  GigaBytes
Max Memory Allocated: 3.7195940017700195  GigaBytes

 h.shape torch.Size([1, 5325, 100]), torch.Size([1, 5325, 100])
----------------------------------------3
 Nvidia-smi: 5.0369873046875 GB
    Memory Allocated: 3.7233967781066895  GigaBytes
Max Memory Allocated: 3.7233967781066895  GigaBytes

----------------------------------------4
 Nvidia-smi: 5.2889404296875 GB
    Memory Allocated: 3.949863910675049  GigaBytes
Max Memory Allocated: 3.9657340049743652  GigaBytes

rst.shape  torch.Size([1, 5325, 100])
m.shape torch.Size([5630, 9, 100])
----------------------------------------1
 Nvidia-smi: 5.3084716796875 GB
    Memory Allocated: 3.9673070907592773  GigaBytes
Max Memory Allocated: 3.9678735733032227  GigaBytes

----------------------------------------2
 Nvidia-smi: 5.3084716796875 GB
    Memory Allocated: 3.9673070907592773  GigaBytes
Max Memory Allocated: 3.9678735733032227  GigaBytes

 h.shape torch.Size([1, 5630, 100]), torch.Size([1, 5630, 100])
----------------------------------------3
 Nvidia-smi: 5.3084716796875 GB
    Memory Allocated: 3.9715023040771484  GigaBytes
Max Memory Allocated: 3.9715023040771484  GigaBytes

----------------------------------------4
 Nvidia-smi: 5.5819091796875 GB
    Memory Allocated: 4.248625755310059  GigaBytes
Max Memory Allocated: 4.268157005310059  GigaBytes

rst.shape  torch.Size([1, 5630, 100])
m.shape torch.Size([644066, 10, 100])
----------------------------------------1
 Nvidia-smi: 8.1326904296875 GB
    Memory Allocated: 6.6458611488342285  GigaBytes
Max Memory Allocated: 6.718682765960693  GigaBytes

----------------------------------------2
 Nvidia-smi: 8.1326904296875 GB
    Memory Allocated: 6.6458611488342285  GigaBytes
Max Memory Allocated: 6.718682765960693  GigaBytes

 h.shape torch.Size([1, 644066, 100]), torch.Size([1, 644066, 100])
----------------------------------------3
 Nvidia-smi: 8.6131591796875 GB
    Memory Allocated: 7.1263298988342285  GigaBytes
Max Memory Allocated: 7.1263298988342285  GigaBytes

