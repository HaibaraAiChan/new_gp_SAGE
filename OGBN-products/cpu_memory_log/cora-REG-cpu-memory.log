main start at this time 1662428662.1330297
-----------------------------------------before load data 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

  NumNodes: 2708
  NumEdges: 10556
  NumFeats: 1433
  NumClasses: 7
  NumTrainingSamples: 140
  NumValidationSamples: 500
  NumTestSamples: 1000
Done loading data from cached files.
success----------------------------------------
140
500
2068
# Nodes: 2708
# Edges: 10556
# Train: 140
# Val: 500
# Test: 2068
# Classes: 7

----------------------------------------start of run function 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  1433
----------------------------------------before model to device 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.00274658203125  GigaBytes
Max Memory Allocated: 0.00274658203125  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.00274658203125  GigaBytes
Max Memory Allocated: 0.00274658203125  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.001436471939086914
global_2_local spend time (sec) 0.00012493133544921875

----------------------------  graph partition start---------------------
REG start----................................
---------================-----------------=============---------REG before start 
{'VmPeak': 20876.5, 'VmSize': 20876.5, 'VmHWM': 3609.609375, 'VmRSS': 3609.609375}
---------================-----------------=============---------REG start 
{'VmPeak': 20876.5, 'VmSize': 20876.5, 'VmHWM': 3609.609375, 'VmRSS': 3609.609375}
---------================-----------------=============---------REG prepare 
{'VmPeak': 20876.5, 'VmSize': 20876.5, 'VmHWM': 3609.9296875, 'VmRSS': 3609.9296875}
---------================-----------------=============---------REG auxiliary graph done 
{'VmPeak': 20876.5, 'VmSize': 20876.5, 'VmHWM': 3610.3359375, 'VmRSS': 3610.3359375}
Convert a graph into a bidirected graph: 0.000 seconds
Metis partitioning: 0.000 seconds
Split the graph: 0.000 seconds
Construct subgraphs: 0.001 seconds
69
71
REG metis partition end ----................................
the time spent:  0.009980440139770508
REG construction  time spent:  0.008154153823852539
pure dgl.metis_partition the time spent:  0.0018262863159179688
total k batches seeds list generation spend  0.010141372680664062
after graph partition
graph partition algorithm spend time 0.03017711639404297

partition_len_list
[307, 327]
REG selection method  spend 0.03054976463317871
check_connections_block*********************************
time for parepare 1: 5.269050598144531e-05
local_output_nid generation: 8.106231689453125e-06
local_in_edges_tensor generation: 0.00012159347534179688

&&&&&&&&&&&&&&& before remove duplicate length: 290
remove duplicated spend time : 4.553794860839844e-05

&&&&&&&&&&&&&&& after remove duplicate length: 246

mini_batch_src_global generation: 4.458427429199219e-05
r_  generation: 0.002385854721069336

local_output_nid generation: 1.0251998901367188e-05
local_in_edges_tensor generation: 0.00014019012451171875

&&&&&&&&&&&&&&& before remove duplicate length: 330
remove duplicated spend time : 4.506111145019531e-05

&&&&&&&&&&&&&&& after remove duplicate length: 276

mini_batch_src_global generation: 4.291534423828125e-05
r_  generation: 0.00011181831359863281


The real block id is  0
get_global_graph_edges_ids_block function  spend 0.0005440711975097656
gen group dst list time:  4.673004150390625e-05
check_connections_block*********************************
time for parepare 1: 0.0001285076141357422
local_output_nid generation: 2.384185791015625e-05
local_in_edges_tensor generation: 0.0002162456512451172

&&&&&&&&&&&&&&& before remove duplicate length: 1503
remove duplicated spend time : 0.00016450881958007812

&&&&&&&&&&&&&&& after remove duplicate length: 814

mini_batch_src_global generation: 7.343292236328125e-05
r_  generation: 0.00038051605224609375

local_output_nid generation: 2.6464462280273438e-05
local_in_edges_tensor generation: 0.0001595020294189453

&&&&&&&&&&&&&&& before remove duplicate length: 1453
remove duplicated spend time : 0.000164031982421875

&&&&&&&&&&&&&&& after remove duplicate length: 699

mini_batch_src_global generation: 6.914138793945312e-05
r_  generation: 0.0003693103790283203


-----------------------------------------after block dataloader generation 
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.00274658203125  GigaBytes
Max Memory Allocated: 0.00274658203125  GigaBytes

connection checking time:  0.005345582962036133
block generation total time  0.007321596145629883
average batch blocks generation time:  0.0036607980728149414
block dataloader generation time/epoch 0.04919624328613281
pseudo mini batch 0 input nodes size: 819
----------------------------------------before load block subtensor 
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.00274658203125  GigaBytes
Max Memory Allocated: 0.00274658203125  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.00274658203125  GigaBytes
Max Memory Allocated: 0.00274658203125  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.007118701934814453  GigaBytes
Max Memory Allocated: 0.007118701934814453  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.007119655609130859  GigaBytes
Max Memory Allocated: 0.007119655609130859  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.0975341796875 GB
    Memory Allocated: 0.007119655609130859  GigaBytes
Max Memory Allocated: 0.007119655609130859  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.1619873046875 GB
    Memory Allocated: 0.007133960723876953  GigaBytes
Max Memory Allocated: 0.007133960723876953  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.1619873046875 GB
    Memory Allocated: 0.007133960723876953  GigaBytes
Max Memory Allocated: 0.007133960723876953  GigaBytes

first layer input nodes number: 819
first layer output nodes number: 307
edges number: 1503
----------------------------------------before model layer 0
 Nvidia-smi: 7.1619873046875 GB
    Memory Allocated: 0.007142543792724609  GigaBytes
Max Memory Allocated: 0.007148265838623047  GigaBytes

torch.Size([819, 1433])
----------------------------------------before mean aggregator
 Nvidia-smi: 7.1619873046875 GB
    Memory Allocated: 0.007142543792724609  GigaBytes
Max Memory Allocated: 0.007148265838623047  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 7.1619873046875 GB
    Memory Allocated: 0.007142543792724609  GigaBytes
Max Memory Allocated: 0.007148265838623047  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.008794307708740234  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.008794307708740234  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009087085723876953  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

h_neigh size torch.Size([307, 256])
h_self size  torch.Size([307, 1433])
----------------------------------------before rst
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009087085723876953  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

torch.Size([307, 256])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009379863739013672  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009087085723876953  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

torch.Size([307, 256])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009379863739013672  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009453296661376953  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------input nodes number: 307
----------------output nodes number: 69
----------------edges number: 290
----------------------------------------before mean aggregator
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009456634521484375  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009456634521484375  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009526252746582031  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009526252746582031  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009528160095214844  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

h_neigh size torch.Size([69, 7])
h_self size  torch.Size([69, 256])
----------------------------------------before rst
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009528160095214844  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

torch.Size([69, 7])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009530067443847656  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009528160095214844  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

torch.Size([69, 7])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009530067443847656  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 7.3221435546875 GB
    Memory Allocated: 0.009532928466796875  GigaBytes
Max Memory Allocated: 0.010434627532958984  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.010188102722167969  GigaBytes
Max Memory Allocated: 0.012119770050048828  GigaBytes

pseudo mini batch 1 input nodes size: 712
----------------------------------------before load block subtensor 
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.010141372680664062  GigaBytes
Max Memory Allocated: 0.012119770050048828  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.010141372680664062  GigaBytes
Max Memory Allocated: 0.012119770050048828  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.013942718505859375  GigaBytes
Max Memory Allocated: 0.013942718505859375  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.013943672180175781  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009570598602294922  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009584903717041016  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009584903717041016  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

first layer input nodes number: 712
first layer output nodes number: 327
edges number: 1453
----------------------------------------before model layer 0
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009593486785888672  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

torch.Size([712, 1433])
----------------------------------------before mean aggregator
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009593486785888672  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 7.3240966796875 GB
    Memory Allocated: 0.009593486785888672  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.0118408203125  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.0118408203125  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012152671813964844  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

h_neigh size torch.Size([327, 256])
h_self size  torch.Size([327, 1433])
----------------------------------------before rst
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012152671813964844  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

torch.Size([327, 256])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012464523315429688  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012152671813964844  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

torch.Size([327, 256])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012464523315429688  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012542724609375  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------input nodes number: 327
----------------output nodes number: 71
----------------edges number: 330
----------------------------------------before mean aggregator
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012546539306640625  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012546539306640625  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012618064880371094  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012618064880371094  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012619972229003906  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

h_neigh size torch.Size([71, 7])
h_self size  torch.Size([71, 256])
----------------------------------------before rst
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012619972229003906  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

torch.Size([71, 7])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012621879577636719  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012619972229003906  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

torch.Size([71, 7])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012619972229003906  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.012622356414794922  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 7.3260498046875 GB
    Memory Allocated: 0.009617805480957031  GigaBytes
Max Memory Allocated: 0.013943672180175781  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 7.3455810546875 GB
    Memory Allocated: 0.015383243560791016  GigaBytes
Max Memory Allocated: 0.01975536346435547  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 7.3455810546875 GB
    Memory Allocated: 0.015383243560791016  GigaBytes
Max Memory Allocated: 0.01975536346435547  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.009319663047790527 |0.17468011379241943 |0.39653170108795166 |0.00020885467529296875 |0.0036067962646484375 |0.001954793930053711 |
----------------------------------------------------------pseudo_mini_loss sum 1.9465339183807373
Total (block generation + training)time/epoch 1.22835373878479
Training time/epoch 1.178809404373169
Training time without block to device /epoch 0.8294491767883301
Training time without total dataloading part /epoch 0.8026494979858398
load block tensor time/epoch 0.018639326095581055
block to device time/epoch 0.34936022758483887
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  2165
Number of first layer input nodes during this epoch:  1531
Number of first layer output nodes during this epoch:  634
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=1433, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=1433, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=7, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=7, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  737280
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 1433])
layers.0.fc_neigh.weight, torch.Size([256, 1433])
layers.1.fc_self.weight, torch.Size([7, 256])
layers.1.fc_neigh.weight, torch.Size([7, 256])
----------------------------------------
un-trainable parameters
