main start at this time 1662430550.3523788
-----------------------------------------before load data 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

#nodes: 2449029
#edges: 123718024
#classes: 47
success----------------------------------------
196571
39255
2164782
# Nodes: 2400608
# Edges: 123718024
# Train: 196571
# Val: 39255
# Test: 2164782
# Classes: 47

----------------------------------------start of run function 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  100
----------------------------------------before model to device 
 Nvidia-smi: 6.2322998046875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 7.0780029296875 GB
    Memory Allocated: 0.0002803802490234375  GigaBytes
Max Memory Allocated: 0.0002803802490234375  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 7.0780029296875 GB
    Memory Allocated: 0.0002803802490234375  GigaBytes
Max Memory Allocated: 0.0002803802490234375  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.20009493827819824
global_2_local spend time (sec) 0.36728906631469727

----------------------------  graph partition start---------------------
REG start----................................
---------================-----------------=============---------REG before start 
{'VmPeak': 27836.84765625, 'VmSize': 24310.99609375, 'VmHWM': 11495.62890625, 'VmRSS': 7538.21484375}
number of edges of full batch :  4763879
---------================-----------------=============---------REG start 
{'VmPeak': 27836.84765625, 'VmSize': 24310.99609375, 'VmHWM': 11495.62890625, 'VmRSS': 7538.21484375}
---------================-----------------=============---------REG A 
{'VmPeak': 27836.84765625, 'VmSize': 24383.6875, 'VmHWM': 11495.62890625, 'VmRSS': 7611.09375}
---------================-----------------=============---------REG AT 
{'VmPeak': 27836.84765625, 'VmSize': 24462.72265625, 'VmHWM': 11495.62890625, 'VmRSS': 7690.53125}
---------================-----------------=============---------REG indices AT 
{'VmPeak': 27836.84765625, 'VmSize': 24830.66796875, 'VmHWM': 11495.62890625, 'VmRSS': 8058.1640625}
---------================-----------------=============---------REG indices A 
{'VmPeak': 27836.84765625, 'VmSize': 25198.36328125, 'VmHWM': 11495.62890625, 'VmRSS': 8426.0625}
---------================-----------------=============---------REG weight AT 
{'VmPeak': 27836.84765625, 'VmSize': 25289.23046875, 'VmHWM': 11495.62890625, 'VmRSS': 8516.03515625}
---------================-----------------=============---------REG weight A 
{'VmPeak': 27836.84765625, 'VmSize': 25380.1015625, 'VmHWM': 11495.62890625, 'VmRSS': 8607.04296875}
---------================-----------------=============---------REG auxiliary graph done 
{'VmPeak': 27836.84765625, 'VmSize': 26145.68359375, 'VmHWM': 11495.62890625, 'VmRSS': 9374.01171875}
Convert a graph into a bidirected graph: 3.254 seconds
Metis partitioning: 11.374 seconds
Split the graph: 6.501 seconds
Construct subgraphs: 0.047 seconds
98906
97665
REG metis partition end ----................................
the time spent:  30.512344121932983
REG construction  time spent:  9.313091278076172
pure dgl.metis_partition the time spent:  21.19925284385681
total k batches seeds list generation spend  31.195220232009888
after graph partition
graph partition algorithm spend time 31.99018383026123

partition_len_list
[621980, 661492]
REG selection method  spend 32.516197681427
check_connections_block*********************************
time for parepare 1: 0.22061729431152344
local_output_nid generation: 0.013356924057006836
local_in_edges_tensor generation: 0.029180288314819336

&&&&&&&&&&&&&&& before remove duplicate length: 2397569
remove duplicated spend time : 0.5681769847869873

&&&&&&&&&&&&&&& after remove duplicate length: 617827

mini_batch_src_global generation: 0.04091763496398926
r_  generation: 0.377777099609375

local_output_nid generation: 0.0149383544921875
local_in_edges_tensor generation: 0.047540903091430664

&&&&&&&&&&&&&&& before remove duplicate length: 2366310
remove duplicated spend time : 0.6270356178283691

&&&&&&&&&&&&&&& after remove duplicate length: 654506

mini_batch_src_global generation: 0.06403303146362305
r_  generation: 0.46758103370666504


The real block id is  0
get_global_graph_edges_ids_block function  spend 0.7365496158599854
gen group dst list time:  0.03629112243652344
check_connections_block*********************************
time for parepare 1: 0.36769652366638184
local_output_nid generation: 0.10093545913696289
local_in_edges_tensor generation: 0.21626639366149902

&&&&&&&&&&&&&&& before remove duplicate length: 5996918
remove duplicated spend time : 1.5549323558807373

&&&&&&&&&&&&&&& after remove duplicate length: 1068036

mini_batch_src_global generation: 0.0824441909790039
r_  generation: 1.033447027206421

local_output_nid generation: 0.12083911895751953
local_in_edges_tensor generation: 0.20319032669067383

&&&&&&&&&&&&&&& before remove duplicate length: 6480009
remove duplicated spend time : 1.783292531967163

&&&&&&&&&&&&&&& after remove duplicate length: 1114879

mini_batch_src_global generation: 0.12292361259460449
r_  generation: 1.1845128536224365


-----------------------------------------after block dataloader generation 
 Nvidia-smi: 7.0780029296875 GB
    Memory Allocated: 0.0002803802490234375  GigaBytes
Max Memory Allocated: 0.0002803802490234375  GigaBytes

connection checking time:  10.823944807052612
block generation total time  12.694786787033081
average batch blocks generation time:  6.3473933935165405
block dataloader generation time/epoch 57.83455443382263
pseudo mini batch 0 input nodes size: 1112553
----------------------------------------before load block subtensor 
 Nvidia-smi: 7.0780029296875 GB
    Memory Allocated: 0.0002803802490234375  GigaBytes
Max Memory Allocated: 0.0002803802490234375  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 7.0780029296875 GB
    Memory Allocated: 0.0002803802490234375  GigaBytes
Max Memory Allocated: 0.0002803802490234375  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 7.4940185546875 GB
    Memory Allocated: 0.41473913192749023  GigaBytes
Max Memory Allocated: 0.41473913192749023  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 7.4940185546875 GB
    Memory Allocated: 0.41547632217407227  GigaBytes
Max Memory Allocated: 0.41547632217407227  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 7.4940185546875 GB
    Memory Allocated: 0.41547632217407227  GigaBytes
Max Memory Allocated: 0.41547632217407227  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 7.6248779296875 GB
    Memory Allocated: 0.47802114486694336  GigaBytes
Max Memory Allocated: 0.47802114486694336  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 7.6248779296875 GB
    Memory Allocated: 0.47802114486694336  GigaBytes
Max Memory Allocated: 0.47802114486694336  GigaBytes

first layer input nodes number: 1112553
first layer output nodes number: 621980
edges number: 5996918
----------------------------------------before model layer 0
 Nvidia-smi: 7.6678466796875 GB
    Memory Allocated: 0.49094486236572266  GigaBytes
Max Memory Allocated: 0.5132851600646973  GigaBytes

torch.Size([1112553, 100])
----------------------------------------before mean aggregator
 Nvidia-smi: 7.6678466796875 GB
    Memory Allocated: 0.49094486236572266  GigaBytes
Max Memory Allocated: 0.5132851600646973  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 7.6678466796875 GB
    Memory Allocated: 0.49094486236572266  GigaBytes
Max Memory Allocated: 0.5132851600646973  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 8.7303466796875 GB
    Memory Allocated: 0.7703647613525391  GigaBytes
Max Memory Allocated: 1.0051040649414062  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 8.7303466796875 GB
    Memory Allocated: 0.7703647613525391  GigaBytes
Max Memory Allocated: 1.0051040649414062  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 9.3240966796875 GB
    Memory Allocated: 1.364114761352539  GigaBytes
Max Memory Allocated: 1.364114761352539  GigaBytes

h_neigh size torch.Size([621980, 256])
h_self size  torch.Size([621980, 100])
----------------------------------------before rst
 Nvidia-smi: 9.3240966796875 GB
    Memory Allocated: 1.364114761352539  GigaBytes
Max Memory Allocated: 1.364114761352539  GigaBytes

torch.Size([621980, 256])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 1.957864761352539  GigaBytes
Max Memory Allocated: 2.551614761352539  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 1.364114761352539  GigaBytes
Max Memory Allocated: 2.551614761352539  GigaBytes

torch.Size([621980, 256])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 1.957864761352539  GigaBytes
Max Memory Allocated: 2.551614761352539  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 2.106156349182129  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------input nodes number: 621980
----------------output nodes number: 98906
----------------edges number: 2397569
----------------------------------------before mean aggregator
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 2.111527919769287  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 10.5115966796875 GB
    Memory Allocated: 2.111527919769287  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2253923416137695  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2253923416137695  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2427101135253906  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

h_neigh size torch.Size([98906, 47])
h_self size  torch.Size([98906, 256])
----------------------------------------before rst
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2427101135253906  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

torch.Size([98906, 47])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2600278854370117  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2427101135253906  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

torch.Size([98906, 47])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.2600278854370117  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 10.5135498046875 GB
    Memory Allocated: 2.277346611022949  GigaBytes
Max Memory Allocated: 2.699906349182129  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.6002669334411621  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

pseudo mini batch 1 input nodes size: 1168020
----------------------------------------before load block subtensor 
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.4330754280090332  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.4330754280090332  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.868196964263916  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.8689250946044922  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.45372915267944336  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.5196404457092285  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.5196404457092285  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

first layer input nodes number: 1168020
first layer output nodes number: 661492
edges number: 6480009
----------------------------------------before model layer 0
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.5332717895507812  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

torch.Size([1168020, 100])
----------------------------------------before mean aggregator
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.5332717895507812  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 11.7283935546875 GB
    Memory Allocated: 0.5332717895507812  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 11.7440185546875 GB
    Memory Allocated: 0.830441951751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 11.7440185546875 GB
    Memory Allocated: 0.830441951751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 12.3748779296875 GB
    Memory Allocated: 1.461301326751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

h_neigh size torch.Size([661492, 256])
h_self size  torch.Size([661492, 100])
----------------------------------------before rst
 Nvidia-smi: 12.3748779296875 GB
    Memory Allocated: 1.461301326751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

torch.Size([661492, 256])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.092160701751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after model layer 0 x = layer(block, x)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 1.461301326751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

torch.Size([661492, 256])
----------------------------------------after model layer 0 x = self.activation(x)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.092160701751709  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after model layer 0 x = self.dropout(x)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.2498726844787598  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------input nodes number: 661492
----------------output nodes number: 97665
----------------edges number: 2366310
----------------------------------------before mean aggregator
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.2555294036865234  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------graph.srcdata['h'] =  feat_src-------
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.2555294036865234  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------graph.update_all(msg_fn, fn.mean('m', 'neigh'))-------
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.3670291900634766  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------h_neigh = graph.dstdata['neigh']-------
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.3670291900634766  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------after mean aggregator-------h_neigh = self.fc_neigh(h_neigh)-
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.384129524230957  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

h_neigh size torch.Size([97665, 47])
h_self size  torch.Size([97665, 256])
----------------------------------------before rst
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.384129524230957  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

torch.Size([97665, 47])
----------------------------------------after rst (rst = self.fc_self(h_self) + h_neigh)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.4012298583984375  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

----------------------------------------end of model layers  after x = self.layers[-1](blocks[-1], x)
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.384129524230957  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

torch.Size([97665, 47])
----------------------------------------- after batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.3839120864868164  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 13.6365966796875 GB
    Memory Allocated: 2.401012897491455  GigaBytes
Max Memory Allocated: 3.3557896614074707  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 14.3045654296875 GB
    Memory Allocated: 0.6283426284790039  GigaBytes
Max Memory Allocated: 3.555917739868164  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 14.3045654296875 GB
    Memory Allocated: 0.6289033889770508  GigaBytes
Max Memory Allocated: 3.555917739868164  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 14.3045654296875 GB
    Memory Allocated: 0.6289033889770508  GigaBytes
Max Memory Allocated: 3.555917739868164  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.17698431015014648 |0.2304772138595581 |0.4141380786895752 |0.0002357959747314453 |0.021224260330200195 |0.0026814937591552734 |
----------------------------------------------------------pseudo_mini_loss sum 6.258962631225586
Total (block generation + training)time/epoch 59.55585169792175
Training time/epoch 1.7209656238555908
Training time without block to device /epoch 1.2600111961364746
Training time without total dataloading part /epoch 0.873877763748169
load block tensor time/epoch 0.35396862030029297
block to device time/epoch 0.4609544277191162
input features size transfer per epoch 2.682209014892578e-07
blocks size to device per epoch 1.7881393432617188e-07
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  3564045
Number of first layer input nodes during this epoch:  2280573
Number of first layer output nodes during this epoch:  1283472
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (fc_self): Linear(in_features=100, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=100, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (fc_self): Linear(in_features=256, out_features=47, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=47, bias=False)
    )
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  75264
trainable parameters
layers.0.fc_self.weight, torch.Size([256, 100])
layers.0.fc_neigh.weight, torch.Size([256, 100])
layers.1.fc_self.weight, torch.Size([47, 256])
layers.1.fc_neigh.weight, torch.Size([47, 256])
----------------------------------------
un-trainable parameters
