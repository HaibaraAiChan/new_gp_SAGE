[21:35:34] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 14089438 edges into 2 parts and get 108754 edge cuts
[21:35:45] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 44458 nodes and 10799724 edges into 2 parts and get 301473 edge cuts
main start at this time 1651872920.2944453
-----------------------------------------before load data 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.015676021575927734
global_2_local spend time (sec) 0.041288137435913086
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0033223628997802734
A = g.adjacency_matrix() spent  0.005345344543457031
auxiliary_graph
Graph(num_nodes=145031, num_edges=14180379,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.09212040901184082
remove nodes length
54090
auxiliary_graph.remove_nodes spent  0.8591821193695068
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=14180379,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.6529526710510254

the counter of shared neighbor distribution
Counter({1.0: 12728892, 2.0: 1148578, 3.0: 165860, 4.0: 33436, 5.0: 8994, 6.0: 2692, 7.0: 738, 8.0: 218, 9.0: 28, 10.0: 2})
14089438
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 14089435, 14089436, 14089437])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 12728892, 2.0: 1148578, 3.0: 165860, 4.0: 33436, 5.0: 8994, 6.0: 2692, 7.0: 738, 8.0: 218, 9.0: 28, 10.0: 2})
Convert a graph into a bidirected graph: 1.110 seconds
Metis partitioning: 2.800 seconds
Split the graph: 2.064 seconds
Construct subgraphs: 0.039 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  6.02088475227356
46483
44458
total k batches seeds list generation spend  12.653562784194946
after graph partition
graph partition algorithm spend time 12.75023078918457
46483
44458
partition_len_list
[68845, 90990]
shared_neighbor_graph_partition_s0 selection method  spend 12.844825029373169
time for parepare:  0.01821756362915039
local_output_nid generation:  0.00437617301940918
local_in_edges_tensor generation:  0.009997129440307617
mini_batch_src_global generation:  0.009366273880004883
r_  generation:  0.14538264274597168
local_output_nid generation:  0.008793830871582031
local_in_edges_tensor generation:  0.012944459915161133
mini_batch_src_global generation:  0.012244701385498047
r_  generation:  0.13481664657592773
----------------------check_connections_block total spend ----------------------------- 0.4144301414489746
generate_one_block  0.18856096267700195
generate_one_block  0.1654813289642334
global_2_local spend time (sec) 0.028198719024658203
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.005750179290771484
A = g.adjacency_matrix() spent  0.004130840301513672
auxiliary_graph
Graph(num_nodes=90990, num_edges=10844182,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.10448360443115234
remove nodes length
46532
auxiliary_graph.remove_nodes spent  0.6749093532562256
after remove non output nodes the auxiliary_graph
Graph(num_nodes=44458, num_edges=10844182,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.49812793731689453

the counter of shared neighbor distribution
Counter({1.0: 9904116, 2.0: 791972, 3.0: 87488, 4.0: 12430, 5.0: 2638, 6.0: 766, 7.0: 234, 8.0: 72, 9.0: 8})
10799724
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 10799721, 10799722, 10799723])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 9904116, 2.0: 791972, 3.0: 87488, 4.0: 12430, 5.0: 2638, 6.0: 766, 7.0: 234, 8.0: 72, 9.0: 8})
Convert a graph into a bidirected graph: 0.691 seconds
Metis partitioning: 1.790 seconds
Split the graph: 1.699 seconds
Construct subgraphs: 0.029 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  4.215175628662109
21780
22678
total k batches seeds list generation spend  9.07364010810852
after graph partition
graph partition algorithm spend time 9.167664766311646
21780
22678
time for parepare:  0.02269911766052246
local_output_nid generation:  0.0026433467864990234
local_in_edges_tensor generation:  0.005248308181762695
mini_batch_src_global generation:  0.006354093551635742
r_  generation:  0.04897141456604004
local_output_nid generation:  0.0028600692749023438
local_in_edges_tensor generation:  0.004698991775512695
mini_batch_src_global generation:  0.007127285003662109
r_  generation:  0.06877326965332031
----------------------check_connections_block total spend ----------------------------- 0.19787311553955078
generate_one_block  0.06885361671447754
generate_one_block  0.09167695045471191
----------===============-------------===============-------------the number of batches ***** 3

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
pseudo mini batch 0 input nodes size: 68845
----------------------------------------before load block subtensor 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.033733367919921875  GigaBytes
Max Memory Allocated: 0.033733367919921875  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.03408002853393555  GigaBytes
Max Memory Allocated: 0.03408002853393555  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.03408002853393555  GigaBytes
Max Memory Allocated: 0.03408002853393555  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 0.9052734375 GB
    Memory Allocated: 0.03599214553833008  GigaBytes
Max Memory Allocated: 0.03599214553833008  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 0.9052734375 GB
    Memory Allocated: 0.03599214553833008  GigaBytes
Max Memory Allocated: 0.03599214553833008  GigaBytes

input nodes number: 68845
output nodes number: 46483
edges number: 256617
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 1.998898983001709  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes
[21:35:59] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 14237192 edges into 3 parts and get 149190 edge cuts

-----------------------------------------after loss calculation
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 1.9988999366760254  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.046395301818847656  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 1 input nodes size: 42587
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.04153776168823242  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.04153776168823242  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.061844825744628906  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.06200742721557617  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.0284576416015625  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.02921581268310547  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.1943359375 GB
    Memory Allocated: 0.02921581268310547  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 42587
output nodes number: 21780
edges number: 101723
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.8107562065124512  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.8107566833496094  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.026854991912841797  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 2 input nodes size: 57944
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.024776935577392578  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.024776935577392578  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.05240678787231445  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.05257606506347656  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.03210639953613281  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.03326225280761719  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2041015625 GB
    Memory Allocated: 0.03326225280761719  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 57944
output nodes number: 22678
edges number: 155074
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 1.1975502967834473  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 1.1975507736206055  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.035785675048828125  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.036846160888671875  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.036846160888671875  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.02697014808654785 |0.13328353563944498 |0.18169212341308594 |0.00020209948221842447 |0.026354153951009113 |0.005308866500854492 |
----------------------------------------------------------pseudo_mini_loss sum 3.837965488433838
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  169376
Number of first layer input nodes during this epoch:  169376
Number of first layer output nodes during this epoch:  90941
----------------------------------------before generate dataloader block 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03684568405151367  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.02911520004272461
global_2_local spend time (sec) 0.05785775184631348
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0045473575592041016
A = g.adjacency_matrix() spent  0.005877017974853516
auxiliary_graph
Graph(num_nodes=144933, num_edges=14328133,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.09675240516662598
remove nodes length
53992
auxiliary_graph.remove_nodes spent  0.7045867443084717
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=14328133,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.7005465030670166

the counter of shared neighbor distribution
Counter({1.0: 12862168, 2.0: 1164718, 3.0: 164710, 4.0: 33108, 5.0: 8804, 6.0: 2640, 7.0: 800, 8.0: 210, 9.0: 32, 10.0: 2})
14237192
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 14237189, 14237190, 14237191])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 12862168, 2.0: 1164718, 3.0: 164710, 4.0: 33108, 5.0: 8804, 6.0: 2640, 7.0: 800, 8.0: 210, 9.0: 32, 10.0: 2})
Convert a graph into a bidirected graph: 1.038 seconds
Metis partitioning: 3.068 seconds
Split the graph: 2.348 seconds
Construct subgraphs: 0.015 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  6.477172374725342
30242
30856
29843
total k batches seeds list generation spend  12.779532432556152
after graph partition
graph partition algorithm spend time 12.880515813827515
30242
30856
29843
partition_len_list
[45530, 50953, 69310]
shared_neighbor_graph_partition_s0 selection method  spend 12.998640775680542
time for parepare:  0.018984079360961914
local_output_nid generation:  0.0034759044647216797
local_in_edges_tensor generation:  0.004469394683837891
mini_batch_src_global generation:  0.008071660995483398
r_  generation: [21:36:09] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 29843 nodes and 10421588 edges into 2 parts and get 670289 edge cuts
 0.09301519393920898
local_output_nid generation:  0.005778074264526367
local_in_edges_tensor generation:  0.00629115104675293
mini_batch_src_global generation:  0.010277986526489258
r_  generation:  0.08494973182678223
local_output_nid generation:  0.005239248275756836
local_in_edges_tensor generation:  0.0051839351654052734
mini_batch_src_global generation:  0.007645130157470703
r_  generation:  0.09354877471923828
----------------------check_connections_block total spend ----------------------------- 0.4067981243133545
generate_one_block  0.11166858673095703
generate_one_block  0.16700959205627441
generate_one_block  0.19863080978393555
global_2_local spend time (sec) 0.01782059669494629
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0024018287658691406
A = g.adjacency_matrix() spent  0.0020647048950195312
auxiliary_graph
Graph(num_nodes=69310, num_edges=10451431,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.05408072471618652
remove nodes length
39467
auxiliary_graph.remove_nodes spent  0.6208276748657227
after remove non output nodes the auxiliary_graph
Graph(num_nodes=29843, num_edges=10451431,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.4748046398162842

the counter of shared neighbor distribution
Counter({1.0: 9573092, 2.0: 760922, 3.0: 76344, 4.0: 8988, 5.0: 1592, 6.0: 444, 7.0: 154, 8.0: 42, 9.0: 10})
10421588
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 10421585, 10421586, 10421587])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 9573092, 2.0: 760922, 3.0: 76344, 4.0: 8988, 5.0: 1592, 6.0: 444, 7.0: 154, 8.0: 42, 9.0: 10})
Convert a graph into a bidirected graph: 0.628 seconds
Metis partitioning: 1.754 seconds
Split the graph: 1.357 seconds
Construct subgraphs: 0.060 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  3.80549693107605
14819
15024
total k batches seeds list generation spend  8.347322463989258
after graph partition
graph partition algorithm spend time 8.383128881454468
14819
15024
time for parepare:  0.022322893142700195
local_output_nid generation:  0.0020117759704589844
local_in_edges_tensor generation:  0.007092475891113281
mini_batch_src_global generation:  0.0030760765075683594
r_  generation:  0.03793621063232422
local_output_nid generation:  0.002440929412841797
local_in_edges_tensor generation:  0.002600431442260742
mini_batch_src_global generation:  0.005223512649536133
r_  generation:  0.047235727310180664
----------------------check_connections_block total spend ----------------------------- 0.1672837734222412
generate_one_block  0.05936431884765625
generate_one_block  0.061929941177368164
----------===============-------------===============-------------the number of batches ***** 4

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03684568405151367  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
block dataloader generation time/epoch 22.671842336654663
pseudo mini batch 0 input nodes size: 45530
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03384733200073242  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03384733200073242  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.0555577278137207  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.05578327178955078  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.027984142303466797  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.029212474822998047  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.029212474822998047  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 45530
output nodes number: 30242
edges number: 164861
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 1.2872309684753418  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 1.2872319221496582  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03250885009765625  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 1 input nodes size: 50953
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.029374122619628906  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.029374122619628906  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.053670406341552734  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.053900718688964844  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.031964778900146484  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03317117691040039  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2060546875 GB
    Memory Allocated: 0.03317117691040039  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 50953
output nodes number: 30856
edges number: 161806
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 1.2686691284179688  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 1.268669605255127  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.03438520431518555  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 2 input nodes size: 38253
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.031246662139892578  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.031246662139892578  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes
[21:36:22] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 14381252 edges into 4 parts and get 453935 edge cuts

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.04948711395263672  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.049597740173339844  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.025071144104003906  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.025694847106933594  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2119140625 GB
    Memory Allocated: 0.025694847106933594  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 38253
output nodes number: 14819
edges number: 83665
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.6600480079650879  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.6600484848022461  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.024379730224609375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 3 input nodes size: 41472
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.022681236267089844  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.022681236267089844  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.042456626892089844  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.04256868362426758  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.024217605590820312  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.02498626708984375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2177734375 GB
    Memory Allocated: 0.02498626708984375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 41472
output nodes number: 15024
edges number: 103082
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.7990913391113281  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.7990918159484863  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026706218719482422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026706218719482422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026706218719482422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.01274120807647705 |0.0012748241424560547 |0.03418684005737305 |0.00017964839935302734 |0.025616824626922607 |0.004710674285888672 |
----------------------------------------------------------pseudo_mini_loss sum 3.26849365234375
Total (block generation + training)time/epoch 22.992773056030273
Training time/epoch 0.32059240341186523
Training time without block to device /epoch 0.315493106842041
Training time without total dataloading part /epoch 0.2446439266204834
load block tensor time/epoch 0.0509648323059082
block to device time/epoch 0.005099296569824219
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  176208
Number of first layer input nodes during this epoch:  176208
Number of first layer output nodes during this epoch:  90941
----------------------------------------before generate dataloader block 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02670574188232422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.026006221771240234
global_2_local spend time (sec) 0.0565030574798584
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004307270050048828
A = g.adjacency_matrix() spent  0.007244110107421875
auxiliary_graph
Graph(num_nodes=145065, num_edges=14472193,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.09345388412475586
remove nodes length
54124
auxiliary_graph.remove_nodes spent  0.7065103054046631
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=14472193,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.6470742225646973

the counter of shared neighbor distribution
Counter({1.0: 12980392, 2.0: 1183048, 3.0: 170858, 4.0: 34106, 5.0: 9200, 6.0: 2692, 7.0: 720, 8.0: 192, 9.0: 38, 10.0: 6})
14381252
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 14381249, 14381250, 14381251])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 12980392, 2.0: 1183048, 3.0: 170858, 4.0: 34106, 5.0: 9200, 6.0: 2692, 7.0: 720, 8.0: 192, 9.0: 38, 10.0: 6})
Convert a graph into a bidirected graph: 1.081 seconds
Metis partitioning: 2.934 seconds
Split the graph: 2.214 seconds
Construct subgraphs: 0.047 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  6.283770799636841
22762
23188
22489
22502
total k batches seeds list generation spend  12.534833431243896
after graph partition
graph partition algorithm spend time 12.628617525100708
22762
23188
22489
22502
partition_len_list
[34006, 39051, 57814, 43050]
shared_neighbor_graph_partition_s0 selection method  spend 12.745441198348999
time for parepare:  0.018561363220214844
local_output_nid generation:  0.002802610397338867
local_in_edges_tensor generation:  0.003641843795776367
mini_batch_src_global generation:  0.005204200744628906
r_  generation:  0.06107378005981445
local_output_nid generation:  0.004182577133178711
local_in_edges_tensor generation:  0.004650115966796875
mini_batch_src_global generation:  0.00566411018371582
r_  generation:  0.06081056594848633
local_output_nid generation:  0.0040645599365234375
local_in_edges_tensor generation:  0.0036056041717529297
mini_batch_src_global generation:  0.0062923431396484375[21:36:31] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 22489 nodes and 9172476 edges into 2 parts and get 720444 edge cuts

r_  generation:  0.07294774055480957
local_output_nid generation:  0.004202842712402344
local_in_edges_tensor generation:  0.003503561019897461
mini_batch_src_global generation:  0.004960536956787109
r_  generation:  0.05280733108520508
----------------------check_connections_block total spend ----------------------------- 0.37105369567871094
generate_one_block  0.08359003067016602
generate_one_block  0.0763692855834961
generate_one_block  0.10435009002685547
generate_one_block  0.06665587425231934
global_2_local spend time (sec) 0.014251232147216797
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0017507076263427734
A = g.adjacency_matrix() spent  0.005120277404785156
auxiliary_graph
Graph(num_nodes=57814, num_edges=9194965,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.038025617599487305
remove nodes length
35325
auxiliary_graph.remove_nodes spent  0.501739501953125
after remove non output nodes the auxiliary_graph
Graph(num_nodes=22489, num_edges=9194965,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.42092394828796387

the counter of shared neighbor distribution
Counter({1.0: 8402914, 2.0: 687724, 3.0: 71954, 4.0: 8202, 5.0: 1184, 6.0: 310, 7.0: 132, 8.0: 50, 9.0: 4, 10.0: 2})
9172476
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([      0,       1,       2,  ..., 9172473, 9172474, 9172475])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 8402914, 2.0: 687724, 3.0: 71954, 4.0: 8202, 5.0: 1184, 6.0: 310, 7.0: 132, 8.0: 50, 9.0: 4, 10.0: 2})
Convert a graph into a bidirected graph: 0.571 seconds
Metis partitioning: 1.528 seconds
Split the graph: 1.056 seconds
Construct subgraphs: 0.013 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  3.1743249893188477
11413
11076
total k batches seeds list generation spend  7.095555782318115
after graph partition
graph partition algorithm spend time 7.1412858963012695
11413
11076
time for parepare:  0.03250575065612793
local_output_nid generation:  0.002099752426147461
local_in_edges_tensor generation:  0.005815982818603516
mini_batch_src_global generation:  0.0039997100830078125
r_  generation:  0.03828120231628418
local_output_nid generation:  0.0018625259399414062
local_in_edges_tensor generation:  0.001953601837158203
mini_batch_src_global generation:  0.0032465457916259766
r_  generation:  0.03149724006652832
----------------------check_connections_block total spend ----------------------------- 0.14092731475830078
generate_one_block  0.058066368103027344
generate_one_block  0.04242515563964844
----------===============-------------===============-------------the number of batches ***** 5

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02670574188232422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
block dataloader generation time/epoch 21.80806601047516
pseudo mini batch 0 input nodes size: 34006
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.024690628051757812  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.024690628051757812  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04090595245361328  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.041075706481933594  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02118825912475586  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.022163867950439453  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.022163867950439453  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 34006
output nodes number: 22762
edges number: 130914
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 1.0177011489868164  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 1.0177021026611328  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.024358749389648438  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 1 input nodes size: 39051
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02189922332763672  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02189922332763672  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04143047332763672  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04160356521606445  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.025218486785888672  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026151180267333984  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026151180267333984  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 39051
output nodes number: 23188
edges number: 125149
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.9778833389282227  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.9778838157653809  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.027698516845703125  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 2 input nodes size: 43050
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.025281906127929688  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.025281906127929688  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04580974578857422  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04597759246826172  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026273250579833984  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.027054309844970703  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.027054309844970703  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 43050
output nodes number: 22502
edges number: 104789
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.8385429382324219  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.8385434150695801  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.029114246368408203  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 3 input nodes size: 33227
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026979446411132812  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.026979446411132812  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.04282331466674805  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.042908668518066406  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.022212982177734375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.022825241088867188  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.022825241088867188  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 33227
output nodes number: 11413
edges number: 82170
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.6360254287719727  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.6360259056091309  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.021646976470947266  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

pseudo mini batch 4 input nodes size: 34937
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.020046234130859375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.020046234130859375  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.03670549392700195  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.0367884635925293  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.020859241485595703  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02138376235961914  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02138376235961914  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

input nodes number: 34937
output nodes number: 11076
edges number: 70392
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.5521650314331055  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.5521655082702637  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02227783203125  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02227783203125  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 3.2587890625 GB
    Memory Allocated: 0.02227783203125  GigaBytes
Max Memory Allocated: 2.153296947479248  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.011660575866699219 |0.0013779163360595702 |0.0301821231842041 |0.0001575469970703125 |0.025601530075073244 |0.003041505813598633 |
----------------------------------------------------------pseudo_mini_loss sum 3.169161796569824
Total (block generation + training)time/epoch 22.155463099479675
Training time/epoch 0.3735377788543701
Training time without block to device /epoch 0.36664819717407227
Training time without total dataloading part /epoch 0.2827475070953369
load block tensor time/epoch 0.058302879333496094
block to device time/epoch 0.0068895816802978516
input features size transfer per epoch 6.705522537231445e-07
blocks size to device per epoch 4.470348358154297e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  184271
Number of first layer input nodes during this epoch:  184271
Number of first layer output nodes during this epoch:  90941
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(128, 128, batch_first=True)
      (fc_self): Linear(in_features=128, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=40, bias=False)
    )
  )
  (bns): ModuleList()
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  142336
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([512, 128])
layers.0.lstm.weight_hh_l0, torch.Size([512, 128])
layers.0.lstm.bias_ih_l0, torch.Size([512])
layers.0.lstm.bias_hh_l0, torch.Size([512])
layers.0.fc_self.weight, torch.Size([40, 128])
layers.0.fc_neigh.weight, torch.Size([40, 128])
----------------------------------------
un-trainable parametersUsing backend: pytorch

