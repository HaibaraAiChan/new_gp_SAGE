[04:01:51] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 42055170 edges into 2 parts and get 240375 edge cuts
[04:02:23] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 45410 nodes and 36779296 edges into 2 parts and get 1699614 edge cuts
main start at this time 1651809678.6705658
-----------------------------------------before load data 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.024469614028930664
global_2_local spend time (sec) 0.04562234878540039
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.00597834587097168
A = g.adjacency_matrix() spent  0.012059926986694336
auxiliary_graph
Graph(num_nodes=160291, num_edges=42146111,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.12524127960205078
remove nodes length
69350
auxiliary_graph.remove_nodes spent  2.5395138263702393
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=42146111,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.9793002605438232

the counter of shared neighbor distribution
Counter({1.0: 30971422, 2.0: 7127264, 3.0: 2263826, 4.0: 839656, 5.0: 364856, 6.0: 179646, 7.0: 99368, 8.0: 60356, 9.0: 38278, 10.0: 26308, 11.0: 17936, 12.0: 13416, 13.0: 9940, 14.0: 7776, 15.0: 6242, 16.0: 4962, 17.0: 3814, 18.0: 3156, 19.0: 2480, 20.0: 2192, 21.0: 1786, 22.0: 1616, 23.0: 1228, 24.0: 1024, 25.0: 900, 26.0: 778, 27.0: 674, 29.0: 558, 28.0: 512, 30.0: 448, 31.0: 384, 32.0: 318, 33.0: 316, 34.0: 236, 37.0: 202, 35.0: 184, 38.0: 154, 36.0: 150, 40.0: 126, 39.0: 104, 44.0: 90, 41.0: 72, 42.0: 68, 43.0: 62, 45.0: 52, 46.0: 32, 50.0: 30, 51.0: 26, 47.0: 22, 48.0: 22, 49.0: 12, 53.0: 12, 52.0: 12, 55.0: 10, 54.0: 10, 57.0: 8, 59.0: 8, 56.0: 6, 67.0: 4, 70.0: 4, 58.0: 4, 64.0: 4, 73.0: 2, 89.0: 2, 77.0: 2, 60.0: 2})
42055170
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 42055167, 42055168, 42055169])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 30971422, 2.0: 7127264, 3.0: 2263826, 4.0: 839656, 5.0: 364856, 6.0: 179646, 7.0: 99368, 8.0: 60356, 9.0: 38278, 10.0: 26308, 11.0: 17936, 12.0: 13416, 13.0: 9940, 14.0: 7776, 15.0: 6242, 16.0: 4962, 17.0: 3814, 18.0: 3156, 19.0: 2480, 20.0: 2192, 21.0: 1786, 22.0: 1616, 23.0: 1228, 24.0: 1024, 25.0: 900, 26.0: 778, 27.0: 674, 29.0: 558, 28.0: 512, 30.0: 448, 31.0: 384, 32.0: 318, 33.0: 316, 34.0: 236, 37.0: 202, 35.0: 184, 38.0: 154, 36.0: 150, 40.0: 126, 39.0: 104, 44.0: 90, 41.0: 72, 42.0: 68, 43.0: 62, 45.0: 52, 46.0: 32, 50.0: 30, 51.0: 26, 47.0: 22, 48.0: 22, 49.0: 12, 53.0: 12, 52.0: 12, 55.0: 10, 54.0: 10, 57.0: 8, 59.0: 8, 56.0: 6, 67.0: 4, 70.0: 4, 58.0: 4, 64.0: 4, 73.0: 2, 89.0: 2, 77.0: 2, 60.0: 2})
Convert a graph into a bidirected graph: 2.855 seconds
Metis partitioning: 7.627 seconds
Split the graph: 6.995 seconds
Construct subgraphs: 0.040 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  17.536221504211426
45531
45410
total k batches seeds list generation spend  35.523972034454346
after graph partition
graph partition algorithm spend time 35.68859338760376
45531
45410
partition_len_list
[69331, 107353]
shared_neighbor_graph_partition_s0 selection method  spend 35.790098428726196
time for parepare:  0.020613670349121094
local_output_nid generation:  0.00487208366394043
local_in_edges_tensor generation:  0.0078046321868896484
mini_batch_src_global generation:  0.01674485206604004
r_  generation:  0.1531219482421875
local_output_nid generation:  0.0060901641845703125
local_in_edges_tensor generation:  0.012800216674804688
mini_batch_src_global generation:  0.025267601013183594
r_  generation:  0.2394862174987793
----------------------check_connections_block total spend ----------------------------- 0.5709977149963379
generate_one_block  0.2048180103302002
generate_one_block  0.32176709175109863
global_2_local spend time (sec) 0.025890350341796875
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.005091667175292969
A = g.adjacency_matrix() spent  0.006685972213745117
auxiliary_graph
Graph(num_nodes=107353, num_edges=36824706,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.0683135986328125
remove nodes length
61943
auxiliary_graph.remove_nodes spent  1.9680392742156982
after remove non output nodes the auxiliary_graph
Graph(num_nodes=45410, num_edges=36824706,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.842029094696045

the counter of shared neighbor distribution
Counter({1.0: 27132386, 2.0: 6334940, 3.0: 1971488, 4.0: 703158, 5.0: 290450, 6.0: 134980, 7.0: 71834, 8.0: 42064, 9.0: 26076, 10.0: 17292, 11.0: 11678, 12.0: 8682, 13.0: 6502, 14.0: 4948, 15.0: 3924, 16.0: 3260, 17.0: 2388, 18.0: 2026, 19.0: 1550, 20.0: 1384, 21.0: 1234, 22.0: 1068, 23.0: 804, 24.0: 688, 25.0: 590, 26.0: 514, 27.0: 482, 29.0: 402, 28.0: 354, 30.0: 318, 31.0: 256, 33.0: 218, 32.0: 212, 34.0: 170, 37.0: 134, 35.0: 118, 38.0: 102, 40.0: 96, 36.0: 94, 39.0: 68, 44.0: 62, 41.0: 56, 42.0: 50, 43.0: 36, 45.0: 30, 46.0: 24, 48.0: 14, 50.0: 14, 49.0: 10, 51.0: 10, 47.0: 10, 53.0: 8, 52.0: 6, 54.0: 6, 57.0: 6, 56.0: 6, 59.0: 6, 55.0: 4, 67.0: 2, 58.0: 2, 60.0: 2})
36779296
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 36779293, 36779294, 36779295])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 27132386, 2.0: 6334940, 3.0: 1971488, 4.0: 703158, 5.0: 290450, 6.0: 134980, 7.0: 71834, 8.0: 42064, 9.0: 26076, 10.0: 17292, 11.0: 11678, 12.0: 8682, 13.0: 6502, 14.0: 4948, 15.0: 3924, 16.0: 3260, 17.0: 2388, 18.0: 2026, 19.0: 1550, 20.0: 1384, 21.0: 1234, 22.0: 1068, 23.0: 804, 24.0: 688, 25.0: 590, 26.0: 514, 27.0: 482, 29.0: 402, 28.0: 354, 30.0: 318, 31.0: 256, 33.0: 218, 32.0: 212, 34.0: 170, 37.0: 134, 35.0: 118, 38.0: 102, 40.0: 96, 36.0: 94, 39.0: 68, 44.0: 62, 41.0: 56, 42.0: 50, 43.0: 36, 45.0: 30, 46.0: 24, 48.0: 14, 50.0: 14, 49.0: 10, 51.0: 10, 47.0: 10, 53.0: 8, 52.0: 6, 54.0: 6, 57.0: 6, 56.0: 6, 59.0: 6, 55.0: 4, 67.0: 2, 58.0: 2, 60.0: 2})
Convert a graph into a bidirected graph: 2.162 seconds
Metis partitioning: 6.258 seconds
Split the graph: 5.979 seconds
Construct subgraphs: 0.039 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  14.456065893173218
22520
22890
total k batches seeds list generation spend  29.966629028320312
after graph partition
graph partition algorithm spend time 30.056260585784912
22520
22890
time for parepare:  0.019296884536743164
local_output_nid generation:  0.0023713111877441406
local_in_edges_tensor generation:  0.011749029159545898
mini_batch_src_global generation:  0.007773399353027344
r_  generation:  0.0756978988647461
local_output_nid generation:  0.004569292068481445
local_in_edges_tensor generation:  0.00968480110168457
mini_batch_src_global generation:  0.01735854148864746
r_  generation:  0.16298270225524902
----------------------check_connections_block total spend ----------------------------- 0.37070393562316895
generate_one_block  0.1071469783782959
generate_one_block  0.22211813926696777
----------===============-------------===============-------------the number of batches ***** 3

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
pseudo mini batch 0 input nodes size: 69331
----------------------------------------before load block subtensor 
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 0.8212890625 GB
    Memory Allocated: 0.000530242919921875  GigaBytes
Max Memory Allocated: 0.000530242919921875  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.033733367919921875  GigaBytes
Max Memory Allocated: 0.033733367919921875  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.0340728759765625  GigaBytes
Max Memory Allocated: 0.0340728759765625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 0.8544921875 GB
    Memory Allocated: 0.0340728759765625  GigaBytes
Max Memory Allocated: 0.0340728759765625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 0.9228515625 GB
    Memory Allocated: 0.03689861297607422  GigaBytes
Max Memory Allocated: 0.03689861297607422  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 0.9228515625 GB
    Memory Allocated: 0.03689861297607422  GigaBytes
Max Memory Allocated: 0.03689861297607422  GigaBytes

input nodes number: 69331
output nodes number: 45531
edges number: 379224
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 2.883580207824707  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 2.8835811614990234  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.04806661605834961  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

pseudo mini batch 1 input nodes size: 58226
----------------------------------------before load block subtensor 
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.04138898849487305  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.04138898849487305  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.0744485855102539  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.07478809356689453  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.041245460510253906  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.044071197509765625  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.0654296875 GB
    Memory Allocated: 0.044071197509765625  GigaBytes
Max Memory Allocated: 3.0965914726257324  GigaBytes

input nodes number: 69331
output nodes number: 45531
edges number: 379224
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 2.8838095664978027  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 2.883810043334961  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.04792308807373047  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

pseudo mini batch 2 input nodes size: 76018
----------------------------------------before load block subtensor 
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.041245460510253906  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.041245460510253906  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.09243535995483398  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.0927739143371582  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.05937480926513672  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.06892633438110352  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 4.2470703125 GB
    Memory Allocated: 0.06892633438110352  GigaBytes
Max Memory Allocated: 3.103527069091797  GigaBytes

input nodes number: 107353
output nodes number: 45410
edges number: 629583
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 4.6901397705078125  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 4.690140247344971  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.07004690170288086  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.07110738754272461  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.07110738754272461  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.03520329793294271 |0.14072370529174805 |1.0013364950815837 |0.00021282831827799478 |0.9510010083516439 |0.004909515380859375 |
----------------------------------------------------------pseudo_mini_loss sum 5.740590572357178
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  246015
Number of first layer input nodes during this epoch:  203575[04:03:05] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 42014260 edges into 3 parts and get 655540 edge cuts
[04:03:36] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 30161 nodes and 34609436 edges into 2 parts and get 4101452 edge cuts

Number of first layer output nodes during this epoch:  136472
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.0711069107055664  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05325913429260254
global_2_local spend time (sec) 0.04794931411743164
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.005630016326904297
A = g.adjacency_matrix() spent  0.010472297668457031
auxiliary_graph
Graph(num_nodes=160262, num_edges=42105201,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.09736824035644531
remove nodes length
69321
auxiliary_graph.remove_nodes spent  2.2758429050445557
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=42105201,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.9520695209503174

the counter of shared neighbor distribution
Counter({1.0: 30959486, 2.0: 7106610, 3.0: 2258498, 4.0: 836916, 5.0: 363892, 6.0: 179954, 7.0: 99716, 8.0: 60074, 9.0: 38370, 10.0: 26266, 11.0: 18318, 12.0: 13256, 13.0: 9846, 14.0: 7862, 15.0: 6328, 16.0: 4928, 17.0: 3896, 18.0: 3112, 19.0: 2484, 20.0: 2204, 21.0: 1792, 22.0: 1560, 23.0: 1248, 24.0: 1086, 25.0: 936, 26.0: 724, 27.0: 622, 29.0: 540, 28.0: 522, 30.0: 450, 31.0: 378, 32.0: 348, 33.0: 306, 34.0: 280, 35.0: 196, 36.0: 166, 38.0: 156, 37.0: 146, 40.0: 110, 39.0: 98, 42.0: 80, 43.0: 66, 44.0: 66, 41.0: 64, 45.0: 54, 46.0: 42, 47.0: 34, 49.0: 26, 51.0: 22, 48.0: 20, 50.0: 20, 53.0: 14, 52.0: 12, 55.0: 12, 59.0: 8, 56.0: 6, 54.0: 6, 58.0: 4, 64.0: 4, 69.0: 4, 68.0: 2, 67.0: 2, 62.0: 2, 60.0: 2, 76.0: 2, 70.0: 2, 57.0: 2, 91.0: 2})
42014260
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 42014257, 42014258, 42014259])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 30959486, 2.0: 7106610, 3.0: 2258498, 4.0: 836916, 5.0: 363892, 6.0: 179954, 7.0: 99716, 8.0: 60074, 9.0: 38370, 10.0: 26266, 11.0: 18318, 12.0: 13256, 13.0: 9846, 14.0: 7862, 15.0: 6328, 16.0: 4928, 17.0: 3896, 18.0: 3112, 19.0: 2484, 20.0: 2204, 21.0: 1792, 22.0: 1560, 23.0: 1248, 24.0: 1086, 25.0: 936, 26.0: 724, 27.0: 622, 29.0: 540, 28.0: 522, 30.0: 450, 31.0: 378, 32.0: 348, 33.0: 306, 34.0: 280, 35.0: 196, 36.0: 166, 38.0: 156, 37.0: 146, 40.0: 110, 39.0: 98, 42.0: 80, 43.0: 66, 44.0: 66, 41.0: 64, 45.0: 54, 46.0: 42, 47.0: 34, 49.0: 26, 51.0: 22, 48.0: 20, 50.0: 20, 53.0: 14, 52.0: 12, 55.0: 12, 59.0: 8, 56.0: 6, 54.0: 6, 58.0: 4, 64.0: 4, 69.0: 4, 68.0: 2, 67.0: 2, 62.0: 2, 60.0: 2, 76.0: 2, 70.0: 2, 57.0: 2, 91.0: 2})
Convert a graph into a bidirected graph: 2.759 seconds
Metis partitioning: 7.646 seconds
Split the graph: 7.509 seconds
Construct subgraphs: 0.069 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  18.00744915008545
30735
30161
30045
total k batches seeds list generation spend  35.91029739379883
after graph partition
graph partition algorithm spend time 36.07183027267456
30735
30161
30045
partition_len_list
[48551, 86262, 56622]
shared_neighbor_graph_partition_s0 selection method  spend 36.18172240257263
time for parepare:  0.020249128341674805
local_output_nid generation:  0.0034737586975097656
local_in_edges_tensor generation:  0.005953788757324219
mini_batch_src_global generation:  0.009535789489746094
r_  generation:  0.1146399974822998
local_output_nid generation:  0.005079507827758789
local_in_edges_tensor generation:  0.011358499526977539
mini_batch_src_global generation:  0.019560575485229492
r_  generation:  0.22134923934936523
local_output_nid generation:  0.005552053451538086
local_in_edges_tensor generation:  0.005476474761962891
mini_batch_src_global generation:  0.012296915054321289
r_  generation:  0.10727882385253906
----------------------check_connections_block total spend ----------------------------- 0.6281280517578125
generate_one_block  0.16214609146118164
generate_one_block  0.28673291206359863
generate_one_block  0.1370549201965332
global_2_local spend time (sec) 0.022195100784301758
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0031464099884033203
A = g.adjacency_matrix() spent  0.00751185417175293
auxiliary_graph
Graph(num_nodes=86262, num_edges=34639597,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.0542902946472168
remove nodes length
56101
auxiliary_graph.remove_nodes spent  2.013007164001465
after remove non output nodes the auxiliary_graph
Graph(num_nodes=30161, num_edges=34639597,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.5535697937011719

the counter of shared neighbor distribution
Counter({1.0: 25418922, 2.0: 6045396, 3.0: 1886650, 4.0: 667320, 5.0: 273482, 6.0: 125960, 7.0: 66506, 8.0: 38068, 9.0: 23442, 10.0: 15384, 11.0: 10632, 12.0: 7486, 13.0: 5606, 14.0: 4424, 15.0: 3512, 16.0: 2780, 17.0: 2154, 18.0: 1736, 19.0: 1364, 20.0: 1220, 21.0: 1092, 22.0: 848, 23.0: 736, 24.0: 662, 25.0: 556, 26.0: 446, 27.0: 386, 29.0: 346, 28.0: 328, 30.0: 300, 31.0: 218, 32.0: 206, 34.0: 198, 33.0: 188, 35.0: 118, 36.0: 114, 38.0: 88, 37.0: 86, 40.0: 84, 39.0: 68, 42.0: 54, 41.0: 38, 44.0: 38, 43.0: 36, 45.0: 32, 49.0: 20, 46.0: 20, 47.0: 18, 53.0: 12, 48.0: 12, 50.0: 10, 52.0: 8, 56.0: 4, 59.0: 4, 51.0: 4, 55.0: 4, 67.0: 2, 62.0: 2, 60.0: 2, 54.0: 2, 57.0: 2})
34609436
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 34609433, 34609434, 34609435])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 25418922, 2.0: 6045396, 3.0: 1886650, 4.0: 667320, 5.0: 273482, 6.0: 125960, 7.0: 66506, 8.0: 38068, 9.0: 23442, 10.0: 15384, 11.0: 10632, 12.0: 7486, 13.0: 5606, 14.0: 4424, 15.0: 3512, 16.0: 2780, 17.0: 2154, 18.0: 1736, 19.0: 1364, 20.0: 1220, 21.0: 1092, 22.0: 848, 23.0: 736, 24.0: 662, 25.0: 556, 26.0: 446, 27.0: 386, 29.0: 346, 28.0: 328, 30.0: 300, 31.0: 218, 32.0: 206, 34.0: 198, 33.0: 188, 35.0: 118, 36.0: 114, 38.0: 88, 37.0: 86, 40.0: 84, 39.0: 68, 42.0: 54, 41.0: 38, 44.0: 38, 43.0: 36, 45.0: 32, 49.0: 20, 46.0: 20, 47.0: 18, 53.0: 12, 48.0: 12, 50.0: 10, 52.0: 8, 56.0: 4, 59.0: 4, 51.0: 4, 55.0: 4, 67.0: 2, 62.0: 2, 60.0: 2, 54.0: 2, 57.0: 2})
Convert a graph into a bidirected graph: 1.840 seconds
Metis partitioning: 5.782 seconds
Split the graph: 3.991 seconds
Construct subgraphs: 0.054 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.684496402740479
15352
14809
total k batches seeds list generation spend  25.972885608673096
after graph partition
graph partition algorithm spend time 26.04759383201599
15352
14809
time for parepare:  0.020355701446533203
local_output_nid generation:  0.0019383430480957031
local_in_edges_tensor generation:  0.012907981872558594
mini_batch_src_global generation:  0.012604236602783203
r_  generation:  0.11786484718322754
local_output_nid generation:  0.0030295848846435547
local_in_edges_tensor generation:  0.005496978759765625
mini_batch_src_global generation:  0.009646892547607422
r_  generation:  0.07879853248596191
----------------------check_connections_block total spend ----------------------------- 0.3024153709411621
generate_one_block  0.18407797813415527
generate_one_block  0.1115107536315918
----------===============-------------===============-------------the number of batches ***** 4

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.0711069107055664  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
block dataloader generation time/epoch 64.25519466400146
pseudo mini batch 0 input nodes size: 48551
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.060416221618652344  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.060416221618652344  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.08385372161865234  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.08408308029174805  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03255462646484375  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03455638885498047  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03455638885498047  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 48551
output nodes number: 30735
edges number: 268628
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 2.0354251861572266  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 2.035426139831543  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03537416458129883  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 1 input nodes size: 56622
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.030664443969726562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.030664443969726562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.057663917541503906  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.057888031005859375  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03422117233276367  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03594350814819336  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03594350814819336  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 56622
output nodes number: 30045
edges number: 231122
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.7673559188842773  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.7673563957214355  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03875303268432617  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 2 input nodes size: 59821
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03455018997192383  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03455018997192383  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05798768997192383  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05821704864501953  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03099346160888672  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03299522399902344  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03299522399902344  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 48551
output nodes number: 30735
edges number: 268628
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 2.041682243347168  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 2.041682720184326  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03537416458129883  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 3 input nodes size: 54651
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.030664443969726562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.030664443969726562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.07179737091064453  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.0720224380493164  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.0483555793762207  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.056055545806884766  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.056055545806884766  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes
[04:04:16] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 42067062 edges into 4 parts and get 3685401 edge cuts

input nodes number: 86262
output nodes number: 30161
edges number: 509057
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 3.776371479034424  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 3.776371955871582  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05719709396362305  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05719709396362305  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05719709396362305  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.01966959238052368 |0.006310164928436279 |0.6637336611747742 |0.0001659989356994629 |0.9454774856567383 |0.004420757293701172 |
----------------------------------------------------------pseudo_mini_loss sum 5.383254528045654
Total (block generation + training)time/epoch 70.84745478630066
Training time/epoch 6.591878652572632
Training time without block to device /epoch 6.566637992858887
Training time without total dataloading part /epoch 6.441929340362549
load block tensor time/epoch 0.07867836952209473
block to device time/epoch 0.025240659713745117
input features size transfer per epoch 5.364418029785156e-07
blocks size to device per epoch 3.5762786865234375e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  239986
Number of first layer input nodes during this epoch:  219645
Number of first layer output nodes during this epoch:  121676
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.057196617126464844  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

The real block id is  0
get_global_graph_edges_ids_block function  spend 0.028847455978393555
global_2_local spend time (sec) 0.051284074783325195
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.006186962127685547
A = g.adjacency_matrix() spent  0.013438940048217773
auxiliary_graph
Graph(num_nodes=160172, num_edges=42158003,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.12088346481323242
remove nodes length
69231
auxiliary_graph.remove_nodes spent  2.285187005996704
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=42158003,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.9935555458068848

the counter of shared neighbor distribution
Counter({1.0: 31004810, 2.0: 7111794, 3.0: 2262212, 4.0: 837528, 5.0: 363508, 6.0: 179410, 7.0: 99040, 8.0: 59936, 9.0: 38312, 10.0: 26292, 11.0: 18112, 12.0: 13334, 13.0: 9882, 14.0: 7776, 15.0: 6148, 16.0: 4860, 17.0: 3892, 18.0: 3150, 19.0: 2518, 20.0: 2194, 21.0: 1810, 22.0: 1656, 23.0: 1252, 24.0: 1050, 25.0: 892, 26.0: 742, 27.0: 668, 28.0: 592, 29.0: 508, 31.0: 432, 30.0: 430, 32.0: 338, 33.0: 296, 34.0: 260, 35.0: 196, 36.0: 176, 38.0: 168, 37.0: 134, 40.0: 104, 39.0: 90, 43.0: 74, 41.0: 70, 42.0: 62, 45.0: 62, 44.0: 54, 46.0: 34, 47.0: 26, 50.0: 24, 49.0: 22, 48.0: 20, 51.0: 20, 52.0: 16, 55.0: 14, 54.0: 10, 53.0: 10, 56.0: 8, 57.0: 6, 59.0: 4, 67.0: 4, 64.0: 4, 58.0: 4, 89.0: 2, 68.0: 2, 79.0: 2, 66.0: 2, 71.0: 2, 62.0: 2})
42067062
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 42067059, 42067060, 42067061])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 31004810, 2.0: 7111794, 3.0: 2262212, 4.0: 837528, 5.0: 363508, 6.0: 179410, 7.0: 99040, 8.0: 59936, 9.0: 38312, 10.0: 26292, 11.0: 18112, 12.0: 13334, 13.0: 9882, 14.0: 7776, 15.0: 6148, 16.0: 4860, 17.0: 3892, 18.0: 3150, 19.0: 2518, 20.0: 2194, 21.0: 1810, 22.0: 1656, 23.0: 1252, 24.0: 1050, 25.0: 892, 26.0: 742, 27.0: 668, 28.0: 592, 29.0: 508, 31.0: 432, 30.0: 430, 32.0: 338, 33.0: 296, 34.0: 260, 35.0: 196, 36.0: 176, 38.0: 168, 37.0: 134, 40.0: 104, 39.0: 90, 43.0: 74, 41.0: 70, 42.0: 62, 45.0: 62, 44.0: 54, 46.0: 34, 47.0: 26, 50.0: 24, 49.0: 22, 48.0: 20, 51.0: 20, 52.0: 16, 55.0: 14, 54.0: 10, 53.0: 10, 56.0: 8, 57.0: 6, 59.0: 4, 67.0: 4, 64.0: 4, 58.0: 4, 89.0: 2, 68.0: 2, 79.0: 2, 66.0: 2, 71.0: 2, 62.0: 2})
Convert a graph into a bidirected graph: 2.947 seconds
Metis partitioning: 8.078 seconds
Split the graph: 5.714 seconds
Construct subgraphs: 0.065 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  16.824705600738525
22635
23229
22436
22641
total k batches seeds list generation spend  34.56963348388672
after graph partition
graph partition algorithm spend time 34.73524713516235
22635
23229
22436
22641
partition_len_list
[38125, 41858, 61272, 76965]
shared_neighbor_graph_partition_s0 selection method  spend 34.84510087966919
time for parepare:  0.020384788513183594
local_output_nid generation:  0.002989053726196289
local_in_edges_tensor generation:  0.004461050033569336
mini_batch_src_global generation:  0.011464357376098633
r_  generation:  0.09318661689758301
local_output_nid generation:  0.004314422607421875
local_in_edges_tensor generation:  0.004565000534057617
mini_batch_src_global generation:  0.009122610092163086
r_  generation:  0.08454465866088867
local_output_nid generation:  0.00420689582824707
local_in_edges_tensor generation:  0.0038788318634033203
mini_batch_src_global generation:  0.007666587829589844
r_  generation:  0.07764744758605957
local_output_nid generation:  0.004253387451171875
local_in_edges_tensor generation:  0.013319015502929688
mini_batch_src_global generation:  0.01900506019592285
r_  generation:  0.17677569389343262
----------------------check_connections_block total spend ----------------------------- 0.6367032527923584
generate_one_block  0.13635849952697754
generate_one_block  0.10980439186096191
generate_one_block  0.12100505828857422
generate_one_block  0.2559173107147217
global_2_local spend time (sec) 0.022348403930664062
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0027892589569091797
A = g.adjacency_matrix() spent  0.004349470138549805
auxiliary_graph
Graph(num_nodes=76965, num_edges=27182547,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.09539961814880371
remove nodes length
54324
auxiliary_graph.remove_nodes spent  1.2327046394348145
after remove non output nodes the auxiliary_graph
Graph(num_nodes=22641, num_edges=27182547,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.210780382156372

the counter of shared neighbor distribution
Counter({1.0: 19577718, 2.0: 4944392, 3.0: 1580776, 4.0: 562582, 5.0: 229798, 6.0: 105094, 7.0: 54770, 8.0: 31444, 9.0: 19456, 10.0: 12928, 11.0: 8982, 12.0: 6316, 13.0: 4670, 14.0: 3718, 15.0: 2934, 16.0: 2298, 17.0: 1846, 18.0: 1510, 19.0: 1210, 20.0: 1006, 21.0: 940, 22.0: 794, 23.0: 654, 24.0: 548, 25.0: 458, 26.0: 396, 27.0: 368, 28.0: 334, 29.0: 286, 30.0: 248, 31.0: 222, 32.0: 176, 33.0: 164, 34.0: 144, 36.0: 102, 35.0: 92, 37.0: 76, 38.0: 74, 40.0: 68, 39.0: 44, 42.0: 42, 41.0: 40, 43.0: 38, 45.0: 30, 46.0: 20, 44.0: 18, 49.0: 14, 50.0: 12, 47.0: 10, 52.0: 8, 54.0: 6, 57.0: 6, 56.0: 6, 53.0: 6, 51.0: 4, 48.0: 4, 55.0: 4, 62.0: 2})
27159906
--------------------------------------- new test ---------------------[04:04:41] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 22641 nodes and 27159906 edges into 2 parts and get 3833481 edge cuts

--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 27159903, 27159904, 27159905])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 19577718, 2.0: 4944392, 3.0: 1580776, 4.0: 562582, 5.0: 229798, 6.0: 105094, 7.0: 54770, 8.0: 31444, 9.0: 19456, 10.0: 12928, 11.0: 8982, 12.0: 6316, 13.0: 4670, 14.0: 3718, 15.0: 2934, 16.0: 2298, 17.0: 1846, 18.0: 1510, 19.0: 1210, 20.0: 1006, 21.0: 940, 22.0: 794, 23.0: 654, 24.0: 548, 25.0: 458, 26.0: 396, 27.0: 368, 28.0: 334, 29.0: 286, 30.0: 248, 31.0: 222, 32.0: 176, 33.0: 164, 34.0: 144, 36.0: 102, 35.0: 92, 37.0: 76, 38.0: 74, 40.0: 68, 39.0: 44, 42.0: 42, 41.0: 40, 43.0: 38, 45.0: 30, 46.0: 20, 44.0: 18, 49.0: 14, 50.0: 12, 47.0: 10, 52.0: 8, 54.0: 6, 57.0: 6, 56.0: 6, 53.0: 6, 51.0: 4, 48.0: 4, 55.0: 4, 62.0: 2})
Convert a graph into a bidirected graph: 1.401 seconds
Metis partitioning: 4.679 seconds
Split the graph: 2.870 seconds
Construct subgraphs: 0.058 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  9.02119493484497
11171
11470
total k batches seeds list generation spend  20.286179780960083
after graph partition
graph partition algorithm spend time 20.374794960021973
11171
11470
time for parepare:  0.021294116973876953
local_output_nid generation:  0.002294778823852539
local_in_edges_tensor generation:  0.0066945552825927734
mini_batch_src_global generation:  0.01616191864013672
r_  generation:  0.09903907775878906
local_output_nid generation:  0.002923727035522461
local_in_edges_tensor generation:  0.0062713623046875
mini_batch_src_global generation:  0.011993885040283203
r_  generation:  0.09413313865661621
----------------------check_connections_block total spend ----------------------------- 0.31622982025146484
generate_one_block  0.1277921199798584
generate_one_block  0.13080668449401855
----------===============-------------===============-------------the number of batches ***** 5

-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.057196617126464844  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

connection checking time:  0
block generation total time  0
average batch blocks generation time:  0.0
block dataloader generation time/epoch 60.764443159103394
pseudo mini batch 0 input nodes size: 38125
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.04862833023071289  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.04862833023071289  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.06680774688720703  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.06697654724121094  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025618553161621094  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027276992797851562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027276992797851562  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 38125
output nodes number: 22635
edges number: 222523
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.6745672225952148  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.6745681762695312  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02769756317138672  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 1 input nodes size: 41858
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02384328842163086  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02384328842163086  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.043802738189697266  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.043975830078125  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025627613067626953  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027004718780517578  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027004718780517578  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 41858
output nodes number: 23229
edges number: 184781
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.4114770889282227  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.4114775657653809  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.029042720794677734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 2 input nodes size: 61272
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025716304779052734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025716304779052734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05493307113647461  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.055100440979003906  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.034967899322509766  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03624582290649414  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03624582290649414  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes
Using backend: pytorch

input nodes number: 61272
output nodes number: 22436
edges number: 171483
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.3195137977600098  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.319514274597168  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03811359405517578  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 3 input nodes size: 57729
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03484964370727539  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.03484964370727539  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05302906036376953  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.05319786071777344  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.023813724517822266  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025472164154052734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025472164154052734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 38125
output nodes number: 22635
edges number: 222523
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.6760039329528809  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.676004409790039  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02769756317138672  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

pseudo mini batch 4 input nodes size: 50165
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02384328842163086  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.02384328842163086  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.043802738189697266  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.043975830078125  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.025627613067626953  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027004718780517578  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.027004718780517578  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

input nodes number: 41858
output nodes number: 23229
edges number: 184781
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.4114770889282227  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 1.4114775657653809  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.029042720794677734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.029042720794677734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.0849609375 GB
    Memory Allocated: 0.029042720794677734  GigaBytes
Max Memory Allocated: 5.029702186584473  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.015867996215820312 |0.0025532722473144533 |0.5030241489410401 |0.00013723373413085938 |0.9180607318878173 |0.004563570022583008 |
----------------------------------------------------------pseudo_mini_loss sum 5.391294002532959
Total (block generation + training)time/epoch 67.68837428092957
Training time/epoch 7.255275011062622
Training time without block to device /epoch 7.24250864982605
Training time without total dataloading part /epoch 7.110674142837524
load block tensor time/epoch 0.07933998107910156
block to device time/epoch 0.012766361236572266
input features size transfer per epoch 6.705522537231445e-07
blocks size to device per epoch 4.470348358154297e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  221238
Number of first layer input nodes during this epoch:  249149
Number of first layer output nodes during this epoch:  114164
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(128, 128, batch_first=True)
      (fc_self): Linear(in_features=128, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=40, bias=False)
    )
  )
  (bns): ModuleList()
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  142336
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([512, 128])
layers.0.lstm.weight_hh_l0, torch.Size([512, 128])
layers.0.lstm.bias_ih_l0, torch.Size([512])
layers.0.lstm.bias_hh_l0, torch.Size([512])
layers.0.fc_self.weight, torch.Size([40, 128])
layers.0.fc_neigh.weight, torch.Size([40, 128])
----------------------------------------
un-trainable parameters
