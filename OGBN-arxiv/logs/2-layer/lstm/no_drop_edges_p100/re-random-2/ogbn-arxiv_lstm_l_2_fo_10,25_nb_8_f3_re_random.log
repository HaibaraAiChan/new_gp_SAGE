[23:34:50] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 28961398 edges into 8 parts and get 4598647 edge cuts
main start at this time 1652225663.9391434
-----------------------------------------before load data 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.020806550979614258
global_2_local spend time (sec) 0.04380965232849121
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0047245025634765625
A = g.adjacency_matrix() spent  0.006360769271850586
auxiliary_graph
Graph(num_nodes=154710, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.1644423007965088
remove nodes length
63769
auxiliary_graph.remove_nodes spent  1.407907247543335
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.3028607368469238

the counter of shared neighbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
28961398
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 28961395, 28961396, 28961397])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
Convert a graph into a bidirected graph: 2.005 seconds
Metis partitioning: 6.051 seconds
Split the graph: 2.685 seconds
Construct subgraphs: 0.088 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  10.84470796585083
11436
11456
11522
11580
11035
11283
11508
11121
total k batches seeds list generation spend  25.480348587036133
after graph partition
graph partition algorithm spend time 25.589358806610107
11436
11456
11522
11580
11035
11283
11508
11121
partition_len_list
[19376, 21264, 21136, 20917, 48032, 41430, 27887, 33663]
shared_neighbor_graph_partition_s0 selection method  spend 25.68927764892578
time for parepare:  0.019346237182617188
local_output_nid generation:  0.0017914772033691406
local_in_edges_tensor generation:  0.0024445056915283203
mini_batch_src_global generation:  0.0037665367126464844
r_  generation:  0.03767538070678711
local_output_nid generation:  0.002303600311279297
local_in_edges_tensor generation:  0.0027663707733154297
mini_batch_src_global generation:  0.004090785980224609
r_  generation:  0.03734183311462402
local_output_nid generation:  0.0024509429931640625
local_in_edges_tensor generation:  0.002256631851196289
mini_batch_src_global generation:  0.0031042098999023438
r_  generation:  0.03196072578430176
local_output_nid generation:  0.0025479793548583984
local_in_edges_tensor generation:  0.0027272701263427734
mini_batch_src_global generation:  0.003482818603515625
r_  generation:  0.03459453582763672
local_output_nid generation:  0.002559661865234375
local_in_edges_tensor generation:  0.003416299819946289
mini_batch_src_global generation:  0.006196260452270508
r_  generation:  0.04944491386413574
local_output_nid generation:  0.0029151439666748047
local_in_edges_tensor generation:  0.004334211349487305
mini_batch_src_global generation:  0.006951093673706055
r_  generation:  0.05662941932678223
local_output_nid generation:  0.002791881561279297
local_in_edges_tensor generation:  0.0021903514862060547
mini_batch_src_global generation:  0.003665924072265625
r_  generation:  0.03844761848449707
local_output_nid generation:  0.0024993419647216797
local_in_edges_tensor generation:  0.002040386199951172
mini_batch_src_global generation:  0.003143310546875
r_  generation:  0.03320121765136719
----------------------check_connections_block total spend ----------------------------- 0.48344874382019043
generate_one_block  0.057410240173339844
generate_one_block  0.049452781677246094
generate_one_block  0.03830361366271973
generate_one_block  0.04235339164733887
generate_one_block  0.06711339950561523
generate_one_block  0.07587337493896484
generate_one_block  0.045482635498046875
generate_one_block  0.04634499549865723
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04584646224975586
gen group dst list time:  0.007253408432006836
time for parepare:  0.026082992553710938
local_output_nid generation:  0.002819538116455078
local_in_edges_tensor generation:  0.022288799285888672
mini_batch_src_global generation:  0.008550167083740234
r_  generation:  0.08620691299438477
local_output_nid generation:  0.006327629089355469
local_in_edges_tensor generation:  0.0057909488677978516
mini_batch_src_global generation:  0.00727391242980957
r_  generation:  0.05892157554626465
local_output_nid generation:  0.005576133728027344
local_in_edges_tensor generation:  0.0047435760498046875
mini_batch_src_global generation:  0.004547595977783203
r_  generation:  0.0531458854675293
local_output_nid generation:  0.005377292633056641
local_in_edges_tensor generation:  0.0041577816009521484
mini_batch_src_global generation:  0.004845380783081055
r_  generation:  0.05400490760803223
local_output_nid generation:  0.009330272674560547
local_in_edges_tensor generation:  0.012948989868164062
mini_batch_src_global generation:  0.01426243782043457
r_  generation:  0.16177797317504883
local_output_nid generation:  0.008219242095947266
local_in_edges_tensor generation:  0.011364459991455078
mini_batch_src_global generation:  0.014427661895751953
r_  generation:  0.1438586711883545
local_output_nid generation:  0.0061571598052978516
local_in_edges_tensor generation:  0.006087541580200195
mini_batch_src_global generation:  0.008754968643188477
r_  generation:  0.08321714401245117
local_output_nid generation:  0.007178306579589844
local_in_edges_tensor generation:  0.007870674133300781
mini_batch_src_global generation:  0.009702920913696289
r_  generation:  0.10133743286132812
----------------------check_connections_block total spend ----------------------------- 1.1132287979125977
generate_one_block  0.06700444221496582
generate_one_block  0.08986258506774902
generate_one_block  0.07022595405578613
generate_one_block  0.06698036193847656
generate_one_block  0.21498656272888184
generate_one_block  0.1986064910888672
generate_one_block  0.11075806617736816
generate_one_block  0.1334521770477295
global_2_local spend time (sec) 0.01074671745300293
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0061016082763671875
A = g.adjacency_matrix() spent  0.0014872550964355469
auxiliary_graph
Graph(num_nodes=48032, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.04397845268249512[23:34:58] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 3872734 edges into 2 parts and get 453065 edge cuts
[23:35:00] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11121 nodes and 1401720 edges into 2 parts and get 16579 edge cuts

remove nodes length
36997
auxiliary_graph.remove_nodes spent  0.15291500091552734
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.170166015625

the counter of shared neighbor distribution
Counter({1.0: 3357116, 2.0: 408566, 3.0: 77052, 4.0: 19494, 5.0: 6250, 6.0: 2292, 7.0: 934, 8.0: 530, 9.0: 198, 10.0: 124, 11.0: 70, 12.0: 40, 13.0: 28, 14.0: 20, 15.0: 8, 17.0: 6, 20.0: 2, 18.0: 2, 16.0: 2})
3872734
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.161 seconds
Metis partitioning: 0.464 seconds
Split the graph: 0.317 seconds
Construct subgraphs: 0.040 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.9873261451721191
5488
5547
total k batches seeds list generation spend  2.1323306560516357
after graph partition
graph partition algorithm spend time 2.163515090942383
5488
5547
time for parepare:  0.034711360931396484
local_output_nid generation:  0.002656698226928711
local_in_edges_tensor generation:  0.004802227020263672
mini_batch_src_global generation:  0.0022890567779541016
r_  generation:  0.024763107299804688
local_output_nid generation:  0.0016214847564697266
local_in_edges_tensor generation:  0.0019598007202148438
mini_batch_src_global generation:  0.00702357292175293
r_  generation:  0.027383804321289062
----------------------check_connections_block total spend ----------------------------- 0.12465453147888184
generate_one_block  0.04365730285644531
generate_one_block  0.041379451751708984
time for parepare:  0.024146556854248047
local_output_nid generation:  0.004471302032470703
local_in_edges_tensor generation:  0.014741182327270508
mini_batch_src_global generation:  0.007477760314941406
r_  generation:  0.1008450984954834
local_output_nid generation:  0.007905960083007812
local_in_edges_tensor generation:  0.010672807693481445
mini_batch_src_global generation:  0.012512445449829102
r_  generation:  0.1188497543334961
----------------------check_connections_block total spend ----------------------------- 0.35523223876953125
generate_one_block  0.11863398551940918
generate_one_block  0.20562076568603516
global_2_local spend time (sec) 0.008430004119873047
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.001325845718383789
A = g.adjacency_matrix() spent  0.0010616779327392578
auxiliary_graph
Graph(num_nodes=33663, num_edges=1412841,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.022624731063842773
remove nodes length
22542
auxiliary_graph.remove_nodes spent  0.056006431579589844
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11121, num_edges=1412841,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.043020009994506836

the counter of shared neighbor distribution
Counter({1.0: 1205076, 2.0: 154896, 3.0: 28316, 4.0: 7460, 5.0: 2768, 6.0: 1212, 7.0: 678, 8.0: 430, 9.0: 276, 10.0: 152, 11.0: 116, 14.0: 80, 12.0: 78, 13.0: 56, 16.0: 46, 15.0: 36, 17.0: 26, 19.0: 8, 18.0: 8, 20.0: 2})
1401720
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.051 seconds
Metis partitioning: 0.131 seconds
Split the graph: 0.214 seconds
Construct subgraphs: 0.040 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.4383213520050049
5561
5560
total k batches seeds list generation spend  0.8513615131378174
after graph partition
graph partition algorithm spend time 0.867933988571167
5561
5560
time for parepare:  0.02138543128967285
local_output_nid generation:  0.0008182525634765625
local_in_edges_tensor generation:  0.0012040138244628906
mini_batch_src_global generation:  0.001552581787109375
r_  generation:  0.012581110000610352
local_output_nid generation:  0.0009443759918212891
local_in_edges_tensor generation:  0.0012118816375732422
mini_batch_src_global generation:  0.0019876956939697266
r_  generation:  0.01754593849182129
----------------------check_connections_block total spend ----------------------------- 0.0702667236328125
generate_one_block  0.017696619033813477
generate_one_block  0.02679443359375
time for parepare:  0.021149635314941406
local_output_nid generation:  0.001842498779296875
local_in_edges_tensor generation:  0.0027899742126464844
mini_batch_src_global generation:  0.002860546112060547
r_  generation:  0.03146028518676758
local_output_nid generation:  0.0045855045318603516
local_in_edges_tensor generation:  0.005772113800048828
mini_batch_src_global generation:  0.006837368011474609
r_  generation:  0.07273721694946289
----------------------check_connections_block total spend ----------------------------- 0.1777510643005371
generate_one_block  0.0408780574798584
generate_one_block  0.09612035751342773
----------===============-------------===============-------------the number of batches *****---- 10

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

connection checking time:  1.1132287979125977
block generation total time  0.9518766403198242
average batch blocks generation time:  0.11898458003997803
pseudo mini batch 0 input nodes size: 33053
----------------------------------------before load block subtensor 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018538475036621094  GigaBytes
Max Memory Allocated: 0.018538475036621094  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

first layer input nodes number: 33053
first layer output nodes number: 19376
edges number: 122818
input nodes number: 19376
output nodes number: 11436
edges number: 93717
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.420609951019287  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.4206109046936035  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.02784109115600586  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

pseudo mini batch 1 input nodes size: 33722
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.0391840934753418  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.039269447326660156  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023423194885253906  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

first layer input nodes number: 33722
first layer output nodes number: 21264
edges number: 130063
input nodes number: 21264
output nodes number: 11456
edges number: 91731
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621076583862305  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621081352233887  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028455734252929688  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 2 input nodes size: 38652
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.042038917541503906  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04212522506713867  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02595996856689453  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 38652
first layer output nodes number: 21136
edges number: 116620
input nodes number: 21136
output nodes number: 11522
edges number: 70352
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436105728149414  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436110496520996  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.030178070068359375  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 3 input nodes size: 34793
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04256391525268555  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04265022277832031  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02413320541381836  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 34793
first layer output nodes number: 20917
edges number: 119121
input nodes number: 20917
output nodes number: 11580
edges number: 77943
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798105239868164  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798110008239746  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028331756591796875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 4 input nodes size: 67485
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.05613565444946289  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.056220054626464844  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.03954315185546875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 67485
first layer output nodes number: 41430
edges number: 337279
input nodes number: 41430
output nodes number: 11283
edges number: 136210
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997467041016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997943878174  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05006885528564453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 56582
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06682205200195312  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06690788269042969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034644126892089844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56582
first layer output nodes number: 27887
edges number: 176606
input nodes number: 27887
output nodes number: 11508
edges number: 82704
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.711897850036621  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.7118983268737793  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040024757385253906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 57944
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0619969367980957  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06203794479370117  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03497171401977539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03687143325805664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03687143325805664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 57944
first layer output nodes number: 25513
edges number: 201903
input nodes number: 25513
output nodes number: 5488
edges number: 52975
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.4094929695129395  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.4094934463500977  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039301395416259766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 7 input nodes size: 67627
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0340423583984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0340423583984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0672454833984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06728696823120117  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03961610794067383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04208040237426758  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04208040237426758  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67627
first layer output nodes number: 31902
edges number: 267044
input nodes number: 31902
output nodes number: 5547
edges number: 63602
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0750865936279297  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.075087070465088  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04688310623168945  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 8 input nodes size: 28763
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03962516784667969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03962516784667969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05334043502807617  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.053381919860839844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes
[23:35:27] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29070896 edges into 8 parts and get 4573862 edge cuts

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.020137310028076172  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.020897388458251953  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.020897388458251953  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 28763
first layer output nodes number: 12981
edges number: 71730
input nodes number: 12981
output nodes number: 5561
edges number: 30157
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.080160140991211  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.0801606178283691  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.022452354431152344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 9 input nodes size: 56000
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.020139217376708984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.020139217376708984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046842098236083984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046883583068847656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0331268310546875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03477764129638672  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03477764129638672  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56000
first layer output nodes number: 23083
edges number: 176533
input nodes number: 23083
output nodes number: 5560
edges number: 44859
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.0976085662841797  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.097609043121338  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03775978088378906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04331016540527344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04331016540527344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.026161956787109374 |0.04452626705169678 |0.17796902656555175 |0.0001590728759765625 |0.13140947818756105 |0.007849931716918945 |
----------------------------------------------------------pseudo_mini_loss sum 5.291038990020752
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  720110
Number of first layer input nodes during this epoch:  474621
Number of first layer output nodes during this epoch:  245489
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043309688568115234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.023912668228149414
global_2_local spend time (sec) 0.054032325744628906
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0044097900390625
A = g.adjacency_matrix() spent  0.00622868537902832
auxiliary_graph
Graph(num_nodes=154609, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.10098147392272949
remove nodes length
63668
auxiliary_graph.remove_nodes spent  1.4497206211090088
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.4012739658355713

the counter of shared neighbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
29070896
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29070893, 29070894, 29070895])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
Convert a graph into a bidirected graph: 2.032 seconds
Metis partitioning: 6.621 seconds
Split the graph: 2.958 seconds
Construct subgraphs: 0.131 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.757051706314087
11035
11613
11394
11224
11375
11384
11366
11550
total k batches seeds list generation spend  25.367737293243408
after graph partition
graph partition algorithm spend time 25.4815616607666
11035
11613
11394
11224
11375
11384
11366
11550
partition_len_list
[44620, 42251, 27756, 34673, 19871, 20606, 22066, 19324]
shared_neighbor_graph_partition_s0 selection method  spend 25.59455108642578
time for parepare:  0.019930124282836914
local_output_nid generation:  0.0017652511596679688
local_in_edges_tensor generation:  0.002243518829345703
mini_batch_src_global generation:  0.003923654556274414
r_  generation:  0.04124927520751953
local_output_nid generation:  0.002721548080444336
local_in_edges_tensor generation:  0.0030629634857177734
mini_batch_src_global generation:  0.006330251693725586
r_  generation:  0.05627274513244629
local_output_nid generation:  0.002998828887939453
local_in_edges_tensor generation:  0.0021524429321289062
mini_batch_src_global generation:  0.003406524658203125
r_  generation:  0.035279273986816406
local_output_nid generation:  0.002383708953857422
local_in_edges_tensor generation:  0.002084970474243164
mini_batch_src_global generation:  0.0034644603729248047
r_  generation:  0.03927779197692871
local_output_nid generation:  0.0023140907287597656
local_in_edges_tensor generation:  0.0025665760040283203[23:35:35] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 2745680 edges into 2 parts and get 86784 edge cuts
[23:35:41] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11613 nodes and 9939568 edges into 2 parts and get 1924418 edge cuts

mini_batch_src_global generation:  0.0032939910888671875
r_  generation:  0.03690671920776367
local_output_nid generation:  0.002362966537475586
local_in_edges_tensor generation:  0.002312898635864258
mini_batch_src_global generation:  0.003222942352294922
r_  generation:  0.038928985595703125
local_output_nid generation:  0.002335786819458008
local_in_edges_tensor generation:  0.0020515918731689453
mini_batch_src_global generation:  0.003040313720703125
r_  generation:  0.035253286361694336
local_output_nid generation:  0.0023162364959716797
local_in_edges_tensor generation:  0.0020477771759033203
mini_batch_src_global generation:  0.005373239517211914
r_  generation:  0.033864736557006836
----------------------check_connections_block total spend ----------------------------- 0.4730668067932129
generate_one_block  0.07074308395385742
generate_one_block  0.07951068878173828
generate_one_block  0.04583311080932617
generate_one_block  0.05230855941772461
generate_one_block  0.04660844802856445
generate_one_block  0.050186872482299805
generate_one_block  0.04408550262451172
generate_one_block  0.0385894775390625
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05147290229797363
gen group dst list time:  0.007543087005615234
time for parepare:  0.027861595153808594
local_output_nid generation:  0.009089469909667969
local_in_edges_tensor generation:  0.023973703384399414
mini_batch_src_global generation:  0.013189554214477539
r_  generation:  0.15870165824890137
local_output_nid generation:  0.009060382843017578
local_in_edges_tensor generation:  0.012883186340332031
mini_batch_src_global generation:  0.015597343444824219
r_  generation:  0.1445157527923584
local_output_nid generation:  0.006285905838012695
local_in_edges_tensor generation:  0.006552696228027344
mini_batch_src_global generation:  0.008562803268432617
r_  generation:  0.08406853675842285
local_output_nid generation:  0.009523868560791016
local_in_edges_tensor generation:  0.007589578628540039
mini_batch_src_global generation:  0.010495901107788086
r_  generation:  0.10609102249145508
local_output_nid generation:  0.004410982131958008
local_in_edges_tensor generation:  0.00407862663269043
mini_batch_src_global generation:  0.009116649627685547
r_  generation:  0.05652666091918945
local_output_nid generation:  0.006187915802001953
local_in_edges_tensor generation:  0.004286766052246094
mini_batch_src_global generation:  0.00562286376953125
r_  generation:  0.05668449401855469
local_output_nid generation:  0.00604557991027832
local_in_edges_tensor generation:  0.004533529281616211
mini_batch_src_global generation:  0.005579233169555664
r_  generation:  0.05935502052307129
local_output_nid generation:  0.004219770431518555
local_in_edges_tensor generation:  0.003610372543334961
mini_batch_src_global generation:  0.00449681282043457
r_  generation:  0.04678511619567871
----------------------check_connections_block total spend ----------------------------- 1.0722057819366455
generate_one_block  0.20220088958740234
generate_one_block  0.19123387336730957
generate_one_block  0.10008049011230469
generate_one_block  0.14229345321655273
generate_one_block  0.06786775588989258
generate_one_block  0.0700528621673584
generate_one_block  0.07526278495788574
generate_one_block  0.05835127830505371
global_2_local spend time (sec) 0.010265111923217773
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.001110076904296875
A = g.adjacency_matrix() spent  0.0012421607971191406
auxiliary_graph
Graph(num_nodes=44620, num_edges=2756715,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.05725407600402832
remove nodes length
33585
auxiliary_graph.remove_nodes spent  0.14202332496643066
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=2756715,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.13738179206848145

the counter of shared neighbor distribution
Counter({1.0: 2462828, 2.0: 225878, 3.0: 39730, 4.0: 10516, 5.0: 3548, 6.0: 1550, 7.0: 734, 8.0: 394, 9.0: 172, 10.0: 118, 11.0: 68, 12.0: 48, 14.0: 34, 13.0: 30, 17.0: 10, 16.0: 8, 15.0: 6, 20.0: 4, 19.0: 4})
2745680
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.126 seconds
Metis partitioning: 0.287 seconds
Split the graph: 0.351 seconds
Construct subgraphs: 0.024 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.7908294200897217
5518
5517
total k batches seeds list generation spend  1.942610740661621
after graph partition
graph partition algorithm spend time 1.9695954322814941
5518
5517
time for parepare:  0.027114152908325195
local_output_nid generation:  0.0009493827819824219
local_in_edges_tensor generation:  0.0045659542083740234
mini_batch_src_global generation:  0.0025184154510498047
r_  generation:  0.016505956649780273
local_output_nid generation:  0.0009584426879882812
local_in_edges_tensor generation:  0.0013282299041748047
mini_batch_src_global generation:  0.003435373306274414
r_  generation:  0.024696826934814453
----------------------check_connections_block total spend ----------------------------- 0.09662461280822754
generate_one_block  0.03127861022949219
generate_one_block  0.03777027130126953
time for parepare:  0.022434711456298828
local_output_nid generation:  0.002542734146118164
local_in_edges_tensor generation:  0.007722139358520508
mini_batch_src_global generation:  0.005558013916015625
r_  generation:  0.052083492279052734
local_output_nid generation:  0.006436824798583984
local_in_edges_tensor generation:  0.009176969528198242
mini_batch_src_global generation:  0.011348962783813477
r_  generation:  0.10662269592285156
----------------------check_connections_block total spend ----------------------------- 0.2651698589324951
generate_one_block  0.07006025314331055
generate_one_block  0.1429755687713623
global_2_local spend time (sec) 0.00929117202758789
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0016829967498779297
A = g.adjacency_matrix() spent  0.001836538314819336
auxiliary_graph
Graph(num_nodes=42251, num_edges=9951181,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.04221796989440918
remove nodes length
30638
auxiliary_graph.remove_nodes spent  0.46768712997436523
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11613, num_edges=9951181,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.4243943691253662

the counter of shared neighbor distribution
Counter({1.0: 7673560, 2.0: 1671190, 3.0: 425676, 4.0: 116054, 5.0: 34910, 6.0: 11650, 7.0: 4030, 8.0: 1488, 9.0: 592, 10.0: 202, 11.0: 122, 12.0: 54, 14.0: 16, 13.0: 14, 15.0: 4, 16.0: 2, 19.0: 2, 18.0: 2})
9939568
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.486 seconds
Metis partitioning: 1.298 seconds
Split the graph: 1.063 seconds
Construct subgraphs: 0.030 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  2.8824210166931152
5865
5748
total k batches seeds list generation spend  5.623769521713257
after graph partition
graph partition algorithm spend time 5.6769044399261475
5865
5748
time for parepare:  0.03868603706359863
local_output_nid generation:  0.0015912055969238281
local_in_edges_tensor generation:  0.005985736846923828
mini_batch_src_global generation:  0.0036983489990234375
r_  generation:  0.03807401657104492
local_output_nid generation:  0.0016527175903320312
local_in_edges_tensor generation:  0.0030879974365234375
mini_batch_src_global generation:  0.003217458724975586
r_  generation:  0.025724411010742188
----------------------check_connections_block total spend ----------------------------- 0.14240646362304688
generate_one_block  0.05535101890563965
generate_one_block  0.037488698959350586
time for parepare:  0.02238750457763672
local_output_nid generation:  0.004448413848876953
local_in_edges_tensor generation:  0.0159151554107666
mini_batch_src_global generation:  0.009814023971557617
r_  generation:  0.09997916221618652
local_output_nid generation:  0.006831169128417969
local_in_edges_tensor generation:  0.008422374725341797
mini_batch_src_global generation:  0.010062932968139648
r_  generation:  0.10561299324035645
----------------------check_connections_block total spend ----------------------------- 0.3334083557128906
generate_one_block  0.1469099521636963
generate_one_block  0.12943792343139648
----------===============-------------===============-------------the number of batches *****---- 10

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043309688568115234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

connection checking time:  1.0722057819366455
block generation total time  0.9073433876037598
average batch blocks generation time:  0.11341792345046997
block dataloader generation time/epoch 37.90918254852295
pseudo mini batch 0 input nodes size: 56404
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03867626190185547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03867626190185547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06557178497314453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06565713882446289  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03891277313232422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040805816650390625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040805816650390625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56404
first layer output nodes number: 27756
edges number: 173271
input nodes number: 27756
output nodes number: 11394
edges number: 80673
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.6587085723876953  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.6587095260620117  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04541349411010742  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 1 input nodes size: 66813
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03985595703125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03985595703125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07171487808227539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07179880142211914  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04481792449951172  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047371864318847656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047371864318847656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 66813
first layer output nodes number: 34673
edges number: 251437
input nodes number: 34673
output nodes number: 11224
edges number: 91205
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.4064149856567383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.4064154624938965  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05192756652832031  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 2 input nodes size: 33566
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04474067687988281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04474067687988281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.060746192932128906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06083106994628906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.028888225555419922  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03044748306274414  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03044748306274414  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 33566
first layer output nodes number: 19871
edges number: 121046
input nodes number: 19871
output nodes number: 11375
edges number: 88191
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.331547737121582  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.3315482139587402  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03362226486206055  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 3 input nodes size: 32665
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02902364730834961  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02902364730834961  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04459953308105469  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044684410095214844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.028594017028808594  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030246734619140625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030246734619140625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 32665
first layer output nodes number: 20606
edges number: 128602
input nodes number: 20606
output nodes number: 11384
edges number: 93147
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.461388111114502  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.46138858795166  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03342914581298828  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 4 input nodes size: 42711
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02859783172607422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02859783172607422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04896402359008789  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04904890060424805  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03338813781738281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034987449645996094  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034987449645996094  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 42711
first layer output nodes number: 22066
edges number: 133031
input nodes number: 22066
output nodes number: 11366
edges number: 81488
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.343301296234131  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.343301773071289  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.038012027740478516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 30677
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03326606750488281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03326606750488281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04789400100708008  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047980308532714844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027529239654541016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02881765365600586  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02881765365600586  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 30677
first layer output nodes number: 19324
edges number: 102484
input nodes number: 19324
output nodes number: 11550
edges number: 70368
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.9488253593444824  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.9488258361816406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03143167495727539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 43439
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027539730072021484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027539730072021484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.049024105072021484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.049065589904785156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034351348876953125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03555583953857422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03555583953857422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 43439
first layer output nodes number: 18157
edges number: 123569
input nodes number: 18157
output nodes number: 5518
edges number: 37965
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.5968785285949707  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.596879005432129  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03693723678588867  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 7 input nodes size: 65287
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.033452510833740234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.033452510833740234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06458377838134766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06462526321411133  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043099403381347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04548072814941406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04548072814941406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 65287
first layer output nodes number: 30778
edges number: 258583
input nodes number: 30778
output nodes number: 5517
edges number: 60849
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.97981595993042  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.979816436767578  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.049553871154785156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 8 input nodes size: 54580
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043099403381347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043099403381347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06912517547607422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0691690444946289  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03799629211425781  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04041004180908203  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04041004180908203  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 54580
first layer output nodes number: 28683
edges number: 246096
input nodes number: 28683
output nodes number: 5865
edges number: 77785
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.1205062866210938  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.120506763458252  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0445704460144043  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 9 input nodes size: 55499
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03804779052734375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03804779052734375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06451177597045898  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06455469131469727  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.038485050201416016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040700435638427734  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040700435638427734  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 55499
first layer output nodes number: 28208
edges number: 234726
input nodes number: 28208
output nodes number: 5748
edges number: 62579
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.8013243675231934  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.8013248443603516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04447460174560547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04447460174560547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04447460174560547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.022616267204284668 |0.003911113739013672 |0.11862056255340576 |0.00012764930725097656 |0.1367805004119873 |0.005925416946411133 |
----------------------------------------------------------pseudo_mini_loss sum 5.012078762054443[23:36:06] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29010640 edges into 8 parts and get 4472343 edge cuts

Total (block generation + training)time/epoch 40.819535970687866
Training time/epoch 2.9100167751312256
Training time without block to device /epoch 2.870905637741089
Training time without total dataloading part /epoch 2.5612125396728516
load block tensor time/epoch 0.22616267204284668
block to device time/epoch 0.03911113739013672
input features size transfer per epoch 1.341104507446289e-06
blocks size to device per epoch 8.940696716308594e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  731763
Number of first layer input nodes during this epoch:  481641
Number of first layer output nodes during this epoch:  250122
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044474124908447266  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.02494359016418457
global_2_local spend time (sec) 0.05266427993774414
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004496574401855469
A = g.adjacency_matrix() spent  0.012960672378540039
auxiliary_graph
Graph(num_nodes=154715, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.11340022087097168
remove nodes length
63774
auxiliary_graph.remove_nodes spent  1.5881662368774414
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.2684400081634521

the counter of shared neighbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})
29010640
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29010637, 29010638, 29010639])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})
Convert a graph into a bidirected graph: 2.031 seconds
Metis partitioning: 6.052 seconds
Split the graph: 2.869 seconds
Construct subgraphs: 0.044 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.011586904525757
11244
11380
11035
11587
11495
11537
11328
11335
total k batches seeds list generation spend  23.221773386001587
after graph partition
graph partition algorithm spend time 23.32984757423401
11244
11380
11035
11587
11495
11537
11328
11335
partition_len_list
[32681, 27197, 46731, 41877, 23451, 19625, 19835, 21177]
shared_neighbor_graph_partition_s0 selection method  spend 23.443177461624146
time for parepare:  0.018468141555786133
local_output_nid generation:  0.001958131790161133
local_in_edges_tensor generation:  0.0022127628326416016
mini_batch_src_global generation:  0.0030167102813720703
r_  generation:  0.03299403190612793
local_output_nid generation:  0.0027883052825927734
local_in_edges_tensor generation:  0.002196788787841797
mini_batch_src_global generation:  0.004357576370239258
r_  generation:  0.03834342956542969
local_output_nid generation:  0.002904653549194336
local_in_edges_tensor generation:  0.002950906753540039
mini_batch_src_global generation:  0.004308462142944336
r_  generation:  0.0458226203918457
local_output_nid generation:  0.0027256011962890625
local_in_edges_tensor generation:  0.002504587173461914
mini_batch_src_global generation:  0.0058743953704833984
r_  generation:  0.056678056716918945
local_output_nid generation:  0.0027763843536376953
local_in_edges_tensor generation:  0.0022554397583007812
mini_batch_src_global generation:  0.0036478042602539062
r_  generation:  0.03679680824279785
local_output_nid generation:  0.002600431442260742
local_in_edges_tensor generation:  0.002117156982421875
mini_batch_src_global generation:  0.002694368362426758
r_  generation:  0.02938365936279297
local_output_nid generation:  0.0022678375244140625
local_in_edges_tensor generation:  0.002131938934326172
mini_batch_src_global generation:  0.003157377243041992
r_  generation:  0.03825521469116211
local_output_nid generation:  0.002306222915649414
local_in_edges_tensor generation:  0.002269268035888672
mini_batch_src_global generation:  0.0035178661346435547
r_  generation:  0.0365450382232666
----------------------check_connections_block total spend ----------------------------- 0.4680309295654297
generate_one_block  0.05514645576477051
generate_one_block  0.04901409149169922
generate_one_block  0.06692695617675781
generate_one_block  0.08041024208068848
generate_one_block  0.04680442810058594
generate_one_block  0.036524057388305664
generate_one_block  0.050370216369628906
generate_one_block  0.04855823516845703
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05420374870300293
gen group dst list time:  0.007161378860473633
time for parepare:  0.02260303497314453
local_output_nid generation:  0.005118608474731445
local_in_edges_tensor generation:  0.022700071334838867
mini_batch_src_global generation:  0.008009195327758789
r_  generation:  0.09719157218933105
local_output_nid generation:  0.0066945552825927734
local_in_edges_tensor generation:  0.007948160171508789
mini_batch_src_global generation:  0.008649826049804688
r_  generation:  0.07784700393676758
local_output_nid generation:  0.010513782501220703
local_in_edges_tensor generation:  0.014835357666015625
mini_batch_src_global generation:  0.013520956039428711
r_  generation:  0.15813732147216797
local_output_nid generation:  0.009018898010253906
local_in_edges_tensor generation:  0.011687278747558594
mini_batch_src_global generation:  0.014411687850952148
r_  generation:  0.15721845626831055
local_output_nid generation:  0.005335807800292969
local_in_edges_tensor generation:  0.005206108093261719
mini_batch_src_global generation:  0.008234739303588867
r_  generation:  0.06729388236999512
local_output_nid generation:  0.004517555236816406
local_in_edges_tensor generation:  0.00403285026550293
mini_batch_src_global generation:  0.005602121353149414
r_  generation:  0.05025625228881836
local_output_nid generation:  0.00435328483581543
local_in_edges_tensor generation:  0.005646228790283203
mini_batch_src_global generation:  0.005782604217529297
r_  generation:  0.05527901649475098
local_output_nid generation:  0.0044689178466796875
local_in_edges_tensor generation:  0.005064725875854492
mini_batch_src_global generation:  0.005609035491943359
r_  generation:  0.05753827095031738
----------------------check_connections_block total spend ----------------------------- 1.073991298675537
generate_one_block  0.13222384452819824
generate_one_block  0.10445642471313477
generate_one_block  0.21844100952148438
generate_one_block  0.19998693466186523
generate_one_block  0.08199167251586914
generate_one_block  0.05968475341796875
generate_one_block  0.07405400276184082
generate_one_block  0.07385873794555664
global_2_local spend time (sec) 0.010972976684570312
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.002310514450073242
A = g.adjacency_matrix() spent  0.0014717578887939453
auxiliary_graph
Graph(num_nodes=46731, num_edges=4062165,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.029818058013916016
remove nodes length
35696
auxiliary_graph.remove_nodes spent  0.138031005859375
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=4062165,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})[23:36:14] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 4051130 edges into 2 parts and get 487291 edge cuts
[23:36:16] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11244 nodes and 1351220 edges into 2 parts and get 17027 edge cuts

auxiliary_graph_no_diag generation spent  0.15555810928344727

the counter of shared neighbor distribution
Counter({1.0: 3495478, 2.0: 439054, 3.0: 85628, 4.0: 20698, 5.0: 6274, 6.0: 2252, 7.0: 1014, 8.0: 364, 9.0: 180, 10.0: 92, 11.0: 50, 12.0: 20, 13.0: 20, 17.0: 2, 14.0: 2, 15.0: 2})
4051130
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.176 seconds
Metis partitioning: 0.468 seconds
Split the graph: 0.479 seconds
Construct subgraphs: 0.016 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  1.1452486515045166
5444
5591
total k batches seeds list generation spend  2.478278636932373
after graph partition
graph partition algorithm spend time 2.501084804534912
5444
5591
time for parepare:  0.02808380126953125
local_output_nid generation:  0.0008223056793212891
local_in_edges_tensor generation:  0.007432460784912109
mini_batch_src_global generation:  0.0020570755004882812
r_  generation:  0.018503189086914062
local_output_nid generation:  0.0012280941009521484
local_in_edges_tensor generation:  0.0015223026275634766
mini_batch_src_global generation:  0.003147125244140625
r_  generation:  0.026039600372314453
----------------------check_connections_block total spend ----------------------------- 0.10355615615844727
generate_one_block  0.029867887496948242
generate_one_block  0.040618896484375
time for parepare:  0.02292156219482422
local_output_nid generation:  0.003383636474609375
local_in_edges_tensor generation:  0.016240358352661133
mini_batch_src_global generation:  0.006618976593017578
r_  generation:  0.0770113468170166
local_output_nid generation:  0.009331464767456055
local_in_edges_tensor generation:  0.008893251419067383
mini_batch_src_global generation:  0.011473655700683594
r_  generation:  0.11493325233459473
----------------------check_connections_block total spend ----------------------------- 0.32190394401550293
generate_one_block  0.10931944847106934
generate_one_block  0.15313243865966797
global_2_local spend time (sec) 0.0075452327728271484
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0012149810791015625
A = g.adjacency_matrix() spent  0.000972747802734375
auxiliary_graph
Graph(num_nodes=32681, num_edges=1362464,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.021814584732055664
remove nodes length
21437
auxiliary_graph.remove_nodes spent  0.05700802803039551
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11244, num_edges=1362464,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.04262995719909668

the counter of shared neighbor distribution
Counter({1.0: 1167212, 2.0: 146166, 3.0: 25870, 4.0: 6746, 5.0: 2406, 6.0: 1038, 7.0: 594, 8.0: 356, 9.0: 174, 10.0: 122, 11.0: 94, 12.0: 76, 17.0: 72, 13.0: 70, 16.0: 64, 15.0: 62, 18.0: 34, 14.0: 32, 19.0: 26, 20.0: 4, 21.0: 2})
1351220
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.051 seconds
Metis partitioning: 0.128 seconds
Split the graph: 0.188 seconds
Construct subgraphs: 0.023 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.39276123046875
5545
5699
total k batches seeds list generation spend  0.7985892295837402
after graph partition
graph partition algorithm spend time 0.8465843200683594
5545
5699
time for parepare:  0.03444528579711914
local_output_nid generation:  0.001115560531616211
local_in_edges_tensor generation:  0.006161212921142578
mini_batch_src_global generation:  0.006228923797607422
r_  generation:  0.024938344955444336
local_output_nid generation:  0.0011684894561767578
local_in_edges_tensor generation:  0.001718282699584961
mini_batch_src_global generation:  0.0025687217712402344
r_  generation:  0.0184628963470459
----------------------check_connections_block total spend ----------------------------- 0.11549973487854004
generate_one_block  0.026337623596191406
generate_one_block  0.019400835037231445
time for parepare:  0.022153615951538086
local_output_nid generation:  0.003793001174926758
local_in_edges_tensor generation:  0.005894899368286133
mini_batch_src_global generation:  0.00591278076171875
r_  generation:  0.07188773155212402
local_output_nid generation:  0.004146575927734375
local_in_edges_tensor generation:  0.0030715465545654297
mini_batch_src_global generation:  0.003705739974975586
r_  generation:  0.03406071662902832
----------------------check_connections_block total spend ----------------------------- 0.181105375289917
generate_one_block  0.09299707412719727
generate_one_block  0.043675899505615234
----------===============-------------===============-------------the number of batches *****---- 10

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044474124908447266  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

connection checking time:  1.073991298675537
block generation total time  0.944697380065918
average batch blocks generation time:  0.11808717250823975
block dataloader generation time/epoch 34.57884728908539
pseudo mini batch 0 input nodes size: 56517
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0384669303894043  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0384669303894043  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06541633605957031  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06550121307373047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03899431228637695  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040967464447021484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040967464447021484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56517
first layer output nodes number: 27197
edges number: 177089
input nodes number: 27197
output nodes number: 11380
edges number: 87562
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.7795138359069824  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.779514789581299  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046170711517333984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 1 input nodes size: 67491
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040413856506347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040413856506347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07259607315063477  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07268285751342773  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04564857482910156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.049241065979003906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.049241065979003906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67491
first layer output nodes number: 41877
edges number: 341298
input nodes number: 41877
output nodes number: 11587
edges number: 140682
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3408203125 GB
    Memory Allocated: 4.81506872177124  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3408203125 GB
    Memory Allocated: 4.815069198608398  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.05535459518432617  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 2 input nodes size: 41668
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04522848129272461  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04522848129272461  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06509733200073242  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06518316268920898  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.032914161682128906  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03455829620361328  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03455829620361328  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 41668
first layer output nodes number: 23451
edges number: 138949
input nodes number: 23451
output nodes number: 11495
edges number: 81583
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.3907971382141113  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.3907976150512695  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.037801265716552734  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 3 input nodes size: 30899
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03293943405151367  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03293943405151367  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04767322540283203  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.0477595329284668  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.027804851531982422  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.029021739959716797  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.029021739959716797  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 30899
first layer output nodes number: 19625
edges number: 98618
input nodes number: 19625
output nodes number: 11537
edges number: 64609
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.840226173400879  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.840226650238037  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03146553039550781  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 4 input nodes size: 33468
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.027750492095947266  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.027750492095947266  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04370927810668945  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.043793678283691406  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.02897357940673828  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03059864044189453  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03059864044189453  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 33468
first layer output nodes number: 19835
edges number: 124830
input nodes number: 19835
output nodes number: 11328
edges number: 93077
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.4287710189819336  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.428771495819092  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03371715545654297  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 5 input nodes size: 35451
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.028953075408935547  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.028953075408935547  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04653120040893555  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.0466160774230957  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.030572891235351562  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03219795227050781  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03219795227050781  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 35451
first layer output nodes number: 21177
edges number: 129545
input nodes number: 21177
output nodes number: 11335
edges number: 88395
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.4062914848327637  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.406291961669922  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03577995300292969  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 6 input nodes size: 53399
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.031005382537841797  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.031005382537841797  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.05646800994873047  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.05650901794433594  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03884601593017578  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04053306579589844  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04053306579589844  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 53399
first layer output nodes number: 23628
edges number: 180163
input nodes number: 23628
output nodes number: 5444
edges number: 46156
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.154414653778076  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 2.1544151306152344  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04212665557861328  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 7 input nodes size: 66179
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03741931915283203  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03741931915283203  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06897592544555664  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06901788711547852  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.043514251708984375  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04668855667114258  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04668855667114258  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 66179
first layer output nodes number: 32264
edges number: 274605
input nodes number: 32264
output nodes number: 5591
edges number: 67588
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 3.200368881225586  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 3.200369358062744  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.05104541778564453  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 8 input nodes size: 53510
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04353618621826172  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04353618621826172  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06905174255371094  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.06909322738647461  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.037494659423828125  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes
Using backend: pytorch

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.039048194885253906  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.039048194885253906  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 53510
first layer output nodes number: 22068
edges number: 166008
input nodes number: 22068
output nodes number: 5545
edges number: 42469
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.991227149963379  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.991227626800537  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.04186677932739258  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

pseudo mini batch 9 input nodes size: 28969
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03748750686645508  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.03748750686645508  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.051301002502441406  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.05134391784667969  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.025786876678466797  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.026595592498779297  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.026595592498779297  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

first layer input nodes number: 28969
first layer output nodes number: 13559
edges number: 76177
input nodes number: 13559
output nodes number: 5699
edges number: 32129
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.1451010704040527  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 1.145101547241211  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.028251171112060547  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.028251171112060547  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.4755859375 GB
    Memory Allocated: 0.028251171112060547  GigaBytes
Max Memory Allocated: 5.011293888092041  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.024280548095703125 |0.00434417724609375 |0.11454601287841797 |0.00012423992156982422 |0.13012354373931884 |0.005890846252441406 |
----------------------------------------------------------pseudo_mini_loss sum 3.8032338619232178
Total (block generation + training)time/epoch 37.433237195014954
Training time/epoch 2.7981367111206055
Training time without block to device /epoch 2.754694938659668
Training time without total dataloading part /epoch 2.453828811645508
load block tensor time/epoch 0.24280548095703125
block to device time/epoch 0.0434417724609375
input features size transfer per epoch 1.341104507446289e-06
blocks size to device per epoch 8.940696716308594e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  712232
Number of first layer input nodes during this epoch:  467551
Number of first layer output nodes during this epoch:  244681
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(128, 128, batch_first=True)
      (fc_self): Linear(in_features=128, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (lstm): LSTM(256, 256, batch_first=True)
      (fc_self): Linear(in_features=256, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=40, bias=False)
    )
  )
  (bns): ModuleList(
    (0): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  744960
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([512, 128])
layers.0.lstm.weight_hh_l0, torch.Size([512, 128])
layers.0.lstm.bias_ih_l0, torch.Size([512])
layers.0.lstm.bias_hh_l0, torch.Size([512])
layers.0.fc_self.weight, torch.Size([256, 128])
layers.0.fc_neigh.weight, torch.Size([256, 128])
layers.1.lstm.weight_ih_l0, torch.Size([1024, 256])
layers.1.lstm.weight_hh_l0, torch.Size([1024, 256])
layers.1.lstm.bias_ih_l0, torch.Size([1024])
layers.1.lstm.bias_hh_l0, torch.Size([1024])
layers.1.fc_self.weight, torch.Size([40, 256])
layers.1.fc_neigh.weight, torch.Size([40, 256])
bns.0.weight, torch.Size([256])
bns.0.bias, torch.Size([256])
----------------------------------------
un-trainable parameters
