[23:00:36] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 28961398 edges into 8 parts and get 4598647 edge cuts
main start at this time 1652223610.8392625
-----------------------------------------before load data 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.021163463592529297
global_2_local spend time (sec) 0.04377603530883789
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004542350769042969
A = g.adjacency_matrix() spent  0.011505365371704102
auxiliary_graph
Graph(num_nodes=154710, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.14068174362182617
remove nodes length
63769
auxiliary_graph.remove_nodes spent  1.482933521270752
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.468909502029419

the counter of shared neighbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
28961398
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 28961395, 28961396, 28961397])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
Convert a graph into a bidirected graph: 2.133 seconds
Metis partitioning: 6.464 seconds
Split the graph: 2.737 seconds
Construct subgraphs: 0.081 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.429687976837158
11436
11456
11522
11580
11035
11283
11508
11121
total k batches seeds list generation spend  24.237853527069092
after graph partition
graph partition algorithm spend time 24.356297969818115
11436
11456
11522
11580
11035
11283
11508
11121
partition_len_list
[19376, 21264, 21136, 20917, 48032, 41430, 27887, 33663]
shared_neighbor_graph_partition_s0 selection method  spend 24.455748558044434
time for parepare:  0.019657135009765625
local_output_nid generation:  0.0016896724700927734
local_in_edges_tensor generation:  0.002370595932006836
mini_batch_src_global generation:  0.0039865970611572266
r_  generation:  0.037444353103637695
local_output_nid generation:  0.0022840499877929688
local_in_edges_tensor generation:  0.002938508987426758
mini_batch_src_global generation:  0.00416111946105957
r_  generation:  0.03676319122314453
local_output_nid generation:  0.00234222412109375
local_in_edges_tensor generation:  0.0020732879638671875
mini_batch_src_global generation:  0.003079652786254883
r_  generation:  0.030321359634399414
local_output_nid generation:  0.002312183380126953
local_in_edges_tensor generation:  0.002081632614135742
mini_batch_src_global generation:  0.003197193145751953
r_  generation:  0.03301191329956055
local_output_nid generation:  0.0022208690643310547
local_in_edges_tensor generation:  0.0026123523712158203
mini_batch_src_global generation:  0.004951953887939453
r_  generation:  0.050676584243774414
local_output_nid generation:  0.0023157596588134766
local_in_edges_tensor generation:  0.0033445358276367188
mini_batch_src_global generation:  0.0058746337890625
r_  generation:  0.05403566360473633
local_output_nid generation:  0.002336263656616211
local_in_edges_tensor generation:  0.002179384231567383
mini_batch_src_global generation:  0.010806798934936523
r_  generation:  0.038391828536987305
local_output_nid generation:  0.0029370784759521484
local_in_edges_tensor generation:  0.002199411392211914
mini_batch_src_global generation:  0.0033423900604248047
r_  generation:  0.03261423110961914
----------------------check_connections_block total spend ----------------------------- 0.4833998680114746
generate_one_block  0.062216758728027344
generate_one_block  0.0562901496887207
generate_one_block  0.04005122184753418
generate_one_block  0.04190373420715332
generate_one_block  0.06973862648010254
generate_one_block  0.07555866241455078
generate_one_block  0.04585909843444824
generate_one_block  0.04875969886779785
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04547619819641113
gen group dst list time:  0.007219552993774414
time for parepare:  0.025498628616333008
local_output_nid generation:  0.0030617713928222656
local_in_edges_tensor generation:  0.04143857955932617
mini_batch_src_global generation:  0.012731552124023438
r_  generation:  0.07444953918457031
local_output_nid generation:  0.004768848419189453
local_in_edges_tensor generation:  0.0058286190032958984
mini_batch_src_global generation:  0.010743856430053711
r_  generation:  0.05814003944396973
local_output_nid generation:  0.004834890365600586
local_in_edges_tensor generation:  0.0043392181396484375
mini_batch_src_global generation:  0.006728410720825195
r_  generation:  0.05374932289123535
local_output_nid generation:  0.004522085189819336
local_in_edges_tensor generation:  0.00457000732421875
mini_batch_src_global generation:  0.005484342575073242
r_  generation:  0.055203914642333984
local_output_nid generation:  0.009214401245117188
local_in_edges_tensor generation:  0.015802621841430664
mini_batch_src_global generation:  0.01430964469909668
r_  generation:  0.1673450469970703
local_output_nid generation:  0.008328437805175781
local_in_edges_tensor generation:  0.01094818115234375
mini_batch_src_global generation:  0.015256881713867188
r_  generation:  0.14067721366882324
local_output_nid generation:  0.006280660629272461
local_in_edges_tensor generation:  0.006283998489379883
mini_batch_src_global generation:  0.009572982788085938
r_  generation:  0.08501863479614258
local_output_nid generation:  0.007227897644042969
local_in_edges_tensor generation:  0.007638692855834961
mini_batch_src_global generation:  0.010578155517578125
r_  generation:  0.10020256042480469
----------------------check_connections_block total spend ----------------------------- 1.1429738998413086
generate_one_block  0.06716156005859375
generate_one_block  0.07061624526977539
generate_one_block  0.06498885154724121
generate_one_block  0.06580758094787598
generate_one_block  0.2084512710571289
generate_one_block  0.18142938613891602
generate_one_block  0.09791183471679688
generate_one_block  0.1278378963470459
global_2_local spend time (sec) 0.010811090469360352
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0036733150482177734
A = g.adjacency_matrix() spent  0.0016384124755859375
auxiliary_graph
Graph(num_nodes=48032, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.032637596130371094[23:00:44] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 3872734 edges into 2 parts and get 453065 edge cuts

remove nodes length
36997
auxiliary_graph.remove_nodes spent  0.1461625099182129
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.13953852653503418

the counter of shared neighbor distribution
Counter({1.0: 3357116, 2.0: 408566, 3.0: 77052, 4.0: 19494, 5.0: 6250, 6.0: 2292, 7.0: 934, 8.0: 530, 9.0: 198, 10.0: 124, 11.0: 70, 12.0: 40, 13.0: 28, 14.0: 20, 15.0: 8, 17.0: 6, 20.0: 2, 18.0: 2, 16.0: 2})
3872734
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.156 seconds
Metis partitioning: 0.451 seconds
Split the graph: 0.313 seconds
Construct subgraphs: 0.014 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.9384598731994629
5488
5547
total k batches seeds list generation spend  2.014777183532715
after graph partition
graph partition algorithm spend time 2.038602828979492
5488
5547
time for parepare:  0.03149843215942383
local_output_nid generation:  0.0010089874267578125
local_in_edges_tensor generation:  0.005714893341064453
mini_batch_src_global generation:  0.0024979114532470703
r_  generation:  0.023609161376953125
local_output_nid generation:  0.001056671142578125
local_in_edges_tensor generation:  0.0015063285827636719
mini_batch_src_global generation:  0.0028667449951171875
r_  generation:  0.025074481964111328
----------------------check_connections_block total spend ----------------------------- 0.11163902282714844
generate_one_block  0.031142473220825195
generate_one_block  0.03744339942932129
time for parepare:  0.021482229232788086
local_output_nid generation:  0.0033779144287109375
local_in_edges_tensor generation:  0.005837917327880859
mini_batch_src_global generation:  0.007374763488769531
r_  generation:  0.08902263641357422
local_output_nid generation:  0.007232666015625
local_in_edges_tensor generation:  0.009547710418701172
mini_batch_src_global generation:  0.011751651763916016
r_  generation:  0.11296391487121582
----------------------check_connections_block total spend ----------------------------- 0.3144865036010742
generate_one_block  0.11524486541748047
generate_one_block  0.15634632110595703
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

connection checking time:  1.1429738998413086
block generation total time  0.884204626083374
average batch blocks generation time:  0.11052557826042175
pseudo mini batch 0 input nodes size: 33053
----------------------------------------before load block subtensor 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018538475036621094  GigaBytes
Max Memory Allocated: 0.018538475036621094  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

first layer input nodes number: 33053
first layer output nodes number: 19376
edges number: 122818
input nodes number: 19376
output nodes number: 11436
edges number: 93717
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.420609951019287  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.4206109046936035  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.02784109115600586  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

pseudo mini batch 1 input nodes size: 33722
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.0391840934753418  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.039269447326660156  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023423194885253906  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

first layer input nodes number: 33722
first layer output nodes number: 21264
edges number: 130063
input nodes number: 21264
output nodes number: 11456
edges number: 91731
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621076583862305  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621081352233887  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028455734252929688  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 2 input nodes size: 38652
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.042038917541503906  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04212522506713867  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02595996856689453  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 38652
first layer output nodes number: 21136
edges number: 116620
input nodes number: 21136
output nodes number: 11522
edges number: 70352
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436105728149414  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436110496520996  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.030178070068359375  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 3 input nodes size: 34793
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04256391525268555  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04265022277832031  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02413320541381836  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 34793
first layer output nodes number: 20917
edges number: 119121
input nodes number: 20917
output nodes number: 11580
edges number: 77943
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798105239868164  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798110008239746  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028331756591796875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 4 input nodes size: 67485
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.05613565444946289  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.056220054626464844  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.03954315185546875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 67485
first layer output nodes number: 41430
edges number: 337279
input nodes number: 41430
output nodes number: 11283
edges number: 136210
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997467041016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997943878174  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05006885528564453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 56582
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06682205200195312  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06690788269042969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034644126892089844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56582
first layer output nodes number: 27887
edges number: 176606
input nodes number: 27887
output nodes number: 11508
edges number: 82704
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.711897850036621  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.7118983268737793  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040024757385253906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 70027
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06775856018066406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0678415298461914  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040775299072265625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043048858642578125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043048858642578125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 70027
first layer output nodes number: 33663
edges number: 229935
input nodes number: 33663
output nodes number: 11121
edges number: 75016
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0054659843444824  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0054664611816406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047191619873046875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 7 input nodes size: 57944
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04068565368652344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04068565368652344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06831550598144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06835651397705078  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0348820686340332  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03678178787231445  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03678178787231445  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 57944
first layer output nodes number: 25513
edges number: 201903
input nodes number: 25513
output nodes number: 5488
edges number: 52975
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.405813217163086  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.405813694000244  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039301395416259766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 8 input nodes size: 67627
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0340423583984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0340423583984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0672454833984375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06728696823120117  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03961610794067383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04208040237426758  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04208040237426758  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67627
first layer output nodes number: 31902
edges number: 267044
input nodes number: 31902
output nodes number: 5547
edges number: 63602
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0750865936279297  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.075087070465088  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04688310623168945  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05243349075317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05243349075317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.02479198243882921 |0.04778973261515299 |0.1757697794172499 |0.00013746155632866753 |0.14262811342875162 |0.008353233337402344 |
----------------------------------------------------------pseudo_mini_loss sum 5.286849021911621
 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  702973
Number of first layer input nodes during this epoch:  459885
Number of first layer output nodes during this epoch:  243088
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.052433013916015625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.031104564666748047
global_2_local spend time (sec) 0.05188560485839844
----------------------------  graph partition start---------------------[23:01:11] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29070896 edges into 8 parts and get 4713408 edge cuts
[23:01:19] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 3285926 edges into 2 parts and get 179157 edge cuts

g = dgl.graph((u,v))  spent  0.00452733039855957
A = g.adjacency_matrix() spent  0.005994558334350586
auxiliary_graph
Graph(num_nodes=154609, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.1051626205444336
remove nodes length
63668
auxiliary_graph.remove_nodes spent  1.6383013725280762
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.241056203842163

the counter of shared neighbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
29070896
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29070893, 29070894, 29070895])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
Convert a graph into a bidirected graph: 2.098 seconds
Metis partitioning: 6.334 seconds
Split the graph: 2.548 seconds
Construct subgraphs: 0.049 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.04581594467163
11606
11485
11586
11572
11236
11133
11035
11288
total k batches seeds list generation spend  25.029627084732056
after graph partition
graph partition algorithm spend time 25.147566080093384
11606
11485
11586
11572
11236
11133
11035
11288
partition_len_list
[21566, 20242, 20867, 21505, 27652, 34219, 46378, 41146]
shared_neighbor_graph_partition_s0 selection method  spend 25.26034641265869
time for parepare:  0.02001810073852539
local_output_nid generation:  0.002025127410888672
local_in_edges_tensor generation:  0.0023097991943359375
mini_batch_src_global generation:  0.0041522979736328125
r_  generation:  0.03978276252746582
local_output_nid generation:  0.0024869441986083984
local_in_edges_tensor generation:  0.0030527114868164062
mini_batch_src_global generation:  0.0050737857818603516
r_  generation:  0.03754305839538574
local_output_nid generation:  0.0031659603118896484
local_in_edges_tensor generation:  0.002074718475341797
mini_batch_src_global generation:  0.004237651824951172
r_  generation:  0.032796382904052734
local_output_nid generation:  0.0024652481079101562
local_in_edges_tensor generation:  0.0022504329681396484
mini_batch_src_global generation:  0.006338834762573242
r_  generation:  0.031116724014282227
local_output_nid generation:  0.002556324005126953
local_in_edges_tensor generation:  0.002526521682739258
mini_batch_src_global generation:  0.003238677978515625
r_  generation:  0.03486490249633789
local_output_nid generation:  0.002480030059814453
local_in_edges_tensor generation:  0.0024242401123046875
mini_batch_src_global generation:  0.003930091857910156
r_  generation:  0.03818368911743164
local_output_nid generation:  0.0025475025177001953
local_in_edges_tensor generation:  0.0023126602172851562
mini_batch_src_global generation:  0.004403352737426758
r_  generation:  0.04326581954956055
local_output_nid generation:  0.0027091503143310547
local_in_edges_tensor generation:  0.002802133560180664
mini_batch_src_global generation:  0.0057260990142822266
r_  generation:  0.057769060134887695
----------------------check_connections_block total spend ----------------------------- 0.4840366840362549
generate_one_block  0.06291770935058594
generate_one_block  0.04940319061279297
generate_one_block  0.044851064682006836
generate_one_block  0.04006314277648926
generate_one_block  0.04560422897338867
generate_one_block  0.05613207817077637
generate_one_block  0.06499671936035156
generate_one_block  0.07837247848510742
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.05298256874084473
gen group dst list time:  0.007374286651611328
time for parepare:  0.025889158248901367
local_output_nid generation:  0.0035681724548339844
local_in_edges_tensor generation:  0.026398420333862305
mini_batch_src_global generation:  0.005428791046142578
r_  generation:  0.05956768989562988
local_output_nid generation:  0.00526881217956543
local_in_edges_tensor generation:  0.0061457157135009766
mini_batch_src_global generation:  0.0057086944580078125
r_  generation:  0.056423187255859375
local_output_nid generation:  0.004761457443237305
local_in_edges_tensor generation:  0.004260540008544922
mini_batch_src_global generation:  0.004502296447753906
r_  generation:  0.05280423164367676
local_output_nid generation:  0.004568338394165039
local_in_edges_tensor generation:  0.004518032073974609
mini_batch_src_global generation:  0.004420280456542969
r_  generation:  0.09831881523132324
local_output_nid generation:  0.00670623779296875
local_in_edges_tensor generation:  0.011098861694335938
mini_batch_src_global generation:  0.008121967315673828
r_  generation:  0.08037996292114258
local_output_nid generation:  0.0071125030517578125
local_in_edges_tensor generation:  0.007895231246948242
mini_batch_src_global generation:  0.010012388229370117
r_  generation:  0.10754227638244629
local_output_nid generation:  0.009469270706176758
local_in_edges_tensor generation:  0.013806343078613281
mini_batch_src_global generation:  0.015607357025146484
r_  generation:  0.150437593460083
local_output_nid generation:  0.008244752883911133
local_in_edges_tensor generation:  0.010608673095703125
mini_batch_src_global generation:  0.014943838119506836
r_  generation:  0.13787555694580078
----------------------check_connections_block total spend ----------------------------- 1.1149215698242188
generate_one_block  0.07561922073364258
generate_one_block  0.07183218002319336
generate_one_block  0.06498861312866211
generate_one_block  0.0650033950805664
generate_one_block  0.11180710792541504
generate_one_block  0.1391313076019287
generate_one_block  0.200270414352417
generate_one_block  0.1813795566558838
global_2_local spend time (sec) 0.010547637939453125
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0012040138244628906
A = g.adjacency_matrix() spent  0.0013887882232666016
auxiliary_graph
Graph(num_nodes=46378, num_edges=3296961,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.030602216720581055
remove nodes length
35343
auxiliary_graph.remove_nodes spent  0.11213517189025879
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=3296961,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.16660308837890625

the counter of shared neighbor distribution
Counter({1.0: 2910728, 2.0: 301716, 3.0: 52540, 4.0: 13022, 5.0: 4400, 6.0: 1770, 7.0: 788, 8.0: 444, 9.0: 200, 10.0: 112, 11.0: 64, 12.0: 44, 14.0: 32, 13.0: 30, 16.0: 10, 17.0: 10, 15.0: 8, 20.0: 4, 19.0: 4})
3285926
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.143 seconds
Metis partitioning: 0.354 seconds
Split the graph: 0.458 seconds
Construct subgraphs: 0.073 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  1.0326390266418457
5628
5407
total k batches seeds list generation spend  1.9902353286743164
after graph partition
graph partition algorithm spend time 2.0206966400146484
5628
5407
time for parepare:  0.021973609924316406
local_output_nid generation:  0.0008127689361572266
local_in_edges_tensor generation:  0.004096508026123047
mini_batch_src_global generation:  0.004454374313354492
r_  generation:  0.02586650848388672
local_output_nid generation:  0.0010914802551269531
local_in_edges_tensor generation:  0.0014505386352539062
mini_batch_src_global generation:  0.0027985572814941406
r_  generation:  0.0168154239654541
----------------------check_connections_block total spend ----------------------------- 0.0935215950012207
generate_one_block  0.052152156829833984
generate_one_block  0.025634050369262695
time for parepare:  0.022993803024291992
local_output_nid generation:  0.004835844039916992
local_in_edges_tensor generation:  0.01537466049194336
mini_batch_src_global generation:  0.009632110595703125
r_  generation:  0.11353325843811035
local_output_nid generation:  0.007178783416748047
local_in_edges_tensor generation:  0.0049822330474853516
mini_batch_src_global generation:  0.007028341293334961
r_  generation:  0.06018328666687012
----------------------check_connections_block total spend ----------------------------- 0.28595805168151855
generate_one_block  0.16165494918823242
generate_one_block  0.07775139808654785
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.052433013916015625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

connection checking time:  1.1149215698242188
block generation total time  0.910031795501709
average batch blocks generation time:  0.11375397443771362
block dataloader generation time/epoch 31.18526554107666
pseudo mini batch 0 input nodes size: 34229
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.045174598693847656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.045174598693847656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06149625778198242  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06158304214477539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02833843231201172  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030096054077148438  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030096054077148438  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 34229
first layer output nodes number: 21566
edges number: 136241
input nodes number: 21566
output nodes number: 11606
edges number: 99513
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.6339111328125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.6339120864868164  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 1 input nodes size: 35675
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02924203872680664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02924203872680664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046253204345703125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04633903503417969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.029930591583251953  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03157758712768555  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03157758712768555  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 35675
first layer output nodes number: 20242
edges number: 129605
input nodes number: 20242
output nodes number: 11485
edges number: 91353
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.4429221153259277  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.442922592163086  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034891605377197266  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 2 input nodes size: 34734
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030067920684814453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030067920684814453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0466303825378418  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046717166900634766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02962017059326172  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.031052589416503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.031052589416503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 34734
first layer output nodes number: 20867
edges number: 115687
input nodes number: 20867
output nodes number: 11586
edges number: 76538
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.1426424980163574  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.1426429748535156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0338892936706543  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 3 input nodes size: 36196
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.029596805572509766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.029596805572509766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04685640335083008  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046942710876464844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03029346466064453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03167915344238281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03167915344238281  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 36196
first layer output nodes number: 21505
edges number: 115570
input nodes number: 21505
output nodes number: 11572
edges number: 70347
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.056213855743408  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.0562143325805664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03435993194580078  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 4 input nodes size: 57175
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030181884765625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030181884765625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05744504928588867  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05752897262573242  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040183067321777344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.042075157165527344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.042075157165527344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 57175
first layer output nodes number: 27652
edges number: 175018
input nodes number: 27652
output nodes number: 11236
edges number: 78825
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.655364990234375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.655365467071533  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04610443115234375  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 65617
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04056072235107422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04056072235107422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07184934616088867  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07193231582641602  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044585227966308594  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047095298767089844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047095298767089844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 65617
first layer output nodes number: 34219
edges number: 246787
input nodes number: 34219
output nodes number: 11133
edges number: 89978
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.348489761352539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.3484902381896973  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.051287174224853516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 66900
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04421710968017578  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04421710968017578  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07611751556396484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0762019157409668  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044830322265625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04838275909423828  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04838275909423828  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 66900
first layer output nodes number: 41146
edges number: 334217
input nodes number: 41146
output nodes number: 11288
edges number: 134773
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 4.6636199951171875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 4.663620471954346  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.05462026596069336  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 7 input nodes size: 67188
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04477119445800781  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04477119445800781  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07680892944335938  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07685089111328125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.044866085052490234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.0475316047668457  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.0475316047668457  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67188
first layer output nodes number: 32149
edges number: 271823
input nodes number: 32149
output nodes number: 5628
edges number: 65297
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 3.1429877281188965  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 3.1429882049560547  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.05206918716430664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 8 input nodes size: 48667
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.044022560119628906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.044022560119628906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.06722879409790039  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.06726932525634766  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03518962860107422  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03648185729980469  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03648185729980469  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 48667
first layer output nodes number: 19522
edges number: 135762
input nodes number: 19522
output nodes number: 5407
edges number: 37626
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 1.6956615447998047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 1.695662021636963  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.038883209228515625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.038883209228515625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.038883209228515625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.025157716539171007 |0.003960900836520725 |0.13525369432237414 |0.00014416376749674478 |0.1351628303527832 |0.007353544235229492 |
----------------------------------------------------------pseudo_mini_loss sum 5.072589874267578
Total (block generation + training)time/epoch 33.9443256855011
Training time/epoch 2.758763551712036
Training time without block to device /epoch 2.7231154441833496
Training time without total dataloading part /epoch 2.442399740219116
load block tensor time/epoch 0.22641944885253906
block to device time/epoch 0.03564810752868652
input features size transfer per epoch 1.2069940567016602e-06
blocks size to device per epoch 8.046627044677734e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  685249
Number of first layer input nodes during this epoch:  446381
Number of first layer output nodes during this epoch:  238868
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03888273239135742  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.0265200138092041
global_2_local spend time (sec) 0.04852437973022461
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004343986511230469
A = g.adjacency_matrix() spent  0.008210420608520508
auxiliary_graph
Graph(num_nodes=154715, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.16833806037902832
remove nodes length
63774
auxiliary_graph.remove_nodes spent  1.415189504623413
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.2391979694366455

the counter of shared neighbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})[23:01:43] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29010640 edges into 8 parts and get 4421747 edge cuts
[23:01:51] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 4262908 edges into 2 parts and get 539989 edge cuts

29010640
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29010637, 29010638, 29010639])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})
Convert a graph into a bidirected graph: 2.106 seconds
Metis partitioning: 6.235 seconds
Split the graph: 2.871 seconds
Construct subgraphs: 0.032 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  11.259023904800415
11392
11209
11035
11616
11176
11420
11530
11563
total k batches seeds list generation spend  23.230005264282227
after graph partition
graph partition algorithm spend time 23.34220600128174
11392
11209
11035
11616
11176
11420
11530
11563
partition_len_list
[26374, 32135, 46213, 42054, 19441, 20683, 20879, 20583]
shared_neighbor_graph_partition_s0 selection method  spend 23.45082378387451
time for parepare:  0.018517255783081055
local_output_nid generation:  0.0017921924591064453
local_in_edges_tensor generation:  0.0023581981658935547
mini_batch_src_global generation:  0.0043621063232421875
r_  generation:  0.036980390548706055
local_output_nid generation:  0.002310037612915039
local_in_edges_tensor generation:  0.0022249221801757812
mini_batch_src_global generation:  0.004346132278442383
r_  generation:  0.034064531326293945
local_output_nid generation:  0.002360105514526367
local_in_edges_tensor generation:  0.0025627613067626953
mini_batch_src_global generation:  0.005300045013427734
r_  generation:  0.05567169189453125
local_output_nid generation:  0.0029938220977783203
local_in_edges_tensor generation:  0.002435922622680664
mini_batch_src_global generation:  0.006701469421386719
r_  generation:  0.05735015869140625
local_output_nid generation:  0.0026831626892089844
local_in_edges_tensor generation:  0.002174854278564453
mini_batch_src_global generation:  0.004700660705566406
r_  generation:  0.03884387016296387
local_output_nid generation:  0.0024874210357666016
local_in_edges_tensor generation:  0.002452373504638672
mini_batch_src_global generation:  0.004317283630371094
r_  generation:  0.041222572326660156
local_output_nid generation:  0.003256082534790039
local_in_edges_tensor generation:  0.005112171173095703
mini_batch_src_global generation:  0.003846406936645508
r_  generation:  0.03498196601867676
local_output_nid generation:  0.0024247169494628906
local_in_edges_tensor generation:  0.002352476119995117
mini_batch_src_global generation:  0.0025701522827148438
r_  generation:  0.028923511505126953
----------------------check_connections_block total spend ----------------------------- 0.4894845485687256
generate_one_block  0.05915379524230957
generate_one_block  0.09054422378540039
generate_one_block  0.0829930305480957
generate_one_block  0.08502531051635742
generate_one_block  0.052565813064575195
generate_one_block  0.050321102142333984
generate_one_block  0.045467376708984375
generate_one_block  0.041049957275390625
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.04257965087890625
gen group dst list time:  0.0076258182525634766
time for parepare:  0.024142980575561523
local_output_nid generation:  0.00455927848815918
local_in_edges_tensor generation:  0.01615285873413086
mini_batch_src_global generation:  0.007375001907348633
r_  generation:  0.07778787612915039
local_output_nid generation:  0.008003473281860352
local_in_edges_tensor generation:  0.010046720504760742
mini_batch_src_global generation:  0.00919198989868164
r_  generation:  0.09858059883117676
local_output_nid generation:  0.010679244995117188
local_in_edges_tensor generation:  0.01421976089477539
mini_batch_src_global generation:  0.013377189636230469
r_  generation:  0.15384387969970703
local_output_nid generation:  0.009278297424316406
local_in_edges_tensor generation:  0.009266376495361328
mini_batch_src_global generation:  0.014368534088134766
r_  generation:  0.14363622665405273
local_output_nid generation:  0.004637002944946289
local_in_edges_tensor generation:  0.004130363464355469
mini_batch_src_global generation:  0.0070037841796875
r_  generation:  0.05584597587585449
local_output_nid generation:  0.004542112350463867
local_in_edges_tensor generation:  0.0047223567962646484
mini_batch_src_global generation:  0.0052988529205322266
r_  generation:  0.05570864677429199
local_output_nid generation:  0.0044231414794921875
local_in_edges_tensor generation:  0.004223346710205078
mini_batch_src_global generation:  0.005022764205932617
r_  generation:  0.05501580238342285
local_output_nid generation:  0.004294395446777344
local_in_edges_tensor generation:  0.0045092105865478516
mini_batch_src_global generation:  0.004546642303466797
r_  generation:  0.04978775978088379
----------------------check_connections_block total spend ----------------------------- 1.0311992168426514
generate_one_block  0.10402107238769531
generate_one_block  0.12678885459899902
generate_one_block  0.2037510871887207
generate_one_block  0.19022560119628906
generate_one_block  0.0689094066619873
generate_one_block  0.0704643726348877
generate_one_block  0.06781005859375
generate_one_block  0.060451507568359375
global_2_local spend time (sec) 0.010597467422485352
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.001318216323852539
A = g.adjacency_matrix() spent  0.0014145374298095703
auxiliary_graph
Graph(num_nodes=46213, num_edges=4273943,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.030277490615844727
remove nodes length
35178
auxiliary_graph.remove_nodes spent  0.22513222694396973
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=4273943,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.19821381568908691

the counter of shared neighbor distribution
Counter({1.0: 3672588, 2.0: 464482, 3.0: 91468, 4.0: 22700, 5.0: 7100, 6.0: 2590, 7.0: 1130, 8.0: 440, 9.0: 184, 10.0: 92, 11.0: 70, 12.0: 34, 13.0: 20, 14.0: 6, 17.0: 2, 15.0: 2})
4262908
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------
Convert a graph into a bidirected graph: 0.182 seconds
Metis partitioning: 0.466 seconds
Split the graph: 0.561 seconds
Construct subgraphs: 0.060 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  1.272859811782837
5454
5581
total k batches seeds list generation spend  2.562652587890625
after graph partition
graph partition algorithm spend time 2.624584913253784
5454
5581
time for parepare:  0.03550553321838379
local_output_nid generation:  0.0012204647064208984
local_in_edges_tensor generation:  0.0023322105407714844
mini_batch_src_global generation:  0.005425930023193359
r_  generation:  0.027598142623901367
local_output_nid generation:  0.0012364387512207031
local_in_edges_tensor generation:  0.0022590160369873047
mini_batch_src_global generation:  0.003845691680908203
r_  generation:  0.031981468200683594
----------------------check_connections_block total spend ----------------------------- 0.13614678382873535
generate_one_block  0.03004002571105957
generate_one_block  0.0827336311340332
time for parepare:  0.033545494079589844
local_output_nid generation:  0.004445791244506836
local_in_edges_tensor generation:  0.006629228591918945
mini_batch_src_global generation:  0.008324861526489258
r_  generation:  0.07790040969848633
local_output_nid generation:  0.01299428939819336
local_in_edges_tensor generation:  0.013097047805786133
mini_batch_src_global generation:  0.012918472290039062
r_  generation:  0.11604022979736328
----------------------check_connections_block total spend ----------------------------- 0.34711456298828125
generate_one_block  0.10904288291931152
generate_one_block  0.1541898250579834
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03888273239135742  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

connection checking time:  1.0311992168426514
block generation total time  0.8924219608306885
average batch blocks generation time:  0.11155274510383606
block dataloader generation time/epoch 30.646904826164246
pseudo mini batch 0 input nodes size: 55004
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.0351557731628418  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.0351557731628418  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.061383724212646484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.06146860122680664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03822183609008789  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04015684127807617  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04015684127807617  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 55004
first layer output nodes number: 26374
edges number: 171982
input nodes number: 26374
output nodes number: 11392
edges number: 87646
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 2.740555763244629  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 2.7405567169189453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.044919490814208984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 1 input nodes size: 67100
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03926706314086914  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.03926706314086914  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07126283645629883  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07134675979614258  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.045033931732177734  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04721212387084961  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.04721212387084961  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67100
first layer output nodes number: 32135
edges number: 217107
input nodes number: 32135
output nodes number: 11209
edges number: 75056
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 2.908918857574463  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 2.908919334411621  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.051471710205078125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 2 input nodes size: 68030
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.045209407806396484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.045209407806396484  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07841253280639648  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.07849931716918945  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.046419620513916016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.05091714859008789  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3056640625 GB
    Memory Allocated: 0.05091714859008789  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 68030
first layer output nodes number: 42054
edges number: 342049
input nodes number: 42054
output nodes number: 11616
edges number: 139569
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.4697265625 GB
    Memory Allocated: 4.809362888336182  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.4697265625 GB
    Memory Allocated: 4.80936336517334  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.057288169860839844  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

pseudo mini batch 3 input nodes size: 33530
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04633378982543945  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04633378982543945  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.062322139739990234  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.06240558624267578  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.029115676879882812  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03069305419921875  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03069305419921875  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 33530
first layer output nodes number: 19441
edges number: 121421
input nodes number: 19441
output nodes number: 11176
edges number: 90221
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.3611955642700195  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.3611960411071777  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03351640701293945  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

pseudo mini batch 4 input nodes size: 32974
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.028879165649414062  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.028879165649414062  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.044602394104003906  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.044687747955322266  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.028615951538085938  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.0302581787109375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.0302581787109375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 32974
first layer output nodes number: 20683
edges number: 128027
input nodes number: 20683
output nodes number: 11420
edges number: 92201
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.4529476165771484  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.4529480934143066  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03411865234375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

pseudo mini batch 5 input nodes size: 34800
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.029308795928955078  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.029308795928955078  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.046443939208984375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04653024673461914  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.030721664428710938  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.032233238220214844  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.032233238220214844  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 34800
first layer output nodes number: 20879
edges number: 121008
input nodes number: 20879
output nodes number: 11530
edges number: 81777
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.249396800994873  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.2493972778320312  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.0352320671081543  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

pseudo mini batch 6 input nodes size: 35672
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.030742168426513672  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.030742168426513672  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04832029342651367  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04840660095214844  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.031185150146484375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.032444000244140625  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.032444000244140625  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 35672
first layer output nodes number: 20583
edges number: 105515
input nodes number: 20583
output nodes number: 11563
edges number: 63297
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 1.8820009231567383  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 1.8820013999938965  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03448677062988281  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes
Using backend: pytorch

pseudo mini batch 7 input nodes size: 51266
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.030640602111816406  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.030640602111816406  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.05508613586425781  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.05512714385986328  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.037462711334228516  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03910398483276367  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.03910398483276367  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 51266
first layer output nodes number: 23040
edges number: 174257
input nodes number: 23040
output nodes number: 5454
edges number: 45832
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.0971951484680176  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 2.097195625305176  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04098844528198242  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

pseudo mini batch 8 input nodes size: 65100
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.036403656005859375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.036403656005859375  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.06744575500488281  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.06748771667480469  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04300117492675781  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04567432403564453  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.04567432403564453  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

first layer input nodes number: 65100
first layer output nodes number: 32103
edges number: 273185
input nodes number: 32103
output nodes number: 5581
edges number: 68651
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 3.1971821784973145  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 3.1971826553344727  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.05002021789550781  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.05002021789550781  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.6044921875 GB
    Memory Allocated: 0.05002021789550781  GigaBytes
Max Memory Allocated: 5.004482746124268  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.02333921856350369 |0.003606875737508138 |0.12386637263827854 |0.00012977917989095053 |0.17019687758551705 |0.0069386959075927734 |
----------------------------------------------------------pseudo_mini_loss sum 3.8043267726898193
Total (block generation + training)time/epoch 33.5060875415802
Training time/epoch 2.959061861038208
Training time without block to device /epoch 2.9265999794006348
Training time without total dataloading part /epoch 2.6546759605407715
load block tensor time/epoch 0.2100529670715332
block to device time/epoch 0.03246188163757324
input features size transfer per epoch 1.2069940567016602e-06
blocks size to device per epoch 8.046627044677734e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  680768
Number of first layer input nodes during this epoch:  443476
Number of first layer output nodes during this epoch:  237292
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(128, 128, batch_first=True)
      (fc_self): Linear(in_features=128, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (lstm): LSTM(256, 256, batch_first=True)
      (fc_self): Linear(in_features=256, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=40, bias=False)
    )
  )
  (bns): ModuleList(
    (0): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size  744960
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([512, 128])
layers.0.lstm.weight_hh_l0, torch.Size([512, 128])
layers.0.lstm.bias_ih_l0, torch.Size([512])
layers.0.lstm.bias_hh_l0, torch.Size([512])
layers.0.fc_self.weight, torch.Size([256, 128])
layers.0.fc_neigh.weight, torch.Size([256, 128])
layers.1.lstm.weight_ih_l0, torch.Size([1024, 256])
layers.1.lstm.weight_hh_l0, torch.Size([1024, 256])
layers.1.lstm.bias_ih_l0, torch.Size([1024])
layers.1.lstm.bias_hh_l0, torch.Size([1024])
layers.1.fc_self.weight, torch.Size([40, 256])
layers.1.fc_neigh.weight, torch.Size([40, 256])
bns.0.weight, torch.Size([256])
bns.0.bias, torch.Size([256])
----------------------------------------
un-trainable parameters
