[23:21:15] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 28961398 edges into 8 parts and get 4598647 edge cuts
main start at this time 1652224851.2161508
-----------------------------------------before load data 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

ogbn-arxiv
# Nodes: 169343
# Edges: 2315598
# Train: 90941
# Val: 29799
# Test: 48603
# Classes: 40

----------------------------------------start of run function 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

in feats:  128
----------------------------------------before model to device 
 Nvidia-smi: 0.2607421875 GB
    Memory Allocated: 0.0  GigaBytes
Max Memory Allocated: 0.0  GigaBytes

----------------------------------------after model to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before generate dataloader block 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.019952774047851562
global_2_local spend time (sec) 0.04447364807128906
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004525423049926758
A = g.adjacency_matrix() spent  0.005969524383544922
auxiliary_graph
Graph(num_nodes=154710, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.150956392288208
remove nodes length
63769
auxiliary_graph.remove_nodes spent  1.5295932292938232
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29052339,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.2941789627075195

the counter of shared neighbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
28961398
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 28961395, 28961396, 28961397])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23396418, 2.0: 4042542, 3.0: 1009392, 4.0: 305652, 5.0: 111008, 6.0: 48054, 7.0: 22158, 8.0: 11680, 9.0: 5998, 10.0: 3494, 11.0: 1958, 12.0: 1128, 13.0: 668, 14.0: 442, 15.0: 276, 16.0: 212, 17.0: 174, 18.0: 66, 19.0: 58, 20.0: 10, 21.0: 6, 22.0: 4})
Convert a graph into a bidirected graph: 2.018 seconds
Metis partitioning: 5.742 seconds
Split the graph: 2.218 seconds
Construct subgraphs: 0.063 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  10.055015325546265
11436
11456
11522
11580
11035
11283
11508
11121
total k batches seeds list generation spend  22.19520092010498
after graph partition
graph partition algorithm spend time 22.363377809524536
11436
11456
11522
11580
11035
11283
11508
11121
partition_len_list
[19376, 21264, 21136, 20917, 48032, 41430, 27887, 33663]
shared_neighbor_graph_partition_s0 selection method  spend 22.488781213760376
time for parepare:  0.028279781341552734
local_output_nid generation:  0.001975536346435547
local_in_edges_tensor generation:  0.0023145675659179688
mini_batch_src_global generation:  0.003901243209838867
r_  generation:  0.03720498085021973
local_output_nid generation:  0.0021483898162841797
local_in_edges_tensor generation:  0.0025107860565185547
mini_batch_src_global generation:  0.003937482833862305
r_  generation:  0.03976631164550781
local_output_nid generation:  0.0023436546325683594
local_in_edges_tensor generation:  0.002091646194458008
mini_batch_src_global generation:  0.0029382705688476562
r_  generation:  0.03045964241027832
local_output_nid generation:  0.002198457717895508
local_in_edges_tensor generation:  0.0020825862884521484
mini_batch_src_global generation:  0.002990245819091797
r_  generation:  0.035275936126708984
local_output_nid generation:  0.0038809776306152344
local_in_edges_tensor generation:  0.0029218196868896484
mini_batch_src_global generation:  0.004845142364501953
r_  generation:  0.04916858673095703
local_output_nid generation:  0.002407550811767578
local_in_edges_tensor generation:  0.0038042068481445312
mini_batch_src_global generation:  0.006309032440185547
r_  generation:  0.08276605606079102
local_output_nid generation:  0.003628253936767578
local_in_edges_tensor generation:  0.0030336380004882812
mini_batch_src_global generation:  0.004914760589599609
r_  generation:  0.057201385498046875
local_output_nid generation:  0.003317117691040039
local_in_edges_tensor generation:  0.0029268264770507812
mini_batch_src_global generation:  0.0043294429779052734
r_  generation:  0.0514063835144043
----------------------check_connections_block total spend ----------------------------- 0.5623271465301514
generate_one_block  0.08255362510681152
generate_one_block  0.07322025299072266
generate_one_block  0.057225942611694336
generate_one_block  0.06358003616333008
generate_one_block  0.10409283638000488
generate_one_block  0.08177638053894043
generate_one_block  0.04544472694396973
generate_one_block  0.04887270927429199
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.041651248931884766
gen group dst list time:  0.007748126983642578
time for parepare:  0.026561737060546875
local_output_nid generation:  0.0028362274169921875
local_in_edges_tensor generation:  0.022069692611694336
mini_batch_src_global generation:  0.0046520233154296875
r_  generation:  0.054120540618896484
local_output_nid generation:  0.004900217056274414
local_in_edges_tensor generation:  0.004876136779785156
mini_batch_src_global generation:  0.005656719207763672
r_  generation:  0.05900931358337402
local_output_nid generation:  0.004837512969970703
local_in_edges_tensor generation:  0.004088401794433594
mini_batch_src_global generation:  0.004245281219482422
r_  generation:  0.05182957649230957
local_output_nid generation:  0.00447392463684082
local_in_edges_tensor generation:  0.003928422927856445
mini_batch_src_global generation:  0.006478786468505859
r_  generation:  0.053353309631347656
local_output_nid generation:  0.010791301727294922
local_in_edges_tensor generation:  0.013218164443969727
mini_batch_src_global generation:  0.014290094375610352
r_  generation:  0.16522669792175293
local_output_nid generation:  0.008652687072753906
local_in_edges_tensor generation:  0.013256072998046875
mini_batch_src_global generation:  0.014339923858642578
r_  generation:  0.14073491096496582
local_output_nid generation:  0.006474494934082031
local_in_edges_tensor generation:  0.006611824035644531
mini_batch_src_global generation:  0.024165630340576172
r_  generation:  0.08225178718566895
local_output_nid generation:  0.008669614791870117
local_in_edges_tensor generation:  0.012799263000488281
mini_batch_src_global generation:  0.011561393737792969
r_  generation:  0.10356020927429199
----------------------check_connections_block total spend ----------------------------- 1.098884105682373
generate_one_block  0.07687878608703613
generate_one_block  0.07216691970825195
generate_one_block  0.06450557708740234
generate_one_block  0.06479310989379883
generate_one_block  0.20757174491882324
generate_one_block  0.18377685546875
generate_one_block  0.0980684757232666
generate_one_block  0.12818098068237305
global_2_local spend time (sec) 0.01040339469909668
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0058972835540771484
A = g.adjacency_matrix() spent  0.0015201568603515625
auxiliary_graph
Graph(num_nodes=48032, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent [23:21:23] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 3872734 edges into 2 parts and get 430597 edge cuts
 0.043672800064086914
remove nodes length
36997
auxiliary_graph.remove_nodes spent  0.14694714546203613
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=3883769,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.15555357933044434

the counter of shared neighbor distribution
Counter({1.0: 3357116, 2.0: 408566, 3.0: 77052, 4.0: 19494, 5.0: 6250, 6.0: 2292, 7.0: 934, 8.0: 530, 9.0: 198, 10.0: 124, 11.0: 70, 12.0: 40, 13.0: 28, 14.0: 20, 15.0: 8, 17.0: 6, 20.0: 2, 18.0: 2, 16.0: 2})
3872734
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([      0,       1,       2,  ..., 3872731, 3872732, 3872733])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 3357116, 2.0: 408566, 3.0: 77052, 4.0: 19494, 5.0: 6250, 6.0: 2292, 7.0: 934, 8.0: 530, 9.0: 198, 10.0: 124, 11.0: 70, 12.0: 40, 13.0: 28, 14.0: 20, 15.0: 8, 17.0: 6, 20.0: 2, 18.0: 2, 16.0: 2})
Convert a graph into a bidirected graph: 0.171 seconds
Metis partitioning: 0.452 seconds
Split the graph: 0.326 seconds
Construct subgraphs: 0.028 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.9825201034545898
5475
5560
total k batches seeds list generation spend  2.754279851913452
after graph partition
graph partition algorithm spend time 2.7816317081451416
5475
5560
time for parepare:  0.021930932998657227
local_output_nid generation:  0.0008153915405273438
local_in_edges_tensor generation:  0.0042476654052734375
mini_batch_src_global generation:  0.002897024154663086
r_  generation:  0.021372318267822266
local_output_nid generation:  0.0010673999786376953
local_in_edges_tensor generation:  0.0016236305236816406
mini_batch_src_global generation:  0.003698587417602539
r_  generation:  0.026085615158081055
----------------------check_connections_block total spend ----------------------------- 0.09828543663024902
generate_one_block  0.038056135177612305
generate_one_block  0.03817033767700195
time for parepare:  0.02178215980529785
local_output_nid generation:  0.003394603729248047
local_in_edges_tensor generation:  0.009896039962768555
mini_batch_src_global generation:  0.018735647201538086
r_  generation:  0.08102583885192871
local_output_nid generation:  0.008350610733032227
local_in_edges_tensor generation:  0.013576030731201172
mini_batch_src_global generation:  0.011937141418457031
r_  generation:  0.11018013954162598
----------------------check_connections_block total spend ----------------------------- 0.3288881778717041
generate_one_block  0.10780596733093262
generate_one_block  0.15676045417785645
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

connection checking time:  1.098884105682373
block generation total time  0.8959424495697021
average batch blocks generation time:  0.11199280619621277
pseudo mini batch 0 input nodes size: 33053
----------------------------------------before load block subtensor 
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 0.8232421875 GB
    Memory Allocated: 0.002777576446533203  GigaBytes
Max Memory Allocated: 0.002777576446533203  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018538475036621094  GigaBytes
Max Memory Allocated: 0.018538475036621094  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 0.8408203125 GB
    Memory Allocated: 0.018623828887939453  GigaBytes
Max Memory Allocated: 0.018623828887939453  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 0.8916015625 GB
    Memory Allocated: 0.020238399505615234  GigaBytes
Max Memory Allocated: 0.020238399505615234  GigaBytes

first layer input nodes number: 33053
first layer output nodes number: 19376
edges number: 122818
input nodes number: 19376
output nodes number: 11436
edges number: 93717
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.420609951019287  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.4970703125 GB
    Memory Allocated: 2.4206109046936035  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.02784109115600586  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

pseudo mini batch 1 input nodes size: 33722
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023104190826416016  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.0391840934753418  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.039269447326660156  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.023423194885253906  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6806640625 GB
    Memory Allocated: 0.025076866149902344  GigaBytes
Max Memory Allocated: 2.5286874771118164  GigaBytes

first layer input nodes number: 33722
first layer output nodes number: 21264
edges number: 130063
input nodes number: 21264
output nodes number: 11456
edges number: 91731
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621076583862305  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.6826171875 GB
    Memory Allocated: 2.4621081352233887  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028455734252929688  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 2 input nodes size: 38652
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02360820770263672  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.042038917541503906  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04212522506713867  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02595996856689453  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02735424041748047  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 38652
first layer output nodes number: 21136
edges number: 116620
input nodes number: 21136
output nodes number: 11522
edges number: 70352
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436105728149414  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.0436110496520996  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.030178070068359375  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 3 input nodes size: 34793
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02597332000732422  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04256391525268555  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04265022277832031  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.02413320541381836  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.025601863861083984  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 34793
first layer output nodes number: 20917
edges number: 119121
input nodes number: 20917
output nodes number: 11580
edges number: 77943
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798105239868164  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 2.1798110008239746  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.028331756591796875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

pseudo mini batch 4 input nodes size: 67485
----------------------------------------before load block subtensor 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.023956298828125  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.05613565444946289  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.056220054626464844  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.03954315185546875  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 3.7705078125 GB
    Memory Allocated: 0.04364347457885742  GigaBytes
Max Memory Allocated: 2.570709228515625  GigaBytes

first layer input nodes number: 67485
first layer output nodes number: 41430
edges number: 337279
input nodes number: 41430
output nodes number: 11283
edges number: 136210
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997467041016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.0419921875 GB
    Memory Allocated: 4.705997943878174  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05006885528564453  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 56582
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039841651916503906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06682205200195312  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06690788269042969  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034644126892089844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03657722473144531  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56582
first layer output nodes number: 27887
edges number: 176606
input nodes number: 27887
output nodes number: 11508
edges number: 82704
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.711897850036621  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.7118983268737793  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040024757385253906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 70027
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03436708450317383  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06775856018066406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0678415298461914  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.040775299072265625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043048858642578125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.043048858642578125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 70027
first layer output nodes number: 33663
edges number: 229935
input nodes number: 33663
output nodes number: 11121
edges number: 75016
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0054659843444824  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.0054664611816406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047191619873046875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 7 input nodes size: 56613
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04068565368652344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04068565368652344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06768083572387695  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06772184371948242  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.034247398376464844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0360870361328125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0360870361328125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 56613
first layer output nodes number: 24889
edges number: 195166
input nodes number: 24889
output nodes number: 5475
edges number: 51650
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.3355870246887207  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.335587501525879  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.038510799407958984  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 8 input nodes size: 68039
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03340578079223633  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03340578079223633  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.06660890579223633  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.066650390625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039614200592041016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04212045669555664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04212045669555664  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 68039
first layer output nodes number: 32269
edges number: 271293
input nodes number: 32269
output nodes number: 5560
edges number: 64927
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.1360602378845215  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.1360607147216797  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04690265655517578  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.052453041076660156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.052453041076660156  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.026218308342827693 |0.04750710063510471 |0.17440666092766655 |0.00013952785068088106 |0.13284683227539062 |0.00870370864868164 |
----------------------------------------------------------pseudo_mini_loss sum 5.290076732635498[23:21:49] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29070896 edges into 8 parts and get 4586068 edge cuts

 Run 0| Epoch 0 |
Number of nodes for computation during this epoch:  701797
Number of first layer input nodes during this epoch:  458966
Number of first layer output nodes during this epoch:  242831
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05245256423950195  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

The real block id is  1
get_global_graph_edges_ids_block function  spend 0.030553817749023438
global_2_local spend time (sec) 0.0724945068359375
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.00707244873046875
A = g.adjacency_matrix() spent  0.007222175598144531
auxiliary_graph
Graph(num_nodes=154609, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.10781359672546387
remove nodes length
63668
auxiliary_graph.remove_nodes spent  1.4922332763671875
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29161837,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.2655091285705566

the counter of shared neighbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
29070896
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29070893, 29070894, 29070895])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23512832, 2.0: 4033528, 3.0: 1010720, 4.0: 307066, 5.0: 110996, 6.0: 47742, 7.0: 21964, 8.0: 11366, 9.0: 6212, 10.0: 3480, 11.0: 1996, 12.0: 1116, 13.0: 654, 14.0: 456, 15.0: 268, 16.0: 194, 17.0: 166, 18.0: 66, 19.0: 50, 20.0: 18, 21.0: 6})
Convert a graph into a bidirected graph: 1.994 seconds
Metis partitioning: 6.172 seconds
Split the graph: 2.444 seconds
Construct subgraphs: 0.031 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  10.654740810394287
11584
11558
11278
11547
11244
11194
11035
11501
total k batches seeds list generation spend  24.05854558944702
after graph partition
graph partition algorithm spend time 24.158101797103882
11584
11558
11278
11547
11244
11194
11035
11501
partition_len_list
[19383, 22990, 20077, 20984, 27007, 34637, 45398, 41920]
shared_neighbor_graph_partition_s0 selection method  spend 24.294992446899414
time for parepare:  0.01902604103088379
local_output_nid generation:  0.0017812252044677734
local_in_edges_tensor generation:  0.002252817153930664
mini_batch_src_global generation:  0.0027832984924316406
r_  generation:  0.030142545700073242
local_output_nid generation:  0.002073049545288086
local_in_edges_tensor generation:  0.0020771026611328125
mini_batch_src_global generation:  0.0034241676330566406
r_  generation:  0.03400921821594238
local_output_nid generation:  0.0021181106567382812
local_in_edges_tensor generation:  0.0024335384368896484
mini_batch_src_global generation:  0.003823995590209961
r_  generation:  0.03717851638793945
local_output_nid generation:  0.0024268627166748047
local_in_edges_tensor generation:  0.0024449825286865234
mini_batch_src_global generation:  0.0040361881256103516
r_  generation:  0.039200544357299805
local_output_nid generation:  0.0023775100708007812
local_in_edges_tensor generation:  0.002031564712524414
mini_batch_src_global generation:  0.003142118453979492
r_  generation:  0.03392148017883301
local_output_nid generation:  0.0023567676544189453
local_in_edges_tensor generation:  0.0025017261505126953
mini_batch_src_global generation:  0.003761768341064453
r_  generation:  0.03935813903808594
local_output_nid generation:  0.0023484230041503906
local_in_edges_tensor generation:  0.0026116371154785156
mini_batch_src_global generation:  0.004220485687255859
r_  generation:  0.04189443588256836
local_output_nid generation:  0.002536773681640625
local_in_edges_tensor generation:  0.002651691436767578
mini_batch_src_global generation:  0.005940914154052734
r_  generation:  0.0631859302520752
----------------------check_connections_block total spend ----------------------------- 0.4722011089324951
generate_one_block  0.06686782836914062
generate_one_block  0.07337760925292969
generate_one_block  0.08423757553100586
generate_one_block  0.0776052474975586
generate_one_block  0.06831550598144531
generate_one_block  0.0827629566192627
generate_one_block  0.0881502628326416
generate_one_block  0.11775422096252441
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.041855573654174805
gen group dst list time:  0.007893562316894531
time for parepare:  0.026690959930419922
local_output_nid generation:  0.0033540725708007812
local_in_edges_tensor generation:  0.0160980224609375
mini_batch_src_global generation:  0.00399327278137207
r_  generation:  0.047136783599853516
local_output_nid generation:  0.006586313247680664
local_in_edges_tensor generation:  0.006277561187744141
mini_batch_src_global generation:  0.014637947082519531
r_  generation:  0.10940122604370117
local_output_nid generation:  0.006754398345947266
local_in_edges_tensor generation:  0.0064241886138916016
mini_batch_src_global generation:  0.0069386959075927734
r_  generation:  0.0744931697845459
local_output_nid generation:  0.005122661590576172
local_in_edges_tensor generation:  0.004075765609741211
mini_batch_src_global generation:  0.005983114242553711
r_  generation:  0.05707740783691406
local_output_nid generation:  0.00630497932434082
local_in_edges_tensor generation:  0.0070226192474365234
mini_batch_src_global generation:  0.007177591323852539
r_  generation:  0.07536792755126953
local_output_nid generation:  0.007763862609863281
local_in_edges_tensor generation:  0.00882577896118164
mini_batch_src_global generation:  0.01031637191772461
r_  generation:  0.10743260383605957
local_output_nid generation:  0.010254144668579102
local_in_edges_tensor generation:  0.013950109481811523
mini_batch_src_global generation:  0.015042304992675781
r_  generation:  0.14834856986999512
local_output_nid generation:  0.0087890625
local_in_edges_tensor generation:  0.011112213134765625
mini_batch_src_global generation:  0.015148639678955078
r_  generation:  0.14677762985229492
----------------------check_connections_block total spend ----------------------------- 1.1682732105255127
generate_one_block  0.05841422080993652
generate_one_block  0.07625341415405273
generate_one_block  0.07236099243164062
generate_one_block  0.07225775718688965
generate_one_block  0.11058998107910156
generate_one_block  0.14197754859924316
generate_one_block  0.1967940330505371
generate_one_block  0.1870272159576416
global_2_local spend time (sec) 0.010492324829101562
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0011835098266601562
A = g.adjacency_matrix() spent  0.001298666000366211
auxiliary_graph
Graph(num_nodes=45398, num_edges=2854529,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.03009176254272461
remove nodes length
34363
auxiliary_graph.remove_nodes spent  0.10890698432922363
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=2854529,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.11050629615783691

the counter of shared neighbor distribution
Counter({1.0: 2544416, 2.0: 239654, 3.0: 42048, 4.0: 10860, 5.0: 3590, 6.0: 1502, 7.0: 692, 8.0: 382, 9.0: 158, 10.0: 96, 11.0: 46, 12.0: 24, 14.0: 12, 13.0: 10, 15.0: 2, 17.0: 2})
2843494
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------[23:21:57] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 2843494 edges into 2 parts and get 41685 edge cuts


before step function auxiliary_graph_no_diag.edata[w]

tensor([      0,       1,       2,  ..., 2843491, 2843492, 2843493])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 2544416, 2.0: 239654, 3.0: 42048, 4.0: 10860, 5.0: 3590, 6.0: 1502, 7.0: 692, 8.0: 382, 9.0: 158, 10.0: 96, 11.0: 46, 12.0: 24, 14.0: 12, 13.0: 10, 15.0: 2, 17.0: 2})
Convert a graph into a bidirected graph: 0.127 seconds
Metis partitioning: 0.301 seconds
Split the graph: 0.397 seconds
Construct subgraphs: 0.032 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  0.8605062961578369
5493
5542
total k batches seeds list generation spend  2.304022789001465
after graph partition
graph partition algorithm spend time 2.3330397605895996
5493
5542
time for parepare:  0.032663822174072266
local_output_nid generation:  0.0013072490692138672
local_in_edges_tensor generation:  0.005484819412231445
mini_batch_src_global generation:  0.0018563270568847656
r_  generation:  0.017949581146240234
local_output_nid generation:  0.0010013580322265625
local_in_edges_tensor generation:  0.0015451908111572266
mini_batch_src_global generation:  0.0030059814453125
r_  generation:  0.025281429290771484
----------------------check_connections_block total spend ----------------------------- 0.10575628280639648
generate_one_block  0.03319358825683594
generate_one_block  0.04071331024169922
time for parepare:  0.024273157119750977
local_output_nid generation:  0.003264188766479492
local_in_edges_tensor generation:  0.008384227752685547
mini_batch_src_global generation:  0.00457763671875
r_  generation:  0.05122065544128418
local_output_nid generation:  0.008918285369873047
local_in_edges_tensor generation:  0.008476018905639648
mini_batch_src_global generation:  0.01085042953491211
r_  generation:  0.12363624572753906
----------------------check_connections_block total spend ----------------------------- 0.2915828227996826
generate_one_block  0.07885003089904785
generate_one_block  0.15260052680969238
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05245256423950195  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

connection checking time:  1.1682732105255127
block generation total time  0.915675163269043
average batch blocks generation time:  0.11445939540863037
block dataloader generation time/epoch 30.796801328659058
pseudo mini batch 0 input nodes size: 30717
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04517650604248047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04517650604248047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05982351303100586  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.059909820556640625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.026665210723876953  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027930736541748047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027930736541748047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 30717
first layer output nodes number: 19383
edges number: 100245
input nodes number: 19383
output nodes number: 11584
edges number: 69421
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.9147710800170898  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 1.9147720336914062  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03161764144897461  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 1 input nodes size: 40546
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027776241302490234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.027776241302490234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047307491302490234  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.047393798828125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.032660484313964844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03427314758300781  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03427314758300781  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 40546
first layer output nodes number: 22990
edges number: 134646
input nodes number: 22990
output nodes number: 11558
edges number: 81717
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.3711462020874023  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.3711466789245605  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.037253379821777344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 2 input nodes size: 36585
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.032471656799316406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.032471656799316406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.050049781799316406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05013418197631836  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030516624450683594  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03215789794921875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03215789794921875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 36585
first layer output nodes number: 20077
edges number: 129662
input nodes number: 20077
output nodes number: 11278
edges number: 90566
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.4331016540527344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.4331021308898926  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.035284996032714844  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 3 input nodes size: 33124
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030478477478027344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030478477478027344  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.046273231506347656  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04635953903198242  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02869701385498047  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030381202697753906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.030381202697753906  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 33124
first layer output nodes number: 20984
edges number: 131109
input nodes number: 20984
output nodes number: 11547
edges number: 94842
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.522193431854248  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.5221939086914062  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.033721923828125  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 4 input nodes size: 55205
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02880096435546875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.02880096435546875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.055124759674072266  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.055208683013916016  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.03932762145996094  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04114723205566406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04114723205566406  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 55205
first layer output nodes number: 27007
edges number: 166537
input nodes number: 27007
output nodes number: 11244
edges number: 77527
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.5634407997131348  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 2.563441276550293  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04479837417602539  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 5 input nodes size: 66603
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039440155029296875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.039440155029296875  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07119894027709961  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07128238677978516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04487466812133789  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04741525650024414  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.04741525650024414  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 66603
first layer output nodes number: 34637
edges number: 250423
input nodes number: 34637
output nodes number: 11194
edges number: 90494
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.388824462890625  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 3.388824939727783  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.05203104019165039  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

pseudo mini batch 6 input nodes size: 67665
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044878482818603516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.044878482818603516  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07808160781860352  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.07816743850708008  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0463252067565918  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0499110221862793  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.1767578125 GB
    Memory Allocated: 0.0499110221862793  GigaBytes
Max Memory Allocated: 4.896666049957275  GigaBytes

first layer input nodes number: 67665
first layer output nodes number: 41920
edges number: 341174
input nodes number: 41920
output nodes number: 11501
edges number: 140027
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.3623046875 GB
    Memory Allocated: 4.799500942230225  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.3623046875 GB
    Memory Allocated: 4.799501419067383  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.05700349807739258  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

pseudo mini batch 7 input nodes size: 40960
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04683256149291992  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04683256149291992  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06636381149291992  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06640481948852539  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03311586380004883  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03424882888793945  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03424882888793945  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

first layer input nodes number: 40960
first layer output nodes number: 17495
edges number: 115936
input nodes number: 17495
output nodes number: 5493
edges number: 35969
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 1.5050582885742188  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 1.505058765411377  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03478860855102539  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

pseudo mini batch 8 input nodes size: 66936
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.031495094299316406  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.031495094299316406  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06341266632080078  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06345415115356445  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.043881893157958984  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.046647071838378906  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.046647071838378906  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

first layer input nodes number: 66936
first layer output nodes number: 31861
edges number: 269681
input nodes number: 31861
output nodes number: 5542
edges number: 63687
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 3.121102809906006  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 3.121103286743164  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.050887107849121094  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.050887107849121094  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.050887107849121094  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.021883116828070745 |0.00452476077609592 |0.11898631519741482 |0.0001220703125 |0.14062566227383083 |0.0042722225189208984 |
----------------------------------------------------------pseudo_mini_loss sum 5.0706377029418945
Total (block generation + training)time/epoch 33.4502534866333
Training time/epoch 2.6531882286071777
Training time without block to device /epoch 2.6124653816223145
Training time without total dataloading part /epoch 2.341878652572632
load block tensor time/epoch 0.19694805145263672
block to device time/epoch 0.04072284698486328
input features size transfer per epoch 1.2069940567016602e-06
blocks size to device per epoch 8.046627044677734e-07
 Run 0| Epoch 1 |
Number of nodes for computation during this epoch:  674695
Number of first layer input nodes during this epoch:  438341
Number of first layer output nodes during this epoch:  236354
----------------------------------------before generate dataloader block 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.05088663101196289  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

The real block id is [23:22:24] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 90941 nodes and 29010640 edges into 8 parts and get 4472343 edge cuts
 1
get_global_graph_edges_ids_block function  spend 0.024716854095458984
global_2_local spend time (sec) 0.0599057674407959
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.004690647125244141
A = g.adjacency_matrix() spent  0.015111923217773438
auxiliary_graph
Graph(num_nodes=154715, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.1076056957244873
remove nodes length
63774
auxiliary_graph.remove_nodes spent  1.706773042678833
after remove non output nodes the auxiliary_graph
Graph(num_nodes=90941, num_edges=29101581,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  1.4163246154785156

the counter of shared neighbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})
29010640
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([       0,        1,        2,  ..., 29010637, 29010638, 29010639])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 23486600, 2.0: 4015792, 3.0: 1001110, 4.0: 300986, 5.0: 109994, 6.0: 47458, 7.0: 22542, 8.0: 11416, 9.0: 6208, 10.0: 3562, 11.0: 1972, 12.0: 1148, 13.0: 654, 14.0: 388, 15.0: 284, 16.0: 206, 17.0: 180, 18.0: 72, 19.0: 50, 20.0: 10, 21.0: 8})
Convert a graph into a bidirected graph: 2.048 seconds
Metis partitioning: 7.880 seconds
Split the graph: 2.735 seconds
Construct subgraphs: 0.035 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  12.713139057159424
11244
11380
11035
11587
11495
11537
11328
11335
total k batches seeds list generation spend  25.226803064346313
after graph partition
graph partition algorithm spend time 25.332679510116577
11244
11380
11035
11587
11495
11537
11328
11335
partition_len_list
[32681, 27197, 46731, 41877, 23451, 19625, 19835, 21177]
shared_neighbor_graph_partition_s0 selection method  spend 25.45491647720337
time for parepare:  0.019762516021728516
local_output_nid generation:  0.0019998550415039062
local_in_edges_tensor generation:  0.002394437789916992
mini_batch_src_global generation:  0.0031278133392333984
r_  generation:  0.032416343688964844
local_output_nid generation:  0.002557516098022461
local_in_edges_tensor generation:  0.002161741256713867
mini_batch_src_global generation:  0.0040972232818603516
r_  generation:  0.03663277626037598
local_output_nid generation:  0.0026443004608154297
local_in_edges_tensor generation:  0.0025129318237304688
mini_batch_src_global generation:  0.004616737365722656
r_  generation:  0.045597076416015625
local_output_nid generation:  0.002926349639892578
local_in_edges_tensor generation:  0.002488851547241211
mini_batch_src_global generation:  0.005927085876464844
r_  generation:  0.05847024917602539
local_output_nid generation:  0.0031523704528808594
local_in_edges_tensor generation:  0.0022788047790527344
mini_batch_src_global generation:  0.003820657730102539
r_  generation:  0.03628182411193848
local_output_nid generation:  0.0029799938201904297
local_in_edges_tensor generation:  0.0021245479583740234
mini_batch_src_global generation:  0.0027866363525390625
r_  generation:  0.02912163734436035
local_output_nid generation:  0.002688884735107422
local_in_edges_tensor generation:  0.0021462440490722656
mini_batch_src_global generation:  0.003221750259399414
r_  generation:  0.03775811195373535
local_output_nid generation:  0.0022890567779541016
local_in_edges_tensor generation:  0.002529144287109375
mini_batch_src_global generation:  0.0035860538482666016
r_  generation:  0.036145687103271484
----------------------check_connections_block total spend ----------------------------- 0.46759796142578125
generate_one_block  0.055062055587768555
generate_one_block  0.049072980880737305
generate_one_block  0.06630825996398926
generate_one_block  0.0794672966003418
generate_one_block  0.045839548110961914
generate_one_block  0.03671622276306152
generate_one_block  0.04911208152770996
generate_one_block  0.04697680473327637
The real block id is  0
get_global_graph_edges_ids_block function  spend 0.03934645652770996
gen group dst list time:  0.007439136505126953
time for parepare:  0.023967981338500977
local_output_nid generation:  0.005456686019897461
local_in_edges_tensor generation:  0.020208120346069336
mini_batch_src_global generation:  0.008098363876342773
r_  generation:  0.10169243812561035
local_output_nid generation:  0.007502555847167969
local_in_edges_tensor generation:  0.007399082183837891
mini_batch_src_global generation:  0.008228778839111328
r_  generation:  0.08803296089172363
local_output_nid generation:  0.012946844100952148
local_in_edges_tensor generation:  0.01839137077331543
mini_batch_src_global generation:  0.014343976974487305
r_  generation:  0.17167305946350098
local_output_nid generation:  0.009081840515136719
local_in_edges_tensor generation:  0.013507604598999023
mini_batch_src_global generation:  0.01596808433532715
r_  generation:  0.16033339500427246
local_output_nid generation:  0.006696939468383789
local_in_edges_tensor generation:  0.0055751800537109375
mini_batch_src_global generation:  0.008503437042236328
r_  generation:  0.06719732284545898
local_output_nid generation:  0.005511760711669922
local_in_edges_tensor generation:  0.004258394241333008
mini_batch_src_global generation:  0.004820823669433594
r_  generation:  0.04661154747009277
local_output_nid generation:  0.005198478698730469
local_in_edges_tensor generation:  0.004252195358276367
mini_batch_src_global generation:  0.005346775054931641
r_  generation:  0.05511927604675293
local_output_nid generation:  0.005621194839477539
local_in_edges_tensor generation:  0.0048847198486328125
mini_batch_src_global generation:  0.005738019943237305
r_  generation:  0.058069705963134766
----------------------check_connections_block total spend ----------------------------- 1.1238181591033936
generate_one_block  0.14499187469482422
generate_one_block  0.10569238662719727
generate_one_block  0.2091081142425537
generate_one_block  0.18942523002624512
generate_one_block  0.07948970794677734
generate_one_block  0.05704784393310547
generate_one_block  0.06881880760192871
generate_one_block  0.07174921035766602
global_2_local spend time (sec) 0.010292768478393555
----------------------------  graph partition start---------------------
g = dgl.graph((u,v))  spent  0.0012011528015136719
A = g.adjacency_matrix() spent  0.0013267993927001953
auxiliary_graph
Graph(num_nodes=46731, num_edges=4062165,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
get remove nodes spent  0.030452251434326172
remove nodes length
35696
auxiliary_graph.remove_nodes spent  0.1588916778564453
after remove non output nodes the auxiliary_graph
Graph(num_nodes=11035, num_edges=4062165,
      ndata_schemes={}
      edata_schemes={'w': Scheme(shape=(), dtype=torch.float32)})
auxiliary_graph_no_diag generation spent  0.13861989974975586

the counter of shared neighbor distribution
Counter({1.0: 3495478, 2.0: 439054, 3.0: 85628, 4.0: 20698, 5.0: 6274, 6.0: 2252, 7.0: 1014, 8.0: 364, 9.0: 180, 10.0: 92, 11.0: 50, 12.0: 20, 13.0: 20, 17.0: 2, 14.0: 2, 15.0: 2})
4051130
--------------------------------------- new test ---------------------
--------------------------------------- new test ---------------------

before step function auxiliary_graph_no_diag.edata[w]

tensor([      0,       1,       2,  ..., 4051127, 4051128, 4051129])
drop no edges

after step function v.2.0 all zero auxiliary_graph_no_diag.edata[w]
the counter of shared neigbor distribution
Counter({1.0: 3495478, 2.0: 439054, 3.0: 85628, 4.0: 20698, 5.0: 6274, 6.0: 2252, 7.0: 1014, 8.0: 364, 9.0: 180, 10.0: 92, 11.0: 50, 12.0: 20, 13.0: 20, 17.0: 2, 14.0: 2, 15.0: 2})[23:22:32] /opt/dgl/src/graph/transform/metis_partition_hetero.cc:78: Partition a graph with 11035 nodes and 4051130 edges into 2 parts and get 358631 edge cuts

Convert a graph into a bidirected graph: 0.176 seconds
Metis partitioning: 0.454 seconds
Split the graph: 0.518 seconds
Construct subgraphs: 0.056 seconds
auxiliary_graph_no_diag dgl.metis_partition spent  1.2076635360717773
5534
5501
total k batches seeds list generation spend  2.8895349502563477
after graph partition
graph partition algorithm spend time 2.9305026531219482
5534
5501
time for parepare:  0.024046897888183594
local_output_nid generation:  0.0008525848388671875
local_in_edges_tensor generation:  0.00146484375
mini_batch_src_global generation:  0.006077289581298828
r_  generation:  0.025157690048217773
local_output_nid generation:  0.0011103153228759766
local_in_edges_tensor generation:  0.0013370513916015625
mini_batch_src_global generation:  0.0023500919342041016
r_  generation:  0.02013540267944336
----------------------check_connections_block total spend ----------------------------- 0.09687232971191406
generate_one_block  0.04064583778381348
generate_one_block  0.028766632080078125
time for parepare:  0.022037982940673828
local_output_nid generation:  0.005068540573120117
local_in_edges_tensor generation:  0.007586002349853516
mini_batch_src_global generation:  0.009680747985839844
r_  generation:  0.10666608810424805
local_output_nid generation:  0.005696773529052734
local_in_edges_tensor generation:  0.005709648132324219
mini_batch_src_global generation:  0.008319854736328125
r_  generation:  0.07773804664611816
----------------------check_connections_block total spend ----------------------------- 0.29190635681152344
generate_one_block  0.14997577667236328
generate_one_block  0.10632824897766113
----------===============-------------===============-------------the number of batches *****---- 9

original number of batches:  8
-----------------------------------------after block dataloader generation 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.05088663101196289  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

connection checking time:  1.1238181591033936
block generation total time  0.9263231754302979
average batch blocks generation time:  0.11579039692878723
block dataloader generation time/epoch 31.528027534484863
pseudo mini batch 0 input nodes size: 67531
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.043888092041015625  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.043888092041015625  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.07608938217163086  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.07617330551147461  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04421424865722656  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04641246795654297  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04641246795654297  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

first layer input nodes number: 67531
first layer output nodes number: 32681
edges number: 220355
input nodes number: 32681
output nodes number: 11244
edges number: 74598
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.939547538757324  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.9395484924316406  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.051727294921875  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

pseudo mini batch 1 input nodes size: 56517
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.045413970947265625  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.045413970947265625  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.072845458984375  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.07293033599853516  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04064512252807617  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0426182746887207  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0426182746887207  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

first layer input nodes number: 56517
first layer output nodes number: 27197
edges number: 177089
input nodes number: 27197
output nodes number: 11380
edges number: 87562
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.7790703773498535  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.7790708541870117  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.046652793884277344  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

pseudo mini batch 2 input nodes size: 67491
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.040895938873291016  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.040895938873291016  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.07307815551757812  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0731649398803711  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04564857482910156  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.049241065979003906  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.049241065979003906  GigaBytes
Max Memory Allocated: 4.993412017822266  GigaBytes

first layer input nodes number: 67491
first layer output nodes number: 41877
edges number: 341298
input nodes number: 41877
output nodes number: 11587
edges number: 140682
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 4.81506872177124  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 4.815069198608398  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.05535459518432617  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 3 input nodes size: 41668
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04522848129272461  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04522848129272461  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06509733200073242  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06518316268920898  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.032914161682128906  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03455829620361328  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03455829620361328  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 41668
first layer output nodes number: 23451
edges number: 138949
input nodes number: 23451
output nodes number: 11495
edges number: 81583
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.3907971382141113  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.3907976150512695  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.037801265716552734  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 4 input nodes size: 30899
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03293943405151367  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03293943405151367  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04767322540283203  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0477595329284668  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.027804851531982422  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.029021739959716797  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.029021739959716797  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 30899
first layer output nodes number: 19625
edges number: 98618
input nodes number: 19625
output nodes number: 11537
edges number: 64609
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 1.840226173400879  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 1.840226650238037  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03146553039550781  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 5 input nodes size: 33468
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.027750492095947266  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.027750492095947266  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04370927810668945  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.043793678283691406  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.02897357940673828  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03059864044189453  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03059864044189453  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 33468
first layer output nodes number: 19835
edges number: 124830
input nodes number: 19835
output nodes number: 11328
edges number: 93077
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.4287710189819336  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.428771495819092  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03371715545654297  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 6 input nodes size: 35451
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.028953075408935547  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.028953075408935547  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04653120040893555  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0466160774230957  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.030572891235351562  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03219795227050781  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03219795227050781  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 35451
first layer output nodes number: 21177
edges number: 129545
input nodes number: 21177
output nodes number: 11335
edges number: 88395
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.4062914848327637  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.406291961669922  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.03577995300292969  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 7 input nodes size: 65789
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.031005382537841797  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.031005382537841797  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06237602233886719  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06241750717163086  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.0447545051574707  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04807329177856445  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04807329177856445  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 65789
first layer output nodes number: 31606
edges number: 268096
input nodes number: 31606
output nodes number: 5534
edges number: 65321
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 3.1152048110961914  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 3.1152052879333496  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.05096101760864258  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

pseudo mini batch 8 input nodes size: 53091
----------------------------------------before load block subtensor 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04334115982055664  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04334115982055664  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after batch input features to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06865692138671875  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after  batch labels to device
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.06869792938232422  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after load block subtensor  
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.037285804748535156  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------after blocks to device 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.039017677307128906  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

----------------------------------------before batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.039017677307128906  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

first layer input nodes number: 53091
first layer output nodes number: 23997
edges number: 183885
input nodes number: 23997
output nodes number: 5501
edges number: 48423
-----------------------------------------batch_pred = model(blocks, batch_inputs) 
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.214709758758545  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss calculation
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 2.214710235595703  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after loss backward
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04210042953491211  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after optimizer step
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04210042953491211  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

-----------------------------------------after optimizer zero grad
 Nvidia-smi: 6.5009765625 GB
    Memory Allocated: 0.04210042953491211  GigaBytes
Max Memory Allocated: 5.011894702911377  GigaBytes

times | data loading | block to device | model prediction | loss calculation | loss backward |  optimizer step |
      |0.0256908999549018 |0.0024400287204318577 |0.11063430044386122 |0.00011867947048611111 |0.13530686166551378 |0.00640106201171875 |
----------------------------------------------------------pseudo_mini_loss sum 3.791412353515625
Total (block generation + training)time/epoch 34.11787807941437
Training time/epoch 2.5259974002838135
Training time without block to device /epoch 2.5040371417999268
Training time without total dataloading part /epoch 2.2209396362304688
load block tensor time/epoch 0.2312180995941162
block to device time/epoch 0.02196025848388672
input features size transfer per epoch 1.2069940567016602e-06
blocks size to device per epoch 8.046627044677734e-07
 Run 0| Epoch 2 |
Number of nodes for computation during this epoch:  693351
Number of first layer input nodes during this epoch:  451905
Number of first layer output nodes during this epoch:  241446
GraphSAGE(
  (layers): ModuleList(
    (0): SAGEConv(
      (lstm): LSTM(128, 128, batch_first=True)
      (fc_self): Linear(in_features=128, out_features=256, bias=False)
      (fc_neigh): Linear(in_features=128, out_features=256, bias=False)
    )
    (1): SAGEConv(
      (lstm): LSTM(256, 256, batch_first=True)
      (fc_self): Linear(in_features=256, out_features=40, bias=False)
      (fc_neigh): Linear(in_features=256, out_features=40, bias=False)
    )
  )
  (bns): ModuleList(
    (0): BatchNorm1d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
  (dropout): Dropout(p=0.5, inplace=False)
)
total model parameters size Using backend: pytorch
 744960
trainable parameters
layers.0.lstm.weight_ih_l0, torch.Size([512, 128])
layers.0.lstm.weight_hh_l0, torch.Size([512, 128])
layers.0.lstm.bias_ih_l0, torch.Size([512])
layers.0.lstm.bias_hh_l0, torch.Size([512])
layers.0.fc_self.weight, torch.Size([256, 128])
layers.0.fc_neigh.weight, torch.Size([256, 128])
layers.1.lstm.weight_ih_l0, torch.Size([1024, 256])
layers.1.lstm.weight_hh_l0, torch.Size([1024, 256])
layers.1.lstm.bias_ih_l0, torch.Size([1024])
layers.1.lstm.bias_hh_l0, torch.Size([1024])
layers.1.fc_self.weight, torch.Size([40, 256])
layers.1.fc_neigh.weight, torch.Size([40, 256])
bns.0.weight, torch.Size([256])
bns.0.bias, torch.Size([256])
----------------------------------------
un-trainable parameters
